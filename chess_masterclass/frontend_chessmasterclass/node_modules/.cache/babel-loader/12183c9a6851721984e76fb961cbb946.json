{"ast":null,"code":"import _objectWithoutProperties2 from \"C:/Users/tomas/Desktop/chess-masterclass/backend/chess_masterclass/frontend_chessmasterclass/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";\nimport _objectSpread2 from \"C:/Users/tomas/Desktop/chess-masterclass/backend/chess_masterclass/frontend_chessmasterclass/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _defineProperty2 from \"C:/Users/tomas/Desktop/chess-masterclass/backend/chess_masterclass/frontend_chessmasterclass/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _toConsumableArray from \"C:/Users/tomas/Desktop/chess-masterclass/backend/chess_masterclass/frontend_chessmasterclass/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _slicedToArray from \"C:/Users/tomas/Desktop/chess-masterclass/backend/chess_masterclass/frontend_chessmasterclass/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _classCallCheck from \"C:/Users/tomas/Desktop/chess-masterclass/backend/chess_masterclass/frontend_chessmasterclass/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/tomas/Desktop/chess-masterclass/backend/chess_masterclass/frontend_chessmasterclass/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nvar _excluded = [\"customDndBackend\", \"customDndBackendOptions\"];\n\nvar _nativeTypesConfig, _eventNames;\n\nimport React, { createContext, memo, useEffect, useLayoutEffect, useState, useCallback, useMemo, isValidElement, cloneElement, useContext, forwardRef, useRef, useImperativeHandle, Fragment as Fragment$1 } from 'react';\nimport { jsx, jsxs, Fragment } from 'react/jsx-runtime';\n/**\n * Create the React Context\n */\n\nvar DndContext = /*#__PURE__*/createContext({\n  dragDropManager: undefined\n});\n/**\n * Adapted from React: https://github.com/facebook/react/blob/master/packages/shared/formatProdErrorMessage.js\n *\n * Do not require this module directly! Use normal throw error calls. These messages will be replaced with error codes\n * during build.\n * @param {number} code\n */\n\nfunction formatProdErrorMessage(code) {\n  return \"Minified Redux error #\" + code + \"; visit https://redux.js.org/Errors?code=\" + code + \" for the full message or \" + 'use the non-minified dev environment for full errors. ';\n} // Inlined version of the `symbol-observable` polyfill\n\n\nvar $$observable = function () {\n  return typeof Symbol === 'function' && Symbol.observable || '@@observable';\n}();\n/**\n * These are private action types reserved by Redux.\n * For any unknown actions, you must return the current state.\n * If the current state is undefined, you must return the initial state.\n * Do not reference these action types directly in your code.\n */\n\n\nvar randomString = function randomString() {\n  return Math.random().toString(36).substring(7).split('').join('.');\n};\n\nvar ActionTypes = {\n  INIT: \"@@redux/INIT\" + randomString(),\n  REPLACE: \"@@redux/REPLACE\" + randomString(),\n  PROBE_UNKNOWN_ACTION: function PROBE_UNKNOWN_ACTION() {\n    return \"@@redux/PROBE_UNKNOWN_ACTION\" + randomString();\n  }\n};\n/**\n * @param {any} obj The object to inspect.\n * @returns {boolean} True if the argument appears to be a plain object.\n */\n\nfunction isPlainObject(obj) {\n  if (typeof obj !== 'object' || obj === null) return false;\n  var proto = obj;\n\n  while (Object.getPrototypeOf(proto) !== null) {\n    proto = Object.getPrototypeOf(proto);\n  }\n\n  return Object.getPrototypeOf(obj) === proto;\n} // Inlined / shortened version of `kindOf` from https://github.com/jonschlinkert/kind-of\n\n\nfunction miniKindOf(val) {\n  if (val === void 0) return 'undefined';\n  if (val === null) return 'null';\n  var type = typeof val;\n\n  switch (type) {\n    case 'boolean':\n    case 'string':\n    case 'number':\n    case 'symbol':\n    case 'function':\n      {\n        return type;\n      }\n  }\n\n  if (Array.isArray(val)) return 'array';\n  if (isDate(val)) return 'date';\n  if (isError(val)) return 'error';\n  var constructorName = ctorName(val);\n\n  switch (constructorName) {\n    case 'Symbol':\n    case 'Promise':\n    case 'WeakMap':\n    case 'WeakSet':\n    case 'Map':\n    case 'Set':\n      return constructorName;\n  } // other\n\n\n  return type.slice(8, -1).toLowerCase().replace(/\\s/g, '');\n}\n\nfunction ctorName(val) {\n  return typeof val.constructor === 'function' ? val.constructor.name : null;\n}\n\nfunction isError(val) {\n  return val instanceof Error || typeof val.message === 'string' && val.constructor && typeof val.constructor.stackTraceLimit === 'number';\n}\n\nfunction isDate(val) {\n  if (val instanceof Date) return true;\n  return typeof val.toDateString === 'function' && typeof val.getDate === 'function' && typeof val.setDate === 'function';\n}\n\nfunction kindOf(val) {\n  var typeOfVal = typeof val;\n\n  if (process.env.NODE_ENV !== 'production') {\n    typeOfVal = miniKindOf(val);\n  }\n\n  return typeOfVal;\n}\n/**\n * @deprecated\n *\n * **We recommend using the `configureStore` method\n * of the `@reduxjs/toolkit` package**, which replaces `createStore`.\n *\n * Redux Toolkit is our recommended approach for writing Redux logic today,\n * including store setup, reducers, data fetching, and more.\n *\n * **For more details, please read this Redux docs page:**\n * **https://redux.js.org/introduction/why-rtk-is-redux-today**\n *\n * `configureStore` from Redux Toolkit is an improved version of `createStore` that\n * simplifies setup and helps avoid common bugs.\n *\n * You should not be using the `redux` core package by itself today, except for learning purposes.\n * The `createStore` method from the core `redux` package will not be removed, but we encourage\n * all users to migrate to using Redux Toolkit for all Redux code.\n *\n * If you want to use `createStore` without this visual deprecation warning, use\n * the `legacy_createStore` import instead:\n *\n * `import { legacy_createStore as createStore} from 'redux'`\n *\n */\n\n\nfunction createStore(reducer, preloadedState, enhancer) {\n  var _ref2;\n\n  if (typeof preloadedState === 'function' && typeof enhancer === 'function' || typeof enhancer === 'function' && typeof arguments[3] === 'function') {\n    throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(0) : 'It looks like you are passing several store enhancers to ' + 'createStore(). This is not supported. Instead, compose them ' + 'together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.');\n  }\n\n  if (typeof preloadedState === 'function' && typeof enhancer === 'undefined') {\n    enhancer = preloadedState;\n    preloadedState = undefined;\n  }\n\n  if (typeof enhancer !== 'undefined') {\n    if (typeof enhancer !== 'function') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(1) : \"Expected the enhancer to be a function. Instead, received: '\" + kindOf(enhancer) + \"'\");\n    }\n\n    return enhancer(createStore)(reducer, preloadedState);\n  }\n\n  if (typeof reducer !== 'function') {\n    throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(2) : \"Expected the root reducer to be a function. Instead, received: '\" + kindOf(reducer) + \"'\");\n  }\n\n  var currentReducer = reducer;\n  var currentState = preloadedState;\n  var currentListeners = [];\n  var nextListeners = currentListeners;\n  var isDispatching = false;\n  /**\n   * This makes a shallow copy of currentListeners so we can use\n   * nextListeners as a temporary list while dispatching.\n   *\n   * This prevents any bugs around consumers calling\n   * subscribe/unsubscribe in the middle of a dispatch.\n   */\n\n  function ensureCanMutateNextListeners() {\n    if (nextListeners === currentListeners) {\n      nextListeners = currentListeners.slice();\n    }\n  }\n  /**\n   * Reads the state tree managed by the store.\n   *\n   * @returns {any} The current state tree of your application.\n   */\n\n\n  function getState() {\n    if (isDispatching) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(3) : 'You may not call store.getState() while the reducer is executing. ' + 'The reducer has already received the state as an argument. ' + 'Pass it down from the top reducer instead of reading it from the store.');\n    }\n\n    return currentState;\n  }\n  /**\n   * Adds a change listener. It will be called any time an action is dispatched,\n   * and some part of the state tree may potentially have changed. You may then\n   * call `getState()` to read the current state tree inside the callback.\n   *\n   * You may call `dispatch()` from a change listener, with the following\n   * caveats:\n   *\n   * 1. The subscriptions are snapshotted just before every `dispatch()` call.\n   * If you subscribe or unsubscribe while the listeners are being invoked, this\n   * will not have any effect on the `dispatch()` that is currently in progress.\n   * However, the next `dispatch()` call, whether nested or not, will use a more\n   * recent snapshot of the subscription list.\n   *\n   * 2. The listener should not expect to see all state changes, as the state\n   * might have been updated multiple times during a nested `dispatch()` before\n   * the listener is called. It is, however, guaranteed that all subscribers\n   * registered before the `dispatch()` started will be called with the latest\n   * state by the time it exits.\n   *\n   * @param {Function} listener A callback to be invoked on every dispatch.\n   * @returns {Function} A function to remove this change listener.\n   */\n\n\n  function subscribe(listener) {\n    if (typeof listener !== 'function') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(4) : \"Expected the listener to be a function. Instead, received: '\" + kindOf(listener) + \"'\");\n    }\n\n    if (isDispatching) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(5) : 'You may not call store.subscribe() while the reducer is executing. ' + 'If you would like to be notified after the store has been updated, subscribe from a ' + 'component and invoke store.getState() in the callback to access the latest state. ' + 'See https://redux.js.org/api/store#subscribelistener for more details.');\n    }\n\n    var isSubscribed = true;\n    ensureCanMutateNextListeners();\n    nextListeners.push(listener);\n    return function unsubscribe() {\n      if (!isSubscribed) {\n        return;\n      }\n\n      if (isDispatching) {\n        throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(6) : 'You may not unsubscribe from a store listener while the reducer is executing. ' + 'See https://redux.js.org/api/store#subscribelistener for more details.');\n      }\n\n      isSubscribed = false;\n      ensureCanMutateNextListeners();\n      var index = nextListeners.indexOf(listener);\n      nextListeners.splice(index, 1);\n      currentListeners = null;\n    };\n  }\n  /**\n   * Dispatches an action. It is the only way to trigger a state change.\n   *\n   * The `reducer` function, used to create the store, will be called with the\n   * current state tree and the given `action`. Its return value will\n   * be considered the **next** state of the tree, and the change listeners\n   * will be notified.\n   *\n   * The base implementation only supports plain object actions. If you want to\n   * dispatch a Promise, an Observable, a thunk, or something else, you need to\n   * wrap your store creating function into the corresponding middleware. For\n   * example, see the documentation for the `redux-thunk` package. Even the\n   * middleware will eventually dispatch plain object actions using this method.\n   *\n   * @param {Object} action A plain object representing “what changed”. It is\n   * a good idea to keep actions serializable so you can record and replay user\n   * sessions, or use the time travelling `redux-devtools`. An action must have\n   * a `type` property which may not be `undefined`. It is a good idea to use\n   * string constants for action types.\n   *\n   * @returns {Object} For convenience, the same action object you dispatched.\n   *\n   * Note that, if you use a custom middleware, it may wrap `dispatch()` to\n   * return something else (for example, a Promise you can await).\n   */\n\n\n  function dispatch(action) {\n    if (!isPlainObject(action)) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(7) : \"Actions must be plain objects. Instead, the actual type was: '\" + kindOf(action) + \"'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.\");\n    }\n\n    if (typeof action.type === 'undefined') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(8) : 'Actions may not have an undefined \"type\" property. You may have misspelled an action type string constant.');\n    }\n\n    if (isDispatching) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(9) : 'Reducers may not dispatch actions.');\n    }\n\n    try {\n      isDispatching = true;\n      currentState = currentReducer(currentState, action);\n    } finally {\n      isDispatching = false;\n    }\n\n    var listeners = currentListeners = nextListeners;\n\n    for (var i = 0; i < listeners.length; i++) {\n      var listener = listeners[i];\n      listener();\n    }\n\n    return action;\n  }\n  /**\n   * Replaces the reducer currently used by the store to calculate the state.\n   *\n   * You might need this if your app implements code splitting and you want to\n   * load some of the reducers dynamically. You might also need this if you\n   * implement a hot reloading mechanism for Redux.\n   *\n   * @param {Function} nextReducer The reducer for the store to use instead.\n   * @returns {void}\n   */\n\n\n  function replaceReducer(nextReducer) {\n    if (typeof nextReducer !== 'function') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(10) : \"Expected the nextReducer to be a function. Instead, received: '\" + kindOf(nextReducer));\n    }\n\n    currentReducer = nextReducer; // This action has a similiar effect to ActionTypes.INIT.\n    // Any reducers that existed in both the new and old rootReducer\n    // will receive the previous state. This effectively populates\n    // the new state tree with any relevant data from the old one.\n\n    dispatch({\n      type: ActionTypes.REPLACE\n    });\n  }\n  /**\n   * Interoperability point for observable/reactive libraries.\n   * @returns {observable} A minimal observable of state changes.\n   * For more information, see the observable proposal:\n   * https://github.com/tc39/proposal-observable\n   */\n\n\n  function observable() {\n    var _ref;\n\n    var outerSubscribe = subscribe;\n    return _ref = {\n      /**\n       * The minimal observable subscription method.\n       * @param {Object} observer Any object that can be used as an observer.\n       * The observer object should have a `next` method.\n       * @returns {subscription} An object with an `unsubscribe` method that can\n       * be used to unsubscribe the observable from the store, and prevent further\n       * emission of values from the observable.\n       */\n      subscribe: function subscribe(observer) {\n        if (typeof observer !== 'object' || observer === null) {\n          throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(11) : \"Expected the observer to be an object. Instead, received: '\" + kindOf(observer) + \"'\");\n        }\n\n        function observeState() {\n          if (observer.next) {\n            observer.next(getState());\n          }\n        }\n\n        observeState();\n        var unsubscribe = outerSubscribe(observeState);\n        return {\n          unsubscribe: unsubscribe\n        };\n      }\n    }, _ref[$$observable] = function () {\n      return this;\n    }, _ref;\n  } // When a store is created, an \"INIT\" action is dispatched so that every\n  // reducer returns their initial state. This effectively populates\n  // the initial state tree.\n\n\n  dispatch({\n    type: ActionTypes.INIT\n  });\n  return _ref2 = {\n    dispatch: dispatch,\n    subscribe: subscribe,\n    getState: getState,\n    replaceReducer: replaceReducer\n  }, _ref2[$$observable] = observable, _ref2;\n}\n/**\n * Prints a warning in the console if it exists.\n *\n * @param {String} message The warning message.\n * @returns {void}\n */\n\n\nfunction warning(message) {\n  /* eslint-disable no-console */\n  if (typeof console !== 'undefined' && typeof console.error === 'function') {\n    console.error(message);\n  }\n  /* eslint-enable no-console */\n\n\n  try {\n    // This error was thrown as a convenience so that if you enable\n    // \"break on all exceptions\" in your console,\n    // it would pause the execution at this line.\n    throw new Error(message);\n  } catch (e) {} // eslint-disable-line no-empty\n\n}\n/*\n * This is a dummy function to check if the function name has been altered by minification.\n * If the function has been minified and NODE_ENV !== 'production', warn the user.\n */\n\n\nfunction isCrushed() {}\n\nif (process.env.NODE_ENV !== 'production' && typeof isCrushed.name === 'string' && isCrushed.name !== 'isCrushed') {\n  warning('You are currently using minified code outside of NODE_ENV === \"production\". ' + 'This means that you are running a slower development build of Redux. ' + 'You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify ' + 'or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) ' + 'to ensure you have the correct code for your production build.');\n}\n/**\n * Use invariant() to assert state which your program assumes to be true.\n *\n * Provide sprintf-style format (only %s is supported) and arguments\n * to provide information about what broke and what you were\n * expecting.\n *\n * The invariant message will be stripped in production, but the invariant\n * will remain to ensure logic does not differ in production.\n */\n\n\nfunction invariant(condition, format) {\n  for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n    args[_key - 2] = arguments[_key];\n  }\n\n  if (isProduction()) {\n    if (format === undefined) {\n      throw new Error('invariant requires an error message argument');\n    }\n  }\n\n  if (!condition) {\n    var error;\n\n    if (format === undefined) {\n      error = new Error('Minified exception occurred; use the non-minified dev environment ' + 'for the full error message and additional helpful warnings.');\n    } else {\n      var argIndex = 0;\n      error = new Error(format.replace(/%s/g, function () {\n        return args[argIndex++];\n      }));\n      error.name = 'Invariant Violation';\n    }\n\n    error.framesToPop = 1 // we don't care about invariant's own frame\n    ;\n    throw error;\n  }\n}\n\nfunction isProduction() {\n  return typeof process !== 'undefined' && process.env['NODE_ENV'] === 'production';\n} // cheap lodash replacements\n\n/**\n * drop-in replacement for _.get\n * @param obj\n * @param path\n * @param defaultValue\n */\n\n\nfunction get(obj, path, defaultValue) {\n  return path.split('.').reduce(function (a, c) {\n    return a && a[c] ? a[c] : defaultValue || null;\n  }, obj);\n}\n/**\n * drop-in replacement for _.without\n */\n\n\nfunction without$1(items, item) {\n  return items.filter(function (i) {\n    return i !== item;\n  });\n}\n/**\n * drop-in replacement for _.isString\n * @param input\n */\n\n\nfunction isObject(input) {\n  return typeof input === 'object';\n}\n/**\n * replacement for _.xor\n * @param itemsA\n * @param itemsB\n */\n\n\nfunction xor(itemsA, itemsB) {\n  var map = new Map();\n\n  var insertItem = function insertItem(item) {\n    map.set(item, map.has(item) ? map.get(item) + 1 : 1);\n  };\n\n  itemsA.forEach(insertItem);\n  itemsB.forEach(insertItem);\n  var result = [];\n  map.forEach(function (count, key) {\n    if (count === 1) {\n      result.push(key);\n    }\n  });\n  return result;\n}\n/**\n * replacement for _.intersection\n * @param itemsA\n * @param itemsB\n */\n\n\nfunction intersection(itemsA, itemsB) {\n  return itemsA.filter(function (t) {\n    return itemsB.indexOf(t) > -1;\n  });\n}\n\nvar INIT_COORDS = 'dnd-core/INIT_COORDS';\nvar BEGIN_DRAG = 'dnd-core/BEGIN_DRAG';\nvar PUBLISH_DRAG_SOURCE = 'dnd-core/PUBLISH_DRAG_SOURCE';\nvar HOVER = 'dnd-core/HOVER';\nvar DROP = 'dnd-core/DROP';\nvar END_DRAG = 'dnd-core/END_DRAG';\n\nfunction setClientOffset(clientOffset, sourceClientOffset) {\n  return {\n    type: INIT_COORDS,\n    payload: {\n      sourceClientOffset: sourceClientOffset || null,\n      clientOffset: clientOffset || null\n    }\n  };\n}\n\nvar ResetCoordinatesAction = {\n  type: INIT_COORDS,\n  payload: {\n    clientOffset: null,\n    sourceClientOffset: null\n  }\n};\n\nfunction createBeginDrag(manager) {\n  return function beginDrag() {\n    var sourceIds = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      publishSource: true\n    };\n    var _options$publishSourc = options.publishSource,\n        publishSource = _options$publishSourc === void 0 ? true : _options$publishSourc,\n        clientOffset = options.clientOffset,\n        getSourceClientOffset = options.getSourceClientOffset;\n    var monitor = manager.getMonitor();\n    var registry = manager.getRegistry(); // Initialize the coordinates using the client offset\n\n    manager.dispatch(setClientOffset(clientOffset));\n    verifyInvariants$1(sourceIds, monitor, registry); // Get the draggable source\n\n    var sourceId = getDraggableSource(sourceIds, monitor);\n\n    if (sourceId == null) {\n      manager.dispatch(ResetCoordinatesAction);\n      return;\n    } // Get the source client offset\n\n\n    var sourceClientOffset = null;\n\n    if (clientOffset) {\n      if (!getSourceClientOffset) {\n        throw new Error('getSourceClientOffset must be defined');\n      }\n\n      verifyGetSourceClientOffsetIsFunction(getSourceClientOffset);\n      sourceClientOffset = getSourceClientOffset(sourceId);\n    } // Initialize the full coordinates\n\n\n    manager.dispatch(setClientOffset(clientOffset, sourceClientOffset));\n    var source = registry.getSource(sourceId);\n    var item = source.beginDrag(monitor, sourceId); // If source.beginDrag returns null, this is an indicator to cancel the drag\n\n    if (item == null) {\n      return undefined;\n    }\n\n    verifyItemIsObject(item);\n    registry.pinSource(sourceId);\n    var itemType = registry.getSourceType(sourceId);\n    return {\n      type: BEGIN_DRAG,\n      payload: {\n        itemType: itemType,\n        item: item,\n        sourceId: sourceId,\n        clientOffset: clientOffset || null,\n        sourceClientOffset: sourceClientOffset || null,\n        isSourcePublic: !!publishSource\n      }\n    };\n  };\n}\n\nfunction verifyInvariants$1(sourceIds, monitor, registry) {\n  invariant(!monitor.isDragging(), 'Cannot call beginDrag while dragging.');\n  sourceIds.forEach(function (sourceId) {\n    invariant(registry.getSource(sourceId), 'Expected sourceIds to be registered.');\n  });\n}\n\nfunction verifyGetSourceClientOffsetIsFunction(getSourceClientOffset) {\n  invariant(typeof getSourceClientOffset === 'function', 'When clientOffset is provided, getSourceClientOffset must be a function.');\n}\n\nfunction verifyItemIsObject(item) {\n  invariant(isObject(item), 'Item must be an object.');\n}\n\nfunction getDraggableSource(sourceIds, monitor) {\n  var sourceId = null;\n\n  for (var i = sourceIds.length - 1; i >= 0; i--) {\n    if (monitor.canDragSource(sourceIds[i])) {\n      sourceId = sourceIds[i];\n      break;\n    }\n  }\n\n  return sourceId;\n}\n\nfunction _defineProperty$4(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread$4(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty$4(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction createDrop(manager) {\n  return function drop() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var monitor = manager.getMonitor();\n    var registry = manager.getRegistry();\n    verifyInvariants(monitor);\n    var targetIds = getDroppableTargets(monitor); // Multiple actions are dispatched here, which is why this doesn't return an action\n\n    targetIds.forEach(function (targetId, index) {\n      var dropResult = determineDropResult(targetId, index, registry, monitor);\n      var action = {\n        type: DROP,\n        payload: {\n          dropResult: _objectSpread$4({}, options, dropResult)\n        }\n      };\n      manager.dispatch(action);\n    });\n  };\n}\n\nfunction verifyInvariants(monitor) {\n  invariant(monitor.isDragging(), 'Cannot call drop while not dragging.');\n  invariant(!monitor.didDrop(), 'Cannot call drop twice during one drag operation.');\n}\n\nfunction determineDropResult(targetId, index, registry, monitor) {\n  var target = registry.getTarget(targetId);\n  var dropResult = target ? target.drop(monitor, targetId) : undefined;\n  verifyDropResultType(dropResult);\n\n  if (typeof dropResult === 'undefined') {\n    dropResult = index === 0 ? {} : monitor.getDropResult();\n  }\n\n  return dropResult;\n}\n\nfunction verifyDropResultType(dropResult) {\n  invariant(typeof dropResult === 'undefined' || isObject(dropResult), 'Drop result must either be an object or undefined.');\n}\n\nfunction getDroppableTargets(monitor) {\n  var targetIds = monitor.getTargetIds().filter(monitor.canDropOnTarget, monitor);\n  targetIds.reverse();\n  return targetIds;\n}\n\nfunction createEndDrag(manager) {\n  return function endDrag() {\n    var monitor = manager.getMonitor();\n    var registry = manager.getRegistry();\n    verifyIsDragging(monitor);\n    var sourceId = monitor.getSourceId();\n\n    if (sourceId != null) {\n      var source = registry.getSource(sourceId, true);\n      source.endDrag(monitor, sourceId);\n      registry.unpinSource();\n    }\n\n    return {\n      type: END_DRAG\n    };\n  };\n}\n\nfunction verifyIsDragging(monitor) {\n  invariant(monitor.isDragging(), 'Cannot call endDrag while not dragging.');\n}\n\nfunction matchesType(targetType, draggedItemType) {\n  if (draggedItemType === null) {\n    return targetType === null;\n  }\n\n  return Array.isArray(targetType) ? targetType.some(function (t) {\n    return t === draggedItemType;\n  }) : targetType === draggedItemType;\n}\n\nfunction createHover(manager) {\n  return function hover(targetIdsArg) {\n    var _ref3 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n        clientOffset = _ref3.clientOffset;\n\n    verifyTargetIdsIsArray(targetIdsArg);\n    var targetIds = targetIdsArg.slice(0);\n    var monitor = manager.getMonitor();\n    var registry = manager.getRegistry();\n    var draggedItemType = monitor.getItemType();\n    removeNonMatchingTargetIds(targetIds, registry, draggedItemType);\n    checkInvariants(targetIds, monitor, registry);\n    hoverAllTargets(targetIds, monitor, registry);\n    return {\n      type: HOVER,\n      payload: {\n        targetIds: targetIds,\n        clientOffset: clientOffset || null\n      }\n    };\n  };\n}\n\nfunction verifyTargetIdsIsArray(targetIdsArg) {\n  invariant(Array.isArray(targetIdsArg), 'Expected targetIds to be an array.');\n}\n\nfunction checkInvariants(targetIds, monitor, registry) {\n  invariant(monitor.isDragging(), 'Cannot call hover while not dragging.');\n  invariant(!monitor.didDrop(), 'Cannot call hover after drop.');\n\n  for (var i = 0; i < targetIds.length; i++) {\n    var targetId = targetIds[i];\n    invariant(targetIds.lastIndexOf(targetId) === i, 'Expected targetIds to be unique in the passed array.');\n    var target = registry.getTarget(targetId);\n    invariant(target, 'Expected targetIds to be registered.');\n  }\n}\n\nfunction removeNonMatchingTargetIds(targetIds, registry, draggedItemType) {\n  // Remove those targetIds that don't match the targetType.  This\n  // fixes shallow isOver which would only be non-shallow because of\n  // non-matching targets.\n  for (var i = targetIds.length - 1; i >= 0; i--) {\n    var targetId = targetIds[i];\n    var targetType = registry.getTargetType(targetId);\n\n    if (!matchesType(targetType, draggedItemType)) {\n      targetIds.splice(i, 1);\n    }\n  }\n}\n\nfunction hoverAllTargets(targetIds, monitor, registry) {\n  // Finally call hover on all matching targets.\n  targetIds.forEach(function (targetId) {\n    var target = registry.getTarget(targetId);\n    target.hover(monitor, targetId);\n  });\n}\n\nfunction createPublishDragSource(manager) {\n  return function publishDragSource() {\n    var monitor = manager.getMonitor();\n\n    if (monitor.isDragging()) {\n      return {\n        type: PUBLISH_DRAG_SOURCE\n      };\n    }\n\n    return;\n  };\n}\n\nfunction createDragDropActions(manager) {\n  return {\n    beginDrag: createBeginDrag(manager),\n    publishDragSource: createPublishDragSource(manager),\n    hover: createHover(manager),\n    drop: createDrop(manager),\n    endDrag: createEndDrag(manager)\n  };\n}\n\nvar DragDropManagerImpl = /*#__PURE__*/function () {\n  function DragDropManagerImpl(store, monitor) {\n    var _this = this;\n\n    _classCallCheck(this, DragDropManagerImpl);\n\n    this.isSetUp = false;\n\n    this.handleRefCountChange = function () {\n      var shouldSetUp = _this.store.getState().refCount > 0;\n\n      if (_this.backend) {\n        if (shouldSetUp && !_this.isSetUp) {\n          _this.backend.setup();\n\n          _this.isSetUp = true;\n        } else if (!shouldSetUp && _this.isSetUp) {\n          _this.backend.teardown();\n\n          _this.isSetUp = false;\n        }\n      }\n    };\n\n    this.store = store;\n    this.monitor = monitor;\n    store.subscribe(this.handleRefCountChange);\n  }\n\n  _createClass(DragDropManagerImpl, [{\n    key: \"receiveBackend\",\n    value: function receiveBackend(backend) {\n      this.backend = backend;\n    }\n  }, {\n    key: \"getMonitor\",\n    value: function getMonitor() {\n      return this.monitor;\n    }\n  }, {\n    key: \"getBackend\",\n    value: function getBackend() {\n      return this.backend;\n    }\n  }, {\n    key: \"getRegistry\",\n    value: function getRegistry() {\n      return this.monitor.registry;\n    }\n  }, {\n    key: \"getActions\",\n    value: function getActions() {\n      /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n      var manager = this;\n      var dispatch = this.store.dispatch;\n\n      function bindActionCreator(actionCreator) {\n        return function () {\n          for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n            args[_key2] = arguments[_key2];\n          }\n\n          var action = actionCreator.apply(manager, args);\n\n          if (typeof action !== 'undefined') {\n            dispatch(action);\n          }\n        };\n      }\n\n      var actions = createDragDropActions(this);\n      return Object.keys(actions).reduce(function (boundActions, key) {\n        var action = actions[key];\n        boundActions[key] = bindActionCreator(action);\n        return boundActions;\n      }, {});\n    }\n  }, {\n    key: \"dispatch\",\n    value: function dispatch(action) {\n      this.store.dispatch(action);\n    }\n  }]);\n\n  return DragDropManagerImpl;\n}();\n/**\n * Coordinate addition\n * @param a The first coordinate\n * @param b The second coordinate\n */\n\n\nfunction add(a, b) {\n  return {\n    x: a.x + b.x,\n    y: a.y + b.y\n  };\n}\n/**\n * Coordinate subtraction\n * @param a The first coordinate\n * @param b The second coordinate\n */\n\n\nfunction subtract(a, b) {\n  return {\n    x: a.x - b.x,\n    y: a.y - b.y\n  };\n}\n/**\n * Returns the cartesian distance of the drag source component's position, based on its position\n * at the time when the current drag operation has started, and the movement difference.\n *\n * Returns null if no item is being dragged.\n *\n * @param state The offset state to compute from\n */\n\n\nfunction _getSourceClientOffset(state) {\n  var clientOffset = state.clientOffset,\n      initialClientOffset = state.initialClientOffset,\n      initialSourceClientOffset = state.initialSourceClientOffset;\n\n  if (!clientOffset || !initialClientOffset || !initialSourceClientOffset) {\n    return null;\n  }\n\n  return subtract(add(clientOffset, initialSourceClientOffset), initialClientOffset);\n}\n/**\n * Determines the x,y offset between the client offset and the initial client offset\n *\n * @param state The offset state to compute from\n */\n\n\nfunction _getDifferenceFromInitialOffset(state) {\n  var clientOffset = state.clientOffset,\n      initialClientOffset = state.initialClientOffset;\n\n  if (!clientOffset || !initialClientOffset) {\n    return null;\n  }\n\n  return subtract(clientOffset, initialClientOffset);\n}\n\nvar NONE = [];\nvar ALL = [];\nNONE.__IS_NONE__ = true;\nALL.__IS_ALL__ = true;\n/**\n * Determines if the given handler IDs are dirty or not.\n *\n * @param dirtyIds The set of dirty handler ids\n * @param handlerIds The set of handler ids to check\n */\n\nfunction areDirty(dirtyIds, handlerIds) {\n  if (dirtyIds === NONE) {\n    return false;\n  }\n\n  if (dirtyIds === ALL || typeof handlerIds === 'undefined') {\n    return true;\n  }\n\n  var commonIds = intersection(handlerIds, dirtyIds);\n  return commonIds.length > 0;\n}\n\nvar DragDropMonitorImpl = /*#__PURE__*/function () {\n  function DragDropMonitorImpl(store, registry) {\n    _classCallCheck(this, DragDropMonitorImpl);\n\n    this.store = store;\n    this.registry = registry;\n  }\n\n  _createClass(DragDropMonitorImpl, [{\n    key: \"subscribeToStateChange\",\n    value: function subscribeToStateChange(listener) {\n      var _this2 = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var handlerIds = options.handlerIds;\n      invariant(typeof listener === 'function', 'listener must be a function.');\n      invariant(typeof handlerIds === 'undefined' || Array.isArray(handlerIds), 'handlerIds, when specified, must be an array of strings.');\n      var prevStateId = this.store.getState().stateId;\n\n      var handleChange = function handleChange() {\n        var state = _this2.store.getState();\n\n        var currentStateId = state.stateId;\n\n        try {\n          var canSkipListener = currentStateId === prevStateId || currentStateId === prevStateId + 1 && !areDirty(state.dirtyHandlerIds, handlerIds);\n\n          if (!canSkipListener) {\n            listener();\n          }\n        } finally {\n          prevStateId = currentStateId;\n        }\n      };\n\n      return this.store.subscribe(handleChange);\n    }\n  }, {\n    key: \"subscribeToOffsetChange\",\n    value: function subscribeToOffsetChange(listener) {\n      var _this3 = this;\n\n      invariant(typeof listener === 'function', 'listener must be a function.');\n      var previousState = this.store.getState().dragOffset;\n\n      var handleChange = function handleChange() {\n        var nextState = _this3.store.getState().dragOffset;\n\n        if (nextState === previousState) {\n          return;\n        }\n\n        previousState = nextState;\n        listener();\n      };\n\n      return this.store.subscribe(handleChange);\n    }\n  }, {\n    key: \"canDragSource\",\n    value: function canDragSource(sourceId) {\n      if (!sourceId) {\n        return false;\n      }\n\n      var source = this.registry.getSource(sourceId);\n      invariant(source, \"Expected to find a valid source. sourceId=\".concat(sourceId));\n\n      if (this.isDragging()) {\n        return false;\n      }\n\n      return source.canDrag(this, sourceId);\n    }\n  }, {\n    key: \"canDropOnTarget\",\n    value: function canDropOnTarget(targetId) {\n      // undefined on initial render\n      if (!targetId) {\n        return false;\n      }\n\n      var target = this.registry.getTarget(targetId);\n      invariant(target, \"Expected to find a valid target. targetId=\".concat(targetId));\n\n      if (!this.isDragging() || this.didDrop()) {\n        return false;\n      }\n\n      var targetType = this.registry.getTargetType(targetId);\n      var draggedItemType = this.getItemType();\n      return matchesType(targetType, draggedItemType) && target.canDrop(this, targetId);\n    }\n  }, {\n    key: \"isDragging\",\n    value: function isDragging() {\n      return Boolean(this.getItemType());\n    }\n  }, {\n    key: \"isDraggingSource\",\n    value: function isDraggingSource(sourceId) {\n      // undefined on initial render\n      if (!sourceId) {\n        return false;\n      }\n\n      var source = this.registry.getSource(sourceId, true);\n      invariant(source, \"Expected to find a valid source. sourceId=\".concat(sourceId));\n\n      if (!this.isDragging() || !this.isSourcePublic()) {\n        return false;\n      }\n\n      var sourceType = this.registry.getSourceType(sourceId);\n      var draggedItemType = this.getItemType();\n\n      if (sourceType !== draggedItemType) {\n        return false;\n      }\n\n      return source.isDragging(this, sourceId);\n    }\n  }, {\n    key: \"isOverTarget\",\n    value: function isOverTarget(targetId) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        shallow: false\n      };\n\n      // undefined on initial render\n      if (!targetId) {\n        return false;\n      }\n\n      var shallow = options.shallow;\n\n      if (!this.isDragging()) {\n        return false;\n      }\n\n      var targetType = this.registry.getTargetType(targetId);\n      var draggedItemType = this.getItemType();\n\n      if (draggedItemType && !matchesType(targetType, draggedItemType)) {\n        return false;\n      }\n\n      var targetIds = this.getTargetIds();\n\n      if (!targetIds.length) {\n        return false;\n      }\n\n      var index = targetIds.indexOf(targetId);\n\n      if (shallow) {\n        return index === targetIds.length - 1;\n      } else {\n        return index > -1;\n      }\n    }\n  }, {\n    key: \"getItemType\",\n    value: function getItemType() {\n      return this.store.getState().dragOperation.itemType;\n    }\n  }, {\n    key: \"getItem\",\n    value: function getItem() {\n      return this.store.getState().dragOperation.item;\n    }\n  }, {\n    key: \"getSourceId\",\n    value: function getSourceId() {\n      return this.store.getState().dragOperation.sourceId;\n    }\n  }, {\n    key: \"getTargetIds\",\n    value: function getTargetIds() {\n      return this.store.getState().dragOperation.targetIds;\n    }\n  }, {\n    key: \"getDropResult\",\n    value: function getDropResult() {\n      return this.store.getState().dragOperation.dropResult;\n    }\n  }, {\n    key: \"didDrop\",\n    value: function didDrop() {\n      return this.store.getState().dragOperation.didDrop;\n    }\n  }, {\n    key: \"isSourcePublic\",\n    value: function isSourcePublic() {\n      return Boolean(this.store.getState().dragOperation.isSourcePublic);\n    }\n  }, {\n    key: \"getInitialClientOffset\",\n    value: function getInitialClientOffset() {\n      return this.store.getState().dragOffset.initialClientOffset;\n    }\n  }, {\n    key: \"getInitialSourceClientOffset\",\n    value: function getInitialSourceClientOffset() {\n      return this.store.getState().dragOffset.initialSourceClientOffset;\n    }\n  }, {\n    key: \"getClientOffset\",\n    value: function getClientOffset() {\n      return this.store.getState().dragOffset.clientOffset;\n    }\n  }, {\n    key: \"getSourceClientOffset\",\n    value: function getSourceClientOffset() {\n      return _getSourceClientOffset(this.store.getState().dragOffset);\n    }\n  }, {\n    key: \"getDifferenceFromInitialOffset\",\n    value: function getDifferenceFromInitialOffset() {\n      return _getDifferenceFromInitialOffset(this.store.getState().dragOffset);\n    }\n  }]);\n\n  return DragDropMonitorImpl;\n}(); // Safari 6 and 6.1 for desktop, iPad, and iPhone are the only browsers that\n// have WebKitMutationObserver but not un-prefixed MutationObserver.\n// Must use `global` or `self` instead of `window` to work in both frames and web\n// workers. `global` is a provision of Browserify, Mr, Mrs, or Mop.\n\n/* globals self */\n\n\nvar scope = typeof global !== 'undefined' ? global : self;\nvar BrowserMutationObserver = scope.MutationObserver || scope.WebKitMutationObserver;\n\nfunction makeRequestCallFromTimer(callback) {\n  return function requestCall() {\n    // We dispatch a timeout with a specified delay of 0 for engines that\n    // can reliably accommodate that request. This will usually be snapped\n    // to a 4 milisecond delay, but once we're flushing, there's no delay\n    // between events.\n    var timeoutHandle = setTimeout(handleTimer, 0); // However, since this timer gets frequently dropped in Firefox\n    // workers, we enlist an interval handle that will try to fire\n    // an event 20 times per second until it succeeds.\n\n    var intervalHandle = setInterval(handleTimer, 50);\n\n    function handleTimer() {\n      // Whichever timer succeeds will cancel both timers and\n      // execute the callback.\n      clearTimeout(timeoutHandle);\n      clearInterval(intervalHandle);\n      callback();\n    }\n  };\n} // To request a high priority event, we induce a mutation observer by toggling\n// the text of a text node between \"1\" and \"-1\".\n\n\nfunction makeRequestCallFromMutationObserver(callback) {\n  var toggle = 1;\n  var observer = new BrowserMutationObserver(callback);\n  var node = document.createTextNode('');\n  observer.observe(node, {\n    characterData: true\n  });\n  return function requestCall() {\n    toggle = -toggle;\n    node.data = toggle;\n  };\n}\n\nvar makeRequestCall = typeof BrowserMutationObserver === 'function' ? // reliably everywhere they are implemented.\n// They are implemented in all modern browsers.\n//\n// - Android 4-4.3\n// - Chrome 26-34\n// - Firefox 14-29\n// - Internet Explorer 11\n// - iPad Safari 6-7.1\n// - iPhone Safari 7-7.1\n// - Safari 6-7\nmakeRequestCallFromMutationObserver : // task queue, are implemented in Internet Explorer 10, Safari 5.0-1, and Opera\n// 11-12, and in web workers in many engines.\n// Although message channels yield to any queued rendering and IO tasks, they\n// would be better than imposing the 4ms delay of timers.\n// However, they do not work reliably in Internet Explorer or Safari.\n// Internet Explorer 10 is the only browser that has setImmediate but does\n// not have MutationObservers.\n// Although setImmediate yields to the browser's renderer, it would be\n// preferrable to falling back to setTimeout since it does not have\n// the minimum 4ms penalty.\n// Unfortunately there appears to be a bug in Internet Explorer 10 Mobile (and\n// Desktop to a lesser extent) that renders both setImmediate and\n// MessageChannel useless for the purposes of ASAP.\n// https://github.com/kriskowal/q/issues/396\n// Timers are implemented universally.\n// We fall back to timers in workers in most engines, and in foreground\n// contexts in the following browsers.\n// However, note that even this simple case requires nuances to operate in a\n// broad spectrum of browsers.\n//\n// - Firefox 3-13\n// - Internet Explorer 6-9\n// - iPad Safari 4.3\n// - Lynx 2.8.7\nmakeRequestCallFromTimer;\n/* eslint-disable no-restricted-globals, @typescript-eslint/ban-ts-comment, @typescript-eslint/no-unused-vars, @typescript-eslint/no-non-null-assertion */\n\nvar AsapQueue = /*#__PURE__*/function () {\n  function AsapQueue() {\n    var _this4 = this;\n\n    _classCallCheck(this, AsapQueue);\n\n    this.queue = []; // We queue errors to ensure they are thrown in right order (FIFO).\n    // Array-as-queue is good enough here, since we are just dealing with exceptions.\n\n    this.pendingErrors = []; // Once a flush has been requested, no further calls to `requestFlush` are\n    // necessary until the next `flush` completes.\n    // @ts-ignore\n\n    this.flushing = false; // The position of the next task to execute in the task queue. This is\n    // preserved between calls to `flush` so that it can be resumed if\n    // a task throws an exception.\n\n    this.index = 0; // If a task schedules additional tasks recursively, the task queue can grow\n    // unbounded. To prevent memory exhaustion, the task queue will periodically\n    // truncate already-completed tasks.\n\n    this.capacity = 1024; // The flush function processes all tasks that have been scheduled with\n    // `rawAsap` unless and until one of those tasks throws an exception.\n    // If a task throws an exception, `flush` ensures that its state will remain\n    // consistent and will resume where it left off when called again.\n    // However, `flush` does not make any arrangements to be called again if an\n    // exception is thrown.\n\n    this.flush = function () {\n      var q = _this4.queue;\n\n      while (_this4.index < q.length) {\n        var currentIndex = _this4.index; // Advance the index before calling the task. This ensures that we will\n        // begin flushing on the next task the task throws an error.\n\n        _this4.index++;\n        q[currentIndex].call(); // Prevent leaking memory for long chains of recursive calls to `asap`.\n        // If we call `asap` within tasks scheduled by `asap`, the queue will\n        // grow, but to avoid an O(n) walk for every task we execute, we don't\n        // shift tasks off the queue after they have been executed.\n        // Instead, we periodically shift 1024 tasks off the queue.\n\n        if (_this4.index > _this4.capacity) {\n          // Manually shift all values starting at the index back to the\n          // beginning of the queue.\n          for (var scan = 0, newLength = q.length - _this4.index; scan < newLength; scan++) {\n            q[scan] = q[scan + _this4.index];\n          }\n\n          q.length -= _this4.index;\n          _this4.index = 0;\n        }\n      }\n\n      q.length = 0;\n      _this4.index = 0;\n      _this4.flushing = false;\n    }; // In a web browser, exceptions are not fatal. However, to avoid\n    // slowing down the queue of pending tasks, we rethrow the error in a\n    // lower priority turn.\n\n\n    this.registerPendingError = function (err) {\n      _this4.pendingErrors.push(err);\n\n      _this4.requestErrorThrow();\n    }; // `requestFlush` requests that the high priority event queue be flushed as\n    // soon as possible.\n    // This is useful to prevent an error thrown in a task from stalling the event\n    // queue if the exception handled by Node.js’s\n    // `process.on(\"uncaughtException\")` or by a domain.\n    // `requestFlush` is implemented using a strategy based on data collected from\n    // every available SauceLabs Selenium web driver worker at time of writing.\n    // https://docs.google.com/spreadsheets/d/1mG-5UYGup5qxGdEMWkhP6BWCz053NUb2E1QoUTU16uA/edit#gid=783724593\n\n\n    this.requestFlush = makeRequestCall(this.flush);\n    this.requestErrorThrow = makeRequestCallFromTimer(function () {\n      // Throw first error\n      if (_this4.pendingErrors.length) {\n        throw _this4.pendingErrors.shift();\n      }\n    });\n  }\n\n  _createClass(AsapQueue, [{\n    key: \"enqueueTask\",\n    value: // Use the fastest means possible to execute a task in its own turn, with\n    // priority over other events including IO, animation, reflow, and redraw\n    // events in browsers.\n    //\n    // An exception thrown by a task will permanently interrupt the processing of\n    // subsequent tasks. The higher level `asap` function ensures that if an\n    // exception is thrown by a task, that the task queue will continue flushing as\n    // soon as possible, but if you use `rawAsap` directly, you are responsible to\n    // either ensure that no exceptions are thrown from your task, or to manually\n    // call `rawAsap.requestFlush` if an exception is thrown.\n    function enqueueTask(task) {\n      var q = this.queue,\n          requestFlush = this.requestFlush;\n\n      if (!q.length) {\n        requestFlush();\n        this.flushing = true;\n      } // Equivalent to push, but avoids a function call.\n\n\n      q[q.length] = task;\n    }\n  }]);\n\n  return AsapQueue;\n}(); // The message channel technique was discovered by Malte Ubl and was the\n// original foundation for this library.\n// http://www.nonblocking.io/2011/06/windownexttick.html\n// Safari 6.0.5 (at least) intermittently fails to create message ports on a\n// page's first load. Thankfully, this version of Safari supports\n// MutationObservers, so we don't need to fall back in that case.\n// function makeRequestCallFromMessageChannel(callback) {\n//     var channel = new MessageChannel();\n//     channel.port1.onmessage = callback;\n//     return function requestCall() {\n//         channel.port2.postMessage(0);\n//     };\n// }\n// For reasons explained above, we are also unable to use `setImmediate`\n// under any circumstances.\n// Even if we were, there is another bug in Internet Explorer 10.\n// It is not sufficient to assign `setImmediate` to `requestFlush` because\n// `setImmediate` must be called *by name* and therefore must be wrapped in a\n// closure.\n// Never forget.\n// function makeRequestCallFromSetImmediate(callback) {\n//     return function requestCall() {\n//         setImmediate(callback);\n//     };\n// }\n// Safari 6.0 has a problem where timers will get lost while the user is\n// scrolling. This problem does not impact ASAP because Safari 6.0 supports\n// mutation observers, so that implementation is used instead.\n// However, if we ever elect to use timers in Safari, the prevalent work-around\n// is to add a scroll event listener that calls for a flush.\n// `setTimeout` does not call the passed callback if the delay is less than\n// approximately 7 in web workers in Firefox 8 through 18, and sometimes not\n// even then.\n// This is for `asap.js` only.\n// Its name will be periodically randomized to break any code that depends on\n// // its existence.\n// rawAsap.makeRequestCallFromTimer = makeRequestCallFromTimer\n// ASAP was originally a nextTick shim included in Q. This was factored out\n// into this ASAP package. It was later adapted to RSVP which made further\n// amendments. These decisions, particularly to marginalize MessageChannel and\n// to capture the MutationObserver implementation in a closure, were integrated\n// back into ASAP proper.\n// https://github.com/tildeio/rsvp.js/blob/cddf7232546a9cf858524b75cde6f9edf72620a7/lib/rsvp/asap.js\n// `call`, just like a function.\n\n\nvar RawTask = /*#__PURE__*/function () {\n  function RawTask(onError, release) {\n    _classCallCheck(this, RawTask);\n\n    this.onError = onError;\n    this.release = release;\n    this.task = null;\n  }\n\n  _createClass(RawTask, [{\n    key: \"call\",\n    value: function call() {\n      try {\n        this.task && this.task();\n      } catch (error) {\n        this.onError(error);\n      } finally {\n        this.task = null;\n        this.release(this);\n      }\n    }\n  }]);\n\n  return RawTask;\n}();\n\nvar TaskFactory = /*#__PURE__*/function () {\n  function TaskFactory(onError) {\n    _classCallCheck(this, TaskFactory);\n\n    this.onError = onError;\n    this.freeTasks = [];\n  }\n\n  _createClass(TaskFactory, [{\n    key: \"create\",\n    value: function create(task) {\n      var tasks = this.freeTasks;\n      var t1 = tasks.length ? tasks.pop() : new RawTask(this.onError, function (t) {\n        return tasks[tasks.length] = t;\n      });\n      t1.task = task;\n      return t1;\n    }\n  }]);\n\n  return TaskFactory;\n}();\n\nvar asapQueue = new AsapQueue();\nvar taskFactory = new TaskFactory(asapQueue.registerPendingError);\n/**\n * Calls a task as soon as possible after returning, in its own event, with priority\n * over other events like animation, reflow, and repaint. An error thrown from an\n * event will not interrupt, nor even substantially slow down the processing of\n * other events, but will be rather postponed to a lower priority event.\n * @param {{call}} task A callable object, typically a function that takes no\n * arguments.\n */\n\nfunction asap(task) {\n  asapQueue.enqueueTask(taskFactory.create(task));\n}\n\nvar ADD_SOURCE = 'dnd-core/ADD_SOURCE';\nvar ADD_TARGET = 'dnd-core/ADD_TARGET';\nvar REMOVE_SOURCE = 'dnd-core/REMOVE_SOURCE';\nvar REMOVE_TARGET = 'dnd-core/REMOVE_TARGET';\n\nfunction _addSource(sourceId) {\n  return {\n    type: ADD_SOURCE,\n    payload: {\n      sourceId: sourceId\n    }\n  };\n}\n\nfunction _addTarget(targetId) {\n  return {\n    type: ADD_TARGET,\n    payload: {\n      targetId: targetId\n    }\n  };\n}\n\nfunction _removeSource(sourceId) {\n  return {\n    type: REMOVE_SOURCE,\n    payload: {\n      sourceId: sourceId\n    }\n  };\n}\n\nfunction _removeTarget(targetId) {\n  return {\n    type: REMOVE_TARGET,\n    payload: {\n      targetId: targetId\n    }\n  };\n}\n\nfunction validateSourceContract(source) {\n  invariant(typeof source.canDrag === 'function', 'Expected canDrag to be a function.');\n  invariant(typeof source.beginDrag === 'function', 'Expected beginDrag to be a function.');\n  invariant(typeof source.endDrag === 'function', 'Expected endDrag to be a function.');\n}\n\nfunction validateTargetContract(target) {\n  invariant(typeof target.canDrop === 'function', 'Expected canDrop to be a function.');\n  invariant(typeof target.hover === 'function', 'Expected hover to be a function.');\n  invariant(typeof target.drop === 'function', 'Expected beginDrag to be a function.');\n}\n\nfunction validateType(type, allowArray) {\n  if (allowArray && Array.isArray(type)) {\n    type.forEach(function (t) {\n      return validateType(t, false);\n    });\n    return;\n  }\n\n  invariant(typeof type === 'string' || typeof type === 'symbol', allowArray ? 'Type can only be a string, a symbol, or an array of either.' : 'Type can only be a string or a symbol.');\n}\n\nvar HandlerRole;\n\n(function (HandlerRole) {\n  HandlerRole[\"SOURCE\"] = \"SOURCE\";\n  HandlerRole[\"TARGET\"] = \"TARGET\";\n})(HandlerRole || (HandlerRole = {}));\n\nvar nextUniqueId = 0;\n\nfunction getNextUniqueId() {\n  return nextUniqueId++;\n}\n\nfunction getNextHandlerId(role) {\n  var id = getNextUniqueId().toString();\n\n  switch (role) {\n    case HandlerRole.SOURCE:\n      return \"S\".concat(id);\n\n    case HandlerRole.TARGET:\n      return \"T\".concat(id);\n\n    default:\n      throw new Error(\"Unknown Handler Role: \".concat(role));\n  }\n}\n\nfunction parseRoleFromHandlerId(handlerId) {\n  switch (handlerId[0]) {\n    case 'S':\n      return HandlerRole.SOURCE;\n\n    case 'T':\n      return HandlerRole.TARGET;\n\n    default:\n      throw new Error(\"Cannot parse handler ID: \".concat(handlerId));\n  }\n}\n\nfunction mapContainsValue(map, searchValue) {\n  var entries = map.entries();\n  var isDone = false;\n\n  do {\n    var _entries$next = entries.next(),\n        done = _entries$next.done,\n        _entries$next$value = _slicedToArray(_entries$next.value, 2),\n        value = _entries$next$value[1];\n\n    if (value === searchValue) {\n      return true;\n    }\n\n    isDone = !!done;\n  } while (!isDone);\n\n  return false;\n}\n\nvar HandlerRegistryImpl = /*#__PURE__*/function () {\n  function HandlerRegistryImpl(store) {\n    _classCallCheck(this, HandlerRegistryImpl);\n\n    this.types = new Map();\n    this.dragSources = new Map();\n    this.dropTargets = new Map();\n    this.pinnedSourceId = null;\n    this.pinnedSource = null;\n    this.store = store;\n  }\n\n  _createClass(HandlerRegistryImpl, [{\n    key: \"addSource\",\n    value: function addSource(type, source) {\n      validateType(type);\n      validateSourceContract(source);\n      var sourceId = this.addHandler(HandlerRole.SOURCE, type, source);\n      this.store.dispatch(_addSource(sourceId));\n      return sourceId;\n    }\n  }, {\n    key: \"addTarget\",\n    value: function addTarget(type, target) {\n      validateType(type, true);\n      validateTargetContract(target);\n      var targetId = this.addHandler(HandlerRole.TARGET, type, target);\n      this.store.dispatch(_addTarget(targetId));\n      return targetId;\n    }\n  }, {\n    key: \"containsHandler\",\n    value: function containsHandler(handler) {\n      return mapContainsValue(this.dragSources, handler) || mapContainsValue(this.dropTargets, handler);\n    }\n  }, {\n    key: \"getSource\",\n    value: function getSource(sourceId) {\n      var includePinned = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      invariant(this.isSourceId(sourceId), 'Expected a valid source ID.');\n      var isPinned = includePinned && sourceId === this.pinnedSourceId;\n      var source = isPinned ? this.pinnedSource : this.dragSources.get(sourceId);\n      return source;\n    }\n  }, {\n    key: \"getTarget\",\n    value: function getTarget(targetId) {\n      invariant(this.isTargetId(targetId), 'Expected a valid target ID.');\n      return this.dropTargets.get(targetId);\n    }\n  }, {\n    key: \"getSourceType\",\n    value: function getSourceType(sourceId) {\n      invariant(this.isSourceId(sourceId), 'Expected a valid source ID.');\n      return this.types.get(sourceId);\n    }\n  }, {\n    key: \"getTargetType\",\n    value: function getTargetType(targetId) {\n      invariant(this.isTargetId(targetId), 'Expected a valid target ID.');\n      return this.types.get(targetId);\n    }\n  }, {\n    key: \"isSourceId\",\n    value: function isSourceId(handlerId) {\n      var role = parseRoleFromHandlerId(handlerId);\n      return role === HandlerRole.SOURCE;\n    }\n  }, {\n    key: \"isTargetId\",\n    value: function isTargetId(handlerId) {\n      var role = parseRoleFromHandlerId(handlerId);\n      return role === HandlerRole.TARGET;\n    }\n  }, {\n    key: \"removeSource\",\n    value: function removeSource(sourceId) {\n      var _this5 = this;\n\n      invariant(this.getSource(sourceId), 'Expected an existing source.');\n      this.store.dispatch(_removeSource(sourceId));\n      asap(function () {\n        _this5.dragSources.delete(sourceId);\n\n        _this5.types.delete(sourceId);\n      });\n    }\n  }, {\n    key: \"removeTarget\",\n    value: function removeTarget(targetId) {\n      invariant(this.getTarget(targetId), 'Expected an existing target.');\n      this.store.dispatch(_removeTarget(targetId));\n      this.dropTargets.delete(targetId);\n      this.types.delete(targetId);\n    }\n  }, {\n    key: \"pinSource\",\n    value: function pinSource(sourceId) {\n      var source = this.getSource(sourceId);\n      invariant(source, 'Expected an existing source.');\n      this.pinnedSourceId = sourceId;\n      this.pinnedSource = source;\n    }\n  }, {\n    key: \"unpinSource\",\n    value: function unpinSource() {\n      invariant(this.pinnedSource, 'No source is pinned at the time.');\n      this.pinnedSourceId = null;\n      this.pinnedSource = null;\n    }\n  }, {\n    key: \"addHandler\",\n    value: function addHandler(role, type, handler) {\n      var id = getNextHandlerId(role);\n      this.types.set(id, type);\n\n      if (role === HandlerRole.SOURCE) {\n        this.dragSources.set(id, handler);\n      } else if (role === HandlerRole.TARGET) {\n        this.dropTargets.set(id, handler);\n      }\n\n      return id;\n    }\n  }]);\n\n  return HandlerRegistryImpl;\n}();\n\nvar strictEquality = function strictEquality(a, b) {\n  return a === b;\n};\n/**\n * Determine if two cartesian coordinate offsets are equal\n * @param offsetA\n * @param offsetB\n */\n\n\nfunction areCoordsEqual(offsetA, offsetB) {\n  if (!offsetA && !offsetB) {\n    return true;\n  } else if (!offsetA || !offsetB) {\n    return false;\n  } else {\n    return offsetA.x === offsetB.x && offsetA.y === offsetB.y;\n  }\n}\n/**\n * Determines if two arrays of items are equal\n * @param a The first array of items\n * @param b The second array of items\n */\n\n\nfunction areArraysEqual(a, b) {\n  var isEqual = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : strictEquality;\n\n  if (a.length !== b.length) {\n    return false;\n  }\n\n  for (var i = 0; i < a.length; ++i) {\n    if (!isEqual(a[i], b[i])) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction reduce$5() {\n  var _state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : NONE;\n\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case HOVER:\n      break;\n\n    case ADD_SOURCE:\n    case ADD_TARGET:\n    case REMOVE_TARGET:\n    case REMOVE_SOURCE:\n      return NONE;\n\n    case BEGIN_DRAG:\n    case PUBLISH_DRAG_SOURCE:\n    case END_DRAG:\n    case DROP:\n    default:\n      return ALL;\n  }\n\n  var _action$payload = action.payload,\n      _action$payload$targe = _action$payload.targetIds,\n      targetIds = _action$payload$targe === void 0 ? [] : _action$payload$targe,\n      _action$payload$prevT = _action$payload.prevTargetIds,\n      prevTargetIds = _action$payload$prevT === void 0 ? [] : _action$payload$prevT;\n  var result = xor(targetIds, prevTargetIds);\n  var didChange = result.length > 0 || !areArraysEqual(targetIds, prevTargetIds);\n\n  if (!didChange) {\n    return NONE;\n  } // Check the target ids at the innermost position. If they are valid, add them\n  // to the result\n\n\n  var prevInnermostTargetId = prevTargetIds[prevTargetIds.length - 1];\n  var innermostTargetId = targetIds[targetIds.length - 1];\n\n  if (prevInnermostTargetId !== innermostTargetId) {\n    if (prevInnermostTargetId) {\n      result.push(prevInnermostTargetId);\n    }\n\n    if (innermostTargetId) {\n      result.push(innermostTargetId);\n    }\n  }\n\n  return result;\n}\n\nfunction _defineProperty$3(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread$3(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty$3(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nvar initialState$1 = {\n  initialSourceClientOffset: null,\n  initialClientOffset: null,\n  clientOffset: null\n};\n\nfunction reduce$4() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState$1;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n  var payload = action.payload;\n\n  switch (action.type) {\n    case INIT_COORDS:\n    case BEGIN_DRAG:\n      return {\n        initialSourceClientOffset: payload.sourceClientOffset,\n        initialClientOffset: payload.clientOffset,\n        clientOffset: payload.clientOffset\n      };\n\n    case HOVER:\n      if (areCoordsEqual(state.clientOffset, payload.clientOffset)) {\n        return state;\n      }\n\n      return _objectSpread$3({}, state, {\n        clientOffset: payload.clientOffset\n      });\n\n    case END_DRAG:\n    case DROP:\n      return initialState$1;\n\n    default:\n      return state;\n  }\n}\n\nfunction _defineProperty$2(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread$2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty$2(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nvar initialState = {\n  itemType: null,\n  item: null,\n  sourceId: null,\n  targetIds: [],\n  dropResult: null,\n  didDrop: false,\n  isSourcePublic: null\n};\n\nfunction reduce$3() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n  var payload = action.payload;\n\n  switch (action.type) {\n    case BEGIN_DRAG:\n      return _objectSpread$2({}, state, {\n        itemType: payload.itemType,\n        item: payload.item,\n        sourceId: payload.sourceId,\n        isSourcePublic: payload.isSourcePublic,\n        dropResult: null,\n        didDrop: false\n      });\n\n    case PUBLISH_DRAG_SOURCE:\n      return _objectSpread$2({}, state, {\n        isSourcePublic: true\n      });\n\n    case HOVER:\n      return _objectSpread$2({}, state, {\n        targetIds: payload.targetIds\n      });\n\n    case REMOVE_TARGET:\n      if (state.targetIds.indexOf(payload.targetId) === -1) {\n        return state;\n      }\n\n      return _objectSpread$2({}, state, {\n        targetIds: without$1(state.targetIds, payload.targetId)\n      });\n\n    case DROP:\n      return _objectSpread$2({}, state, {\n        dropResult: payload.dropResult,\n        didDrop: true,\n        targetIds: []\n      });\n\n    case END_DRAG:\n      return _objectSpread$2({}, state, {\n        itemType: null,\n        item: null,\n        sourceId: null,\n        dropResult: null,\n        didDrop: false,\n        isSourcePublic: null,\n        targetIds: []\n      });\n\n    default:\n      return state;\n  }\n}\n\nfunction reduce$2() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case ADD_SOURCE:\n    case ADD_TARGET:\n      return state + 1;\n\n    case REMOVE_SOURCE:\n    case REMOVE_TARGET:\n      return state - 1;\n\n    default:\n      return state;\n  }\n}\n\nfunction reduce$1() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n  return state + 1;\n}\n\nfunction _defineProperty$1(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread$1(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty$1(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction reduce() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n  return {\n    dirtyHandlerIds: reduce$5(state.dirtyHandlerIds, {\n      type: action.type,\n      payload: _objectSpread$1({}, action.payload, {\n        prevTargetIds: get(state, 'dragOperation.targetIds', [])\n      })\n    }),\n    dragOffset: reduce$4(state.dragOffset, action),\n    refCount: reduce$2(state.refCount, action),\n    dragOperation: reduce$3(state.dragOperation, action),\n    stateId: reduce$1(state.stateId)\n  };\n}\n\nfunction createDragDropManager(backendFactory) {\n  var globalContext = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : undefined;\n  var backendOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var debugMode = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  var store = makeStoreInstance(debugMode);\n  var monitor = new DragDropMonitorImpl(store, new HandlerRegistryImpl(store));\n  var manager = new DragDropManagerImpl(store, monitor);\n  var backend = backendFactory(manager, globalContext, backendOptions);\n  manager.receiveBackend(backend);\n  return manager;\n}\n\nfunction makeStoreInstance(debugMode) {\n  // TODO: if we ever make a react-native version of this,\n  // we'll need to consider how to pull off dev-tooling\n  var reduxDevTools = typeof window !== 'undefined' && window.__REDUX_DEVTOOLS_EXTENSION__;\n  return createStore(reduce, debugMode && reduxDevTools && reduxDevTools({\n    name: 'dnd-core',\n    instanceId: 'dnd-core'\n  }));\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nvar refCount = 0;\nvar INSTANCE_SYM = Symbol.for('__REACT_DND_CONTEXT_INSTANCE__');\nvar DndProvider = /*#__PURE__*/memo(function DndProvider(_param) {\n  var children = _param.children,\n      props = _objectWithoutProperties(_param, [\"children\"]);\n\n  var _getDndContextValue = getDndContextValue(props),\n      _getDndContextValue2 = _slicedToArray(_getDndContextValue, 2),\n      manager = _getDndContextValue2[0],\n      isGlobalInstance = _getDndContextValue2[1];\n  /**\n  * If the global context was used to store the DND context\n  * then where theres no more references to it we should\n  * clean it up to avoid memory leaks\n  */\n\n\n  useEffect(function () {\n    if (isGlobalInstance) {\n      var context = getGlobalContext();\n      ++refCount;\n      return function () {\n        if (--refCount === 0) {\n          context[INSTANCE_SYM] = null;\n        }\n      };\n    }\n\n    return;\n  }, []);\n  return /*#__PURE__*/jsx(DndContext.Provider, {\n    value: manager,\n    children: children\n  });\n});\n\nfunction getDndContextValue(props) {\n  if ('manager' in props) {\n    var _manager = {\n      dragDropManager: props.manager\n    };\n    return [_manager, false];\n  }\n\n  var manager = createSingletonDndContext(props.backend, props.context, props.options, props.debugMode);\n  var isGlobalInstance = !props.context;\n  return [manager, isGlobalInstance];\n}\n\nfunction createSingletonDndContext(backend) {\n  var context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : getGlobalContext();\n  var options = arguments.length > 2 ? arguments[2] : undefined;\n  var debugMode = arguments.length > 3 ? arguments[3] : undefined;\n  var ctx = context;\n\n  if (!ctx[INSTANCE_SYM]) {\n    ctx[INSTANCE_SYM] = {\n      dragDropManager: createDragDropManager(backend, context, options, debugMode)\n    };\n  }\n\n  return ctx[INSTANCE_SYM];\n}\n\nfunction getGlobalContext() {\n  return typeof global !== 'undefined' ? global : window;\n}\n\nvar fastDeepEqual = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    if (a.constructor !== b.constructor) return false;\n    var length, i, keys;\n\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length != b.length) return false;\n\n      for (i = length; i-- !== 0;) {\n        if (!equal(a[i], b[i])) return false;\n      }\n\n      return true;\n    }\n\n    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\n    if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\n    if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) return false;\n\n    for (i = length; i-- !== 0;) {\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n    }\n\n    for (i = length; i-- !== 0;) {\n      var key = keys[i];\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  } // true if both NaN, false otherwise\n\n\n  return a !== a && b !== b;\n};\n\nvar useIsomorphicLayoutEffect = typeof window !== 'undefined' ? useLayoutEffect : useEffect;\n/**\n *\n * @param monitor The monitor to collect state from\n * @param collect The collecting function\n * @param onUpdate A method to invoke when updates occur\n */\n\nfunction useCollector(monitor, collect, onUpdate) {\n  var _useState = useState(function () {\n    return collect(monitor);\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      collected = _useState2[0],\n      setCollected = _useState2[1];\n\n  var updateCollected = useCallback(function () {\n    var nextValue = collect(monitor); // This needs to be a deep-equality check because some monitor-collected values\n    // include XYCoord objects that may be equivalent, but do not have instance equality.\n\n    if (!fastDeepEqual(collected, nextValue)) {\n      setCollected(nextValue);\n\n      if (onUpdate) {\n        onUpdate();\n      }\n    }\n  }, [collected, monitor, onUpdate]); // update the collected properties after react renders.\n  // Note that the \"Dustbin Stress Test\" fails if this is not\n  // done when the component updates\n\n  useIsomorphicLayoutEffect(updateCollected);\n  return [collected, updateCollected];\n}\n\nfunction useMonitorOutput(monitor, collect, onCollect) {\n  var _useCollector = useCollector(monitor, collect, onCollect),\n      _useCollector2 = _slicedToArray(_useCollector, 2),\n      collected = _useCollector2[0],\n      updateCollected = _useCollector2[1];\n\n  useIsomorphicLayoutEffect(function subscribeToMonitorStateChange() {\n    var handlerId = monitor.getHandlerId();\n\n    if (handlerId == null) {\n      return;\n    }\n\n    return monitor.subscribeToStateChange(updateCollected, {\n      handlerIds: [handlerId]\n    });\n  }, [monitor, updateCollected]);\n  return collected;\n}\n\nfunction useCollectedProps(collector, monitor, connector) {\n  return useMonitorOutput(monitor, collector || function () {\n    return {};\n  }, function () {\n    return connector.reconnect();\n  });\n}\n\nfunction useOptionalFactory(arg, deps) {\n  var memoDeps = _toConsumableArray(deps || []);\n\n  if (deps == null && typeof arg !== 'function') {\n    memoDeps.push(arg);\n  }\n\n  return useMemo(function () {\n    return typeof arg === 'function' ? arg() : arg;\n  }, memoDeps);\n}\n\nfunction useConnectDragSource(connector) {\n  return useMemo(function () {\n    return connector.hooks.dragSource();\n  }, [connector]);\n}\n\nfunction useConnectDragPreview(connector) {\n  return useMemo(function () {\n    return connector.hooks.dragPreview();\n  }, [connector]);\n}\n\nvar isCallingCanDrag = false;\nvar isCallingIsDragging = false;\n\nvar DragSourceMonitorImpl = /*#__PURE__*/function () {\n  function DragSourceMonitorImpl(manager) {\n    _classCallCheck(this, DragSourceMonitorImpl);\n\n    this.sourceId = null;\n    this.internalMonitor = manager.getMonitor();\n  }\n\n  _createClass(DragSourceMonitorImpl, [{\n    key: \"receiveHandlerId\",\n    value: function receiveHandlerId(sourceId) {\n      this.sourceId = sourceId;\n    }\n  }, {\n    key: \"getHandlerId\",\n    value: function getHandlerId() {\n      return this.sourceId;\n    }\n  }, {\n    key: \"canDrag\",\n    value: function canDrag() {\n      invariant(!isCallingCanDrag, 'You may not call monitor.canDrag() inside your canDrag() implementation. ' + 'Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor');\n\n      try {\n        isCallingCanDrag = true;\n        return this.internalMonitor.canDragSource(this.sourceId);\n      } finally {\n        isCallingCanDrag = false;\n      }\n    }\n  }, {\n    key: \"isDragging\",\n    value: function isDragging() {\n      if (!this.sourceId) {\n        return false;\n      }\n\n      invariant(!isCallingIsDragging, 'You may not call monitor.isDragging() inside your isDragging() implementation. ' + 'Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor');\n\n      try {\n        isCallingIsDragging = true;\n        return this.internalMonitor.isDraggingSource(this.sourceId);\n      } finally {\n        isCallingIsDragging = false;\n      }\n    }\n  }, {\n    key: \"subscribeToStateChange\",\n    value: function subscribeToStateChange(listener, options) {\n      return this.internalMonitor.subscribeToStateChange(listener, options);\n    }\n  }, {\n    key: \"isDraggingSource\",\n    value: function isDraggingSource(sourceId) {\n      return this.internalMonitor.isDraggingSource(sourceId);\n    }\n  }, {\n    key: \"isOverTarget\",\n    value: function isOverTarget(targetId, options) {\n      return this.internalMonitor.isOverTarget(targetId, options);\n    }\n  }, {\n    key: \"getTargetIds\",\n    value: function getTargetIds() {\n      return this.internalMonitor.getTargetIds();\n    }\n  }, {\n    key: \"isSourcePublic\",\n    value: function isSourcePublic() {\n      return this.internalMonitor.isSourcePublic();\n    }\n  }, {\n    key: \"getSourceId\",\n    value: function getSourceId() {\n      return this.internalMonitor.getSourceId();\n    }\n  }, {\n    key: \"subscribeToOffsetChange\",\n    value: function subscribeToOffsetChange(listener) {\n      return this.internalMonitor.subscribeToOffsetChange(listener);\n    }\n  }, {\n    key: \"canDragSource\",\n    value: function canDragSource(sourceId) {\n      return this.internalMonitor.canDragSource(sourceId);\n    }\n  }, {\n    key: \"canDropOnTarget\",\n    value: function canDropOnTarget(targetId) {\n      return this.internalMonitor.canDropOnTarget(targetId);\n    }\n  }, {\n    key: \"getItemType\",\n    value: function getItemType() {\n      return this.internalMonitor.getItemType();\n    }\n  }, {\n    key: \"getItem\",\n    value: function getItem() {\n      return this.internalMonitor.getItem();\n    }\n  }, {\n    key: \"getDropResult\",\n    value: function getDropResult() {\n      return this.internalMonitor.getDropResult();\n    }\n  }, {\n    key: \"didDrop\",\n    value: function didDrop() {\n      return this.internalMonitor.didDrop();\n    }\n  }, {\n    key: \"getInitialClientOffset\",\n    value: function getInitialClientOffset() {\n      return this.internalMonitor.getInitialClientOffset();\n    }\n  }, {\n    key: \"getInitialSourceClientOffset\",\n    value: function getInitialSourceClientOffset() {\n      return this.internalMonitor.getInitialSourceClientOffset();\n    }\n  }, {\n    key: \"getSourceClientOffset\",\n    value: function getSourceClientOffset() {\n      return this.internalMonitor.getSourceClientOffset();\n    }\n  }, {\n    key: \"getClientOffset\",\n    value: function getClientOffset() {\n      return this.internalMonitor.getClientOffset();\n    }\n  }, {\n    key: \"getDifferenceFromInitialOffset\",\n    value: function getDifferenceFromInitialOffset() {\n      return this.internalMonitor.getDifferenceFromInitialOffset();\n    }\n  }]);\n\n  return DragSourceMonitorImpl;\n}();\n\nvar isCallingCanDrop = false;\n\nvar DropTargetMonitorImpl = /*#__PURE__*/function () {\n  function DropTargetMonitorImpl(manager) {\n    _classCallCheck(this, DropTargetMonitorImpl);\n\n    this.targetId = null;\n    this.internalMonitor = manager.getMonitor();\n  }\n\n  _createClass(DropTargetMonitorImpl, [{\n    key: \"receiveHandlerId\",\n    value: function receiveHandlerId(targetId) {\n      this.targetId = targetId;\n    }\n  }, {\n    key: \"getHandlerId\",\n    value: function getHandlerId() {\n      return this.targetId;\n    }\n  }, {\n    key: \"subscribeToStateChange\",\n    value: function subscribeToStateChange(listener, options) {\n      return this.internalMonitor.subscribeToStateChange(listener, options);\n    }\n  }, {\n    key: \"canDrop\",\n    value: function canDrop() {\n      // Cut out early if the target id has not been set. This should prevent errors\n      // where the user has an older version of dnd-core like in\n      // https://github.com/react-dnd/react-dnd/issues/1310\n      if (!this.targetId) {\n        return false;\n      }\n\n      invariant(!isCallingCanDrop, 'You may not call monitor.canDrop() inside your canDrop() implementation. ' + 'Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor');\n\n      try {\n        isCallingCanDrop = true;\n        return this.internalMonitor.canDropOnTarget(this.targetId);\n      } finally {\n        isCallingCanDrop = false;\n      }\n    }\n  }, {\n    key: \"isOver\",\n    value: function isOver(options) {\n      if (!this.targetId) {\n        return false;\n      }\n\n      return this.internalMonitor.isOverTarget(this.targetId, options);\n    }\n  }, {\n    key: \"getItemType\",\n    value: function getItemType() {\n      return this.internalMonitor.getItemType();\n    }\n  }, {\n    key: \"getItem\",\n    value: function getItem() {\n      return this.internalMonitor.getItem();\n    }\n  }, {\n    key: \"getDropResult\",\n    value: function getDropResult() {\n      return this.internalMonitor.getDropResult();\n    }\n  }, {\n    key: \"didDrop\",\n    value: function didDrop() {\n      return this.internalMonitor.didDrop();\n    }\n  }, {\n    key: \"getInitialClientOffset\",\n    value: function getInitialClientOffset() {\n      return this.internalMonitor.getInitialClientOffset();\n    }\n  }, {\n    key: \"getInitialSourceClientOffset\",\n    value: function getInitialSourceClientOffset() {\n      return this.internalMonitor.getInitialSourceClientOffset();\n    }\n  }, {\n    key: \"getSourceClientOffset\",\n    value: function getSourceClientOffset() {\n      return this.internalMonitor.getSourceClientOffset();\n    }\n  }, {\n    key: \"getClientOffset\",\n    value: function getClientOffset() {\n      return this.internalMonitor.getClientOffset();\n    }\n  }, {\n    key: \"getDifferenceFromInitialOffset\",\n    value: function getDifferenceFromInitialOffset() {\n      return this.internalMonitor.getDifferenceFromInitialOffset();\n    }\n  }]);\n\n  return DropTargetMonitorImpl;\n}();\n\nfunction registerTarget(type, target, manager) {\n  var registry = manager.getRegistry();\n  var targetId = registry.addTarget(type, target);\n  return [targetId, function () {\n    return registry.removeTarget(targetId);\n  }];\n}\n\nfunction registerSource(type, source, manager) {\n  var registry = manager.getRegistry();\n  var sourceId = registry.addSource(type, source);\n  return [sourceId, function () {\n    return registry.removeSource(sourceId);\n  }];\n}\n\nfunction shallowEqual(objA, objB, compare, compareContext) {\n  var compareResult = compare ? compare.call(compareContext, objA, objB) : void 0;\n\n  if (compareResult !== void 0) {\n    return !!compareResult;\n  }\n\n  if (objA === objB) {\n    return true;\n  }\n\n  if (typeof objA !== 'object' || !objA || typeof objB !== 'object' || !objB) {\n    return false;\n  }\n\n  var keysA = Object.keys(objA);\n  var keysB = Object.keys(objB);\n\n  if (keysA.length !== keysB.length) {\n    return false;\n  }\n\n  var bHasOwnProperty = Object.prototype.hasOwnProperty.bind(objB); // Test for A's keys different from B.\n\n  for (var idx = 0; idx < keysA.length; idx++) {\n    var key = keysA[idx];\n\n    if (!bHasOwnProperty(key)) {\n      return false;\n    }\n\n    var valueA = objA[key];\n    var valueB = objB[key];\n    compareResult = compare ? compare.call(compareContext, valueA, valueB, key) : void 0;\n\n    if (compareResult === false || compareResult === void 0 && valueA !== valueB) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction isRef(obj) {\n  return (// eslint-disable-next-line no-prototype-builtins\n    obj !== null && typeof obj === 'object' && Object.prototype.hasOwnProperty.call(obj, 'current')\n  );\n}\n\nfunction throwIfCompositeComponentElement(element) {\n  // Custom components can no longer be wrapped directly in React DnD 2.0\n  // so that we don't need to depend on findDOMNode() from react-dom.\n  if (typeof element.type === 'string') {\n    return;\n  }\n\n  var displayName = element.type.displayName || element.type.name || 'the component';\n  throw new Error('Only native element nodes can now be passed to React DnD connectors.' + \"You can either wrap \".concat(displayName, \" into a <div>, or turn it into a \") + 'drag source or a drop target itself.');\n}\n\nfunction wrapHookToRecognizeElement(hook) {\n  return function () {\n    var elementOrNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n    // When passed a node, call the hook straight away.\n    if (! /*#__PURE__*/isValidElement(elementOrNode)) {\n      var node = elementOrNode;\n      hook(node, options); // return the node so it can be chained (e.g. when within callback refs\n      // <div ref={node => connectDragSource(connectDropTarget(node))}/>\n\n      return node;\n    } // If passed a ReactElement, clone it and attach this function as a ref.\n    // This helps us achieve a neat API where user doesn't even know that refs\n    // are being used under the hood.\n\n\n    var element = elementOrNode;\n    throwIfCompositeComponentElement(element); // When no options are passed, use the hook directly\n\n    var ref = options ? function (node) {\n      return hook(node, options);\n    } : hook;\n    return cloneWithRef(element, ref);\n  };\n}\n\nfunction wrapConnectorHooks(hooks) {\n  var wrappedHooks = {};\n  Object.keys(hooks).forEach(function (key) {\n    var hook = hooks[key]; // ref objects should be passed straight through without wrapping\n\n    if (key.endsWith('Ref')) {\n      wrappedHooks[key] = hooks[key];\n    } else {\n      var wrappedHook = wrapHookToRecognizeElement(hook);\n\n      wrappedHooks[key] = function () {\n        return wrappedHook;\n      };\n    }\n  });\n  return wrappedHooks;\n}\n\nfunction setRef(ref, node) {\n  if (typeof ref === 'function') {\n    ref(node);\n  } else {\n    ref.current = node;\n  }\n}\n\nfunction cloneWithRef(element, newRef) {\n  var previousRef = element.ref;\n  invariant(typeof previousRef !== 'string', 'Cannot connect React DnD to an element with an existing string ref. ' + 'Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. ' + 'Read more: https://reactjs.org/docs/refs-and-the-dom.html#callback-refs');\n\n  if (!previousRef) {\n    // When there is no ref on the element, use the new ref directly\n    return /*#__PURE__*/cloneElement(element, {\n      ref: newRef\n    });\n  } else {\n    return /*#__PURE__*/cloneElement(element, {\n      ref: function ref(node) {\n        setRef(previousRef, node);\n        setRef(newRef, node);\n      }\n    });\n  }\n}\n\nvar SourceConnector = /*#__PURE__*/function () {\n  function SourceConnector(backend) {\n    var _this6 = this;\n\n    _classCallCheck(this, SourceConnector);\n\n    this.hooks = wrapConnectorHooks({\n      dragSource: function dragSource(node, options) {\n        _this6.clearDragSource();\n\n        _this6.dragSourceOptions = options || null;\n\n        if (isRef(node)) {\n          _this6.dragSourceRef = node;\n        } else {\n          _this6.dragSourceNode = node;\n        }\n\n        _this6.reconnectDragSource();\n      },\n      dragPreview: function dragPreview(node, options) {\n        _this6.clearDragPreview();\n\n        _this6.dragPreviewOptions = options || null;\n\n        if (isRef(node)) {\n          _this6.dragPreviewRef = node;\n        } else {\n          _this6.dragPreviewNode = node;\n        }\n\n        _this6.reconnectDragPreview();\n      }\n    });\n    this.handlerId = null; // The drop target may either be attached via ref or connect function\n\n    this.dragSourceRef = null;\n    this.dragSourceOptionsInternal = null; // The drag preview may either be attached via ref or connect function\n\n    this.dragPreviewRef = null;\n    this.dragPreviewOptionsInternal = null;\n    this.lastConnectedHandlerId = null;\n    this.lastConnectedDragSource = null;\n    this.lastConnectedDragSourceOptions = null;\n    this.lastConnectedDragPreview = null;\n    this.lastConnectedDragPreviewOptions = null;\n    this.backend = backend;\n  }\n\n  _createClass(SourceConnector, [{\n    key: \"receiveHandlerId\",\n    value: function receiveHandlerId(newHandlerId) {\n      if (this.handlerId === newHandlerId) {\n        return;\n      }\n\n      this.handlerId = newHandlerId;\n      this.reconnect();\n    }\n  }, {\n    key: \"connectTarget\",\n    get: function get() {\n      return this.dragSource;\n    }\n  }, {\n    key: \"dragSourceOptions\",\n    get: function get() {\n      return this.dragSourceOptionsInternal;\n    },\n    set: function set(options) {\n      this.dragSourceOptionsInternal = options;\n    }\n  }, {\n    key: \"dragPreviewOptions\",\n    get: function get() {\n      return this.dragPreviewOptionsInternal;\n    },\n    set: function set(options) {\n      this.dragPreviewOptionsInternal = options;\n    }\n  }, {\n    key: \"reconnect\",\n    value: function reconnect() {\n      var didChange = this.reconnectDragSource();\n      this.reconnectDragPreview(didChange);\n    }\n  }, {\n    key: \"reconnectDragSource\",\n    value: function reconnectDragSource() {\n      var dragSource = this.dragSource; // if nothing has changed then don't resubscribe\n\n      var didChange = this.didHandlerIdChange() || this.didConnectedDragSourceChange() || this.didDragSourceOptionsChange();\n\n      if (didChange) {\n        this.disconnectDragSource();\n      }\n\n      if (!this.handlerId) {\n        return didChange;\n      }\n\n      if (!dragSource) {\n        this.lastConnectedDragSource = dragSource;\n        return didChange;\n      }\n\n      if (didChange) {\n        this.lastConnectedHandlerId = this.handlerId;\n        this.lastConnectedDragSource = dragSource;\n        this.lastConnectedDragSourceOptions = this.dragSourceOptions;\n        this.dragSourceUnsubscribe = this.backend.connectDragSource(this.handlerId, dragSource, this.dragSourceOptions);\n      }\n\n      return didChange;\n    }\n  }, {\n    key: \"reconnectDragPreview\",\n    value: function reconnectDragPreview() {\n      var forceDidChange = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      var dragPreview = this.dragPreview; // if nothing has changed then don't resubscribe\n\n      var didChange = forceDidChange || this.didHandlerIdChange() || this.didConnectedDragPreviewChange() || this.didDragPreviewOptionsChange();\n\n      if (didChange) {\n        this.disconnectDragPreview();\n      }\n\n      if (!this.handlerId) {\n        return;\n      }\n\n      if (!dragPreview) {\n        this.lastConnectedDragPreview = dragPreview;\n        return;\n      }\n\n      if (didChange) {\n        this.lastConnectedHandlerId = this.handlerId;\n        this.lastConnectedDragPreview = dragPreview;\n        this.lastConnectedDragPreviewOptions = this.dragPreviewOptions;\n        this.dragPreviewUnsubscribe = this.backend.connectDragPreview(this.handlerId, dragPreview, this.dragPreviewOptions);\n      }\n    }\n  }, {\n    key: \"didHandlerIdChange\",\n    value: function didHandlerIdChange() {\n      return this.lastConnectedHandlerId !== this.handlerId;\n    }\n  }, {\n    key: \"didConnectedDragSourceChange\",\n    value: function didConnectedDragSourceChange() {\n      return this.lastConnectedDragSource !== this.dragSource;\n    }\n  }, {\n    key: \"didConnectedDragPreviewChange\",\n    value: function didConnectedDragPreviewChange() {\n      return this.lastConnectedDragPreview !== this.dragPreview;\n    }\n  }, {\n    key: \"didDragSourceOptionsChange\",\n    value: function didDragSourceOptionsChange() {\n      return !shallowEqual(this.lastConnectedDragSourceOptions, this.dragSourceOptions);\n    }\n  }, {\n    key: \"didDragPreviewOptionsChange\",\n    value: function didDragPreviewOptionsChange() {\n      return !shallowEqual(this.lastConnectedDragPreviewOptions, this.dragPreviewOptions);\n    }\n  }, {\n    key: \"disconnectDragSource\",\n    value: function disconnectDragSource() {\n      if (this.dragSourceUnsubscribe) {\n        this.dragSourceUnsubscribe();\n        this.dragSourceUnsubscribe = undefined;\n      }\n    }\n  }, {\n    key: \"disconnectDragPreview\",\n    value: function disconnectDragPreview() {\n      if (this.dragPreviewUnsubscribe) {\n        this.dragPreviewUnsubscribe();\n        this.dragPreviewUnsubscribe = undefined;\n        this.dragPreviewNode = null;\n        this.dragPreviewRef = null;\n      }\n    }\n  }, {\n    key: \"dragSource\",\n    get: function get() {\n      return this.dragSourceNode || this.dragSourceRef && this.dragSourceRef.current;\n    }\n  }, {\n    key: \"dragPreview\",\n    get: function get() {\n      return this.dragPreviewNode || this.dragPreviewRef && this.dragPreviewRef.current;\n    }\n  }, {\n    key: \"clearDragSource\",\n    value: function clearDragSource() {\n      this.dragSourceNode = null;\n      this.dragSourceRef = null;\n    }\n  }, {\n    key: \"clearDragPreview\",\n    value: function clearDragPreview() {\n      this.dragPreviewNode = null;\n      this.dragPreviewRef = null;\n    }\n  }]);\n\n  return SourceConnector;\n}();\n\nvar TargetConnector = /*#__PURE__*/function () {\n  function TargetConnector(backend) {\n    var _this7 = this;\n\n    _classCallCheck(this, TargetConnector);\n\n    this.hooks = wrapConnectorHooks({\n      dropTarget: function dropTarget(node, options) {\n        _this7.clearDropTarget();\n\n        _this7.dropTargetOptions = options;\n\n        if (isRef(node)) {\n          _this7.dropTargetRef = node;\n        } else {\n          _this7.dropTargetNode = node;\n        }\n\n        _this7.reconnect();\n      }\n    });\n    this.handlerId = null; // The drop target may either be attached via ref or connect function\n\n    this.dropTargetRef = null;\n    this.dropTargetOptionsInternal = null;\n    this.lastConnectedHandlerId = null;\n    this.lastConnectedDropTarget = null;\n    this.lastConnectedDropTargetOptions = null;\n    this.backend = backend;\n  }\n\n  _createClass(TargetConnector, [{\n    key: \"connectTarget\",\n    get: function get() {\n      return this.dropTarget;\n    }\n  }, {\n    key: \"reconnect\",\n    value: function reconnect() {\n      // if nothing has changed then don't resubscribe\n      var didChange = this.didHandlerIdChange() || this.didDropTargetChange() || this.didOptionsChange();\n\n      if (didChange) {\n        this.disconnectDropTarget();\n      }\n\n      var dropTarget = this.dropTarget;\n\n      if (!this.handlerId) {\n        return;\n      }\n\n      if (!dropTarget) {\n        this.lastConnectedDropTarget = dropTarget;\n        return;\n      }\n\n      if (didChange) {\n        this.lastConnectedHandlerId = this.handlerId;\n        this.lastConnectedDropTarget = dropTarget;\n        this.lastConnectedDropTargetOptions = this.dropTargetOptions;\n        this.unsubscribeDropTarget = this.backend.connectDropTarget(this.handlerId, dropTarget, this.dropTargetOptions);\n      }\n    }\n  }, {\n    key: \"receiveHandlerId\",\n    value: function receiveHandlerId(newHandlerId) {\n      if (newHandlerId === this.handlerId) {\n        return;\n      }\n\n      this.handlerId = newHandlerId;\n      this.reconnect();\n    }\n  }, {\n    key: \"dropTargetOptions\",\n    get: function get() {\n      return this.dropTargetOptionsInternal;\n    },\n    set: function set(options) {\n      this.dropTargetOptionsInternal = options;\n    }\n  }, {\n    key: \"didHandlerIdChange\",\n    value: function didHandlerIdChange() {\n      return this.lastConnectedHandlerId !== this.handlerId;\n    }\n  }, {\n    key: \"didDropTargetChange\",\n    value: function didDropTargetChange() {\n      return this.lastConnectedDropTarget !== this.dropTarget;\n    }\n  }, {\n    key: \"didOptionsChange\",\n    value: function didOptionsChange() {\n      return !shallowEqual(this.lastConnectedDropTargetOptions, this.dropTargetOptions);\n    }\n  }, {\n    key: \"disconnectDropTarget\",\n    value: function disconnectDropTarget() {\n      if (this.unsubscribeDropTarget) {\n        this.unsubscribeDropTarget();\n        this.unsubscribeDropTarget = undefined;\n      }\n    }\n  }, {\n    key: \"dropTarget\",\n    get: function get() {\n      return this.dropTargetNode || this.dropTargetRef && this.dropTargetRef.current;\n    }\n  }, {\n    key: \"clearDropTarget\",\n    value: function clearDropTarget() {\n      this.dropTargetRef = null;\n      this.dropTargetNode = null;\n    }\n  }]);\n\n  return TargetConnector;\n}();\n/**\n * A hook to retrieve the DragDropManager from Context\n */\n\n\nfunction useDragDropManager() {\n  var _useContext = useContext(DndContext),\n      dragDropManager = _useContext.dragDropManager;\n\n  invariant(dragDropManager != null, 'Expected drag drop context');\n  return dragDropManager;\n}\n\nfunction useDragSourceConnector(dragSourceOptions, dragPreviewOptions) {\n  var manager = useDragDropManager();\n  var connector = useMemo(function () {\n    return new SourceConnector(manager.getBackend());\n  }, [manager]);\n  useIsomorphicLayoutEffect(function () {\n    connector.dragSourceOptions = dragSourceOptions || null;\n    connector.reconnect();\n    return function () {\n      return connector.disconnectDragSource();\n    };\n  }, [connector, dragSourceOptions]);\n  useIsomorphicLayoutEffect(function () {\n    connector.dragPreviewOptions = dragPreviewOptions || null;\n    connector.reconnect();\n    return function () {\n      return connector.disconnectDragPreview();\n    };\n  }, [connector, dragPreviewOptions]);\n  return connector;\n}\n\nfunction useDragSourceMonitor() {\n  var manager = useDragDropManager();\n  return useMemo(function () {\n    return new DragSourceMonitorImpl(manager);\n  }, [manager]);\n}\n\nvar DragSourceImpl = /*#__PURE__*/function () {\n  function DragSourceImpl(spec, monitor, connector) {\n    _classCallCheck(this, DragSourceImpl);\n\n    this.spec = spec;\n    this.monitor = monitor;\n    this.connector = connector;\n  }\n\n  _createClass(DragSourceImpl, [{\n    key: \"beginDrag\",\n    value: function beginDrag() {\n      var spec = this.spec;\n      var monitor = this.monitor;\n      var result = null;\n\n      if (typeof spec.item === 'object') {\n        result = spec.item;\n      } else if (typeof spec.item === 'function') {\n        result = spec.item(monitor);\n      } else {\n        result = {};\n      }\n\n      return result !== null && result !== void 0 ? result : null;\n    }\n  }, {\n    key: \"canDrag\",\n    value: function canDrag() {\n      var spec = this.spec;\n      var monitor = this.monitor;\n\n      if (typeof spec.canDrag === 'boolean') {\n        return spec.canDrag;\n      } else if (typeof spec.canDrag === 'function') {\n        return spec.canDrag(monitor);\n      } else {\n        return true;\n      }\n    }\n  }, {\n    key: \"isDragging\",\n    value: function isDragging(globalMonitor, target) {\n      var spec = this.spec;\n      var monitor = this.monitor;\n      var isDragging = spec.isDragging;\n      return isDragging ? isDragging(monitor) : target === globalMonitor.getSourceId();\n    }\n  }, {\n    key: \"endDrag\",\n    value: function endDrag() {\n      var spec = this.spec;\n      var monitor = this.monitor;\n      var connector = this.connector;\n      var end = spec.end;\n\n      if (end) {\n        end(monitor.getItem(), monitor);\n      }\n\n      connector.reconnect();\n    }\n  }]);\n\n  return DragSourceImpl;\n}();\n\nfunction useDragSource(spec, monitor, connector) {\n  var handler = useMemo(function () {\n    return new DragSourceImpl(spec, monitor, connector);\n  }, [monitor, connector]);\n  useEffect(function () {\n    handler.spec = spec;\n  }, [spec]);\n  return handler;\n}\n\nfunction useDragType(spec) {\n  return useMemo(function () {\n    var result = spec.type;\n    invariant(result != null, 'spec.type must be defined');\n    return result;\n  }, [spec]);\n}\n\nfunction useRegisteredDragSource(spec, monitor, connector) {\n  var manager = useDragDropManager();\n  var handler = useDragSource(spec, monitor, connector);\n  var itemType = useDragType(spec);\n  useIsomorphicLayoutEffect(function registerDragSource() {\n    if (itemType != null) {\n      var _registerSource = registerSource(itemType, handler, manager),\n          _registerSource2 = _slicedToArray(_registerSource, 2),\n          handlerId = _registerSource2[0],\n          unregister = _registerSource2[1];\n\n      monitor.receiveHandlerId(handlerId);\n      connector.receiveHandlerId(handlerId);\n      return unregister;\n    }\n\n    return;\n  }, [manager, monitor, connector, handler, itemType]);\n}\n/**\n * useDragSource hook\n * @param sourceSpec The drag source specification (object or function, function preferred)\n * @param deps The memoization deps array to use when evaluating spec changes\n */\n\n\nfunction useDrag(specArg, deps) {\n  var spec = useOptionalFactory(specArg, deps);\n  invariant(!spec.begin, \"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)\");\n  var monitor = useDragSourceMonitor();\n  var connector = useDragSourceConnector(spec.options, spec.previewOptions);\n  useRegisteredDragSource(spec, monitor, connector);\n  return [useCollectedProps(spec.collect, monitor, connector), useConnectDragSource(connector), useConnectDragPreview(connector)];\n}\n/**\n * useDragLayer Hook\n * @param collector The property collector\n */\n\n\nfunction useDragLayer(collect) {\n  var dragDropManager = useDragDropManager();\n  var monitor = dragDropManager.getMonitor();\n\n  var _useCollector3 = useCollector(monitor, collect),\n      _useCollector4 = _slicedToArray(_useCollector3, 2),\n      collected = _useCollector4[0],\n      updateCollected = _useCollector4[1];\n\n  useEffect(function () {\n    return monitor.subscribeToOffsetChange(updateCollected);\n  });\n  useEffect(function () {\n    return monitor.subscribeToStateChange(updateCollected);\n  });\n  return collected;\n}\n\nfunction useConnectDropTarget(connector) {\n  return useMemo(function () {\n    return connector.hooks.dropTarget();\n  }, [connector]);\n}\n\nfunction useDropTargetConnector(options) {\n  var manager = useDragDropManager();\n  var connector = useMemo(function () {\n    return new TargetConnector(manager.getBackend());\n  }, [manager]);\n  useIsomorphicLayoutEffect(function () {\n    connector.dropTargetOptions = options || null;\n    connector.reconnect();\n    return function () {\n      return connector.disconnectDropTarget();\n    };\n  }, [options]);\n  return connector;\n}\n\nfunction useDropTargetMonitor() {\n  var manager = useDragDropManager();\n  return useMemo(function () {\n    return new DropTargetMonitorImpl(manager);\n  }, [manager]);\n}\n/**\n * Internal utility hook to get an array-version of spec.accept.\n * The main utility here is that we aren't creating a new array on every render if a non-array spec.accept is passed in.\n * @param spec\n */\n\n\nfunction useAccept(spec) {\n  var accept = spec.accept;\n  return useMemo(function () {\n    invariant(spec.accept != null, 'accept must be defined');\n    return Array.isArray(accept) ? accept : [accept];\n  }, [accept]);\n}\n\nvar DropTargetImpl = /*#__PURE__*/function () {\n  function DropTargetImpl(spec, monitor) {\n    _classCallCheck(this, DropTargetImpl);\n\n    this.spec = spec;\n    this.monitor = monitor;\n  }\n\n  _createClass(DropTargetImpl, [{\n    key: \"canDrop\",\n    value: function canDrop() {\n      var spec = this.spec;\n      var monitor = this.monitor;\n      return spec.canDrop ? spec.canDrop(monitor.getItem(), monitor) : true;\n    }\n  }, {\n    key: \"hover\",\n    value: function hover() {\n      var spec = this.spec;\n      var monitor = this.monitor;\n\n      if (spec.hover) {\n        spec.hover(monitor.getItem(), monitor);\n      }\n    }\n  }, {\n    key: \"drop\",\n    value: function drop() {\n      var spec = this.spec;\n      var monitor = this.monitor;\n\n      if (spec.drop) {\n        return spec.drop(monitor.getItem(), monitor);\n      }\n\n      return;\n    }\n  }]);\n\n  return DropTargetImpl;\n}();\n\nfunction useDropTarget(spec, monitor) {\n  var dropTarget = useMemo(function () {\n    return new DropTargetImpl(spec, monitor);\n  }, [monitor]);\n  useEffect(function () {\n    dropTarget.spec = spec;\n  }, [spec]);\n  return dropTarget;\n}\n\nfunction useRegisteredDropTarget(spec, monitor, connector) {\n  var manager = useDragDropManager();\n  var dropTarget = useDropTarget(spec, monitor);\n  var accept = useAccept(spec);\n  useIsomorphicLayoutEffect(function registerDropTarget() {\n    var _registerTarget = registerTarget(accept, dropTarget, manager),\n        _registerTarget2 = _slicedToArray(_registerTarget, 2),\n        handlerId = _registerTarget2[0],\n        unregister = _registerTarget2[1];\n\n    monitor.receiveHandlerId(handlerId);\n    connector.receiveHandlerId(handlerId);\n    return unregister;\n  }, [manager, monitor, dropTarget, connector, accept.map(function (a) {\n    return a.toString();\n  }).join('|')]);\n}\n/**\n * useDropTarget Hook\n * @param spec The drop target specification (object or function, function preferred)\n * @param deps The memoization deps array to use when evaluating spec changes\n */\n\n\nfunction useDrop(specArg, deps) {\n  var spec = useOptionalFactory(specArg, deps);\n  var monitor = useDropTargetMonitor();\n  var connector = useDropTargetConnector(spec.options);\n  useRegisteredDropTarget(spec, monitor, connector);\n  return [useCollectedProps(spec.collect, monitor, connector), useConnectDropTarget(connector)];\n} // cheap lodash replacements\n\n\nfunction memoize(fn) {\n  var result = null;\n\n  var memoized = function memoized() {\n    if (result == null) {\n      result = fn();\n    }\n\n    return result;\n  };\n\n  return memoized;\n}\n/**\n * drop-in replacement for _.without\n */\n\n\nfunction without(items, item) {\n  return items.filter(function (i) {\n    return i !== item;\n  });\n}\n\nfunction union(itemsA, itemsB) {\n  var set = new Set();\n\n  var insertItem = function insertItem(item) {\n    return set.add(item);\n  };\n\n  itemsA.forEach(insertItem);\n  itemsB.forEach(insertItem);\n  var result = [];\n  set.forEach(function (key) {\n    return result.push(key);\n  });\n  return result;\n}\n\nvar EnterLeaveCounter = /*#__PURE__*/function () {\n  function EnterLeaveCounter(isNodeInDocument) {\n    _classCallCheck(this, EnterLeaveCounter);\n\n    this.entered = [];\n    this.isNodeInDocument = isNodeInDocument;\n  }\n\n  _createClass(EnterLeaveCounter, [{\n    key: \"enter\",\n    value: function enter(enteringNode) {\n      var _this8 = this;\n\n      var previousLength = this.entered.length;\n\n      var isNodeEntered = function isNodeEntered(node) {\n        return _this8.isNodeInDocument(node) && (!node.contains || node.contains(enteringNode));\n      };\n\n      this.entered = union(this.entered.filter(isNodeEntered), [enteringNode]);\n      return previousLength === 0 && this.entered.length > 0;\n    }\n  }, {\n    key: \"leave\",\n    value: function leave(leavingNode) {\n      var previousLength = this.entered.length;\n      this.entered = without(this.entered.filter(this.isNodeInDocument), leavingNode);\n      return previousLength > 0 && this.entered.length === 0;\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      this.entered = [];\n    }\n  }]);\n\n  return EnterLeaveCounter;\n}();\n\nvar NativeDragSource = /*#__PURE__*/function () {\n  function NativeDragSource(config) {\n    _classCallCheck(this, NativeDragSource);\n\n    this.config = config;\n    this.item = {};\n    this.initializeExposedProperties();\n  }\n\n  _createClass(NativeDragSource, [{\n    key: \"initializeExposedProperties\",\n    value: function initializeExposedProperties() {\n      var _this9 = this;\n\n      Object.keys(this.config.exposeProperties).forEach(function (property) {\n        Object.defineProperty(_this9.item, property, {\n          configurable: true,\n          enumerable: true,\n          get: function get() {\n            // eslint-disable-next-line no-console\n            console.warn(\"Browser doesn't allow reading \\\"\".concat(property, \"\\\" until the drop event.\"));\n            return null;\n          }\n        });\n      });\n    }\n  }, {\n    key: \"loadDataTransfer\",\n    value: function loadDataTransfer(dataTransfer) {\n      var _this10 = this;\n\n      if (dataTransfer) {\n        var newProperties = {};\n        Object.keys(this.config.exposeProperties).forEach(function (property) {\n          var propertyFn = _this10.config.exposeProperties[property];\n\n          if (propertyFn != null) {\n            newProperties[property] = {\n              value: propertyFn(dataTransfer, _this10.config.matchesTypes),\n              configurable: true,\n              enumerable: true\n            };\n          }\n        });\n        Object.defineProperties(this.item, newProperties);\n      }\n    }\n  }, {\n    key: \"canDrag\",\n    value: function canDrag() {\n      return true;\n    }\n  }, {\n    key: \"beginDrag\",\n    value: function beginDrag() {\n      return this.item;\n    }\n  }, {\n    key: \"isDragging\",\n    value: function isDragging(monitor, handle) {\n      return handle === monitor.getSourceId();\n    }\n  }, {\n    key: \"endDrag\",\n    value: function endDrag() {// empty\n    }\n  }]);\n\n  return NativeDragSource;\n}();\n\nvar FILE = '__NATIVE_FILE__';\nvar URL = '__NATIVE_URL__';\nvar TEXT = '__NATIVE_TEXT__';\nvar HTML = '__NATIVE_HTML__';\nvar NativeTypes = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  FILE: FILE,\n  URL: URL,\n  TEXT: TEXT,\n  HTML: HTML\n});\n\nfunction getDataFromDataTransfer(dataTransfer, typesToTry, defaultValue) {\n  var result = typesToTry.reduce(function (resultSoFar, typeToTry) {\n    return resultSoFar || dataTransfer.getData(typeToTry);\n  }, '');\n  return result != null ? result : defaultValue;\n}\n\nvar nativeTypesConfig = (_nativeTypesConfig = {}, _defineProperty2(_nativeTypesConfig, FILE, {\n  exposeProperties: {\n    files: function files(dataTransfer) {\n      return Array.prototype.slice.call(dataTransfer.files);\n    },\n    items: function items(dataTransfer) {\n      return dataTransfer.items;\n    },\n    dataTransfer: function dataTransfer(_dataTransfer) {\n      return _dataTransfer;\n    }\n  },\n  matchesTypes: ['Files']\n}), _defineProperty2(_nativeTypesConfig, HTML, {\n  exposeProperties: {\n    html: function html(dataTransfer, matchesTypes) {\n      return getDataFromDataTransfer(dataTransfer, matchesTypes, '');\n    },\n    dataTransfer: function dataTransfer(_dataTransfer2) {\n      return _dataTransfer2;\n    }\n  },\n  matchesTypes: ['Html', 'text/html']\n}), _defineProperty2(_nativeTypesConfig, URL, {\n  exposeProperties: {\n    urls: function urls(dataTransfer, matchesTypes) {\n      return getDataFromDataTransfer(dataTransfer, matchesTypes, '').split('\\n');\n    },\n    dataTransfer: function dataTransfer(_dataTransfer3) {\n      return _dataTransfer3;\n    }\n  },\n  matchesTypes: ['Url', 'text/uri-list']\n}), _defineProperty2(_nativeTypesConfig, TEXT, {\n  exposeProperties: {\n    text: function text(dataTransfer, matchesTypes) {\n      return getDataFromDataTransfer(dataTransfer, matchesTypes, '');\n    },\n    dataTransfer: function dataTransfer(_dataTransfer4) {\n      return _dataTransfer4;\n    }\n  },\n  matchesTypes: ['Text', 'text/plain']\n}), _nativeTypesConfig);\n\nfunction createNativeDragSource(type, dataTransfer) {\n  var config = nativeTypesConfig[type];\n\n  if (!config) {\n    throw new Error(\"native type \".concat(type, \" has no configuration\"));\n  }\n\n  var result = new NativeDragSource(config);\n  result.loadDataTransfer(dataTransfer);\n  return result;\n}\n\nfunction matchNativeItemType(dataTransfer) {\n  if (!dataTransfer) {\n    return null;\n  }\n\n  var dataTransferTypes = Array.prototype.slice.call(dataTransfer.types || []);\n  return Object.keys(nativeTypesConfig).filter(function (nativeItemType) {\n    var typeConfig = nativeTypesConfig[nativeItemType];\n\n    if (!(typeConfig === null || typeConfig === void 0 ? void 0 : typeConfig.matchesTypes)) {\n      return false;\n    }\n\n    return typeConfig.matchesTypes.some(function (t) {\n      return dataTransferTypes.indexOf(t) > -1;\n    });\n  })[0] || null;\n}\n\nvar isFirefox = memoize(function () {\n  return /firefox/i.test(navigator.userAgent);\n});\nvar isSafari = memoize(function () {\n  return Boolean(window.safari);\n});\n\nvar MonotonicInterpolant = /*#__PURE__*/function () {\n  function MonotonicInterpolant(xs, ys) {\n    _classCallCheck(this, MonotonicInterpolant);\n\n    var length = xs.length; // Rearrange xs and ys so that xs is sorted\n\n    var indexes = [];\n\n    for (var i = 0; i < length; i++) {\n      indexes.push(i);\n    }\n\n    indexes.sort(function (a, b) {\n      return xs[a] < xs[b] ? -1 : 1;\n    }); // Get consecutive differences and slopes\n\n    var dxs = [];\n    var ms = [];\n    var dx;\n    var dy;\n\n    for (var i1 = 0; i1 < length - 1; i1++) {\n      dx = xs[i1 + 1] - xs[i1];\n      dy = ys[i1 + 1] - ys[i1];\n      dxs.push(dx);\n      ms.push(dy / dx);\n    } // Get degree-1 coefficients\n\n\n    var c1s = [ms[0]];\n\n    for (var i2 = 0; i2 < dxs.length - 1; i2++) {\n      var m2 = ms[i2];\n      var mNext = ms[i2 + 1];\n\n      if (m2 * mNext <= 0) {\n        c1s.push(0);\n      } else {\n        dx = dxs[i2];\n        var dxNext = dxs[i2 + 1];\n        var common = dx + dxNext;\n        c1s.push(3 * common / ((common + dxNext) / m2 + (common + dx) / mNext));\n      }\n    }\n\n    c1s.push(ms[ms.length - 1]); // Get degree-2 and degree-3 coefficients\n\n    var c2s = [];\n    var c3s = [];\n    var m;\n\n    for (var i3 = 0; i3 < c1s.length - 1; i3++) {\n      m = ms[i3];\n      var c1 = c1s[i3];\n      var invDx = 1 / dxs[i3];\n\n      var _common = c1 + c1s[i3 + 1] - m - m;\n\n      c2s.push((m - c1 - _common) * invDx);\n      c3s.push(_common * invDx * invDx);\n    }\n\n    this.xs = xs;\n    this.ys = ys;\n    this.c1s = c1s;\n    this.c2s = c2s;\n    this.c3s = c3s;\n  }\n\n  _createClass(MonotonicInterpolant, [{\n    key: \"interpolate\",\n    value: function interpolate(x) {\n      var xs = this.xs,\n          ys = this.ys,\n          c1s = this.c1s,\n          c2s = this.c2s,\n          c3s = this.c3s; // The rightmost point in the dataset should give an exact result\n\n      var i = xs.length - 1;\n\n      if (x === xs[i]) {\n        return ys[i];\n      } // Search for the interval x is in, returning the corresponding y if x is one of the original xs\n\n\n      var low = 0;\n      var high = c3s.length - 1;\n      var mid;\n\n      while (low <= high) {\n        mid = Math.floor(0.5 * (low + high));\n        var xHere = xs[mid];\n\n        if (xHere < x) {\n          low = mid + 1;\n        } else if (xHere > x) {\n          high = mid - 1;\n        } else {\n          return ys[mid];\n        }\n      }\n\n      i = Math.max(0, high); // Interpolate\n\n      var diff = x - xs[i];\n      var diffSq = diff * diff;\n      return ys[i] + c1s[i] * diff + c2s[i] * diffSq + c3s[i] * diff * diffSq;\n    }\n  }]);\n\n  return MonotonicInterpolant;\n}();\n\nvar ELEMENT_NODE$1 = 1;\n\nfunction getNodeClientOffset$1(node) {\n  var el = node.nodeType === ELEMENT_NODE$1 ? node : node.parentElement;\n\n  if (!el) {\n    return null;\n  }\n\n  var _el$getBoundingClient = el.getBoundingClientRect(),\n      top = _el$getBoundingClient.top,\n      left = _el$getBoundingClient.left;\n\n  return {\n    x: left,\n    y: top\n  };\n}\n\nfunction getEventClientOffset$1(e) {\n  return {\n    x: e.clientX,\n    y: e.clientY\n  };\n}\n\nfunction isImageNode(node) {\n  var ref;\n  return node.nodeName === 'IMG' && (isFirefox() || !((ref = document.documentElement) === null || ref === void 0 ? void 0 : ref.contains(node)));\n}\n\nfunction getDragPreviewSize(isImage, dragPreview, sourceWidth, sourceHeight) {\n  var dragPreviewWidth = isImage ? dragPreview.width : sourceWidth;\n  var dragPreviewHeight = isImage ? dragPreview.height : sourceHeight; // Work around @2x coordinate discrepancies in browsers\n\n  if (isSafari() && isImage) {\n    dragPreviewHeight /= window.devicePixelRatio;\n    dragPreviewWidth /= window.devicePixelRatio;\n  }\n\n  return {\n    dragPreviewWidth: dragPreviewWidth,\n    dragPreviewHeight: dragPreviewHeight\n  };\n}\n\nfunction getDragPreviewOffset(sourceNode, dragPreview, clientOffset, anchorPoint, offsetPoint) {\n  // The browsers will use the image intrinsic size under different conditions.\n  // Firefox only cares if it's an image, but WebKit also wants it to be detached.\n  var isImage = isImageNode(dragPreview);\n  var dragPreviewNode = isImage ? sourceNode : dragPreview;\n  var dragPreviewNodeOffsetFromClient = getNodeClientOffset$1(dragPreviewNode);\n  var offsetFromDragPreview = {\n    x: clientOffset.x - dragPreviewNodeOffsetFromClient.x,\n    y: clientOffset.y - dragPreviewNodeOffsetFromClient.y\n  };\n  var sourceWidth = sourceNode.offsetWidth,\n      sourceHeight = sourceNode.offsetHeight;\n  var anchorX = anchorPoint.anchorX,\n      anchorY = anchorPoint.anchorY;\n\n  var _getDragPreviewSize = getDragPreviewSize(isImage, dragPreview, sourceWidth, sourceHeight),\n      dragPreviewWidth = _getDragPreviewSize.dragPreviewWidth,\n      dragPreviewHeight = _getDragPreviewSize.dragPreviewHeight;\n\n  var calculateYOffset = function calculateYOffset() {\n    var interpolantY = new MonotonicInterpolant([0, 0.5, 1], [// Dock to the top\n    offsetFromDragPreview.y, // Align at the center\n    offsetFromDragPreview.y / sourceHeight * dragPreviewHeight, // Dock to the bottom\n    offsetFromDragPreview.y + dragPreviewHeight - sourceHeight]);\n    var y = interpolantY.interpolate(anchorY); // Work around Safari 8 positioning bug\n\n    if (isSafari() && isImage) {\n      // We'll have to wait for @3x to see if this is entirely correct\n      y += (window.devicePixelRatio - 1) * dragPreviewHeight;\n    }\n\n    return y;\n  };\n\n  var calculateXOffset = function calculateXOffset() {\n    // Interpolate coordinates depending on anchor point\n    // If you know a simpler way to do this, let me know\n    var interpolantX = new MonotonicInterpolant([0, 0.5, 1], [// Dock to the left\n    offsetFromDragPreview.x, // Align at the center\n    offsetFromDragPreview.x / sourceWidth * dragPreviewWidth, // Dock to the right\n    offsetFromDragPreview.x + dragPreviewWidth - sourceWidth]);\n    return interpolantX.interpolate(anchorX);\n  }; // Force offsets if specified in the options.\n\n\n  var offsetX = offsetPoint.offsetX,\n      offsetY = offsetPoint.offsetY;\n  var isManualOffsetX = offsetX === 0 || offsetX;\n  var isManualOffsetY = offsetY === 0 || offsetY;\n  return {\n    x: isManualOffsetX ? offsetX : calculateXOffset(),\n    y: isManualOffsetY ? offsetY : calculateYOffset()\n  };\n}\n\nvar OptionsReader$1 = /*#__PURE__*/function () {\n  function OptionsReader$1(globalContext, options) {\n    _classCallCheck(this, OptionsReader$1);\n\n    this.ownerDocument = null;\n    this.globalContext = globalContext;\n    this.optionsArgs = options;\n  }\n\n  _createClass(OptionsReader$1, [{\n    key: \"window\",\n    get: function get() {\n      if (this.globalContext) {\n        return this.globalContext;\n      } else if (typeof window !== 'undefined') {\n        return window;\n      }\n\n      return undefined;\n    }\n  }, {\n    key: \"document\",\n    get: function get() {\n      var ref;\n\n      if ((ref = this.globalContext) === null || ref === void 0 ? void 0 : ref.document) {\n        return this.globalContext.document;\n      } else if (this.window) {\n        return this.window.document;\n      } else {\n        return undefined;\n      }\n    }\n  }, {\n    key: \"rootElement\",\n    get: function get() {\n      var ref;\n      return ((ref = this.optionsArgs) === null || ref === void 0 ? void 0 : ref.rootElement) || this.window;\n    }\n  }]);\n\n  return OptionsReader$1;\n}();\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nvar HTML5BackendImpl = /*#__PURE__*/function () {\n  function HTML5BackendImpl(manager, globalContext, options) {\n    var _this11 = this;\n\n    _classCallCheck(this, HTML5BackendImpl);\n\n    this.sourcePreviewNodes = new Map();\n    this.sourcePreviewNodeOptions = new Map();\n    this.sourceNodes = new Map();\n    this.sourceNodeOptions = new Map();\n    this.dragStartSourceIds = null;\n    this.dropTargetIds = [];\n    this.dragEnterTargetIds = [];\n    this.currentNativeSource = null;\n    this.currentNativeHandle = null;\n    this.currentDragSourceNode = null;\n    this.altKeyPressed = false;\n    this.mouseMoveTimeoutTimer = null;\n    this.asyncEndDragFrameId = null;\n    this.dragOverTargetIds = null;\n    this.lastClientOffset = null;\n    this.hoverRafId = null;\n\n    this.getSourceClientOffset = function (sourceId) {\n      var source = _this11.sourceNodes.get(sourceId);\n\n      return source && getNodeClientOffset$1(source) || null;\n    };\n\n    this.endDragNativeItem = function () {\n      if (!_this11.isDraggingNativeItem()) {\n        return;\n      }\n\n      _this11.actions.endDrag();\n\n      if (_this11.currentNativeHandle) {\n        _this11.registry.removeSource(_this11.currentNativeHandle);\n      }\n\n      _this11.currentNativeHandle = null;\n      _this11.currentNativeSource = null;\n    };\n\n    this.isNodeInDocument = function (node) {\n      // Check the node either in the main document or in the current context\n      return Boolean(node && _this11.document && _this11.document.body && _this11.document.body.contains(node));\n    };\n\n    this.endDragIfSourceWasRemovedFromDOM = function () {\n      var node = _this11.currentDragSourceNode;\n\n      if (node == null || _this11.isNodeInDocument(node)) {\n        return;\n      }\n\n      if (_this11.clearCurrentDragSourceNode() && _this11.monitor.isDragging()) {\n        _this11.actions.endDrag();\n      }\n\n      _this11.cancelHover();\n    };\n\n    this.scheduleHover = function (dragOverTargetIds) {\n      if (_this11.hoverRafId === null && typeof requestAnimationFrame !== 'undefined') {\n        _this11.hoverRafId = requestAnimationFrame(function () {\n          if (_this11.monitor.isDragging()) {\n            _this11.actions.hover(dragOverTargetIds || [], {\n              clientOffset: _this11.lastClientOffset\n            });\n          }\n\n          _this11.hoverRafId = null;\n        });\n      }\n    };\n\n    this.cancelHover = function () {\n      if (_this11.hoverRafId !== null && typeof cancelAnimationFrame !== 'undefined') {\n        cancelAnimationFrame(_this11.hoverRafId);\n        _this11.hoverRafId = null;\n      }\n    };\n\n    this.handleTopDragStartCapture = function () {\n      _this11.clearCurrentDragSourceNode();\n\n      _this11.dragStartSourceIds = [];\n    };\n\n    this.handleTopDragStart = function (e) {\n      if (e.defaultPrevented) {\n        return;\n      }\n\n      var dragStartSourceIds = _this11.dragStartSourceIds;\n      _this11.dragStartSourceIds = null;\n      var clientOffset = getEventClientOffset$1(e); // Avoid crashing if we missed a drop event or our previous drag died\n\n      if (_this11.monitor.isDragging()) {\n        _this11.actions.endDrag();\n\n        _this11.cancelHover();\n      } // Don't publish the source just yet (see why below)\n\n\n      _this11.actions.beginDrag(dragStartSourceIds || [], {\n        publishSource: false,\n        getSourceClientOffset: _this11.getSourceClientOffset,\n        clientOffset: clientOffset\n      });\n\n      var dataTransfer = e.dataTransfer;\n      var nativeType = matchNativeItemType(dataTransfer);\n\n      if (_this11.monitor.isDragging()) {\n        if (dataTransfer && typeof dataTransfer.setDragImage === 'function') {\n          // Use custom drag image if user specifies it.\n          // If child drag source refuses drag but parent agrees,\n          // use parent's node as drag image. Neither works in IE though.\n          var sourceId = _this11.monitor.getSourceId();\n\n          var sourceNode = _this11.sourceNodes.get(sourceId);\n\n          var dragPreview = _this11.sourcePreviewNodes.get(sourceId) || sourceNode;\n\n          if (dragPreview) {\n            var _this11$getCurrentSou = _this11.getCurrentSourcePreviewNodeOptions(),\n                anchorX = _this11$getCurrentSou.anchorX,\n                anchorY = _this11$getCurrentSou.anchorY,\n                offsetX = _this11$getCurrentSou.offsetX,\n                offsetY = _this11$getCurrentSou.offsetY;\n\n            var anchorPoint = {\n              anchorX: anchorX,\n              anchorY: anchorY\n            };\n            var offsetPoint = {\n              offsetX: offsetX,\n              offsetY: offsetY\n            };\n            var dragPreviewOffset = getDragPreviewOffset(sourceNode, dragPreview, clientOffset, anchorPoint, offsetPoint);\n            dataTransfer.setDragImage(dragPreview, dragPreviewOffset.x, dragPreviewOffset.y);\n          }\n        }\n\n        try {\n          // Firefox won't drag without setting data\n          dataTransfer === null || dataTransfer === void 0 ? void 0 : dataTransfer.setData('application/json', {});\n        } catch (err) {// IE doesn't support MIME types in setData\n        } // Store drag source node so we can check whether\n        // it is removed from DOM and trigger endDrag manually.\n\n\n        _this11.setCurrentDragSourceNode(e.target); // Now we are ready to publish the drag source.. or are we not?\n\n\n        var _this11$getCurrentSou2 = _this11.getCurrentSourcePreviewNodeOptions(),\n            captureDraggingState = _this11$getCurrentSou2.captureDraggingState;\n\n        if (!captureDraggingState) {\n          // Usually we want to publish it in the next tick so that browser\n          // is able to screenshot the current (not yet dragging) state.\n          //\n          // It also neatly avoids a situation where render() returns null\n          // in the same tick for the source element, and browser freaks out.\n          setTimeout(function () {\n            return _this11.actions.publishDragSource();\n          }, 0);\n        } else {\n          // In some cases the user may want to override this behavior, e.g.\n          // to work around IE not supporting custom drag previews.\n          //\n          // When using a custom drag layer, the only way to prevent\n          // the default drag preview from drawing in IE is to screenshot\n          // the dragging state in which the node itself has zero opacity\n          // and height. In this case, though, returning null from render()\n          // will abruptly end the dragging, which is not obvious.\n          //\n          // This is the reason such behavior is strictly opt-in.\n          _this11.actions.publishDragSource();\n        }\n      } else if (nativeType) {\n        // A native item (such as URL) dragged from inside the document\n        _this11.beginDragNativeItem(nativeType);\n      } else if (dataTransfer && !dataTransfer.types && (e.target && !e.target.hasAttribute || !e.target.hasAttribute('draggable'))) {\n        // Looks like a Safari bug: dataTransfer.types is null, but there was no draggable.\n        // Just let it drag. It's a native type (URL or text) and will be picked up in\n        // dragenter handler.\n        return;\n      } else {\n        // If by this time no drag source reacted, tell browser not to drag.\n        e.preventDefault();\n      }\n    };\n\n    this.handleTopDragEndCapture = function () {\n      if (_this11.clearCurrentDragSourceNode() && _this11.monitor.isDragging()) {\n        // Firefox can dispatch this event in an infinite loop\n        // if dragend handler does something like showing an alert.\n        // Only proceed if we have not handled it already.\n        _this11.actions.endDrag();\n      }\n\n      _this11.cancelHover();\n    };\n\n    this.handleTopDragEnterCapture = function (e) {\n      _this11.dragEnterTargetIds = [];\n\n      if (_this11.isDraggingNativeItem()) {\n        var ref;\n        (ref = _this11.currentNativeSource) === null || ref === void 0 ? void 0 : ref.loadDataTransfer(e.dataTransfer);\n      }\n\n      var isFirstEnter = _this11.enterLeaveCounter.enter(e.target);\n\n      if (!isFirstEnter || _this11.monitor.isDragging()) {\n        return;\n      }\n\n      var dataTransfer = e.dataTransfer;\n      var nativeType = matchNativeItemType(dataTransfer);\n\n      if (nativeType) {\n        // A native item (such as file or URL) dragged from outside the document\n        _this11.beginDragNativeItem(nativeType, dataTransfer);\n      }\n    };\n\n    this.handleTopDragEnter = function (e) {\n      var dragEnterTargetIds = _this11.dragEnterTargetIds;\n      _this11.dragEnterTargetIds = [];\n\n      if (!_this11.monitor.isDragging()) {\n        // This is probably a native item type we don't understand.\n        return;\n      }\n\n      _this11.altKeyPressed = e.altKey; // If the target changes position as the result of `dragenter`, `dragover` might still\n      // get dispatched despite target being no longer there. The easy solution is to check\n      // whether there actually is a target before firing `hover`.\n\n      if (dragEnterTargetIds.length > 0) {\n        _this11.actions.hover(dragEnterTargetIds, {\n          clientOffset: getEventClientOffset$1(e)\n        });\n      }\n\n      var canDrop = dragEnterTargetIds.some(function (targetId) {\n        return _this11.monitor.canDropOnTarget(targetId);\n      });\n\n      if (canDrop) {\n        // IE requires this to fire dragover events\n        e.preventDefault();\n\n        if (e.dataTransfer) {\n          e.dataTransfer.dropEffect = _this11.getCurrentDropEffect();\n        }\n      }\n    };\n\n    this.handleTopDragOverCapture = function (e) {\n      _this11.dragOverTargetIds = [];\n\n      if (_this11.isDraggingNativeItem()) {\n        var ref;\n        (ref = _this11.currentNativeSource) === null || ref === void 0 ? void 0 : ref.loadDataTransfer(e.dataTransfer);\n      }\n    };\n\n    this.handleTopDragOver = function (e) {\n      var dragOverTargetIds = _this11.dragOverTargetIds;\n      _this11.dragOverTargetIds = [];\n\n      if (!_this11.monitor.isDragging()) {\n        // This is probably a native item type we don't understand.\n        // Prevent default \"drop and blow away the whole document\" action.\n        e.preventDefault();\n\n        if (e.dataTransfer) {\n          e.dataTransfer.dropEffect = 'none';\n        }\n\n        return;\n      }\n\n      _this11.altKeyPressed = e.altKey;\n      _this11.lastClientOffset = getEventClientOffset$1(e);\n\n      _this11.scheduleHover(dragOverTargetIds);\n\n      var canDrop = (dragOverTargetIds || []).some(function (targetId) {\n        return _this11.monitor.canDropOnTarget(targetId);\n      });\n\n      if (canDrop) {\n        // Show user-specified drop effect.\n        e.preventDefault();\n\n        if (e.dataTransfer) {\n          e.dataTransfer.dropEffect = _this11.getCurrentDropEffect();\n        }\n      } else if (_this11.isDraggingNativeItem()) {\n        // Don't show a nice cursor but still prevent default\n        // \"drop and blow away the whole document\" action.\n        e.preventDefault();\n      } else {\n        e.preventDefault();\n\n        if (e.dataTransfer) {\n          e.dataTransfer.dropEffect = 'none';\n        }\n      }\n    };\n\n    this.handleTopDragLeaveCapture = function (e) {\n      if (_this11.isDraggingNativeItem()) {\n        e.preventDefault();\n      }\n\n      var isLastLeave = _this11.enterLeaveCounter.leave(e.target);\n\n      if (!isLastLeave) {\n        return;\n      }\n\n      if (_this11.isDraggingNativeItem()) {\n        setTimeout(function () {\n          return _this11.endDragNativeItem();\n        }, 0);\n      }\n\n      _this11.cancelHover();\n    };\n\n    this.handleTopDropCapture = function (e) {\n      _this11.dropTargetIds = [];\n\n      if (_this11.isDraggingNativeItem()) {\n        var ref;\n        e.preventDefault();\n        (ref = _this11.currentNativeSource) === null || ref === void 0 ? void 0 : ref.loadDataTransfer(e.dataTransfer);\n      } else if (matchNativeItemType(e.dataTransfer)) {\n        // Dragging some elements, like <a> and <img> may still behave like a native drag event,\n        // even if the current drag event matches a user-defined type.\n        // Stop the default behavior when we're not expecting a native item to be dropped.\n        e.preventDefault();\n      }\n\n      _this11.enterLeaveCounter.reset();\n    };\n\n    this.handleTopDrop = function (e) {\n      var dropTargetIds = _this11.dropTargetIds;\n      _this11.dropTargetIds = [];\n\n      _this11.actions.hover(dropTargetIds, {\n        clientOffset: getEventClientOffset$1(e)\n      });\n\n      _this11.actions.drop({\n        dropEffect: _this11.getCurrentDropEffect()\n      });\n\n      if (_this11.isDraggingNativeItem()) {\n        _this11.endDragNativeItem();\n      } else if (_this11.monitor.isDragging()) {\n        _this11.actions.endDrag();\n      }\n\n      _this11.cancelHover();\n    };\n\n    this.handleSelectStart = function (e) {\n      var target = e.target; // Only IE requires us to explicitly say\n      // we want drag drop operation to start\n\n      if (typeof target.dragDrop !== 'function') {\n        return;\n      } // Inputs and textareas should be selectable\n\n\n      if (target.tagName === 'INPUT' || target.tagName === 'SELECT' || target.tagName === 'TEXTAREA' || target.isContentEditable) {\n        return;\n      } // For other targets, ask IE\n      // to enable drag and drop\n\n\n      e.preventDefault();\n      target.dragDrop();\n    };\n\n    this.options = new OptionsReader$1(globalContext, options);\n    this.actions = manager.getActions();\n    this.monitor = manager.getMonitor();\n    this.registry = manager.getRegistry();\n    this.enterLeaveCounter = new EnterLeaveCounter(this.isNodeInDocument);\n  }\n\n  _createClass(HTML5BackendImpl, [{\n    key: \"profile\",\n    value:\n    /**\n    * Generate profiling statistics for the HTML5Backend.\n    */\n    function profile() {\n      var ref, ref1;\n      return {\n        sourcePreviewNodes: this.sourcePreviewNodes.size,\n        sourcePreviewNodeOptions: this.sourcePreviewNodeOptions.size,\n        sourceNodeOptions: this.sourceNodeOptions.size,\n        sourceNodes: this.sourceNodes.size,\n        dragStartSourceIds: ((ref = this.dragStartSourceIds) === null || ref === void 0 ? void 0 : ref.length) || 0,\n        dropTargetIds: this.dropTargetIds.length,\n        dragEnterTargetIds: this.dragEnterTargetIds.length,\n        dragOverTargetIds: ((ref1 = this.dragOverTargetIds) === null || ref1 === void 0 ? void 0 : ref1.length) || 0\n      };\n    } // public for test\n\n  }, {\n    key: \"window\",\n    get: function get() {\n      return this.options.window;\n    }\n  }, {\n    key: \"document\",\n    get: function get() {\n      return this.options.document;\n    }\n    /**\n    * Get the root element to use for event subscriptions\n    */\n\n  }, {\n    key: \"rootElement\",\n    get: function get() {\n      return this.options.rootElement;\n    }\n  }, {\n    key: \"setup\",\n    value: function setup() {\n      var root = this.rootElement;\n\n      if (root === undefined) {\n        return;\n      }\n\n      if (root.__isReactDndBackendSetUp) {\n        throw new Error('Cannot have two HTML5 backends at the same time.');\n      }\n\n      root.__isReactDndBackendSetUp = true;\n      this.addEventListeners(root);\n    }\n  }, {\n    key: \"teardown\",\n    value: function teardown() {\n      var root = this.rootElement;\n\n      if (root === undefined) {\n        return;\n      }\n\n      root.__isReactDndBackendSetUp = false;\n      this.removeEventListeners(this.rootElement);\n      this.clearCurrentDragSourceNode();\n\n      if (this.asyncEndDragFrameId) {\n        var ref;\n        (ref = this.window) === null || ref === void 0 ? void 0 : ref.cancelAnimationFrame(this.asyncEndDragFrameId);\n      }\n    }\n  }, {\n    key: \"connectDragPreview\",\n    value: function connectDragPreview(sourceId, node, options) {\n      var _this12 = this;\n\n      this.sourcePreviewNodeOptions.set(sourceId, options);\n      this.sourcePreviewNodes.set(sourceId, node);\n      return function () {\n        _this12.sourcePreviewNodes.delete(sourceId);\n\n        _this12.sourcePreviewNodeOptions.delete(sourceId);\n      };\n    }\n  }, {\n    key: \"connectDragSource\",\n    value: function connectDragSource(sourceId, node, options) {\n      var _this13 = this;\n\n      this.sourceNodes.set(sourceId, node);\n      this.sourceNodeOptions.set(sourceId, options);\n\n      var handleDragStart = function handleDragStart(e) {\n        return _this13.handleDragStart(e, sourceId);\n      };\n\n      var handleSelectStart = function handleSelectStart(e) {\n        return _this13.handleSelectStart(e);\n      };\n\n      node.setAttribute('draggable', 'true');\n      node.addEventListener('dragstart', handleDragStart);\n      node.addEventListener('selectstart', handleSelectStart);\n      return function () {\n        _this13.sourceNodes.delete(sourceId);\n\n        _this13.sourceNodeOptions.delete(sourceId);\n\n        node.removeEventListener('dragstart', handleDragStart);\n        node.removeEventListener('selectstart', handleSelectStart);\n        node.setAttribute('draggable', 'false');\n      };\n    }\n  }, {\n    key: \"connectDropTarget\",\n    value: function connectDropTarget(targetId, node) {\n      var _this14 = this;\n\n      var handleDragEnter = function handleDragEnter(e) {\n        return _this14.handleDragEnter(e, targetId);\n      };\n\n      var handleDragOver = function handleDragOver(e) {\n        return _this14.handleDragOver(e, targetId);\n      };\n\n      var handleDrop = function handleDrop(e) {\n        return _this14.handleDrop(e, targetId);\n      };\n\n      node.addEventListener('dragenter', handleDragEnter);\n      node.addEventListener('dragover', handleDragOver);\n      node.addEventListener('drop', handleDrop);\n      return function () {\n        node.removeEventListener('dragenter', handleDragEnter);\n        node.removeEventListener('dragover', handleDragOver);\n        node.removeEventListener('drop', handleDrop);\n      };\n    }\n  }, {\n    key: \"addEventListeners\",\n    value: function addEventListeners(target) {\n      // SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n      if (!target.addEventListener) {\n        return;\n      }\n\n      target.addEventListener('dragstart', this.handleTopDragStart);\n      target.addEventListener('dragstart', this.handleTopDragStartCapture, true);\n      target.addEventListener('dragend', this.handleTopDragEndCapture, true);\n      target.addEventListener('dragenter', this.handleTopDragEnter);\n      target.addEventListener('dragenter', this.handleTopDragEnterCapture, true);\n      target.addEventListener('dragleave', this.handleTopDragLeaveCapture, true);\n      target.addEventListener('dragover', this.handleTopDragOver);\n      target.addEventListener('dragover', this.handleTopDragOverCapture, true);\n      target.addEventListener('drop', this.handleTopDrop);\n      target.addEventListener('drop', this.handleTopDropCapture, true);\n    }\n  }, {\n    key: \"removeEventListeners\",\n    value: function removeEventListeners(target) {\n      // SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n      if (!target.removeEventListener) {\n        return;\n      }\n\n      target.removeEventListener('dragstart', this.handleTopDragStart);\n      target.removeEventListener('dragstart', this.handleTopDragStartCapture, true);\n      target.removeEventListener('dragend', this.handleTopDragEndCapture, true);\n      target.removeEventListener('dragenter', this.handleTopDragEnter);\n      target.removeEventListener('dragenter', this.handleTopDragEnterCapture, true);\n      target.removeEventListener('dragleave', this.handleTopDragLeaveCapture, true);\n      target.removeEventListener('dragover', this.handleTopDragOver);\n      target.removeEventListener('dragover', this.handleTopDragOverCapture, true);\n      target.removeEventListener('drop', this.handleTopDrop);\n      target.removeEventListener('drop', this.handleTopDropCapture, true);\n    }\n  }, {\n    key: \"getCurrentSourceNodeOptions\",\n    value: function getCurrentSourceNodeOptions() {\n      var sourceId = this.monitor.getSourceId();\n      var sourceNodeOptions = this.sourceNodeOptions.get(sourceId);\n      return _objectSpread({\n        dropEffect: this.altKeyPressed ? 'copy' : 'move'\n      }, sourceNodeOptions || {});\n    }\n  }, {\n    key: \"getCurrentDropEffect\",\n    value: function getCurrentDropEffect() {\n      if (this.isDraggingNativeItem()) {\n        // It makes more sense to default to 'copy' for native resources\n        return 'copy';\n      }\n\n      return this.getCurrentSourceNodeOptions().dropEffect;\n    }\n  }, {\n    key: \"getCurrentSourcePreviewNodeOptions\",\n    value: function getCurrentSourcePreviewNodeOptions() {\n      var sourceId = this.monitor.getSourceId();\n      var sourcePreviewNodeOptions = this.sourcePreviewNodeOptions.get(sourceId);\n      return _objectSpread({\n        anchorX: 0.5,\n        anchorY: 0.5,\n        captureDraggingState: false\n      }, sourcePreviewNodeOptions || {});\n    }\n  }, {\n    key: \"isDraggingNativeItem\",\n    value: function isDraggingNativeItem() {\n      var itemType = this.monitor.getItemType();\n      return Object.keys(NativeTypes).some(function (key) {\n        return NativeTypes[key] === itemType;\n      });\n    }\n  }, {\n    key: \"beginDragNativeItem\",\n    value: function beginDragNativeItem(type, dataTransfer) {\n      this.clearCurrentDragSourceNode();\n      this.currentNativeSource = createNativeDragSource(type, dataTransfer);\n      this.currentNativeHandle = this.registry.addSource(type, this.currentNativeSource);\n      this.actions.beginDrag([this.currentNativeHandle]);\n    }\n  }, {\n    key: \"setCurrentDragSourceNode\",\n    value: function setCurrentDragSourceNode(node) {\n      var _this15 = this;\n\n      this.clearCurrentDragSourceNode();\n      this.currentDragSourceNode = node; // A timeout of > 0 is necessary to resolve Firefox issue referenced\n      // See:\n      //   * https://github.com/react-dnd/react-dnd/pull/928\n      //   * https://github.com/react-dnd/react-dnd/issues/869\n\n      var MOUSE_MOVE_TIMEOUT = 1000; // Receiving a mouse event in the middle of a dragging operation\n      // means it has ended and the drag source node disappeared from DOM,\n      // so the browser didn't dispatch the dragend event.\n      //\n      // We need to wait before we start listening for mousemove events.\n      // This is needed because the drag preview needs to be drawn or else it fires an 'mousemove' event\n      // immediately in some browsers.\n      //\n      // See:\n      //   * https://github.com/react-dnd/react-dnd/pull/928\n      //   * https://github.com/react-dnd/react-dnd/issues/869\n      //\n\n      this.mouseMoveTimeoutTimer = setTimeout(function () {\n        var ref;\n        return (ref = _this15.rootElement) === null || ref === void 0 ? void 0 : ref.addEventListener('mousemove', _this15.endDragIfSourceWasRemovedFromDOM, true);\n      }, MOUSE_MOVE_TIMEOUT);\n    }\n  }, {\n    key: \"clearCurrentDragSourceNode\",\n    value: function clearCurrentDragSourceNode() {\n      if (this.currentDragSourceNode) {\n        this.currentDragSourceNode = null;\n\n        if (this.rootElement) {\n          var ref;\n          (ref = this.window) === null || ref === void 0 ? void 0 : ref.clearTimeout(this.mouseMoveTimeoutTimer || undefined);\n          this.rootElement.removeEventListener('mousemove', this.endDragIfSourceWasRemovedFromDOM, true);\n        }\n\n        this.mouseMoveTimeoutTimer = null;\n        return true;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"handleDragStart\",\n    value: function handleDragStart(e, sourceId) {\n      if (e.defaultPrevented) {\n        return;\n      }\n\n      if (!this.dragStartSourceIds) {\n        this.dragStartSourceIds = [];\n      }\n\n      this.dragStartSourceIds.unshift(sourceId);\n    }\n  }, {\n    key: \"handleDragEnter\",\n    value: function handleDragEnter(_e, targetId) {\n      this.dragEnterTargetIds.unshift(targetId);\n    }\n  }, {\n    key: \"handleDragOver\",\n    value: function handleDragOver(_e, targetId) {\n      if (this.dragOverTargetIds === null) {\n        this.dragOverTargetIds = [];\n      }\n\n      this.dragOverTargetIds.unshift(targetId);\n    }\n  }, {\n    key: \"handleDrop\",\n    value: function handleDrop(_e, targetId) {\n      this.dropTargetIds.unshift(targetId);\n    }\n  }]);\n\n  return HTML5BackendImpl;\n}();\n\nvar emptyImage;\n\nfunction getEmptyImage() {\n  if (!emptyImage) {\n    emptyImage = new Image();\n    emptyImage.src = 'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==';\n  }\n\n  return emptyImage;\n}\n\nvar HTML5Backend = function createBackend(manager, context, options) {\n  return new HTML5BackendImpl(manager, context, options);\n};\n\nvar ListenerType;\n\n(function (ListenerType) {\n  ListenerType[\"mouse\"] = \"mouse\";\n  ListenerType[\"touch\"] = \"touch\";\n  ListenerType[\"keyboard\"] = \"keyboard\";\n})(ListenerType || (ListenerType = {}));\n\nvar OptionsReader = /*#__PURE__*/function () {\n  function OptionsReader(args, context) {\n    _classCallCheck(this, OptionsReader);\n\n    this.args = args;\n    this.context = context;\n  }\n\n  _createClass(OptionsReader, [{\n    key: \"delay\",\n    get: function get() {\n      var _delay;\n\n      return (_delay = this.args.delay) !== null && _delay !== void 0 ? _delay : 0;\n    }\n  }, {\n    key: \"scrollAngleRanges\",\n    get: function get() {\n      return this.args.scrollAngleRanges;\n    }\n  }, {\n    key: \"getDropTargetElementsAtPoint\",\n    get: function get() {\n      return this.args.getDropTargetElementsAtPoint;\n    }\n  }, {\n    key: \"ignoreContextMenu\",\n    get: function get() {\n      var _ignoreContextMenu;\n\n      return (_ignoreContextMenu = this.args.ignoreContextMenu) !== null && _ignoreContextMenu !== void 0 ? _ignoreContextMenu : false;\n    }\n  }, {\n    key: \"enableHoverOutsideTarget\",\n    get: function get() {\n      var _enableHoverOutsideTarget;\n\n      return (_enableHoverOutsideTarget = this.args.enableHoverOutsideTarget) !== null && _enableHoverOutsideTarget !== void 0 ? _enableHoverOutsideTarget : false;\n    }\n  }, {\n    key: \"enableKeyboardEvents\",\n    get: function get() {\n      var _enableKeyboardEvents;\n\n      return (_enableKeyboardEvents = this.args.enableKeyboardEvents) !== null && _enableKeyboardEvents !== void 0 ? _enableKeyboardEvents : false;\n    }\n  }, {\n    key: \"enableMouseEvents\",\n    get: function get() {\n      var _enableMouseEvents;\n\n      return (_enableMouseEvents = this.args.enableMouseEvents) !== null && _enableMouseEvents !== void 0 ? _enableMouseEvents : false;\n    }\n  }, {\n    key: \"enableTouchEvents\",\n    get: function get() {\n      var _enableTouchEvents;\n\n      return (_enableTouchEvents = this.args.enableTouchEvents) !== null && _enableTouchEvents !== void 0 ? _enableTouchEvents : true;\n    }\n  }, {\n    key: \"touchSlop\",\n    get: function get() {\n      return this.args.touchSlop || 0;\n    }\n  }, {\n    key: \"delayTouchStart\",\n    get: function get() {\n      var ref, ref1;\n      var ref2, ref3;\n      return (ref3 = (ref2 = (ref = this.args) === null || ref === void 0 ? void 0 : ref.delayTouchStart) !== null && ref2 !== void 0 ? ref2 : (ref1 = this.args) === null || ref1 === void 0 ? void 0 : ref1.delay) !== null && ref3 !== void 0 ? ref3 : 0;\n    }\n  }, {\n    key: \"delayMouseStart\",\n    get: function get() {\n      var ref, ref4;\n      var ref5, ref6;\n      return (ref6 = (ref5 = (ref = this.args) === null || ref === void 0 ? void 0 : ref.delayMouseStart) !== null && ref5 !== void 0 ? ref5 : (ref4 = this.args) === null || ref4 === void 0 ? void 0 : ref4.delay) !== null && ref6 !== void 0 ? ref6 : 0;\n    }\n  }, {\n    key: \"window\",\n    get: function get() {\n      if (this.context && this.context.window) {\n        return this.context.window;\n      } else if (typeof window !== 'undefined') {\n        return window;\n      }\n\n      return undefined;\n    }\n  }, {\n    key: \"document\",\n    get: function get() {\n      var ref;\n\n      if ((ref = this.context) === null || ref === void 0 ? void 0 : ref.document) {\n        return this.context.document;\n      }\n\n      if (this.window) {\n        return this.window.document;\n      }\n\n      return undefined;\n    }\n  }, {\n    key: \"rootElement\",\n    get: function get() {\n      var ref;\n      return ((ref = this.args) === null || ref === void 0 ? void 0 : ref.rootElement) || this.document;\n    }\n  }]);\n\n  return OptionsReader;\n}();\n\nfunction distance(x1, y1, x2, y2) {\n  return Math.sqrt(Math.pow(Math.abs(x2 - x1), 2) + Math.pow(Math.abs(y2 - y1), 2));\n}\n\nfunction inAngleRanges(x1, y1, x2, y2, angleRanges) {\n  if (!angleRanges) {\n    return false;\n  }\n\n  var angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI + 180;\n\n  for (var i = 0; i < angleRanges.length; ++i) {\n    var ar = angleRanges[i];\n\n    if (ar && (ar.start == null || angle >= ar.start) && (ar.end == null || angle <= ar.end)) {\n      return true;\n    }\n  }\n\n  return false;\n} // Used for MouseEvent.buttons (note the s on the end).\n\n\nvar MouseButtons = {\n  Left: 1,\n  Right: 2,\n  Center: 4\n}; // Used for e.button (note the lack of an s on the end).\n\nvar MouseButton = {\n  Left: 0,\n  Center: 1,\n  Right: 2\n};\n/**\n * Only touch events and mouse events where the left button is pressed should initiate a drag.\n * @param {MouseEvent | TouchEvent} e The event\n */\n\nfunction eventShouldStartDrag(e) {\n  // For touch events, button will be undefined. If e.button is defined,\n  // then it should be MouseButton.Left.\n  return e.button === undefined || e.button === MouseButton.Left;\n}\n/**\n * Only touch events and mouse events where the left mouse button is no longer held should end a drag.\n * It's possible the user mouse downs with the left mouse button, then mouse down and ups with the right mouse button.\n * We don't want releasing the right mouse button to end the drag.\n * @param {MouseEvent | TouchEvent} e The event\n */\n\n\nfunction eventShouldEndDrag(e) {\n  // Touch events will have buttons be undefined, while mouse events will have e.buttons's left button\n  // bit field unset if the left mouse button has been released\n  return e.buttons === undefined || (e.buttons & MouseButtons.Left) === 0;\n}\n\nfunction isTouchEvent(e) {\n  return !!e.targetTouches;\n}\n\nvar ELEMENT_NODE = 1;\n\nfunction getNodeClientOffset(node) {\n  var el = node.nodeType === ELEMENT_NODE ? node : node.parentElement;\n\n  if (!el) {\n    return undefined;\n  }\n\n  var _el$getBoundingClient2 = el.getBoundingClientRect(),\n      top = _el$getBoundingClient2.top,\n      left = _el$getBoundingClient2.left;\n\n  return {\n    x: left,\n    y: top\n  };\n}\n\nfunction getEventClientTouchOffset(e, lastTargetTouchFallback) {\n  if (e.targetTouches.length === 1) {\n    return getEventClientOffset(e.targetTouches[0]);\n  } else if (lastTargetTouchFallback && e.touches.length === 1) {\n    if (e.touches[0].target === lastTargetTouchFallback.target) {\n      return getEventClientOffset(e.touches[0]);\n    }\n  }\n\n  return;\n}\n\nfunction getEventClientOffset(e, lastTargetTouchFallback) {\n  if (isTouchEvent(e)) {\n    return getEventClientTouchOffset(e, lastTargetTouchFallback);\n  } else {\n    return {\n      x: e.clientX,\n      y: e.clientY\n    };\n  }\n}\n\nvar supportsPassive = function () {\n  // simular to jQuery's test\n  var supported = false;\n\n  try {\n    addEventListener('test', function () {// do nothing\n    }, Object.defineProperty({}, 'passive', {\n      get: function get() {\n        supported = true;\n        return true;\n      }\n    }));\n  } catch (e) {// do nothing\n  }\n\n  return supported;\n}();\n\nvar eventNames = (_eventNames = {}, _defineProperty2(_eventNames, ListenerType.mouse, {\n  start: 'mousedown',\n  move: 'mousemove',\n  end: 'mouseup',\n  contextmenu: 'contextmenu'\n}), _defineProperty2(_eventNames, ListenerType.touch, {\n  start: 'touchstart',\n  move: 'touchmove',\n  end: 'touchend'\n}), _defineProperty2(_eventNames, ListenerType.keyboard, {\n  keydown: 'keydown'\n}), _eventNames);\n\nvar TouchBackendImpl = /*#__PURE__*/function () {\n  function TouchBackendImpl(manager, context, options) {\n    var _this16 = this;\n\n    _classCallCheck(this, TouchBackendImpl);\n\n    this.getSourceClientOffset = function (sourceId) {\n      var element = _this16.sourceNodes.get(sourceId);\n\n      return element && getNodeClientOffset(element);\n    };\n\n    this.handleTopMoveStartCapture = function (e) {\n      if (!eventShouldStartDrag(e)) {\n        return;\n      }\n\n      _this16.moveStartSourceIds = [];\n    };\n\n    this.handleMoveStart = function (sourceId) {\n      // Just because we received an event doesn't necessarily mean we need to collect drag sources.\n      // We only collect start collecting drag sources on touch and left mouse events.\n      if (Array.isArray(_this16.moveStartSourceIds)) {\n        _this16.moveStartSourceIds.unshift(sourceId);\n      }\n    };\n\n    this.handleTopMoveStart = function (e) {\n      if (!eventShouldStartDrag(e)) {\n        return;\n      } // Don't prematurely preventDefault() here since it might:\n      // 1. Mess up scrolling\n      // 2. Mess up long tap (which brings up context menu)\n      // 3. If there's an anchor link as a child, tap won't be triggered on link\n\n\n      var clientOffset = getEventClientOffset(e);\n\n      if (clientOffset) {\n        if (isTouchEvent(e)) {\n          _this16.lastTargetTouchFallback = e.targetTouches[0];\n        }\n\n        _this16._mouseClientOffset = clientOffset;\n      }\n\n      _this16.waitingForDelay = false;\n    };\n\n    this.handleTopMoveStartDelay = function (e) {\n      if (!eventShouldStartDrag(e)) {\n        return;\n      }\n\n      var delay = e.type === eventNames.touch.start ? _this16.options.delayTouchStart : _this16.options.delayMouseStart;\n      _this16.timeout = setTimeout(_this16.handleTopMoveStart.bind(_this16, e), delay);\n      _this16.waitingForDelay = true;\n    };\n\n    this.handleTopMoveCapture = function () {\n      _this16.dragOverTargetIds = [];\n    };\n\n    this.handleMove = function (_evt, targetId) {\n      if (_this16.dragOverTargetIds) {\n        _this16.dragOverTargetIds.unshift(targetId);\n      }\n    };\n\n    this.handleTopMove = function (e1) {\n      if (_this16.timeout) {\n        clearTimeout(_this16.timeout);\n      }\n\n      if (!_this16.document || _this16.waitingForDelay) {\n        return;\n      }\n\n      var moveStartSourceIds = _this16.moveStartSourceIds,\n          dragOverTargetIds = _this16.dragOverTargetIds;\n      var enableHoverOutsideTarget = _this16.options.enableHoverOutsideTarget;\n      var clientOffset = getEventClientOffset(e1, _this16.lastTargetTouchFallback);\n\n      if (!clientOffset) {\n        return;\n      } // If the touch move started as a scroll, or is is between the scroll angles\n\n\n      if (_this16._isScrolling || !_this16.monitor.isDragging() && inAngleRanges(_this16._mouseClientOffset.x || 0, _this16._mouseClientOffset.y || 0, clientOffset.x, clientOffset.y, _this16.options.scrollAngleRanges)) {\n        _this16._isScrolling = true;\n        return;\n      } // If we're not dragging and we've moved a little, that counts as a drag start\n\n\n      if (!_this16.monitor.isDragging() && // eslint-disable-next-line no-prototype-builtins\n      _this16._mouseClientOffset.hasOwnProperty('x') && moveStartSourceIds && distance(_this16._mouseClientOffset.x || 0, _this16._mouseClientOffset.y || 0, clientOffset.x, clientOffset.y) > (_this16.options.touchSlop ? _this16.options.touchSlop : 0)) {\n        _this16.moveStartSourceIds = undefined;\n\n        _this16.actions.beginDrag(moveStartSourceIds, {\n          clientOffset: _this16._mouseClientOffset,\n          getSourceClientOffset: _this16.getSourceClientOffset,\n          publishSource: false\n        });\n      }\n\n      if (!_this16.monitor.isDragging()) {\n        return;\n      }\n\n      var sourceNode = _this16.sourceNodes.get(_this16.monitor.getSourceId());\n\n      _this16.installSourceNodeRemovalObserver(sourceNode);\n\n      _this16.actions.publishDragSource();\n\n      if (e1.cancelable) e1.preventDefault(); // Get the node elements of the hovered DropTargets\n\n      var dragOverTargetNodes = (dragOverTargetIds || []).map(function (key) {\n        return _this16.targetNodes.get(key);\n      }).filter(function (e) {\n        return !!e;\n      }); // Get the a ordered list of nodes that are touched by\n\n      var elementsAtPoint = _this16.options.getDropTargetElementsAtPoint ? _this16.options.getDropTargetElementsAtPoint(clientOffset.x, clientOffset.y, dragOverTargetNodes) : _this16.document.elementsFromPoint(clientOffset.x, clientOffset.y); // Extend list with parents that are not receiving elementsFromPoint events (size 0 elements and svg groups)\n\n      var elementsAtPointExtended = [];\n\n      for (var nodeId in elementsAtPoint) {\n        // eslint-disable-next-line no-prototype-builtins\n        if (!elementsAtPoint.hasOwnProperty(nodeId)) {\n          continue;\n        }\n\n        var currentNode = elementsAtPoint[nodeId];\n\n        if (currentNode != null) {\n          elementsAtPointExtended.push(currentNode);\n        }\n\n        while (currentNode) {\n          currentNode = currentNode.parentElement;\n\n          if (currentNode && elementsAtPointExtended.indexOf(currentNode) === -1) {\n            elementsAtPointExtended.push(currentNode);\n          }\n        }\n      }\n\n      var orderedDragOverTargetIds = elementsAtPointExtended // Filter off nodes that arent a hovered DropTargets nodes\n      .filter(function (node) {\n        return dragOverTargetNodes.indexOf(node) > -1;\n      }) // Map back the nodes elements to targetIds\n      .map(function (node) {\n        return _this16._getDropTargetId(node);\n      }) // Filter off possible null rows\n      .filter(function (node) {\n        return !!node;\n      }).filter(function (id, index, ids) {\n        return ids.indexOf(id) === index;\n      }); // Invoke hover for drop targets when source node is still over and pointer is outside\n\n      if (enableHoverOutsideTarget) {\n        for (var targetId in _this16.targetNodes) {\n          var targetNode = _this16.targetNodes.get(targetId);\n\n          if (sourceNode && targetNode && targetNode.contains(sourceNode) && orderedDragOverTargetIds.indexOf(targetId) === -1) {\n            orderedDragOverTargetIds.unshift(targetId);\n            break;\n          }\n        }\n      } // Reverse order because dnd-core reverse it before calling the DropTarget drop methods\n\n\n      orderedDragOverTargetIds.reverse();\n\n      _this16.actions.hover(orderedDragOverTargetIds, {\n        clientOffset: clientOffset\n      });\n    };\n    /**\n    *\n    * visible for testing\n    */\n\n\n    this._getDropTargetId = function (node) {\n      var keys = _this16.targetNodes.keys();\n\n      var next = keys.next();\n\n      while (next.done === false) {\n        var targetId = next.value;\n\n        if (node === _this16.targetNodes.get(targetId)) {\n          return targetId;\n        } else {\n          next = keys.next();\n        }\n      }\n\n      return undefined;\n    };\n\n    this.handleTopMoveEndCapture = function (e) {\n      _this16._isScrolling = false;\n      _this16.lastTargetTouchFallback = undefined;\n\n      if (!eventShouldEndDrag(e)) {\n        return;\n      }\n\n      if (!_this16.monitor.isDragging() || _this16.monitor.didDrop()) {\n        _this16.moveStartSourceIds = undefined;\n        return;\n      }\n\n      if (e.cancelable) e.preventDefault();\n      _this16._mouseClientOffset = {};\n\n      _this16.uninstallSourceNodeRemovalObserver();\n\n      _this16.actions.drop();\n\n      _this16.actions.endDrag();\n    };\n\n    this.handleCancelOnEscape = function (e) {\n      if (e.key === 'Escape' && _this16.monitor.isDragging()) {\n        _this16._mouseClientOffset = {};\n\n        _this16.uninstallSourceNodeRemovalObserver();\n\n        _this16.actions.endDrag();\n      }\n    };\n\n    this.options = new OptionsReader(options, context);\n    this.actions = manager.getActions();\n    this.monitor = manager.getMonitor();\n    this.sourceNodes = new Map();\n    this.sourcePreviewNodes = new Map();\n    this.sourcePreviewNodeOptions = new Map();\n    this.targetNodes = new Map();\n    this.listenerTypes = [];\n    this._mouseClientOffset = {};\n    this._isScrolling = false;\n\n    if (this.options.enableMouseEvents) {\n      this.listenerTypes.push(ListenerType.mouse);\n    }\n\n    if (this.options.enableTouchEvents) {\n      this.listenerTypes.push(ListenerType.touch);\n    }\n\n    if (this.options.enableKeyboardEvents) {\n      this.listenerTypes.push(ListenerType.keyboard);\n    }\n  }\n\n  _createClass(TouchBackendImpl, [{\n    key: \"profile\",\n    value:\n    /**\n    * Generate profiling statistics for the HTML5Backend.\n    */\n    function profile() {\n      var ref;\n      return {\n        sourceNodes: this.sourceNodes.size,\n        sourcePreviewNodes: this.sourcePreviewNodes.size,\n        sourcePreviewNodeOptions: this.sourcePreviewNodeOptions.size,\n        targetNodes: this.targetNodes.size,\n        dragOverTargetIds: ((ref = this.dragOverTargetIds) === null || ref === void 0 ? void 0 : ref.length) || 0\n      };\n    } // public for test\n\n  }, {\n    key: \"document\",\n    get: function get() {\n      return this.options.document;\n    }\n  }, {\n    key: \"setup\",\n    value: function setup() {\n      var root = this.options.rootElement;\n\n      if (!root) {\n        return;\n      }\n\n      invariant(!TouchBackendImpl.isSetUp, 'Cannot have two Touch backends at the same time.');\n      TouchBackendImpl.isSetUp = true;\n      this.addEventListener(root, 'start', this.getTopMoveStartHandler());\n      this.addEventListener(root, 'start', this.handleTopMoveStartCapture, true);\n      this.addEventListener(root, 'move', this.handleTopMove);\n      this.addEventListener(root, 'move', this.handleTopMoveCapture, true);\n      this.addEventListener(root, 'end', this.handleTopMoveEndCapture, true);\n\n      if (this.options.enableMouseEvents && !this.options.ignoreContextMenu) {\n        this.addEventListener(root, 'contextmenu', this.handleTopMoveEndCapture);\n      }\n\n      if (this.options.enableKeyboardEvents) {\n        this.addEventListener(root, 'keydown', this.handleCancelOnEscape, true);\n      }\n    }\n  }, {\n    key: \"teardown\",\n    value: function teardown() {\n      var root = this.options.rootElement;\n\n      if (!root) {\n        return;\n      }\n\n      TouchBackendImpl.isSetUp = false;\n      this._mouseClientOffset = {};\n      this.removeEventListener(root, 'start', this.handleTopMoveStartCapture, true);\n      this.removeEventListener(root, 'start', this.handleTopMoveStart);\n      this.removeEventListener(root, 'move', this.handleTopMoveCapture, true);\n      this.removeEventListener(root, 'move', this.handleTopMove);\n      this.removeEventListener(root, 'end', this.handleTopMoveEndCapture, true);\n\n      if (this.options.enableMouseEvents && !this.options.ignoreContextMenu) {\n        this.removeEventListener(root, 'contextmenu', this.handleTopMoveEndCapture);\n      }\n\n      if (this.options.enableKeyboardEvents) {\n        this.removeEventListener(root, 'keydown', this.handleCancelOnEscape, true);\n      }\n\n      this.uninstallSourceNodeRemovalObserver();\n    }\n  }, {\n    key: \"addEventListener\",\n    value: function addEventListener(subject, event, handler) {\n      var capture = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n      var options = supportsPassive ? {\n        capture: capture,\n        passive: false\n      } : capture;\n      this.listenerTypes.forEach(function (listenerType) {\n        var evt = eventNames[listenerType][event];\n\n        if (evt) {\n          subject.addEventListener(evt, handler, options);\n        }\n      });\n    }\n  }, {\n    key: \"removeEventListener\",\n    value: function removeEventListener(subject, event, handler) {\n      var capture = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n      var options = supportsPassive ? {\n        capture: capture,\n        passive: false\n      } : capture;\n      this.listenerTypes.forEach(function (listenerType) {\n        var evt = eventNames[listenerType][event];\n\n        if (evt) {\n          subject.removeEventListener(evt, handler, options);\n        }\n      });\n    }\n  }, {\n    key: \"connectDragSource\",\n    value: function connectDragSource(sourceId, node) {\n      var _this17 = this;\n\n      var handleMoveStart = this.handleMoveStart.bind(this, sourceId);\n      this.sourceNodes.set(sourceId, node);\n      this.addEventListener(node, 'start', handleMoveStart);\n      return function () {\n        _this17.sourceNodes.delete(sourceId);\n\n        _this17.removeEventListener(node, 'start', handleMoveStart);\n      };\n    }\n  }, {\n    key: \"connectDragPreview\",\n    value: function connectDragPreview(sourceId, node, options) {\n      var _this18 = this;\n\n      this.sourcePreviewNodeOptions.set(sourceId, options);\n      this.sourcePreviewNodes.set(sourceId, node);\n      return function () {\n        _this18.sourcePreviewNodes.delete(sourceId);\n\n        _this18.sourcePreviewNodeOptions.delete(sourceId);\n      };\n    }\n  }, {\n    key: \"connectDropTarget\",\n    value: function connectDropTarget(targetId, node) {\n      var _this19 = this;\n\n      var root = this.options.rootElement;\n\n      if (!this.document || !root) {\n        return function () {\n          /* noop */\n        };\n      }\n\n      var handleMove = function handleMove(e) {\n        if (!_this19.document || !root || !_this19.monitor.isDragging()) {\n          return;\n        }\n\n        var coords;\n        /**\n        * Grab the coordinates for the current mouse/touch position\n        */\n\n        switch (e.type) {\n          case eventNames.mouse.move:\n            coords = {\n              x: e.clientX,\n              y: e.clientY\n            };\n            break;\n\n          case eventNames.touch.move:\n            var ref, ref1;\n            coords = {\n              x: ((ref = e.touches[0]) === null || ref === void 0 ? void 0 : ref.clientX) || 0,\n              y: ((ref1 = e.touches[0]) === null || ref1 === void 0 ? void 0 : ref1.clientY) || 0\n            };\n            break;\n        }\n        /**\n        * Use the coordinates to grab the element the drag ended on.\n        * If the element is the same as the target node (or any of it's children) then we have hit a drop target and can handle the move.\n        */\n\n\n        var droppedOn = coords != null ? _this19.document.elementFromPoint(coords.x, coords.y) : undefined;\n        var childMatch = droppedOn && node.contains(droppedOn);\n\n        if (droppedOn === node || childMatch) {\n          return _this19.handleMove(e, targetId);\n        }\n      };\n      /**\n      * Attaching the event listener to the body so that touchmove will work while dragging over multiple target elements.\n      */\n\n\n      this.addEventListener(this.document.body, 'move', handleMove);\n      this.targetNodes.set(targetId, node);\n      return function () {\n        if (_this19.document) {\n          _this19.targetNodes.delete(targetId);\n\n          _this19.removeEventListener(_this19.document.body, 'move', handleMove);\n        }\n      };\n    }\n  }, {\n    key: \"getTopMoveStartHandler\",\n    value: function getTopMoveStartHandler() {\n      if (!this.options.delayTouchStart && !this.options.delayMouseStart) {\n        return this.handleTopMoveStart;\n      }\n\n      return this.handleTopMoveStartDelay;\n    }\n  }, {\n    key: \"installSourceNodeRemovalObserver\",\n    value: function installSourceNodeRemovalObserver(node) {\n      var _this20 = this;\n\n      this.uninstallSourceNodeRemovalObserver();\n      this.draggedSourceNode = node;\n      this.draggedSourceNodeRemovalObserver = new MutationObserver(function () {\n        if (node && !node.parentElement) {\n          _this20.resurrectSourceNode();\n\n          _this20.uninstallSourceNodeRemovalObserver();\n        }\n      });\n\n      if (!node || !node.parentElement) {\n        return;\n      }\n\n      this.draggedSourceNodeRemovalObserver.observe(node.parentElement, {\n        childList: true\n      });\n    }\n  }, {\n    key: \"resurrectSourceNode\",\n    value: function resurrectSourceNode() {\n      if (this.document && this.draggedSourceNode) {\n        this.draggedSourceNode.style.display = 'none';\n        this.draggedSourceNode.removeAttribute('data-reactid');\n        this.document.body.appendChild(this.draggedSourceNode);\n      }\n    }\n  }, {\n    key: \"uninstallSourceNodeRemovalObserver\",\n    value: function uninstallSourceNodeRemovalObserver() {\n      if (this.draggedSourceNodeRemovalObserver) {\n        this.draggedSourceNodeRemovalObserver.disconnect();\n      }\n\n      this.draggedSourceNodeRemovalObserver = undefined;\n      this.draggedSourceNode = undefined;\n    }\n  }]);\n\n  return TouchBackendImpl;\n}();\n\nvar TouchBackend = function createBackend(manager) {\n  var context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  return new TouchBackendImpl(manager, context, options);\n};\n\nvar COLUMNS = 'abcdefgh'.split('');\nvar chessboardDefaultProps = {\n  animationDuration: 300,\n  areArrowsAllowed: true,\n  arePiecesDraggable: true,\n  arePremovesAllowed: false,\n  boardOrientation: 'white',\n  boardWidth: 560,\n  clearPremovesOnRightClick: true,\n  customArrows: [],\n  customArrowColor: 'rgb(255,170,0)',\n  customBoardStyle: {},\n  customDarkSquareStyle: {\n    backgroundColor: '#B58863'\n  },\n  customDndBackend: undefined,\n  customDndBackendOptions: undefined,\n  customDropSquareStyle: {\n    boxShadow: 'inset 0 0 1px 6px rgba(255,255,255,0.75)'\n  },\n  customLightSquareStyle: {\n    backgroundColor: '#F0D9B5'\n  },\n  customPieces: {},\n  customPremoveDarkSquareStyle: {\n    backgroundColor: '#A42323'\n  },\n  customPremoveLightSquareStyle: {\n    backgroundColor: '#BD2828'\n  },\n  customSquareStyles: {},\n  dropOffBoardAction: 'snapback',\n  id: 0,\n  isDraggablePiece: function isDraggablePiece() {\n    return true;\n  },\n  getPositionObject: function getPositionObject() {},\n  onArrowsChange: function onArrowsChange() {},\n  onDragOverSquare: function onDragOverSquare() {},\n  onMouseOutSquare: function onMouseOutSquare() {},\n  onMouseOverSquare: function onMouseOverSquare() {},\n  onPieceClick: function onPieceClick() {},\n  onPieceDragBegin: function onPieceDragBegin() {},\n  onPieceDragEnd: function onPieceDragEnd() {},\n  onPieceDrop: function onPieceDrop() {\n    return true;\n  },\n  onSquareClick: function onSquareClick() {},\n  onSquareRightClick: function onSquareRightClick() {},\n  position: 'start',\n  showBoardNotation: true,\n  // showSparePieces: false,\n  snapToCursor: true\n};\nvar startPositionObject = {\n  a8: 'bR',\n  b8: 'bN',\n  c8: 'bB',\n  d8: 'bQ',\n  e8: 'bK',\n  f8: 'bB',\n  g8: 'bN',\n  h8: 'bR',\n  a7: 'bP',\n  b7: 'bP',\n  c7: 'bP',\n  d7: 'bP',\n  e7: 'bP',\n  f7: 'bP',\n  g7: 'bP',\n  h7: 'bP',\n  a2: 'wP',\n  b2: 'wP',\n  c2: 'wP',\n  d2: 'wP',\n  e2: 'wP',\n  f2: 'wP',\n  g2: 'wP',\n  h2: 'wP',\n  a1: 'wR',\n  b1: 'wN',\n  c1: 'wB',\n  d1: 'wQ',\n  e1: 'wK',\n  f1: 'wB',\n  g1: 'wN',\n  h1: 'wR'\n};\nvar whiteColumnValues = {\n  a: 0,\n  b: 1,\n  c: 2,\n  d: 3,\n  e: 4,\n  f: 5,\n  g: 6,\n  h: 7\n};\nvar blackColumnValues = {\n  a: 7,\n  b: 6,\n  c: 5,\n  d: 4,\n  e: 3,\n  f: 2,\n  g: 1,\n  h: 0\n};\nvar whiteRows = [7, 6, 5, 4, 3, 2, 1, 0];\nvar blackRows = [0, 1, 2, 3, 4, 5, 6, 7];\n\nvar getRelativeCoords = function getRelativeCoords(boardOrientation, boardWidth, square) {\n  var squareWidth = boardWidth / 8;\n  var columns = boardOrientation === 'white' ? whiteColumnValues : blackColumnValues;\n  var rows = boardOrientation === 'white' ? whiteRows : blackRows;\n  var x = columns[square[0]] * squareWidth + squareWidth / 2;\n  var y = rows[square[1] - 1] * squareWidth + squareWidth / 2;\n  return {\n    x: x,\n    y: y\n  };\n};\n\nvar isDifferentFromStart = function isDifferentFromStart(newPosition) {\n  var isDifferent = false;\n  Object.keys(startPositionObject).forEach(function (square) {\n    if (newPosition[square] !== startPositionObject[square]) isDifferent = true;\n  });\n  Object.keys(newPosition).forEach(function (square) {\n    if (startPositionObject[square] !== newPosition[square]) isDifferent = true;\n  });\n  return isDifferent;\n};\n\nvar getPositionDifferences = function getPositionDifferences(currentPosition, newPosition) {\n  var difference = {\n    removed: {},\n    added: {}\n  }; // removed from current\n\n  Object.keys(currentPosition).forEach(function (square) {\n    if (newPosition[square] !== currentPosition[square]) difference.removed[square] = currentPosition[square];\n  }); // added from new\n\n  Object.keys(newPosition).forEach(function (square) {\n    if (currentPosition[square] !== newPosition[square]) difference.added[square] = newPosition[square];\n  });\n  return difference;\n};\n\nfunction isString(s) {\n  return typeof s === 'string';\n}\n\nfunction convertPositionToObject(position) {\n  if (position === 'start') return fenToObj('rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR');\n  if (validFen(position)) return fenToObj(position);\n  if (validPositionObject(position)) return position;\n  return {};\n}\n\nfunction fenToObj(fen) {\n  if (!validFen(fen)) return false; // cut off any move, castling, etc info from the end. we're only interested in position information\n\n  fen = fen.replace(/ .+$/, '');\n  var rows = fen.split('/');\n  var position = {};\n  var currentRow = 8;\n\n  for (var i = 0; i < 8; i++) {\n    var row = rows[i].split('');\n    var colIdx = 0; // loop through each character in the FEN section\n\n    for (var j = 0; j < row.length; j++) {\n      // number / empty squares\n      if (row[j].search(/[1-8]/) !== -1) {\n        var numEmptySquares = parseInt(row[j], 10);\n        colIdx = colIdx + numEmptySquares;\n      } else {\n        // piece\n        var square = COLUMNS[colIdx] + currentRow;\n        position[square] = fenToPieceCode(row[j]);\n        colIdx = colIdx + 1;\n      }\n    }\n\n    currentRow = currentRow - 1;\n  }\n\n  return position;\n}\n\nfunction expandFenEmptySquares(fen) {\n  return fen.replace(/8/g, '11111111').replace(/7/g, '1111111').replace(/6/g, '111111').replace(/5/g, '11111').replace(/4/g, '1111').replace(/3/g, '111').replace(/2/g, '11');\n}\n\nfunction validFen(fen) {\n  if (!isString(fen)) return false; // cut off any move, castling, etc info from the end. we're only interested in position information\n\n  fen = fen.replace(/ .+$/, ''); // expand the empty square numbers to just 1s\n\n  fen = expandFenEmptySquares(fen); // FEN should be 8 sections separated by slashes\n\n  var chunks = fen.split('/');\n  if (chunks.length !== 8) return false; // check each section\n\n  for (var i = 0; i < 8; i++) {\n    if (chunks[i].length !== 8 || chunks[i].search(/[^kqrnbpKQRNBP1]/) !== -1) {\n      return false;\n    }\n  }\n\n  return true;\n} // convert FEN piece code to bP, wK, etc\n\n\nfunction fenToPieceCode(piece) {\n  // black piece\n  if (piece.toLowerCase() === piece) {\n    return 'b' + piece.toUpperCase();\n  } // white piece\n\n\n  return 'w' + piece.toUpperCase();\n}\n\nfunction validSquare(square) {\n  return isString(square) && square.search(/^[a-h][1-8]$/) !== -1;\n}\n\nfunction validPieceCode(code) {\n  return isString(code) && code.search(/^[bw][KQRNBP]$/) !== -1;\n}\n\nfunction validPositionObject(pos) {\n  if (pos === null || typeof pos !== 'object') return false;\n\n  for (var i in pos) {\n    if (!pos[i]) continue;\n\n    if (!validSquare(i) || !validPieceCode(pos[i])) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nvar defaultPieces = {\n  wP: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsx(\"path\", {\n      d: \"m 22.5,9 c -2.21,0 -4,1.79 -4,4 0,0.89 0.29,1.71 0.78,2.38 C 17.33,16.5 16,18.59 16,21 c 0,2.03 0.94,3.84 2.41,5.03 C 15.41,27.09 11,31.58 11,39.5 H 34 C 34,31.58 29.59,27.09 26.59,26.03 28.06,24.84 29,23.03 29,21 29,18.59 27.67,16.5 25.72,15.38 26.21,14.71 26.5,13.89 26.5,13 c 0,-2.21 -1.79,-4 -4,-4 z\",\n      style: {\n        opacity: '1',\n        fill: '#ffffff',\n        fillOpacity: '1',\n        fillRule: 'nonzero',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'miter',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      }\n    })\n  }),\n  wR: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        opacity: '1',\n        fill: '#ffffff',\n        fillOpacity: '1',\n        fillRule: 'evenodd',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z \",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z \",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14\",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 34,14 L 31,17 L 14,17 L 11,14\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 31,17 L 31,29.5 L 14,29.5 L 14,17\",\n        style: {\n          strokeLinecap: 'butt',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 31,29.5 L 32.5,32 L 12.5,32 L 14,29.5\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 11,14 L 34,14\",\n        style: {\n          fill: 'none',\n          stroke: '#000000',\n          strokeLinejoin: 'miter'\n        }\n      })]\n    })\n  }),\n  wN: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        opacity: '1',\n        fill: 'none',\n        fillOpacity: '1',\n        fillRule: 'evenodd',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18\",\n        style: {\n          fill: '#ffffff',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10\",\n        style: {\n          fill: '#ffffff',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z\",\n        style: {\n          fill: '#000000',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z\",\n        transform: \"matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)\",\n        style: {\n          fill: '#000000',\n          stroke: '#000000'\n        }\n      })]\n    })\n  }),\n  wB: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        opacity: '1',\n        fill: 'none',\n        fillRule: 'evenodd',\n        fillOpacity: '1',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsxs(\"g\", {\n        style: {\n          fill: '#ffffff',\n          stroke: '#000000',\n          strokeLinecap: 'butt'\n        },\n        children: [/*#__PURE__*/jsx(\"path\", {\n          d: \"M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.65,38.99 6.68,38.97 6,38 C 7.35,36.54 9,36 9,36 z\"\n        }), /*#__PURE__*/jsx(\"path\", {\n          d: \"M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z\"\n        }), /*#__PURE__*/jsx(\"path\", {\n          d: \"M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z\"\n        })]\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18\",\n        style: {\n          fill: 'none',\n          stroke: '#000000',\n          strokeLinejoin: 'miter'\n        }\n      })]\n    })\n  }),\n  wQ: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        fill: '#ffffff',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinejoin: 'round'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 9,26 C 17.5,24.5 30,24.5 36,26 L 38.5,13.5 L 31,25 L 30.7,10.9 L 25.5,24.5 L 22.5,10 L 19.5,24.5 L 14.3,10.9 L 14,25 L 6.5,13.5 L 9,26 z\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 11,36 11,36 C 9.5,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 11.5,30 C 15,29 30,29 33.5,30\",\n        style: {\n          fill: 'none'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12,33.5 C 18,32.5 27,32.5 33,33.5\",\n        style: {\n          fill: 'none'\n        }\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"6\",\n        cy: \"12\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"14\",\n        cy: \"9\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"22.5\",\n        cy: \"8\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"31\",\n        cy: \"9\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"39\",\n        cy: \"12\",\n        r: \"2\"\n      })]\n    })\n  }),\n  wK: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        fill: 'none',\n        fillOpacity: '1',\n        fillRule: 'evenodd',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 22.5,11.63 L 22.5,6\",\n        style: {\n          fill: 'none',\n          stroke: '#000000',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 20,8 L 25,8\",\n        style: {\n          fill: 'none',\n          stroke: '#000000',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25\",\n        style: {\n          fill: '#ffffff',\n          stroke: '#000000',\n          strokeLinecap: 'butt',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12.5,37 C 18,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 20,16 10.5,13 6.5,19.5 C 3.5,25.5 12.5,30 12.5,30 L 12.5,37\",\n        style: {\n          fill: '#ffffff',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12.5,30 C 18,27 27,27 32.5,30\",\n        style: {\n          fill: 'none',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12.5,33.5 C 18,30.5 27,30.5 32.5,33.5\",\n        style: {\n          fill: 'none',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12.5,37 C 18,34 27,34 32.5,37\",\n        style: {\n          fill: 'none',\n          stroke: '#000000'\n        }\n      })]\n    })\n  }),\n  bP: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsx(\"path\", {\n      d: \"m 22.5,9 c -2.21,0 -4,1.79 -4,4 0,0.89 0.29,1.71 0.78,2.38 C 17.33,16.5 16,18.59 16,21 c 0,2.03 0.94,3.84 2.41,5.03 C 15.41,27.09 11,31.58 11,39.5 H 34 C 34,31.58 29.59,27.09 26.59,26.03 28.06,24.84 29,23.03 29,21 29,18.59 27.67,16.5 25.72,15.38 26.21,14.71 26.5,13.89 26.5,13 c 0,-2.21 -1.79,-4 -4,-4 z\",\n      style: {\n        opacity: '1',\n        fill: '#000000',\n        fillOpacity: '1',\n        fillRule: 'nonzero',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'miter',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      }\n    })\n  }),\n  bR: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        opacity: '1',\n        fill: '#000000',\n        fillOpacity: '1',\n        fillRule: 'evenodd',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z \",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12.5,32 L 14,29.5 L 31,29.5 L 32.5,32 L 12.5,32 z \",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z \",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 14,29.5 L 14,16.5 L 31,16.5 L 31,29.5 L 14,29.5 z \",\n        style: {\n          strokeLinecap: 'butt',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 14,16.5 L 11,14 L 34,14 L 31,16.5 L 14,16.5 z \",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14 L 11,14 z \",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12,35.5 L 33,35.5 L 33,35.5\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff',\n          strokeWidth: '1',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 13,31.5 L 32,31.5\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff',\n          strokeWidth: '1',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 14,29.5 L 31,29.5\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff',\n          strokeWidth: '1',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 14,16.5 L 31,16.5\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff',\n          strokeWidth: '1',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 11,14 L 34,14\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff',\n          strokeWidth: '1',\n          strokeLinejoin: 'miter'\n        }\n      })]\n    })\n  }),\n  bN: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        opacity: '1',\n        fill: 'none',\n        fillOpacity: '1',\n        fillRule: 'evenodd',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18\",\n        style: {\n          fill: '#000000',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10\",\n        style: {\n          fill: '#000000',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z\",\n        style: {\n          fill: '#ffffff',\n          stroke: '#ffffff'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z\",\n        transform: \"matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)\",\n        style: {\n          fill: '#ffffff',\n          stroke: '#ffffff'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 24.55,10.4 L 24.1,11.85 L 24.6,12 C 27.75,13 30.25,14.49 32.5,18.75 C 34.75,23.01 35.75,29.06 35.25,39 L 35.2,39.5 L 37.45,39.5 L 37.5,39 C 38,28.94 36.62,22.15 34.25,17.66 C 31.88,13.17 28.46,11.02 25.06,10.5 L 24.55,10.4 z \",\n        style: {\n          fill: '#ffffff',\n          stroke: 'none'\n        }\n      })]\n    })\n  }),\n  bB: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        opacity: '1',\n        fill: 'none',\n        fillRule: 'evenodd',\n        fillOpacity: '1',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsxs(\"g\", {\n        style: {\n          fill: '#000000',\n          stroke: '#000000',\n          strokeLinecap: 'butt'\n        },\n        children: [/*#__PURE__*/jsx(\"path\", {\n          d: \"M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.65,38.99 6.68,38.97 6,38 C 7.35,36.54 9,36 9,36 z\"\n        }), /*#__PURE__*/jsx(\"path\", {\n          d: \"M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z\"\n        }), /*#__PURE__*/jsx(\"path\", {\n          d: \"M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z\"\n        })]\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff',\n          strokeLinejoin: 'miter'\n        }\n      })]\n    })\n  }),\n  bQ: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        fill: '#000000',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 9,26 C 17.5,24.5 30,24.5 36,26 L 38.5,13.5 L 31,25 L 30.7,10.9 L 25.5,24.5 L 22.5,10 L 19.5,24.5 L 14.3,10.9 L 14,25 L 6.5,13.5 L 9,26 z\",\n        style: {\n          strokeLinecap: 'butt',\n          fill: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"m 9,26 c 0,2 1.5,2 2.5,4 1,1.5 1,1 0.5,3.5 -1.5,1 -1,2.5 -1,2.5 -1.5,1.5 0,2.5 0,2.5 6.5,1 16.5,1 23,0 0,0 1.5,-1 0,-2.5 0,0 0.5,-1.5 -1,-2.5 -0.5,-2.5 -0.5,-2 0.5,-3.5 1,-2 2.5,-2 2.5,-4 -8.5,-1.5 -18.5,-1.5 -27,0 z\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 11.5,30 C 15,29 30,29 33.5,30\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"m 12,33.5 c 6,-1 15,-1 21,0\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"6\",\n        cy: \"12\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"14\",\n        cy: \"9\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"22.5\",\n        cy: \"8\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"31\",\n        cy: \"9\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"39\",\n        cy: \"12\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 11,38.5 A 35,35 1 0 0 34,38.5\",\n        style: {\n          fill: 'none',\n          stroke: '#000000',\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsxs(\"g\", {\n        style: {\n          fill: 'none',\n          stroke: '#ffffff'\n        },\n        children: [/*#__PURE__*/jsx(\"path\", {\n          d: \"M 11,29 A 35,35 1 0 1 34,29\"\n        }), /*#__PURE__*/jsx(\"path\", {\n          d: \"M 12.5,31.5 L 32.5,31.5\"\n        }), /*#__PURE__*/jsx(\"path\", {\n          d: \"M 11.5,34.5 A 35,35 1 0 0 33.5,34.5\"\n        }), /*#__PURE__*/jsx(\"path\", {\n          d: \"M 10.5,37.5 A 35,35 1 0 0 34.5,37.5\"\n        })]\n      })]\n    })\n  }),\n  bK: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        fill: 'none',\n        fillOpacity: '1',\n        fillRule: 'evenodd',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 22.5,11.63 L 22.5,6\",\n        style: {\n          fill: 'none',\n          stroke: '#000000',\n          strokeLinejoin: 'miter'\n        },\n        id: \"path6570\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25\",\n        style: {\n          fill: '#000000',\n          fillOpacity: '1',\n          strokeLinecap: 'butt',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12.5,37 C 18,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 20,16 10.5,13 6.5,19.5 C 3.5,25.5 12.5,30 12.5,30 L 12.5,37\",\n        style: {\n          fill: '#000000',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 20,8 L 25,8\",\n        style: {\n          fill: 'none',\n          stroke: '#000000',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 32,29.5 C 32,29.5 40.5,25.5 38.03,19.85 C 34.15,14 25,18 22.5,24.5 L 22.5,26.6 L 22.5,24.5 C 20,18 10.85,14 6.97,19.85 C 4.5,25.5 13,29.5 13,29.5\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12.5,30 C 18,27 27,27 32.5,30 M 12.5,33.5 C 18,30.5 27,30.5 32.5,33.5 M 12.5,37 C 18,34 27,34 32.5,37\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff'\n        }\n      })]\n    })\n  })\n};\nvar ChessboardContext = /*#__PURE__*/React.createContext();\n\nvar useChessboard = function useChessboard() {\n  return useContext(ChessboardContext);\n};\n\nvar ChessboardProvider = /*#__PURE__*/forwardRef(function (_ref4, ref) {\n  var animationDuration = _ref4.animationDuration,\n      areArrowsAllowed = _ref4.areArrowsAllowed,\n      arePiecesDraggable = _ref4.arePiecesDraggable,\n      arePremovesAllowed = _ref4.arePremovesAllowed,\n      boardOrientation = _ref4.boardOrientation,\n      boardWidth = _ref4.boardWidth,\n      clearPremovesOnRightClick = _ref4.clearPremovesOnRightClick,\n      customArrows = _ref4.customArrows,\n      customArrowColor = _ref4.customArrowColor,\n      customBoardStyle = _ref4.customBoardStyle,\n      customDarkSquareStyle = _ref4.customDarkSquareStyle,\n      customDropSquareStyle = _ref4.customDropSquareStyle,\n      customLightSquareStyle = _ref4.customLightSquareStyle,\n      customPieces = _ref4.customPieces,\n      customPremoveDarkSquareStyle = _ref4.customPremoveDarkSquareStyle,\n      customPremoveLightSquareStyle = _ref4.customPremoveLightSquareStyle,\n      customSquareStyles = _ref4.customSquareStyles,\n      dropOffBoardAction = _ref4.dropOffBoardAction,\n      id = _ref4.id,\n      isDraggablePiece = _ref4.isDraggablePiece,\n      getPositionObject = _ref4.getPositionObject,\n      onArrowsChange = _ref4.onArrowsChange,\n      onDragOverSquare = _ref4.onDragOverSquare,\n      onMouseOutSquare = _ref4.onMouseOutSquare,\n      onMouseOverSquare = _ref4.onMouseOverSquare,\n      onPieceClick = _ref4.onPieceClick,\n      onPieceDragBegin = _ref4.onPieceDragBegin,\n      onPieceDragEnd = _ref4.onPieceDragEnd,\n      onPieceDrop = _ref4.onPieceDrop,\n      onSquareClick = _ref4.onSquareClick,\n      onSquareRightClick = _ref4.onSquareRightClick,\n      position = _ref4.position,\n      showBoardNotation = _ref4.showBoardNotation,\n      showSparePieces = _ref4.showSparePieces,\n      snapToCursor = _ref4.snapToCursor,\n      children = _ref4.children;\n\n  // position stored and displayed on board\n  var _useState3 = useState(convertPositionToObject(position)),\n      _useState4 = _slicedToArray(_useState3, 2),\n      currentPosition = _useState4[0],\n      setCurrentPosition = _useState4[1]; // calculated differences between current and incoming positions\n\n\n  var _useState5 = useState({}),\n      _useState6 = _slicedToArray(_useState5, 2),\n      positionDifferences = _useState6[0],\n      setPositionDifferences = _useState6[1]; // colour of last piece moved to determine if premoving\n\n\n  var _useState7 = useState(undefined),\n      _useState8 = _slicedToArray(_useState7, 2),\n      lastPieceColour = _useState8[0],\n      setLastPieceColour = _useState8[1]; // current premoves\n\n\n  var _useState9 = useState([]),\n      _useState10 = _slicedToArray(_useState9, 2),\n      premoves = _useState10[0],\n      setPremoves = _useState10[1]; // ref used to access current value during timeouts (closures)\n\n\n  var premovesRef = useRef(premoves); // current right mouse down square\n\n  var _useState11 = useState(),\n      _useState12 = _slicedToArray(_useState11, 2),\n      currentRightClickDown = _useState12[0],\n      setCurrentRightClickDown = _useState12[1]; // current arrows\n\n\n  var _useState13 = useState([]),\n      _useState14 = _slicedToArray(_useState13, 2),\n      arrows = _useState14[0],\n      setArrows = _useState14[1]; // chess pieces/styling\n\n\n  var _useState15 = useState(_objectSpread2(_objectSpread2({}, defaultPieces), customPieces)),\n      _useState16 = _slicedToArray(_useState15, 2),\n      chessPieces = _useState16[0],\n      setChessPieces = _useState16[1]; // whether the last move was a manual drop or not\n\n\n  var _useState17 = useState(false),\n      _useState18 = _slicedToArray(_useState17, 2),\n      manualDrop = _useState18[0],\n      setManualDrop = _useState18[1]; // the most recent timeout whilst waiting for animation to complete\n\n\n  var _useState19 = useState(undefined),\n      _useState20 = _slicedToArray(_useState19, 2),\n      previousTimeout = _useState20[0],\n      setPreviousTimeout = _useState20[1]; // if currently waiting for an animation to finish\n\n\n  var _useState21 = useState(false),\n      _useState22 = _slicedToArray(_useState21, 2),\n      waitingForAnimation = _useState22[0],\n      setWaitingForAnimation = _useState22[1]; // open clearPremoves() to allow user to call on undo/reset/whenever\n\n\n  useImperativeHandle(ref, function () {\n    return {\n      clearPremoves: function clearPremoves() {\n        var clearLastPieceColour = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n\n        _clearPremoves(clearLastPieceColour);\n      }\n    };\n  }); // handle custom pieces change\n\n  useEffect(function () {\n    setChessPieces(_objectSpread2(_objectSpread2({}, defaultPieces), customPieces));\n  }, [customPieces]); // handle external position change\n\n  useEffect(function () {\n    var _Object$keys, _Object$entries, _Object$entries$;\n\n    var newPosition = convertPositionToObject(position);\n    var differences = getPositionDifferences(currentPosition, newPosition);\n    var newPieceColour = ((_Object$keys = Object.keys(differences.added)) === null || _Object$keys === void 0 ? void 0 : _Object$keys.length) <= 2 ? (_Object$entries = Object.entries(differences.added)) === null || _Object$entries === void 0 ? void 0 : (_Object$entries$ = _Object$entries[0]) === null || _Object$entries$ === void 0 ? void 0 : _Object$entries$[1][0] : undefined; // external move has come in before animation is over\n    // cancel animation and immediately update position\n\n    if (waitingForAnimation) {\n      setCurrentPosition(newPosition);\n      setWaitingForAnimation(false);\n      arePremovesAllowed && attemptPremove(newPieceColour);\n\n      if (previousTimeout) {\n        clearTimeout(previousTimeout);\n      }\n    } else {\n      // move was made using drag and drop\n      if (manualDrop) {\n        setCurrentPosition(newPosition);\n        setWaitingForAnimation(false);\n        arePremovesAllowed && attemptPremove(newPieceColour);\n      } else {\n        // move was made by external position change\n        // if position === start then don't override newPieceColour\n        // needs isDifferentFromStart in scenario where premoves have been cleared upon board reset but first move is made by computer, the last move colour would need to be updated\n        if (isDifferentFromStart(newPosition) && lastPieceColour !== undefined) {\n          setLastPieceColour(newPieceColour);\n        } else {\n          // position === start, likely a board reset\n          setLastPieceColour(undefined);\n        }\n\n        setPositionDifferences(differences); // animate external move\n\n        setWaitingForAnimation(true);\n        var newTimeout = setTimeout(function () {\n          setCurrentPosition(newPosition);\n          setWaitingForAnimation(false);\n          arePremovesAllowed && attemptPremove(newPieceColour);\n        }, animationDuration);\n        setPreviousTimeout(newTimeout);\n      }\n    } // reset manual drop, ready for next move to be made by user or external\n\n\n    setManualDrop(false); // inform latest position information\n\n    getPositionObject(newPosition); // clear arrows\n\n    clearArrows(); // clear timeout on unmount\n\n    return function () {\n      clearTimeout(previousTimeout);\n    };\n  }, [position]); // handle external arrows change\n\n  useEffect(function () {\n    setArrows(customArrows);\n  }, [customArrows]); // callback when new arrows are set\n\n  useEffect(function () {\n    onArrowsChange(arrows);\n  }, [arrows]); // handle drop position change\n\n  function handleSetPosition(sourceSq, targetSq, piece) {\n    // if dropped back down, don't do anything\n    if (sourceSq === targetSq) {\n      return;\n    }\n\n    clearArrows(); // if second move is made for same colour, or there are still premoves queued, then this move needs to be added to premove queue instead of played\n    // premoves length check for colour is added in because white could make 3 premoves, and then black responds to the first move (changing the last piece colour) and then white pre-moves again\n\n    if (arePremovesAllowed && waitingForAnimation || arePremovesAllowed && (lastPieceColour === piece[0] || premovesRef.current.filter(function (p) {\n      return p.piece[0] === piece[0];\n    }).length > 0)) {\n      var oldPremoves = _toConsumableArray(premovesRef.current);\n\n      oldPremoves.push({\n        sourceSq: sourceSq,\n        targetSq: targetSq,\n        piece: piece\n      });\n      premovesRef.current = oldPremoves;\n      setPremoves(_toConsumableArray(oldPremoves));\n      return;\n    } // if transitioning, don't allow new drop\n\n\n    if (!arePremovesAllowed && waitingForAnimation) return;\n\n    var newOnDropPosition = _objectSpread2({}, currentPosition);\n\n    setManualDrop(true);\n    setLastPieceColour(piece[0]); // if onPieceDrop function provided, execute it, position must be updated externally and captured by useEffect above for this move to show on board\n\n    if (onPieceDrop.length) {\n      var isValidMove = onPieceDrop(sourceSq, targetSq, piece);\n      if (!isValidMove) _clearPremoves();\n    } else {\n      // delete if dropping off board\n      if (dropOffBoardAction === 'trash' && !targetSq) {\n        delete newOnDropPosition[sourceSq];\n      } // delete source piece if not dropping from spare piece\n\n\n      if (sourceSq !== 'spare') {\n        delete newOnDropPosition[sourceSq];\n      } // add piece in new position\n\n\n      newOnDropPosition[targetSq] = piece;\n      setCurrentPosition(newOnDropPosition);\n    } // inform latest position information\n\n\n    getPositionObject(newOnDropPosition);\n  }\n\n  function attemptPremove(newPieceColour) {\n    if (premovesRef.current.length === 0) return; // get current value of premove as this is called in a timeout so value may have changed since timeout was set\n\n    var premove = premovesRef.current[0]; // if premove is a differing colour to last move made, then this move can be made\n\n    if (premove.piece[0] !== undefined && premove.piece[0] !== newPieceColour && onPieceDrop.length) {\n      setLastPieceColour(premove.piece[0]);\n      setManualDrop(true); // pre-move doesn't need animation\n\n      var isValidMove = onPieceDrop(premove.sourceSq, premove.targetSq, premove.piece); // premove was successful and can be removed from queue\n\n      if (isValidMove) {\n        var oldPremoves = _toConsumableArray(premovesRef.current);\n\n        oldPremoves.shift();\n        premovesRef.current = oldPremoves;\n        setPremoves(_toConsumableArray(oldPremoves));\n      } else {\n        // premove wasn't successful, clear premove queue\n        _clearPremoves();\n      }\n    }\n  }\n\n  function _clearPremoves() {\n    var clearLastPieceColour = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n    // don't clear when right clicking to clear, otherwise you won't be able to premove again before next go\n    if (clearLastPieceColour) setLastPieceColour(undefined);\n    premovesRef.current = [];\n    setPremoves([]);\n  }\n\n  function onRightClickDown(square) {\n    setCurrentRightClickDown(square);\n  }\n\n  function onRightClickUp(square) {\n    if (!areArrowsAllowed) return;\n\n    if (currentRightClickDown) {\n      // same square, don't draw an arrow, but do clear premoves and run onSquareRightClick\n      if (currentRightClickDown === square) {\n        setCurrentRightClickDown(null);\n        clearPremovesOnRightClick && _clearPremoves(false);\n        onSquareRightClick(square);\n        return;\n      } // if arrow already exists then it needs to be removed\n\n\n      var _loop = function _loop(i) {\n        if (arrows[i][0] === currentRightClickDown && arrows[i][1] === square) {\n          setArrows(function (oldArrows) {\n            var newArrows = _toConsumableArray(oldArrows);\n\n            newArrows.splice(i, 1);\n            return newArrows;\n          });\n          return {\n            v: void 0\n          };\n        }\n      };\n\n      for (var i in arrows) {\n        var _ret = _loop(i);\n\n        if (typeof _ret === \"object\") return _ret.v;\n      } // different square, draw an arrow\n\n\n      setArrows(function (oldArrows) {\n        return [].concat(_toConsumableArray(oldArrows), [[currentRightClickDown, square]]);\n      });\n    } else setCurrentRightClickDown(null);\n  }\n\n  function clearCurrentRightClickDown() {\n    setCurrentRightClickDown(null);\n  }\n\n  function clearArrows() {\n    setArrows([]);\n  }\n\n  return /*#__PURE__*/jsx(ChessboardContext.Provider, {\n    value: {\n      animationDuration: animationDuration,\n      arePiecesDraggable: arePiecesDraggable,\n      arePremovesAllowed: arePremovesAllowed,\n      boardOrientation: boardOrientation,\n      boardWidth: boardWidth,\n      customArrowColor: customArrowColor,\n      customBoardStyle: customBoardStyle,\n      customDarkSquareStyle: customDarkSquareStyle,\n      customDropSquareStyle: customDropSquareStyle,\n      customLightSquareStyle: customLightSquareStyle,\n      customPremoveDarkSquareStyle: customPremoveDarkSquareStyle,\n      customPremoveLightSquareStyle: customPremoveLightSquareStyle,\n      customSquareStyles: customSquareStyles,\n      dropOffBoardAction: dropOffBoardAction,\n      id: id,\n      isDraggablePiece: isDraggablePiece,\n      getPositionObject: getPositionObject,\n      onDragOverSquare: onDragOverSquare,\n      onMouseOutSquare: onMouseOutSquare,\n      onMouseOverSquare: onMouseOverSquare,\n      onPieceClick: onPieceClick,\n      onPieceDragBegin: onPieceDragBegin,\n      onPieceDragEnd: onPieceDragEnd,\n      onPieceDrop: onPieceDrop,\n      onSquareClick: onSquareClick,\n      onSquareRightClick: onSquareRightClick,\n      showBoardNotation: showBoardNotation,\n      showSparePieces: showSparePieces,\n      snapToCursor: snapToCursor,\n      arrows: arrows,\n      chessPieces: chessPieces,\n      clearArrows: clearArrows,\n      clearCurrentRightClickDown: clearCurrentRightClickDown,\n      clearPremoves: _clearPremoves,\n      currentPosition: currentPosition,\n      handleSetPosition: handleSetPosition,\n      lastPieceColour: lastPieceColour,\n      manualDrop: manualDrop,\n      onRightClickDown: onRightClickDown,\n      onRightClickUp: onRightClickUp,\n      positionDifferences: positionDifferences,\n      premoves: premoves,\n      setChessPieces: setChessPieces,\n      setCurrentPosition: setCurrentPosition,\n      setManualDrop: setManualDrop,\n      waitingForAnimation: waitingForAnimation\n    },\n    children: children\n  });\n});\n\nfunction Notation(_ref5) {\n  var row = _ref5.row,\n      col = _ref5.col;\n\n  var _useChessboard = useChessboard(),\n      boardOrientation = _useChessboard.boardOrientation,\n      boardWidth = _useChessboard.boardWidth,\n      customDarkSquareStyle = _useChessboard.customDarkSquareStyle,\n      customLightSquareStyle = _useChessboard.customLightSquareStyle;\n\n  var whiteColor = customLightSquareStyle.backgroundColor;\n  var blackColor = customDarkSquareStyle.backgroundColor;\n  var isRow = col === 0;\n  var isColumn = row === 7;\n  var isBottomLeftSquare = isRow && isColumn;\n\n  function getRow() {\n    return boardOrientation === 'white' ? 8 - row : row + 1;\n  }\n\n  function getColumn() {\n    return boardOrientation === 'black' ? COLUMNS[7 - col] : COLUMNS[col];\n  }\n\n  function renderBottomLeft() {\n    return /*#__PURE__*/jsxs(Fragment, {\n      children: [/*#__PURE__*/jsx(\"div\", {\n        style: _objectSpread2(_objectSpread2(_objectSpread2({}, notationStyle), {\n          color: whiteColor\n        }), numericStyle(boardWidth)),\n        children: getRow()\n      }), /*#__PURE__*/jsx(\"div\", {\n        style: _objectSpread2(_objectSpread2(_objectSpread2({}, notationStyle), {\n          color: whiteColor\n        }), alphaStyle(boardWidth)),\n        children: getColumn()\n      })]\n    });\n  }\n\n  function renderLetters() {\n    return /*#__PURE__*/jsx(\"div\", {\n      style: _objectSpread2(_objectSpread2(_objectSpread2({}, notationStyle), {\n        color: col % 2 !== 0 ? blackColor : whiteColor\n      }), alphaStyle(boardWidth)),\n      children: getColumn()\n    });\n  }\n\n  function renderNumbers() {\n    return /*#__PURE__*/jsx(\"div\", {\n      style: _objectSpread2(_objectSpread2(_objectSpread2({}, notationStyle), boardOrientation === 'black' ? {\n        color: row % 2 === 0 ? blackColor : whiteColor\n      } : {\n        color: row % 2 === 0 ? blackColor : whiteColor\n      }), numericStyle(boardWidth)),\n      children: getRow()\n    });\n  }\n\n  if (isBottomLeftSquare) {\n    return renderBottomLeft();\n  }\n\n  if (isColumn) {\n    return renderLetters();\n  }\n\n  if (isRow) {\n    return renderNumbers();\n  }\n\n  return null;\n}\n\nvar alphaStyle = function alphaStyle(width) {\n  return {\n    alignSelf: 'flex-end',\n    paddingLeft: width / 8 - width / 48,\n    fontSize: width / 48\n  };\n};\n\nvar numericStyle = function numericStyle(width) {\n  return {\n    alignSelf: 'flex-start',\n    paddingRight: width / 8 - width / 48,\n    fontSize: width / 48\n  };\n};\n\nvar notationStyle = {\n  zIndex: 3,\n  position: 'absolute'\n};\n\nfunction Piece(_ref6) {\n  var piece = _ref6.piece,\n      square = _ref6.square,\n      squares = _ref6.squares,\n      _ref6$isPremovedPiece = _ref6.isPremovedPiece,\n      isPremovedPiece = _ref6$isPremovedPiece === void 0 ? false : _ref6$isPremovedPiece;\n\n  var _useChessboard2 = useChessboard(),\n      animationDuration = _useChessboard2.animationDuration,\n      arePiecesDraggable = _useChessboard2.arePiecesDraggable,\n      arePremovesAllowed = _useChessboard2.arePremovesAllowed,\n      boardWidth = _useChessboard2.boardWidth,\n      id = _useChessboard2.id,\n      isDraggablePiece = _useChessboard2.isDraggablePiece,\n      onPieceClick = _useChessboard2.onPieceClick,\n      onPieceDragBegin = _useChessboard2.onPieceDragBegin,\n      onPieceDragEnd = _useChessboard2.onPieceDragEnd,\n      premoves = _useChessboard2.premoves,\n      chessPieces = _useChessboard2.chessPieces,\n      dropTarget = _useChessboard2.dropTarget,\n      positionDifferences = _useChessboard2.positionDifferences,\n      waitingForAnimation = _useChessboard2.waitingForAnimation,\n      currentPosition = _useChessboard2.currentPosition;\n\n  var _useState23 = useState({\n    opacity: 1,\n    zIndex: 5,\n    touchAction: 'none',\n    cursor: arePiecesDraggable && isDraggablePiece({\n      piece: piece,\n      sourceSquare: square\n    }) ? '-webkit-grab' : 'default'\n  }),\n      _useState24 = _slicedToArray(_useState23, 2),\n      pieceStyle = _useState24[0],\n      setPieceStyle = _useState24[1];\n\n  var _useDrag = useDrag(function () {\n    return {\n      type: 'piece',\n      item: function item() {\n        onPieceDragBegin(piece, square);\n        return {\n          piece: piece,\n          square: square,\n          id: id\n        };\n      },\n      end: function end() {\n        return onPieceDragEnd(piece, square);\n      },\n      collect: function collect(monitor) {\n        return {\n          canDrag: isDraggablePiece({\n            piece: piece,\n            sourceSquare: square\n          }),\n          isDragging: !!monitor.isDragging()\n        };\n      }\n    };\n  }, [piece, square, currentPosition, id]),\n      _useDrag2 = _slicedToArray(_useDrag, 3),\n      _useDrag2$ = _useDrag2[0],\n      canDrag = _useDrag2$.canDrag,\n      isDragging = _useDrag2$.isDragging,\n      drag = _useDrag2[1],\n      dragPreview = _useDrag2[2]; // hide the default preview\n\n\n  dragPreview(getEmptyImage(), {\n    captureDraggingState: true\n  }); // hide piece on drag\n\n  useEffect(function () {\n    setPieceStyle(function (oldPieceStyle) {\n      return _objectSpread2(_objectSpread2({}, oldPieceStyle), {}, {\n        opacity: isDragging ? 0 : 1\n      });\n    });\n  }, [isDragging]); // hide piece on matching premoves\n\n  useEffect(function () {\n    // if premoves aren't allowed, don't waste time on calculations\n    if (!arePremovesAllowed) return;\n    var hidePiece = false; // side effect: if piece moves into pre-moved square, its hidden\n    // if there are any premove targets on this square, hide the piece underneath\n\n    if (!isPremovedPiece && premoves.find(function (p) {\n      return p.targetSq === square;\n    })) hidePiece = true; // if sourceSq === sq and piece matches then this piece has been pre-moved elsewhere?\n\n    if (premoves.find(function (p) {\n      return p.sourceSq === square && p.piece === piece;\n    })) hidePiece = true; // TODO: If a premoved piece returns to a premoved square, it will hide (e1, e2, e1)\n\n    setPieceStyle(function (oldPieceStyle) {\n      return _objectSpread2(_objectSpread2({}, oldPieceStyle), {}, {\n        display: hidePiece ? 'none' : 'unset'\n      });\n    });\n  }, [currentPosition, premoves]); // new move has come in\n  // if waiting for animation, then animation has started and we can perform animation\n  // we need to head towards where we need to go, we are the source, we are heading towards the target\n\n  useEffect(function () {\n    var _positionDifferences$;\n\n    var removedPiece = (_positionDifferences$ = positionDifferences.removed) === null || _positionDifferences$ === void 0 ? void 0 : _positionDifferences$[square]; // return as null and not loaded yet\n\n    if (!positionDifferences.added) return; // check if piece matches or if removed piece was a pawn and new square is on 1st or 8th rank (promotion)\n\n    var newSquare = Object.entries(positionDifferences.added).find(function (_ref7) {\n      var _ref8 = _slicedToArray(_ref7, 2),\n          s = _ref8[0],\n          p = _ref8[1];\n\n      return p === removedPiece || (removedPiece === null || removedPiece === void 0 ? void 0 : removedPiece[1]) === 'P' && (s[1] === '1' || s[1] === '8');\n    }); // we can perform animation if our square was in removed, AND the matching piece is in added AND this isn't a premoved piece\n\n    if (waitingForAnimation && removedPiece && newSquare && !isPremovedPiece) {\n      var _getSquareCoordinates = getSquareCoordinates(square, newSquare[0]),\n          sourceSq = _getSquareCoordinates.sourceSq,\n          targetSq = _getSquareCoordinates.targetSq;\n\n      if (sourceSq && targetSq) {\n        setPieceStyle(function (oldPieceStyle) {\n          return _objectSpread2(_objectSpread2({}, oldPieceStyle), {}, {\n            transform: \"translate(\".concat(targetSq.x - sourceSq.x, \"px, \").concat(targetSq.y - sourceSq.y, \"px)\"),\n            transition: \"transform \".concat(animationDuration, \"ms\"),\n            zIndex: 6\n          });\n        });\n      }\n    }\n  }, [positionDifferences]); // translate to their own positions (repaint on undo)\n\n  useEffect(function () {\n    var _getSingleSquareCoord = getSingleSquareCoordinates(square),\n        sourceSq = _getSingleSquareCoord.sourceSq;\n\n    if (sourceSq) {\n      setPieceStyle(function (oldPieceStyle) {\n        return _objectSpread2(_objectSpread2({}, oldPieceStyle), {}, {\n          transform: \"translate(\".concat(0, \"px, \", 0, \"px)\"),\n          transition: \"transform \".concat(0, \"ms\")\n        });\n      });\n    }\n  }, [currentPosition]); // update is piece draggable\n\n  useEffect(function () {\n    setPieceStyle(function (oldPieceStyle) {\n      return _objectSpread2(_objectSpread2({}, oldPieceStyle), {}, {\n        cursor: arePiecesDraggable && isDraggablePiece({\n          piece: piece,\n          sourceSquare: square\n        }) ? '-webkit-grab' : 'default'\n      });\n    });\n  }, [square, currentPosition, arePiecesDraggable]);\n\n  function getSingleSquareCoordinates(square) {\n    return {\n      sourceSq: squares[square]\n    };\n  }\n\n  function getSquareCoordinates(sourceSquare, targetSquare) {\n    return {\n      sourceSq: squares[sourceSquare],\n      targetSq: squares[targetSquare]\n    };\n  }\n\n  return /*#__PURE__*/jsx(\"div\", {\n    ref: arePiecesDraggable ? canDrag ? drag : null : null,\n    onClick: function onClick() {\n      return onPieceClick(piece);\n    },\n    style: pieceStyle,\n    children: typeof chessPieces[piece] === 'function' ? chessPieces[piece]({\n      squareWidth: boardWidth / 8,\n      isDragging: isDragging,\n      droppedPiece: dropTarget === null || dropTarget === void 0 ? void 0 : dropTarget.piece,\n      targetSquare: dropTarget === null || dropTarget === void 0 ? void 0 : dropTarget.target,\n      sourceSquare: dropTarget === null || dropTarget === void 0 ? void 0 : dropTarget.source\n    }) : /*#__PURE__*/jsx(\"svg\", {\n      viewBox: '1 1 43 43',\n      width: boardWidth / 8,\n      height: boardWidth / 8,\n      children: /*#__PURE__*/jsx(\"g\", {\n        children: chessPieces[piece]\n      })\n    })\n  });\n}\n\nfunction Square(_ref9) {\n  var square = _ref9.square,\n      squareColor = _ref9.squareColor,\n      setSquares = _ref9.setSquares,\n      squareHasPremove = _ref9.squareHasPremove,\n      children = _ref9.children;\n  var squareRef = useRef();\n\n  var _useChessboard3 = useChessboard(),\n      boardWidth = _useChessboard3.boardWidth,\n      boardOrientation = _useChessboard3.boardOrientation,\n      clearArrows = _useChessboard3.clearArrows,\n      currentPosition = _useChessboard3.currentPosition,\n      customBoardStyle = _useChessboard3.customBoardStyle,\n      customDarkSquareStyle = _useChessboard3.customDarkSquareStyle,\n      customDropSquareStyle = _useChessboard3.customDropSquareStyle,\n      customLightSquareStyle = _useChessboard3.customLightSquareStyle,\n      customPremoveDarkSquareStyle = _useChessboard3.customPremoveDarkSquareStyle,\n      customPremoveLightSquareStyle = _useChessboard3.customPremoveLightSquareStyle,\n      customSquareStyles = _useChessboard3.customSquareStyles,\n      handleSetPosition = _useChessboard3.handleSetPosition,\n      lastPieceColour = _useChessboard3.lastPieceColour,\n      onDragOverSquare = _useChessboard3.onDragOverSquare,\n      onMouseOutSquare = _useChessboard3.onMouseOutSquare,\n      onMouseOverSquare = _useChessboard3.onMouseOverSquare,\n      onPieceDrop = _useChessboard3.onPieceDrop,\n      onRightClickDown = _useChessboard3.onRightClickDown,\n      onRightClickUp = _useChessboard3.onRightClickUp,\n      onSquareClick = _useChessboard3.onSquareClick,\n      waitingForAnimation = _useChessboard3.waitingForAnimation;\n\n  var _useDrop = useDrop(function () {\n    return {\n      accept: 'piece',\n      drop: function drop(item) {\n        return handleSetPosition(item.square, square, item.piece);\n      },\n      collect: function collect(monitor) {\n        return {\n          isOver: !!monitor.isOver()\n        };\n      }\n    };\n  }, [square, currentPosition, onPieceDrop, waitingForAnimation, lastPieceColour]),\n      _useDrop2 = _slicedToArray(_useDrop, 2),\n      isOver = _useDrop2[0].isOver,\n      drop = _useDrop2[1];\n\n  useEffect(function () {\n    var _squareRef$current$ge = squareRef.current.getBoundingClientRect(),\n        x = _squareRef$current$ge.x,\n        y = _squareRef$current$ge.y;\n\n    setSquares(function (oldSquares) {\n      return _objectSpread2(_objectSpread2({}, oldSquares), {}, _defineProperty2({}, square, {\n        x: x,\n        y: y\n      }));\n    });\n  }, [boardWidth, boardOrientation]);\n\n  var defaultSquareStyle = _objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2({}, borderRadius(customBoardStyle, square, boardOrientation)), squareColor === 'black' ? customDarkSquareStyle : customLightSquareStyle), squareHasPremove && (squareColor === 'black' ? customPremoveDarkSquareStyle : customPremoveLightSquareStyle)), isOver && customDropSquareStyle);\n\n  return /*#__PURE__*/jsx(\"div\", {\n    ref: drop,\n    style: defaultSquareStyle,\n    \"data-square-color\": squareColor,\n    \"data-square\": square,\n    onMouseOver: function onMouseOver(e) {\n      // noop if moving from child of square into square.\n      if (e.relatedTarget && e.currentTarget.contains(e.relatedTarget)) return;\n      onMouseOverSquare(square);\n    },\n    onMouseOut: function onMouseOut(e) {\n      // noop if moving from square into a child of square.\n      if (e.relatedTarget && e.currentTarget.contains(e.relatedTarget)) return;\n      onMouseOutSquare(square);\n    },\n    onMouseDown: function onMouseDown(e) {\n      if (e.button === 2) onRightClickDown(square);\n    },\n    onMouseUp: function onMouseUp(e) {\n      if (e.button === 2) onRightClickUp(square);\n    },\n    onDragEnter: function onDragEnter() {\n      return onDragOverSquare(square);\n    },\n    onClick: function onClick() {\n      onSquareClick(square);\n      clearArrows();\n    },\n    onContextMenu: function onContextMenu(e) {\n      e.preventDefault();\n    },\n    children: /*#__PURE__*/jsx(\"div\", {\n      ref: squareRef,\n      style: _objectSpread2(_objectSpread2(_objectSpread2({}, size(boardWidth)), center), !squareHasPremove && (customSquareStyles === null || customSquareStyles === void 0 ? void 0 : customSquareStyles[square])),\n      children: children\n    })\n  });\n}\n\nvar center = {\n  display: 'flex',\n  justifyContent: 'center'\n};\n\nvar size = function size(width) {\n  return {\n    width: width / 8,\n    height: width / 8\n  };\n};\n\nvar borderRadius = function borderRadius(customBoardStyle, square, boardOrientation) {\n  if (!customBoardStyle.borderRadius) return {};\n\n  if (square === 'a1') {\n    return boardOrientation === 'white' ? {\n      borderBottomLeftRadius: customBoardStyle.borderRadius\n    } : {\n      borderTopRightRadius: customBoardStyle.borderRadius\n    };\n  }\n\n  if (square === 'a8') {\n    return boardOrientation === 'white' ? {\n      borderTopLeftRadius: customBoardStyle.borderRadius\n    } : {\n      borderBottomRightRadius: customBoardStyle.borderRadius\n    };\n  }\n\n  if (square === 'h1') {\n    return boardOrientation === 'white' ? {\n      borderBottomRightRadius: customBoardStyle.borderRadius\n    } : {\n      borderTopLeftRadius: customBoardStyle.borderRadius\n    };\n  }\n\n  if (square === 'h8') {\n    return boardOrientation === 'white' ? {\n      borderTopRightRadius: customBoardStyle.borderRadius\n    } : {\n      borderBottomLeftRadius: customBoardStyle.borderRadius\n    };\n  }\n\n  return {};\n};\n\nfunction Squares(_ref10) {\n  var children = _ref10.children;\n\n  var _useChessboard4 = useChessboard(),\n      boardOrientation = _useChessboard4.boardOrientation,\n      boardWidth = _useChessboard4.boardWidth,\n      customBoardStyle = _useChessboard4.customBoardStyle,\n      id = _useChessboard4.id;\n\n  return /*#__PURE__*/jsx(\"div\", {\n    \"data-boardid\": id,\n    style: _objectSpread2(_objectSpread2({}, boardStyles(boardWidth)), customBoardStyle),\n    children: _toConsumableArray(Array(8)).map(function (_, r) {\n      return /*#__PURE__*/jsx(\"div\", {\n        style: rowStyles(boardWidth),\n        children: _toConsumableArray(Array(8)).map(function (_, c) {\n          // a1, a2 ...\n          var square = boardOrientation === 'black' ? COLUMNS[7 - c] + (r + 1) : COLUMNS[c] + (8 - r);\n          var squareColor = c % 2 === r % 2 ? 'white' : 'black';\n          return children({\n            square: square,\n            squareColor: squareColor,\n            col: c,\n            row: r\n          });\n        })\n      }, r.toString());\n    })\n  });\n}\n\nvar boardStyles = function boardStyles(width) {\n  return {\n    cursor: 'default',\n    height: width,\n    width: width\n  };\n};\n\nvar rowStyles = function rowStyles(width) {\n  return {\n    display: 'flex',\n    flexWrap: 'nowrap',\n    width: width\n  };\n};\n\nvar errorImage = {\n  whiteKing: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    style: {\n      shapeRendering: 'geometricPrecision',\n      textRendering: 'geometricPrecision',\n      imageRendering: 'optimizeQuality'\n    },\n    viewBox: \"0 0 4210 12970\",\n    x: \"0px\",\n    y: \"0px\",\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    width: \"250\",\n    height: \"250\",\n    children: /*#__PURE__*/jsx(\"g\", {\n      children: /*#__PURE__*/jsx(\"path\", {\n        style: {\n          fill: 'black',\n          fillRule: 'nonzero'\n        },\n        d: \"M2105 0c169,0 286,160 249,315l200 0c-172,266 -231,479 -256,792 315,-24 530,-86 792,-255l0 897c-265,-171 -479,-231 -792,-256 18,234 75,495 185,682l339 0c233,0 369,269 225,456l545 0 -595 1916c130,94 158,275 59,402 465,0 416,568 51,568l-334 0 465 2867 332 0c250,0 381,306 199,485 162,63 273,220 273,399l0 633 168 0 0 475c-1403,0 -2807,0 -4210,0l0 -475 167 0 0 -633c0,-179 112,-336 274,-399 -181,-178 -52,-485 199,-485l332 0 465 -2867 -335 0c-353,0 -418,-568 51,-568 -98,-127 -70,-308 59,-402l-594 -1916c181,0 363,0 545,0 -144,-187 -9,-456 225,-456l339 0c110,-187 167,-448 185,-682 -315,25 -530,87 -793,256l0 -897c266,171 480,231 793,255 -25,-315 -87,-529 -256,-792l199 0c-36,-155 81,-315 250,-315zm-1994 10012l0 253 3988 0 0 -253c-1330,0 -2659,0 -3988,0zm484 -1060c-174,0 -316,142 -316,316l0 633 3652 0 0 -633c0,-174 -142,-316 -316,-316 -1007,0 -2013,0 -3020,0zm45 -457c-230,0 -225,345 0,345l2930 0c230,0 225,-345 0,-345 -977,0 -1953,0 -2930,0zm2020 -2978l-1111 0 -465 2867 2041 0 -465 -2867zm-1558 -456c-229,0 -224,345 0,345 669,0 1337,0 2005,0 230,0 225,-345 0,-345 -668,0 -1336,0 -2005,0zm1730 -457l-1454 0c-229,0 -224,345 0,345l1454 0c229,0 224,-345 0,-345zm-2064 -1862l544 1751c529,0 1057,0 1586,0l544 -1751c-892,0 -1783,0 -2674,0zm1085 -567l504 0c-126,-247 -163,-526 -177,-800 273,15 553,52 800,177l0 -504c-247,126 -527,163 -800,177 14,-273 51,-552 177,-799 -168,0 -336,0 -504,0 125,247 162,526 177,799 -274,-14 -553,-51 -800,-177l0 504c247,-125 527,-162 800,-177 -15,274 -52,553 -177,800zm969 111l-1434 0c-230,0 -225,345 0,345l1434 0c230,0 225,-345 0,-345zm-717 -2175c-105,0 -175,109 -133,204l266 0c42,-96 -30,-205 -133,-204z\"\n      })\n    })\n  })\n};\n\nfunction ErrorBoundary(_ref11) {\n  var children = _ref11.children;\n\n  try {\n    return children;\n  } catch (error) {\n    return /*#__PURE__*/jsx(WhiteKing, {\n      showError: true\n    });\n  }\n}\n\nfunction WhiteKing(_ref12) {\n  var _ref12$showError = _ref12.showError,\n      showError = _ref12$showError === void 0 ? false : _ref12$showError;\n  return /*#__PURE__*/jsxs(\"div\", {\n    style: container,\n    children: [/*#__PURE__*/jsx(\"div\", {\n      style: whiteKingStyle,\n      children: errorImage.whiteKing\n    }), showError && /*#__PURE__*/jsx(\"h1\", {\n      children: \"Something went wrong\"\n    })]\n  });\n}\n\nvar container = {\n  display: 'flex',\n  justifyContent: 'center',\n  alignItems: 'center',\n  flexDirection: 'column'\n};\nvar whiteKingStyle = {\n  width: 250,\n  height: 250,\n  transform: 'rotate(90deg)'\n};\n\nfunction Board() {\n  var boardRef = useRef();\n\n  var _useState25 = useState({}),\n      _useState26 = _slicedToArray(_useState25, 2),\n      squares = _useState26[0],\n      setSquares = _useState26[1];\n\n  var _useChessboard5 = useChessboard(),\n      arrows = _useChessboard5.arrows,\n      boardOrientation = _useChessboard5.boardOrientation,\n      boardWidth = _useChessboard5.boardWidth,\n      clearCurrentRightClickDown = _useChessboard5.clearCurrentRightClickDown,\n      customArrowColor = _useChessboard5.customArrowColor,\n      showBoardNotation = _useChessboard5.showBoardNotation,\n      currentPosition = _useChessboard5.currentPosition,\n      premoves = _useChessboard5.premoves;\n\n  useEffect(function () {\n    function handleClickOutside(event) {\n      if (boardRef.current && !boardRef.current.contains(event.target)) {\n        clearCurrentRightClickDown();\n      }\n    }\n\n    document.addEventListener('mouseup', handleClickOutside);\n    return function () {\n      document.removeEventListener('mouseup', handleClickOutside);\n    };\n  }, []);\n  return boardWidth ? /*#__PURE__*/jsxs(\"div\", {\n    ref: boardRef,\n    style: {\n      position: 'relative'\n    },\n    children: [/*#__PURE__*/jsx(Squares, {\n      children: function children(_ref13) {\n        var square = _ref13.square,\n            squareColor = _ref13.squareColor,\n            col = _ref13.col,\n            row = _ref13.row;\n        var squareHasPremove = premoves.find(function (p) {\n          return p.sourceSq === square || p.targetSq === square;\n        });\n        var squareHasPremoveTarget = premoves.find(function (p) {\n          return p.targetSq === square;\n        });\n        return /*#__PURE__*/jsxs(Square, {\n          square: square,\n          squareColor: squareColor,\n          setSquares: setSquares,\n          squareHasPremove: squareHasPremove,\n          children: [currentPosition[square] && /*#__PURE__*/jsx(Piece, {\n            piece: currentPosition[square],\n            square: square,\n            squares: squares\n          }), squareHasPremoveTarget && /*#__PURE__*/jsx(Piece, {\n            isPremovedPiece: true,\n            piece: squareHasPremoveTarget.piece,\n            square: square,\n            squares: squares\n          }), showBoardNotation && /*#__PURE__*/jsx(Notation, {\n            row: row,\n            col: col\n          })]\n        }, \"\".concat(col).concat(row));\n      }\n    }), /*#__PURE__*/jsx(\"svg\", {\n      width: boardWidth,\n      height: boardWidth,\n      style: {\n        position: 'absolute',\n        top: '0',\n        left: '0',\n        pointerEvents: 'none',\n        zIndex: '10'\n      },\n      children: arrows.map(function (arrow) {\n        var from = getRelativeCoords(boardOrientation, boardWidth, arrow[0]);\n        var to = getRelativeCoords(boardOrientation, boardWidth, arrow[1]);\n        return /*#__PURE__*/jsxs(Fragment$1, {\n          children: [/*#__PURE__*/jsx(\"defs\", {\n            children: /*#__PURE__*/jsx(\"marker\", {\n              id: \"arrowhead\",\n              markerWidth: \"2\",\n              markerHeight: \"2.5\",\n              refX: \"1.25\",\n              refY: \"1.25\",\n              orient: \"auto\",\n              children: /*#__PURE__*/jsx(\"polygon\", {\n                points: \"0 0, 2 1.25, 0 2.5\",\n                style: {\n                  fill: customArrowColor\n                }\n              })\n            })\n          }), /*#__PURE__*/jsx(\"line\", {\n            x1: from.x,\n            y1: from.y,\n            x2: to.x,\n            y2: to.y,\n            style: {\n              stroke: customArrowColor,\n              strokeWidth: boardWidth / 36\n            },\n            markerEnd: \"url(#arrowhead)\"\n          })]\n        }, \"\".concat(arrow[0], \"-\").concat(arrow[1]));\n      })\n    })]\n  }) : /*#__PURE__*/jsx(WhiteKing, {});\n}\n\nfunction CustomDragLayer() {\n  var _useChessboard6 = useChessboard(),\n      boardWidth = _useChessboard6.boardWidth,\n      chessPieces = _useChessboard6.chessPieces,\n      id = _useChessboard6.id,\n      snapToCursor = _useChessboard6.snapToCursor;\n\n  var collectedProps = useDragLayer(function (monitor) {\n    return {\n      item: monitor.getItem(),\n      clientOffset: monitor.getClientOffset(),\n      sourceClientOffset: monitor.getSourceClientOffset(),\n      isDragging: monitor.isDragging()\n    };\n  });\n  var isDragging = collectedProps.isDragging,\n      item = collectedProps.item,\n      clientOffset = collectedProps.clientOffset,\n      sourceClientOffset = collectedProps.sourceClientOffset;\n  var layerStyles = {\n    position: 'fixed',\n    pointerEvents: 'none',\n    zIndex: 10,\n    left: 0,\n    top: 0\n  };\n  var getItemStyle = useCallback(function (clientOffset, sourceClientOffset) {\n    if (!clientOffset || !sourceClientOffset) return {\n      display: 'none'\n    };\n\n    var _ref14 = snapToCursor ? clientOffset : sourceClientOffset,\n        x = _ref14.x,\n        y = _ref14.y;\n\n    if (snapToCursor) {\n      var halfSquareWidth = boardWidth / 8 / 2;\n      x -= halfSquareWidth;\n      y -= halfSquareWidth;\n    }\n\n    var transform = \"translate(\".concat(x, \"px, \").concat(y, \"px)\");\n    return {\n      transform: transform,\n      WebkitTransform: transform,\n      touchAction: 'none'\n    };\n  }, [boardWidth, snapToCursor]);\n  return isDragging && item.id === id ? /*#__PURE__*/jsx(\"div\", {\n    style: layerStyles,\n    children: /*#__PURE__*/jsx(\"div\", {\n      style: getItemStyle(clientOffset, sourceClientOffset),\n      children: typeof chessPieces[item.piece] === 'function' ? chessPieces[item.piece]({\n        squareWidth: boardWidth / 8,\n        isDragging: true\n      }) : /*#__PURE__*/jsx(\"svg\", {\n        viewBox: '1 1 43 43',\n        width: boardWidth / 8,\n        height: boardWidth / 8,\n        children: /*#__PURE__*/jsx(\"g\", {\n          children: chessPieces[item.piece]\n        })\n      })\n    })\n  }) : null;\n}\n\nvar Chessboard = /*#__PURE__*/forwardRef(function (props, ref) {\n  var _useState27 = useState(false),\n      _useState28 = _slicedToArray(_useState27, 2),\n      backendSet = _useState28[0],\n      setBackendSet = _useState28[1];\n\n  var _useState29 = useState(false),\n      _useState30 = _slicedToArray(_useState29, 2),\n      isMobile = _useState30[0],\n      setIsMobile = _useState30[1];\n\n  var customDndBackend = props.customDndBackend,\n      customDndBackendOptions = props.customDndBackendOptions,\n      otherProps = _objectWithoutProperties2(props, _excluded);\n\n  useEffect(function () {\n    setIsMobile('ontouchstart' in window);\n    setBackendSet(true);\n  }, []);\n  var backend = customDndBackend || (isMobile ? TouchBackend : HTML5Backend);\n  return backendSet && /*#__PURE__*/jsx(ErrorBoundary, {\n    children: /*#__PURE__*/jsx(DndProvider, {\n      backend: backend,\n      children: /*#__PURE__*/jsxs(ChessboardProvider, _objectSpread2(_objectSpread2({\n        ref: ref\n      }, otherProps), {}, {\n        children: [/*#__PURE__*/jsx(CustomDragLayer, {}), /*#__PURE__*/jsx(Board, {})]\n      }))\n    })\n  });\n});\nChessboard.defaultProps = chessboardDefaultProps;\nexport { Chessboard };","map":{"version":3,"names":["React","createContext","memo","useEffect","useLayoutEffect","useState","useCallback","useMemo","isValidElement","cloneElement","useContext","forwardRef","useRef","useImperativeHandle","Fragment","Fragment$1","jsx","jsxs","DndContext","dragDropManager","undefined","formatProdErrorMessage","code","$$observable","Symbol","observable","randomString","Math","random","toString","substring","split","join","ActionTypes","INIT","REPLACE","PROBE_UNKNOWN_ACTION","isPlainObject","obj","proto","Object","getPrototypeOf","miniKindOf","val","type","Array","isArray","isDate","isError","constructorName","ctorName","slice","toLowerCase","replace","constructor","name","Error","message","stackTraceLimit","Date","toDateString","getDate","setDate","kindOf","typeOfVal","process","env","NODE_ENV","createStore","reducer","preloadedState","enhancer","_ref2","arguments","currentReducer","currentState","currentListeners","nextListeners","isDispatching","ensureCanMutateNextListeners","getState","subscribe","listener","isSubscribed","push","unsubscribe","index","indexOf","splice","dispatch","action","listeners","i","length","replaceReducer","nextReducer","_ref","outerSubscribe","observer","observeState","next","warning","console","error","e","isCrushed","invariant","condition","format","args","isProduction","argIndex","framesToPop","get","path","defaultValue","reduce","a","c","without$1","items","item","filter","isObject","input","xor","itemsA","itemsB","map","Map","insertItem","set","has","forEach","result","count","key","intersection","t","INIT_COORDS","BEGIN_DRAG","PUBLISH_DRAG_SOURCE","HOVER","DROP","END_DRAG","setClientOffset","clientOffset","sourceClientOffset","payload","ResetCoordinatesAction","createBeginDrag","manager","beginDrag","sourceIds","options","publishSource","getSourceClientOffset","monitor","getMonitor","registry","getRegistry","verifyInvariants$1","sourceId","getDraggableSource","verifyGetSourceClientOffsetIsFunction","source","getSource","verifyItemIsObject","pinSource","itemType","getSourceType","isSourcePublic","isDragging","canDragSource","_defineProperty$4","value","defineProperty","enumerable","configurable","writable","_objectSpread$4","target","ownKeys","keys","getOwnPropertySymbols","concat","sym","getOwnPropertyDescriptor","createDrop","drop","verifyInvariants","targetIds","getDroppableTargets","targetId","dropResult","determineDropResult","didDrop","getTarget","verifyDropResultType","getDropResult","getTargetIds","canDropOnTarget","reverse","createEndDrag","endDrag","verifyIsDragging","getSourceId","unpinSource","matchesType","targetType","draggedItemType","some","createHover","hover","targetIdsArg","verifyTargetIdsIsArray","getItemType","removeNonMatchingTargetIds","checkInvariants","hoverAllTargets","lastIndexOf","getTargetType","createPublishDragSource","publishDragSource","createDragDropActions","DragDropManagerImpl","store","isSetUp","handleRefCountChange","shouldSetUp","refCount","backend","setup","teardown","bindActionCreator","actionCreator","apply","actions","boundActions","add","b","x","y","subtract","state","initialClientOffset","initialSourceClientOffset","getDifferenceFromInitialOffset","NONE","ALL","__IS_NONE__","__IS_ALL__","areDirty","dirtyIds","handlerIds","commonIds","DragDropMonitorImpl","prevStateId","stateId","handleChange","currentStateId","canSkipListener","dirtyHandlerIds","previousState","dragOffset","nextState","canDrag","canDrop","Boolean","sourceType","shallow","dragOperation","scope","global","self","BrowserMutationObserver","MutationObserver","WebKitMutationObserver","makeRequestCallFromTimer","callback","requestCall","timeoutHandle","setTimeout","handleTimer","intervalHandle","setInterval","clearTimeout","clearInterval","makeRequestCallFromMutationObserver","toggle","node","document","createTextNode","observe","characterData","data","makeRequestCall","AsapQueue","queue","pendingErrors","flushing","capacity","flush","q","currentIndex","call","scan","newLength","registerPendingError","err","requestErrorThrow","requestFlush","shift","task","RawTask","onError","release","TaskFactory","freeTasks","tasks","t1","pop","asapQueue","taskFactory","asap","enqueueTask","create","ADD_SOURCE","ADD_TARGET","REMOVE_SOURCE","REMOVE_TARGET","addSource","addTarget","removeSource","removeTarget","validateSourceContract","validateTargetContract","validateType","allowArray","HandlerRole","nextUniqueId","getNextUniqueId","getNextHandlerId","role","id","SOURCE","TARGET","parseRoleFromHandlerId","handlerId","mapContainsValue","searchValue","entries","isDone","done","HandlerRegistryImpl","types","dragSources","dropTargets","pinnedSourceId","pinnedSource","addHandler","handler","includePinned","isSourceId","isPinned","isTargetId","delete","strictEquality","areCoordsEqual","offsetA","offsetB","areArraysEqual","isEqual","reduce$5","_state","prevTargetIds","didChange","prevInnermostTargetId","innermostTargetId","_defineProperty$3","_objectSpread$3","initialState$1","reduce$4","_defineProperty$2","_objectSpread$2","initialState","reduce$3","reduce$2","reduce$1","_defineProperty$1","_objectSpread$1","createDragDropManager","backendFactory","globalContext","backendOptions","debugMode","makeStoreInstance","receiveBackend","reduxDevTools","window","__REDUX_DEVTOOLS_EXTENSION__","instanceId","_objectWithoutProperties","excluded","_objectWithoutPropertiesLoose","sourceSymbolKeys","prototype","propertyIsEnumerable","sourceKeys","INSTANCE_SYM","for","DndProvider","_param","children","props","getDndContextValue","isGlobalInstance","context","getGlobalContext","Provider","createSingletonDndContext","ctx","fastDeepEqual","equal","RegExp","flags","valueOf","hasOwnProperty","useIsomorphicLayoutEffect","useCollector","collect","onUpdate","collected","setCollected","updateCollected","nextValue","useMonitorOutput","onCollect","subscribeToMonitorStateChange","getHandlerId","subscribeToStateChange","useCollectedProps","collector","connector","reconnect","useOptionalFactory","arg","deps","memoDeps","useConnectDragSource","hooks","dragSource","useConnectDragPreview","dragPreview","isCallingCanDrag","isCallingIsDragging","DragSourceMonitorImpl","internalMonitor","isDraggingSource","isOverTarget","subscribeToOffsetChange","getItem","getInitialClientOffset","getInitialSourceClientOffset","getClientOffset","isCallingCanDrop","DropTargetMonitorImpl","registerTarget","registerSource","shallowEqual","objA","objB","compare","compareContext","compareResult","keysA","keysB","bHasOwnProperty","bind","idx","valueA","valueB","isRef","throwIfCompositeComponentElement","element","displayName","wrapHookToRecognizeElement","hook","elementOrNode","ref","cloneWithRef","wrapConnectorHooks","wrappedHooks","endsWith","wrappedHook","setRef","current","newRef","previousRef","SourceConnector","clearDragSource","dragSourceOptions","dragSourceRef","dragSourceNode","reconnectDragSource","clearDragPreview","dragPreviewOptions","dragPreviewRef","dragPreviewNode","reconnectDragPreview","dragSourceOptionsInternal","dragPreviewOptionsInternal","lastConnectedHandlerId","lastConnectedDragSource","lastConnectedDragSourceOptions","lastConnectedDragPreview","lastConnectedDragPreviewOptions","newHandlerId","didHandlerIdChange","didConnectedDragSourceChange","didDragSourceOptionsChange","disconnectDragSource","dragSourceUnsubscribe","connectDragSource","forceDidChange","didConnectedDragPreviewChange","didDragPreviewOptionsChange","disconnectDragPreview","dragPreviewUnsubscribe","connectDragPreview","TargetConnector","dropTarget","clearDropTarget","dropTargetOptions","dropTargetRef","dropTargetNode","dropTargetOptionsInternal","lastConnectedDropTarget","lastConnectedDropTargetOptions","didDropTargetChange","didOptionsChange","disconnectDropTarget","unsubscribeDropTarget","connectDropTarget","useDragDropManager","useDragSourceConnector","getBackend","useDragSourceMonitor","DragSourceImpl","spec","globalMonitor","end","useDragSource","useDragType","useRegisteredDragSource","registerDragSource","unregister","receiveHandlerId","useDrag","specArg","begin","previewOptions","useDragLayer","useConnectDropTarget","useDropTargetConnector","useDropTargetMonitor","useAccept","accept","DropTargetImpl","useDropTarget","useRegisteredDropTarget","registerDropTarget","useDrop","memoize","fn","memoized","without","union","Set","EnterLeaveCounter","isNodeInDocument","entered","enteringNode","previousLength","isNodeEntered","contains","leavingNode","NativeDragSource","config","initializeExposedProperties","exposeProperties","property","warn","dataTransfer","newProperties","propertyFn","matchesTypes","defineProperties","handle","FILE","URL","TEXT","HTML","NativeTypes","freeze","__proto__","getDataFromDataTransfer","typesToTry","resultSoFar","typeToTry","getData","nativeTypesConfig","files","html","urls","text","createNativeDragSource","loadDataTransfer","matchNativeItemType","dataTransferTypes","nativeItemType","typeConfig","isFirefox","test","navigator","userAgent","isSafari","safari","MonotonicInterpolant","xs","ys","indexes","sort","dxs","ms","dx","dy","i1","c1s","i2","m2","mNext","dxNext","common","c2s","c3s","m","i3","c1","invDx","low","high","mid","floor","xHere","max","diff","diffSq","ELEMENT_NODE$1","getNodeClientOffset$1","el","nodeType","parentElement","getBoundingClientRect","top","left","getEventClientOffset$1","clientX","clientY","isImageNode","nodeName","documentElement","getDragPreviewSize","isImage","sourceWidth","sourceHeight","dragPreviewWidth","width","dragPreviewHeight","height","devicePixelRatio","getDragPreviewOffset","sourceNode","anchorPoint","offsetPoint","dragPreviewNodeOffsetFromClient","offsetFromDragPreview","offsetWidth","offsetHeight","anchorX","anchorY","calculateYOffset","interpolantY","interpolate","calculateXOffset","interpolantX","offsetX","offsetY","isManualOffsetX","isManualOffsetY","OptionsReader$1","ownerDocument","optionsArgs","rootElement","_defineProperty","_objectSpread","HTML5BackendImpl","sourcePreviewNodes","sourcePreviewNodeOptions","sourceNodes","sourceNodeOptions","dragStartSourceIds","dropTargetIds","dragEnterTargetIds","currentNativeSource","currentNativeHandle","currentDragSourceNode","altKeyPressed","mouseMoveTimeoutTimer","asyncEndDragFrameId","dragOverTargetIds","lastClientOffset","hoverRafId","endDragNativeItem","isDraggingNativeItem","body","endDragIfSourceWasRemovedFromDOM","clearCurrentDragSourceNode","cancelHover","scheduleHover","requestAnimationFrame","cancelAnimationFrame","handleTopDragStartCapture","handleTopDragStart","defaultPrevented","nativeType","setDragImage","getCurrentSourcePreviewNodeOptions","dragPreviewOffset","setData","setCurrentDragSourceNode","captureDraggingState","beginDragNativeItem","hasAttribute","preventDefault","handleTopDragEndCapture","handleTopDragEnterCapture","isFirstEnter","enterLeaveCounter","enter","handleTopDragEnter","altKey","dropEffect","getCurrentDropEffect","handleTopDragOverCapture","handleTopDragOver","handleTopDragLeaveCapture","isLastLeave","leave","handleTopDropCapture","reset","handleTopDrop","handleSelectStart","dragDrop","tagName","isContentEditable","getActions","ref1","size","root","__isReactDndBackendSetUp","addEventListeners","removeEventListeners","handleDragStart","setAttribute","addEventListener","removeEventListener","handleDragEnter","handleDragOver","handleDrop","getCurrentSourceNodeOptions","MOUSE_MOVE_TIMEOUT","unshift","_e","emptyImage","getEmptyImage","Image","src","HTML5Backend","createBackend","ListenerType","OptionsReader","_delay","delay","scrollAngleRanges","getDropTargetElementsAtPoint","_ignoreContextMenu","ignoreContextMenu","_enableHoverOutsideTarget","enableHoverOutsideTarget","_enableKeyboardEvents","enableKeyboardEvents","_enableMouseEvents","enableMouseEvents","_enableTouchEvents","enableTouchEvents","touchSlop","ref2","ref3","delayTouchStart","ref4","ref5","ref6","delayMouseStart","distance","x1","y1","x2","y2","sqrt","pow","abs","inAngleRanges","angleRanges","angle","atan2","PI","ar","start","MouseButtons","Left","Right","Center","MouseButton","eventShouldStartDrag","button","eventShouldEndDrag","buttons","isTouchEvent","targetTouches","ELEMENT_NODE","getNodeClientOffset","getEventClientTouchOffset","lastTargetTouchFallback","getEventClientOffset","touches","supportsPassive","supported","eventNames","mouse","move","contextmenu","touch","keyboard","keydown","TouchBackendImpl","handleTopMoveStartCapture","moveStartSourceIds","handleMoveStart","handleTopMoveStart","_mouseClientOffset","waitingForDelay","handleTopMoveStartDelay","timeout","handleTopMoveCapture","handleMove","_evt","handleTopMove","e1","_isScrolling","installSourceNodeRemovalObserver","cancelable","dragOverTargetNodes","targetNodes","elementsAtPoint","elementsFromPoint","elementsAtPointExtended","nodeId","currentNode","orderedDragOverTargetIds","_getDropTargetId","ids","targetNode","handleTopMoveEndCapture","uninstallSourceNodeRemovalObserver","handleCancelOnEscape","listenerTypes","getTopMoveStartHandler","subject","event","capture","passive","listenerType","evt","coords","droppedOn","elementFromPoint","childMatch","draggedSourceNode","draggedSourceNodeRemovalObserver","resurrectSourceNode","childList","style","display","removeAttribute","appendChild","disconnect","TouchBackend","COLUMNS","chessboardDefaultProps","animationDuration","areArrowsAllowed","arePiecesDraggable","arePremovesAllowed","boardOrientation","boardWidth","clearPremovesOnRightClick","customArrows","customArrowColor","customBoardStyle","customDarkSquareStyle","backgroundColor","customDndBackend","customDndBackendOptions","customDropSquareStyle","boxShadow","customLightSquareStyle","customPieces","customPremoveDarkSquareStyle","customPremoveLightSquareStyle","customSquareStyles","dropOffBoardAction","isDraggablePiece","getPositionObject","onArrowsChange","onDragOverSquare","onMouseOutSquare","onMouseOverSquare","onPieceClick","onPieceDragBegin","onPieceDragEnd","onPieceDrop","onSquareClick","onSquareRightClick","position","showBoardNotation","snapToCursor","startPositionObject","a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","d1","f1","g1","h1","whiteColumnValues","d","f","g","h","blackColumnValues","whiteRows","blackRows","getRelativeCoords","square","squareWidth","columns","rows","isDifferentFromStart","newPosition","isDifferent","getPositionDifferences","currentPosition","difference","removed","added","isString","s","convertPositionToObject","fenToObj","validFen","validPositionObject","fen","currentRow","row","colIdx","j","search","numEmptySquares","parseInt","fenToPieceCode","expandFenEmptySquares","chunks","piece","toUpperCase","validSquare","validPieceCode","pos","defaultPieces","wP","xmlns","version","opacity","fill","fillOpacity","fillRule","stroke","strokeWidth","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeDasharray","strokeOpacity","wR","wN","transform","wB","wQ","cx","cy","r","wK","bP","bR","bN","bB","bQ","bK","ChessboardContext","useChessboard","ChessboardProvider","showSparePieces","setCurrentPosition","positionDifferences","setPositionDifferences","lastPieceColour","setLastPieceColour","premoves","setPremoves","premovesRef","currentRightClickDown","setCurrentRightClickDown","arrows","setArrows","chessPieces","setChessPieces","manualDrop","setManualDrop","previousTimeout","setPreviousTimeout","waitingForAnimation","setWaitingForAnimation","clearPremoves","clearLastPieceColour","_Object$keys","_Object$entries","_Object$entries$","differences","newPieceColour","attemptPremove","newTimeout","clearArrows","handleSetPosition","sourceSq","targetSq","p","oldPremoves","newOnDropPosition","isValidMove","premove","onRightClickDown","onRightClickUp","oldArrows","newArrows","clearCurrentRightClickDown","Notation","col","whiteColor","blackColor","isRow","isColumn","isBottomLeftSquare","getRow","getColumn","renderBottomLeft","notationStyle","color","numericStyle","alphaStyle","renderLetters","renderNumbers","alignSelf","paddingLeft","fontSize","paddingRight","zIndex","Piece","squares","isPremovedPiece","touchAction","cursor","sourceSquare","pieceStyle","setPieceStyle","drag","oldPieceStyle","hidePiece","find","_positionDifferences$","removedPiece","newSquare","getSquareCoordinates","transition","getSingleSquareCoordinates","targetSquare","onClick","droppedPiece","viewBox","Square","squareColor","setSquares","squareHasPremove","squareRef","isOver","oldSquares","defaultSquareStyle","borderRadius","onMouseOver","relatedTarget","currentTarget","onMouseOut","onMouseDown","onMouseUp","onDragEnter","onContextMenu","center","justifyContent","borderBottomLeftRadius","borderTopRightRadius","borderTopLeftRadius","borderBottomRightRadius","Squares","boardStyles","_","rowStyles","flexWrap","errorImage","whiteKing","shapeRendering","textRendering","imageRendering","clipRule","ErrorBoundary","WhiteKing","showError","container","whiteKingStyle","alignItems","flexDirection","Board","boardRef","handleClickOutside","squareHasPremoveTarget","pointerEvents","arrow","from","to","markerWidth","markerHeight","refX","refY","orient","points","markerEnd","CustomDragLayer","collectedProps","layerStyles","getItemStyle","halfSquareWidth","WebkitTransform","Chessboard","backendSet","setBackendSet","isMobile","setIsMobile","otherProps","defaultProps"],"sources":["C:/Users/tomas/Desktop/chess-masterclass/backend/chess_masterclass/frontend_chessmasterclass/node_modules/react-chessboard/dist/index.esm.js"],"sourcesContent":["import React, { createContext, memo, useEffect, useLayoutEffect, useState, useCallback, useMemo, isValidElement, cloneElement, useContext, forwardRef, useRef, useImperativeHandle, Fragment as Fragment$1 } from 'react';\nimport { jsx, jsxs, Fragment } from 'react/jsx-runtime';\n\n/**\n * Create the React Context\n */\n\nconst DndContext = /*#__PURE__*/createContext({\n  dragDropManager: undefined\n});\n\n/**\n * Adapted from React: https://github.com/facebook/react/blob/master/packages/shared/formatProdErrorMessage.js\n *\n * Do not require this module directly! Use normal throw error calls. These messages will be replaced with error codes\n * during build.\n * @param {number} code\n */\n\nfunction formatProdErrorMessage(code) {\n  return \"Minified Redux error #\" + code + \"; visit https://redux.js.org/Errors?code=\" + code + \" for the full message or \" + 'use the non-minified dev environment for full errors. ';\n} // Inlined version of the `symbol-observable` polyfill\n\n\nvar $$observable = function () {\n  return typeof Symbol === 'function' && Symbol.observable || '@@observable';\n}();\n/**\n * These are private action types reserved by Redux.\n * For any unknown actions, you must return the current state.\n * If the current state is undefined, you must return the initial state.\n * Do not reference these action types directly in your code.\n */\n\n\nvar randomString = function randomString() {\n  return Math.random().toString(36).substring(7).split('').join('.');\n};\n\nvar ActionTypes = {\n  INIT: \"@@redux/INIT\" + randomString(),\n  REPLACE: \"@@redux/REPLACE\" + randomString(),\n  PROBE_UNKNOWN_ACTION: function PROBE_UNKNOWN_ACTION() {\n    return \"@@redux/PROBE_UNKNOWN_ACTION\" + randomString();\n  }\n};\n/**\n * @param {any} obj The object to inspect.\n * @returns {boolean} True if the argument appears to be a plain object.\n */\n\nfunction isPlainObject(obj) {\n  if (typeof obj !== 'object' || obj === null) return false;\n  var proto = obj;\n\n  while (Object.getPrototypeOf(proto) !== null) {\n    proto = Object.getPrototypeOf(proto);\n  }\n\n  return Object.getPrototypeOf(obj) === proto;\n} // Inlined / shortened version of `kindOf` from https://github.com/jonschlinkert/kind-of\n\n\nfunction miniKindOf(val) {\n  if (val === void 0) return 'undefined';\n  if (val === null) return 'null';\n  var type = typeof val;\n\n  switch (type) {\n    case 'boolean':\n    case 'string':\n    case 'number':\n    case 'symbol':\n    case 'function':\n      {\n        return type;\n      }\n  }\n\n  if (Array.isArray(val)) return 'array';\n  if (isDate(val)) return 'date';\n  if (isError(val)) return 'error';\n  var constructorName = ctorName(val);\n\n  switch (constructorName) {\n    case 'Symbol':\n    case 'Promise':\n    case 'WeakMap':\n    case 'WeakSet':\n    case 'Map':\n    case 'Set':\n      return constructorName;\n  } // other\n\n\n  return type.slice(8, -1).toLowerCase().replace(/\\s/g, '');\n}\n\nfunction ctorName(val) {\n  return typeof val.constructor === 'function' ? val.constructor.name : null;\n}\n\nfunction isError(val) {\n  return val instanceof Error || typeof val.message === 'string' && val.constructor && typeof val.constructor.stackTraceLimit === 'number';\n}\n\nfunction isDate(val) {\n  if (val instanceof Date) return true;\n  return typeof val.toDateString === 'function' && typeof val.getDate === 'function' && typeof val.setDate === 'function';\n}\n\nfunction kindOf(val) {\n  var typeOfVal = typeof val;\n\n  if (process.env.NODE_ENV !== 'production') {\n    typeOfVal = miniKindOf(val);\n  }\n\n  return typeOfVal;\n}\n/**\n * @deprecated\n *\n * **We recommend using the `configureStore` method\n * of the `@reduxjs/toolkit` package**, which replaces `createStore`.\n *\n * Redux Toolkit is our recommended approach for writing Redux logic today,\n * including store setup, reducers, data fetching, and more.\n *\n * **For more details, please read this Redux docs page:**\n * **https://redux.js.org/introduction/why-rtk-is-redux-today**\n *\n * `configureStore` from Redux Toolkit is an improved version of `createStore` that\n * simplifies setup and helps avoid common bugs.\n *\n * You should not be using the `redux` core package by itself today, except for learning purposes.\n * The `createStore` method from the core `redux` package will not be removed, but we encourage\n * all users to migrate to using Redux Toolkit for all Redux code.\n *\n * If you want to use `createStore` without this visual deprecation warning, use\n * the `legacy_createStore` import instead:\n *\n * `import { legacy_createStore as createStore} from 'redux'`\n *\n */\n\n\nfunction createStore(reducer, preloadedState, enhancer) {\n  var _ref2;\n\n  if (typeof preloadedState === 'function' && typeof enhancer === 'function' || typeof enhancer === 'function' && typeof arguments[3] === 'function') {\n    throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(0) : 'It looks like you are passing several store enhancers to ' + 'createStore(). This is not supported. Instead, compose them ' + 'together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.');\n  }\n\n  if (typeof preloadedState === 'function' && typeof enhancer === 'undefined') {\n    enhancer = preloadedState;\n    preloadedState = undefined;\n  }\n\n  if (typeof enhancer !== 'undefined') {\n    if (typeof enhancer !== 'function') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(1) : \"Expected the enhancer to be a function. Instead, received: '\" + kindOf(enhancer) + \"'\");\n    }\n\n    return enhancer(createStore)(reducer, preloadedState);\n  }\n\n  if (typeof reducer !== 'function') {\n    throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(2) : \"Expected the root reducer to be a function. Instead, received: '\" + kindOf(reducer) + \"'\");\n  }\n\n  var currentReducer = reducer;\n  var currentState = preloadedState;\n  var currentListeners = [];\n  var nextListeners = currentListeners;\n  var isDispatching = false;\n  /**\n   * This makes a shallow copy of currentListeners so we can use\n   * nextListeners as a temporary list while dispatching.\n   *\n   * This prevents any bugs around consumers calling\n   * subscribe/unsubscribe in the middle of a dispatch.\n   */\n\n  function ensureCanMutateNextListeners() {\n    if (nextListeners === currentListeners) {\n      nextListeners = currentListeners.slice();\n    }\n  }\n  /**\n   * Reads the state tree managed by the store.\n   *\n   * @returns {any} The current state tree of your application.\n   */\n\n\n  function getState() {\n    if (isDispatching) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(3) : 'You may not call store.getState() while the reducer is executing. ' + 'The reducer has already received the state as an argument. ' + 'Pass it down from the top reducer instead of reading it from the store.');\n    }\n\n    return currentState;\n  }\n  /**\n   * Adds a change listener. It will be called any time an action is dispatched,\n   * and some part of the state tree may potentially have changed. You may then\n   * call `getState()` to read the current state tree inside the callback.\n   *\n   * You may call `dispatch()` from a change listener, with the following\n   * caveats:\n   *\n   * 1. The subscriptions are snapshotted just before every `dispatch()` call.\n   * If you subscribe or unsubscribe while the listeners are being invoked, this\n   * will not have any effect on the `dispatch()` that is currently in progress.\n   * However, the next `dispatch()` call, whether nested or not, will use a more\n   * recent snapshot of the subscription list.\n   *\n   * 2. The listener should not expect to see all state changes, as the state\n   * might have been updated multiple times during a nested `dispatch()` before\n   * the listener is called. It is, however, guaranteed that all subscribers\n   * registered before the `dispatch()` started will be called with the latest\n   * state by the time it exits.\n   *\n   * @param {Function} listener A callback to be invoked on every dispatch.\n   * @returns {Function} A function to remove this change listener.\n   */\n\n\n  function subscribe(listener) {\n    if (typeof listener !== 'function') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(4) : \"Expected the listener to be a function. Instead, received: '\" + kindOf(listener) + \"'\");\n    }\n\n    if (isDispatching) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(5) : 'You may not call store.subscribe() while the reducer is executing. ' + 'If you would like to be notified after the store has been updated, subscribe from a ' + 'component and invoke store.getState() in the callback to access the latest state. ' + 'See https://redux.js.org/api/store#subscribelistener for more details.');\n    }\n\n    var isSubscribed = true;\n    ensureCanMutateNextListeners();\n    nextListeners.push(listener);\n    return function unsubscribe() {\n      if (!isSubscribed) {\n        return;\n      }\n\n      if (isDispatching) {\n        throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(6) : 'You may not unsubscribe from a store listener while the reducer is executing. ' + 'See https://redux.js.org/api/store#subscribelistener for more details.');\n      }\n\n      isSubscribed = false;\n      ensureCanMutateNextListeners();\n      var index = nextListeners.indexOf(listener);\n      nextListeners.splice(index, 1);\n      currentListeners = null;\n    };\n  }\n  /**\n   * Dispatches an action. It is the only way to trigger a state change.\n   *\n   * The `reducer` function, used to create the store, will be called with the\n   * current state tree and the given `action`. Its return value will\n   * be considered the **next** state of the tree, and the change listeners\n   * will be notified.\n   *\n   * The base implementation only supports plain object actions. If you want to\n   * dispatch a Promise, an Observable, a thunk, or something else, you need to\n   * wrap your store creating function into the corresponding middleware. For\n   * example, see the documentation for the `redux-thunk` package. Even the\n   * middleware will eventually dispatch plain object actions using this method.\n   *\n   * @param {Object} action A plain object representing “what changed”. It is\n   * a good idea to keep actions serializable so you can record and replay user\n   * sessions, or use the time travelling `redux-devtools`. An action must have\n   * a `type` property which may not be `undefined`. It is a good idea to use\n   * string constants for action types.\n   *\n   * @returns {Object} For convenience, the same action object you dispatched.\n   *\n   * Note that, if you use a custom middleware, it may wrap `dispatch()` to\n   * return something else (for example, a Promise you can await).\n   */\n\n\n  function dispatch(action) {\n    if (!isPlainObject(action)) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(7) : \"Actions must be plain objects. Instead, the actual type was: '\" + kindOf(action) + \"'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.\");\n    }\n\n    if (typeof action.type === 'undefined') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(8) : 'Actions may not have an undefined \"type\" property. You may have misspelled an action type string constant.');\n    }\n\n    if (isDispatching) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(9) : 'Reducers may not dispatch actions.');\n    }\n\n    try {\n      isDispatching = true;\n      currentState = currentReducer(currentState, action);\n    } finally {\n      isDispatching = false;\n    }\n\n    var listeners = currentListeners = nextListeners;\n\n    for (var i = 0; i < listeners.length; i++) {\n      var listener = listeners[i];\n      listener();\n    }\n\n    return action;\n  }\n  /**\n   * Replaces the reducer currently used by the store to calculate the state.\n   *\n   * You might need this if your app implements code splitting and you want to\n   * load some of the reducers dynamically. You might also need this if you\n   * implement a hot reloading mechanism for Redux.\n   *\n   * @param {Function} nextReducer The reducer for the store to use instead.\n   * @returns {void}\n   */\n\n\n  function replaceReducer(nextReducer) {\n    if (typeof nextReducer !== 'function') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(10) : \"Expected the nextReducer to be a function. Instead, received: '\" + kindOf(nextReducer));\n    }\n\n    currentReducer = nextReducer; // This action has a similiar effect to ActionTypes.INIT.\n    // Any reducers that existed in both the new and old rootReducer\n    // will receive the previous state. This effectively populates\n    // the new state tree with any relevant data from the old one.\n\n    dispatch({\n      type: ActionTypes.REPLACE\n    });\n  }\n  /**\n   * Interoperability point for observable/reactive libraries.\n   * @returns {observable} A minimal observable of state changes.\n   * For more information, see the observable proposal:\n   * https://github.com/tc39/proposal-observable\n   */\n\n\n  function observable() {\n    var _ref;\n\n    var outerSubscribe = subscribe;\n    return _ref = {\n      /**\n       * The minimal observable subscription method.\n       * @param {Object} observer Any object that can be used as an observer.\n       * The observer object should have a `next` method.\n       * @returns {subscription} An object with an `unsubscribe` method that can\n       * be used to unsubscribe the observable from the store, and prevent further\n       * emission of values from the observable.\n       */\n      subscribe: function subscribe(observer) {\n        if (typeof observer !== 'object' || observer === null) {\n          throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(11) : \"Expected the observer to be an object. Instead, received: '\" + kindOf(observer) + \"'\");\n        }\n\n        function observeState() {\n          if (observer.next) {\n            observer.next(getState());\n          }\n        }\n\n        observeState();\n        var unsubscribe = outerSubscribe(observeState);\n        return {\n          unsubscribe: unsubscribe\n        };\n      }\n    }, _ref[$$observable] = function () {\n      return this;\n    }, _ref;\n  } // When a store is created, an \"INIT\" action is dispatched so that every\n  // reducer returns their initial state. This effectively populates\n  // the initial state tree.\n\n\n  dispatch({\n    type: ActionTypes.INIT\n  });\n  return _ref2 = {\n    dispatch: dispatch,\n    subscribe: subscribe,\n    getState: getState,\n    replaceReducer: replaceReducer\n  }, _ref2[$$observable] = observable, _ref2;\n}\n/**\n * Prints a warning in the console if it exists.\n *\n * @param {String} message The warning message.\n * @returns {void}\n */\n\nfunction warning(message) {\n  /* eslint-disable no-console */\n  if (typeof console !== 'undefined' && typeof console.error === 'function') {\n    console.error(message);\n  }\n  /* eslint-enable no-console */\n\n\n  try {\n    // This error was thrown as a convenience so that if you enable\n    // \"break on all exceptions\" in your console,\n    // it would pause the execution at this line.\n    throw new Error(message);\n  } catch (e) {} // eslint-disable-line no-empty\n\n}\n/*\n * This is a dummy function to check if the function name has been altered by minification.\n * If the function has been minified and NODE_ENV !== 'production', warn the user.\n */\n\n\nfunction isCrushed() {}\n\nif (process.env.NODE_ENV !== 'production' && typeof isCrushed.name === 'string' && isCrushed.name !== 'isCrushed') {\n  warning('You are currently using minified code outside of NODE_ENV === \"production\". ' + 'This means that you are running a slower development build of Redux. ' + 'You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify ' + 'or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) ' + 'to ensure you have the correct code for your production build.');\n}\n\n/**\n * Use invariant() to assert state which your program assumes to be true.\n *\n * Provide sprintf-style format (only %s is supported) and arguments\n * to provide information about what broke and what you were\n * expecting.\n *\n * The invariant message will be stripped in production, but the invariant\n * will remain to ensure logic does not differ in production.\n */\nfunction invariant(condition, format, ...args) {\n  if (isProduction()) {\n    if (format === undefined) {\n      throw new Error('invariant requires an error message argument');\n    }\n  }\n\n  if (!condition) {\n    let error;\n\n    if (format === undefined) {\n      error = new Error('Minified exception occurred; use the non-minified dev environment ' + 'for the full error message and additional helpful warnings.');\n    } else {\n      let argIndex = 0;\n      error = new Error(format.replace(/%s/g, function () {\n        return args[argIndex++];\n      }));\n      error.name = 'Invariant Violation';\n    }\n\n    error.framesToPop = 1 // we don't care about invariant's own frame\n    ;\n    throw error;\n  }\n}\n\nfunction isProduction() {\n  return typeof process !== 'undefined' && process.env['NODE_ENV'] === 'production';\n}\n\n// cheap lodash replacements\n\n/**\n * drop-in replacement for _.get\n * @param obj\n * @param path\n * @param defaultValue\n */\nfunction get(obj, path, defaultValue) {\n  return path.split('.').reduce((a, c) => a && a[c] ? a[c] : defaultValue || null, obj);\n}\n/**\n * drop-in replacement for _.without\n */\n\nfunction without$1(items, item) {\n  return items.filter(i => i !== item);\n}\n/**\n * drop-in replacement for _.isString\n * @param input\n */\n\nfunction isObject(input) {\n  return typeof input === 'object';\n}\n/**\n * replacement for _.xor\n * @param itemsA\n * @param itemsB\n */\n\nfunction xor(itemsA, itemsB) {\n  const map = new Map();\n\n  const insertItem = item => {\n    map.set(item, map.has(item) ? map.get(item) + 1 : 1);\n  };\n\n  itemsA.forEach(insertItem);\n  itemsB.forEach(insertItem);\n  const result = [];\n  map.forEach((count, key) => {\n    if (count === 1) {\n      result.push(key);\n    }\n  });\n  return result;\n}\n/**\n * replacement for _.intersection\n * @param itemsA\n * @param itemsB\n */\n\nfunction intersection(itemsA, itemsB) {\n  return itemsA.filter(t => itemsB.indexOf(t) > -1);\n}\n\nconst INIT_COORDS = 'dnd-core/INIT_COORDS';\nconst BEGIN_DRAG = 'dnd-core/BEGIN_DRAG';\nconst PUBLISH_DRAG_SOURCE = 'dnd-core/PUBLISH_DRAG_SOURCE';\nconst HOVER = 'dnd-core/HOVER';\nconst DROP = 'dnd-core/DROP';\nconst END_DRAG = 'dnd-core/END_DRAG';\n\nfunction setClientOffset(clientOffset, sourceClientOffset) {\n  return {\n    type: INIT_COORDS,\n    payload: {\n      sourceClientOffset: sourceClientOffset || null,\n      clientOffset: clientOffset || null\n    }\n  };\n}\n\nconst ResetCoordinatesAction = {\n  type: INIT_COORDS,\n  payload: {\n    clientOffset: null,\n    sourceClientOffset: null\n  }\n};\nfunction createBeginDrag(manager) {\n  return function beginDrag(sourceIds = [], options = {\n    publishSource: true\n  }) {\n    const {\n      publishSource = true,\n      clientOffset,\n      getSourceClientOffset\n    } = options;\n    const monitor = manager.getMonitor();\n    const registry = manager.getRegistry(); // Initialize the coordinates using the client offset\n\n    manager.dispatch(setClientOffset(clientOffset));\n    verifyInvariants$1(sourceIds, monitor, registry); // Get the draggable source\n\n    const sourceId = getDraggableSource(sourceIds, monitor);\n\n    if (sourceId == null) {\n      manager.dispatch(ResetCoordinatesAction);\n      return;\n    } // Get the source client offset\n\n\n    let sourceClientOffset = null;\n\n    if (clientOffset) {\n      if (!getSourceClientOffset) {\n        throw new Error('getSourceClientOffset must be defined');\n      }\n\n      verifyGetSourceClientOffsetIsFunction(getSourceClientOffset);\n      sourceClientOffset = getSourceClientOffset(sourceId);\n    } // Initialize the full coordinates\n\n\n    manager.dispatch(setClientOffset(clientOffset, sourceClientOffset));\n    const source = registry.getSource(sourceId);\n    const item = source.beginDrag(monitor, sourceId); // If source.beginDrag returns null, this is an indicator to cancel the drag\n\n    if (item == null) {\n      return undefined;\n    }\n\n    verifyItemIsObject(item);\n    registry.pinSource(sourceId);\n    const itemType = registry.getSourceType(sourceId);\n    return {\n      type: BEGIN_DRAG,\n      payload: {\n        itemType,\n        item,\n        sourceId,\n        clientOffset: clientOffset || null,\n        sourceClientOffset: sourceClientOffset || null,\n        isSourcePublic: !!publishSource\n      }\n    };\n  };\n}\n\nfunction verifyInvariants$1(sourceIds, monitor, registry) {\n  invariant(!monitor.isDragging(), 'Cannot call beginDrag while dragging.');\n  sourceIds.forEach(function (sourceId) {\n    invariant(registry.getSource(sourceId), 'Expected sourceIds to be registered.');\n  });\n}\n\nfunction verifyGetSourceClientOffsetIsFunction(getSourceClientOffset) {\n  invariant(typeof getSourceClientOffset === 'function', 'When clientOffset is provided, getSourceClientOffset must be a function.');\n}\n\nfunction verifyItemIsObject(item) {\n  invariant(isObject(item), 'Item must be an object.');\n}\n\nfunction getDraggableSource(sourceIds, monitor) {\n  let sourceId = null;\n\n  for (let i = sourceIds.length - 1; i >= 0; i--) {\n    if (monitor.canDragSource(sourceIds[i])) {\n      sourceId = sourceIds[i];\n      break;\n    }\n  }\n\n  return sourceId;\n}\n\nfunction _defineProperty$4(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread$4(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty$4(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\nfunction createDrop(manager) {\n  return function drop(options = {}) {\n    const monitor = manager.getMonitor();\n    const registry = manager.getRegistry();\n    verifyInvariants(monitor);\n    const targetIds = getDroppableTargets(monitor); // Multiple actions are dispatched here, which is why this doesn't return an action\n\n    targetIds.forEach((targetId, index) => {\n      const dropResult = determineDropResult(targetId, index, registry, monitor);\n      const action = {\n        type: DROP,\n        payload: {\n          dropResult: _objectSpread$4({}, options, dropResult)\n        }\n      };\n      manager.dispatch(action);\n    });\n  };\n}\n\nfunction verifyInvariants(monitor) {\n  invariant(monitor.isDragging(), 'Cannot call drop while not dragging.');\n  invariant(!monitor.didDrop(), 'Cannot call drop twice during one drag operation.');\n}\n\nfunction determineDropResult(targetId, index, registry, monitor) {\n  const target = registry.getTarget(targetId);\n  let dropResult = target ? target.drop(monitor, targetId) : undefined;\n  verifyDropResultType(dropResult);\n\n  if (typeof dropResult === 'undefined') {\n    dropResult = index === 0 ? {} : monitor.getDropResult();\n  }\n\n  return dropResult;\n}\n\nfunction verifyDropResultType(dropResult) {\n  invariant(typeof dropResult === 'undefined' || isObject(dropResult), 'Drop result must either be an object or undefined.');\n}\n\nfunction getDroppableTargets(monitor) {\n  const targetIds = monitor.getTargetIds().filter(monitor.canDropOnTarget, monitor);\n  targetIds.reverse();\n  return targetIds;\n}\n\nfunction createEndDrag(manager) {\n  return function endDrag() {\n    const monitor = manager.getMonitor();\n    const registry = manager.getRegistry();\n    verifyIsDragging(monitor);\n    const sourceId = monitor.getSourceId();\n\n    if (sourceId != null) {\n      const source = registry.getSource(sourceId, true);\n      source.endDrag(monitor, sourceId);\n      registry.unpinSource();\n    }\n\n    return {\n      type: END_DRAG\n    };\n  };\n}\n\nfunction verifyIsDragging(monitor) {\n  invariant(monitor.isDragging(), 'Cannot call endDrag while not dragging.');\n}\n\nfunction matchesType(targetType, draggedItemType) {\n  if (draggedItemType === null) {\n    return targetType === null;\n  }\n\n  return Array.isArray(targetType) ? targetType.some(t => t === draggedItemType) : targetType === draggedItemType;\n}\n\nfunction createHover(manager) {\n  return function hover(targetIdsArg, {\n    clientOffset\n  } = {}) {\n    verifyTargetIdsIsArray(targetIdsArg);\n    const targetIds = targetIdsArg.slice(0);\n    const monitor = manager.getMonitor();\n    const registry = manager.getRegistry();\n    const draggedItemType = monitor.getItemType();\n    removeNonMatchingTargetIds(targetIds, registry, draggedItemType);\n    checkInvariants(targetIds, monitor, registry);\n    hoverAllTargets(targetIds, monitor, registry);\n    return {\n      type: HOVER,\n      payload: {\n        targetIds,\n        clientOffset: clientOffset || null\n      }\n    };\n  };\n}\n\nfunction verifyTargetIdsIsArray(targetIdsArg) {\n  invariant(Array.isArray(targetIdsArg), 'Expected targetIds to be an array.');\n}\n\nfunction checkInvariants(targetIds, monitor, registry) {\n  invariant(monitor.isDragging(), 'Cannot call hover while not dragging.');\n  invariant(!monitor.didDrop(), 'Cannot call hover after drop.');\n\n  for (let i = 0; i < targetIds.length; i++) {\n    const targetId = targetIds[i];\n    invariant(targetIds.lastIndexOf(targetId) === i, 'Expected targetIds to be unique in the passed array.');\n    const target = registry.getTarget(targetId);\n    invariant(target, 'Expected targetIds to be registered.');\n  }\n}\n\nfunction removeNonMatchingTargetIds(targetIds, registry, draggedItemType) {\n  // Remove those targetIds that don't match the targetType.  This\n  // fixes shallow isOver which would only be non-shallow because of\n  // non-matching targets.\n  for (let i = targetIds.length - 1; i >= 0; i--) {\n    const targetId = targetIds[i];\n    const targetType = registry.getTargetType(targetId);\n\n    if (!matchesType(targetType, draggedItemType)) {\n      targetIds.splice(i, 1);\n    }\n  }\n}\n\nfunction hoverAllTargets(targetIds, monitor, registry) {\n  // Finally call hover on all matching targets.\n  targetIds.forEach(function (targetId) {\n    const target = registry.getTarget(targetId);\n    target.hover(monitor, targetId);\n  });\n}\n\nfunction createPublishDragSource(manager) {\n  return function publishDragSource() {\n    const monitor = manager.getMonitor();\n\n    if (monitor.isDragging()) {\n      return {\n        type: PUBLISH_DRAG_SOURCE\n      };\n    }\n\n    return;\n  };\n}\n\nfunction createDragDropActions(manager) {\n  return {\n    beginDrag: createBeginDrag(manager),\n    publishDragSource: createPublishDragSource(manager),\n    hover: createHover(manager),\n    drop: createDrop(manager),\n    endDrag: createEndDrag(manager)\n  };\n}\n\nclass DragDropManagerImpl {\n  receiveBackend(backend) {\n    this.backend = backend;\n  }\n\n  getMonitor() {\n    return this.monitor;\n  }\n\n  getBackend() {\n    return this.backend;\n  }\n\n  getRegistry() {\n    return this.monitor.registry;\n  }\n\n  getActions() {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    const manager = this;\n    const {\n      dispatch\n    } = this.store;\n\n    function bindActionCreator(actionCreator) {\n      return (...args) => {\n        const action = actionCreator.apply(manager, args);\n\n        if (typeof action !== 'undefined') {\n          dispatch(action);\n        }\n      };\n    }\n\n    const actions = createDragDropActions(this);\n    return Object.keys(actions).reduce((boundActions, key) => {\n      const action = actions[key];\n      boundActions[key] = bindActionCreator(action);\n      return boundActions;\n    }, {});\n  }\n\n  dispatch(action) {\n    this.store.dispatch(action);\n  }\n\n  constructor(store, monitor) {\n    this.isSetUp = false;\n\n    this.handleRefCountChange = () => {\n      const shouldSetUp = this.store.getState().refCount > 0;\n\n      if (this.backend) {\n        if (shouldSetUp && !this.isSetUp) {\n          this.backend.setup();\n          this.isSetUp = true;\n        } else if (!shouldSetUp && this.isSetUp) {\n          this.backend.teardown();\n          this.isSetUp = false;\n        }\n      }\n    };\n\n    this.store = store;\n    this.monitor = monitor;\n    store.subscribe(this.handleRefCountChange);\n  }\n\n}\n\n/**\n * Coordinate addition\n * @param a The first coordinate\n * @param b The second coordinate\n */\nfunction add(a, b) {\n  return {\n    x: a.x + b.x,\n    y: a.y + b.y\n  };\n}\n/**\n * Coordinate subtraction\n * @param a The first coordinate\n * @param b The second coordinate\n */\n\nfunction subtract(a, b) {\n  return {\n    x: a.x - b.x,\n    y: a.y - b.y\n  };\n}\n/**\n * Returns the cartesian distance of the drag source component's position, based on its position\n * at the time when the current drag operation has started, and the movement difference.\n *\n * Returns null if no item is being dragged.\n *\n * @param state The offset state to compute from\n */\n\nfunction getSourceClientOffset(state) {\n  const {\n    clientOffset,\n    initialClientOffset,\n    initialSourceClientOffset\n  } = state;\n\n  if (!clientOffset || !initialClientOffset || !initialSourceClientOffset) {\n    return null;\n  }\n\n  return subtract(add(clientOffset, initialSourceClientOffset), initialClientOffset);\n}\n/**\n * Determines the x,y offset between the client offset and the initial client offset\n *\n * @param state The offset state to compute from\n */\n\nfunction getDifferenceFromInitialOffset(state) {\n  const {\n    clientOffset,\n    initialClientOffset\n  } = state;\n\n  if (!clientOffset || !initialClientOffset) {\n    return null;\n  }\n\n  return subtract(clientOffset, initialClientOffset);\n}\n\nconst NONE = [];\nconst ALL = [];\nNONE.__IS_NONE__ = true;\nALL.__IS_ALL__ = true;\n/**\n * Determines if the given handler IDs are dirty or not.\n *\n * @param dirtyIds The set of dirty handler ids\n * @param handlerIds The set of handler ids to check\n */\n\nfunction areDirty(dirtyIds, handlerIds) {\n  if (dirtyIds === NONE) {\n    return false;\n  }\n\n  if (dirtyIds === ALL || typeof handlerIds === 'undefined') {\n    return true;\n  }\n\n  const commonIds = intersection(handlerIds, dirtyIds);\n  return commonIds.length > 0;\n}\n\nclass DragDropMonitorImpl {\n  subscribeToStateChange(listener, options = {}) {\n    const {\n      handlerIds\n    } = options;\n    invariant(typeof listener === 'function', 'listener must be a function.');\n    invariant(typeof handlerIds === 'undefined' || Array.isArray(handlerIds), 'handlerIds, when specified, must be an array of strings.');\n    let prevStateId = this.store.getState().stateId;\n\n    const handleChange = () => {\n      const state = this.store.getState();\n      const currentStateId = state.stateId;\n\n      try {\n        const canSkipListener = currentStateId === prevStateId || currentStateId === prevStateId + 1 && !areDirty(state.dirtyHandlerIds, handlerIds);\n\n        if (!canSkipListener) {\n          listener();\n        }\n      } finally {\n        prevStateId = currentStateId;\n      }\n    };\n\n    return this.store.subscribe(handleChange);\n  }\n\n  subscribeToOffsetChange(listener) {\n    invariant(typeof listener === 'function', 'listener must be a function.');\n    let previousState = this.store.getState().dragOffset;\n\n    const handleChange = () => {\n      const nextState = this.store.getState().dragOffset;\n\n      if (nextState === previousState) {\n        return;\n      }\n\n      previousState = nextState;\n      listener();\n    };\n\n    return this.store.subscribe(handleChange);\n  }\n\n  canDragSource(sourceId) {\n    if (!sourceId) {\n      return false;\n    }\n\n    const source = this.registry.getSource(sourceId);\n    invariant(source, `Expected to find a valid source. sourceId=${sourceId}`);\n\n    if (this.isDragging()) {\n      return false;\n    }\n\n    return source.canDrag(this, sourceId);\n  }\n\n  canDropOnTarget(targetId) {\n    // undefined on initial render\n    if (!targetId) {\n      return false;\n    }\n\n    const target = this.registry.getTarget(targetId);\n    invariant(target, `Expected to find a valid target. targetId=${targetId}`);\n\n    if (!this.isDragging() || this.didDrop()) {\n      return false;\n    }\n\n    const targetType = this.registry.getTargetType(targetId);\n    const draggedItemType = this.getItemType();\n    return matchesType(targetType, draggedItemType) && target.canDrop(this, targetId);\n  }\n\n  isDragging() {\n    return Boolean(this.getItemType());\n  }\n\n  isDraggingSource(sourceId) {\n    // undefined on initial render\n    if (!sourceId) {\n      return false;\n    }\n\n    const source = this.registry.getSource(sourceId, true);\n    invariant(source, `Expected to find a valid source. sourceId=${sourceId}`);\n\n    if (!this.isDragging() || !this.isSourcePublic()) {\n      return false;\n    }\n\n    const sourceType = this.registry.getSourceType(sourceId);\n    const draggedItemType = this.getItemType();\n\n    if (sourceType !== draggedItemType) {\n      return false;\n    }\n\n    return source.isDragging(this, sourceId);\n  }\n\n  isOverTarget(targetId, options = {\n    shallow: false\n  }) {\n    // undefined on initial render\n    if (!targetId) {\n      return false;\n    }\n\n    const {\n      shallow\n    } = options;\n\n    if (!this.isDragging()) {\n      return false;\n    }\n\n    const targetType = this.registry.getTargetType(targetId);\n    const draggedItemType = this.getItemType();\n\n    if (draggedItemType && !matchesType(targetType, draggedItemType)) {\n      return false;\n    }\n\n    const targetIds = this.getTargetIds();\n\n    if (!targetIds.length) {\n      return false;\n    }\n\n    const index = targetIds.indexOf(targetId);\n\n    if (shallow) {\n      return index === targetIds.length - 1;\n    } else {\n      return index > -1;\n    }\n  }\n\n  getItemType() {\n    return this.store.getState().dragOperation.itemType;\n  }\n\n  getItem() {\n    return this.store.getState().dragOperation.item;\n  }\n\n  getSourceId() {\n    return this.store.getState().dragOperation.sourceId;\n  }\n\n  getTargetIds() {\n    return this.store.getState().dragOperation.targetIds;\n  }\n\n  getDropResult() {\n    return this.store.getState().dragOperation.dropResult;\n  }\n\n  didDrop() {\n    return this.store.getState().dragOperation.didDrop;\n  }\n\n  isSourcePublic() {\n    return Boolean(this.store.getState().dragOperation.isSourcePublic);\n  }\n\n  getInitialClientOffset() {\n    return this.store.getState().dragOffset.initialClientOffset;\n  }\n\n  getInitialSourceClientOffset() {\n    return this.store.getState().dragOffset.initialSourceClientOffset;\n  }\n\n  getClientOffset() {\n    return this.store.getState().dragOffset.clientOffset;\n  }\n\n  getSourceClientOffset() {\n    return getSourceClientOffset(this.store.getState().dragOffset);\n  }\n\n  getDifferenceFromInitialOffset() {\n    return getDifferenceFromInitialOffset(this.store.getState().dragOffset);\n  }\n\n  constructor(store, registry) {\n    this.store = store;\n    this.registry = registry;\n  }\n\n}\n\n// Safari 6 and 6.1 for desktop, iPad, and iPhone are the only browsers that\n// have WebKitMutationObserver but not un-prefixed MutationObserver.\n// Must use `global` or `self` instead of `window` to work in both frames and web\n// workers. `global` is a provision of Browserify, Mr, Mrs, or Mop.\n\n/* globals self */\nconst scope = typeof global !== 'undefined' ? global : self;\nconst BrowserMutationObserver = scope.MutationObserver || scope.WebKitMutationObserver;\nfunction makeRequestCallFromTimer(callback) {\n  return function requestCall() {\n    // We dispatch a timeout with a specified delay of 0 for engines that\n    // can reliably accommodate that request. This will usually be snapped\n    // to a 4 milisecond delay, but once we're flushing, there's no delay\n    // between events.\n    const timeoutHandle = setTimeout(handleTimer, 0); // However, since this timer gets frequently dropped in Firefox\n    // workers, we enlist an interval handle that will try to fire\n    // an event 20 times per second until it succeeds.\n\n    const intervalHandle = setInterval(handleTimer, 50);\n\n    function handleTimer() {\n      // Whichever timer succeeds will cancel both timers and\n      // execute the callback.\n      clearTimeout(timeoutHandle);\n      clearInterval(intervalHandle);\n      callback();\n    }\n  };\n} // To request a high priority event, we induce a mutation observer by toggling\n// the text of a text node between \"1\" and \"-1\".\n\nfunction makeRequestCallFromMutationObserver(callback) {\n  let toggle = 1;\n  const observer = new BrowserMutationObserver(callback);\n  const node = document.createTextNode('');\n  observer.observe(node, {\n    characterData: true\n  });\n  return function requestCall() {\n    toggle = -toggle;\n    node.data = toggle;\n  };\n}\nconst makeRequestCall = typeof BrowserMutationObserver === 'function' ? // reliably everywhere they are implemented.\n// They are implemented in all modern browsers.\n//\n// - Android 4-4.3\n// - Chrome 26-34\n// - Firefox 14-29\n// - Internet Explorer 11\n// - iPad Safari 6-7.1\n// - iPhone Safari 7-7.1\n// - Safari 6-7\nmakeRequestCallFromMutationObserver : // task queue, are implemented in Internet Explorer 10, Safari 5.0-1, and Opera\n// 11-12, and in web workers in many engines.\n// Although message channels yield to any queued rendering and IO tasks, they\n// would be better than imposing the 4ms delay of timers.\n// However, they do not work reliably in Internet Explorer or Safari.\n// Internet Explorer 10 is the only browser that has setImmediate but does\n// not have MutationObservers.\n// Although setImmediate yields to the browser's renderer, it would be\n// preferrable to falling back to setTimeout since it does not have\n// the minimum 4ms penalty.\n// Unfortunately there appears to be a bug in Internet Explorer 10 Mobile (and\n// Desktop to a lesser extent) that renders both setImmediate and\n// MessageChannel useless for the purposes of ASAP.\n// https://github.com/kriskowal/q/issues/396\n// Timers are implemented universally.\n// We fall back to timers in workers in most engines, and in foreground\n// contexts in the following browsers.\n// However, note that even this simple case requires nuances to operate in a\n// broad spectrum of browsers.\n//\n// - Firefox 3-13\n// - Internet Explorer 6-9\n// - iPad Safari 4.3\n// - Lynx 2.8.7\nmakeRequestCallFromTimer;\n\n/* eslint-disable no-restricted-globals, @typescript-eslint/ban-ts-comment, @typescript-eslint/no-unused-vars, @typescript-eslint/no-non-null-assertion */\nclass AsapQueue {\n  // Use the fastest means possible to execute a task in its own turn, with\n  // priority over other events including IO, animation, reflow, and redraw\n  // events in browsers.\n  //\n  // An exception thrown by a task will permanently interrupt the processing of\n  // subsequent tasks. The higher level `asap` function ensures that if an\n  // exception is thrown by a task, that the task queue will continue flushing as\n  // soon as possible, but if you use `rawAsap` directly, you are responsible to\n  // either ensure that no exceptions are thrown from your task, or to manually\n  // call `rawAsap.requestFlush` if an exception is thrown.\n  enqueueTask(task) {\n    const {\n      queue: q,\n      requestFlush\n    } = this;\n\n    if (!q.length) {\n      requestFlush();\n      this.flushing = true;\n    } // Equivalent to push, but avoids a function call.\n\n\n    q[q.length] = task;\n  }\n\n  constructor() {\n    this.queue = []; // We queue errors to ensure they are thrown in right order (FIFO).\n    // Array-as-queue is good enough here, since we are just dealing with exceptions.\n\n    this.pendingErrors = []; // Once a flush has been requested, no further calls to `requestFlush` are\n    // necessary until the next `flush` completes.\n    // @ts-ignore\n\n    this.flushing = false; // The position of the next task to execute in the task queue. This is\n    // preserved between calls to `flush` so that it can be resumed if\n    // a task throws an exception.\n\n    this.index = 0; // If a task schedules additional tasks recursively, the task queue can grow\n    // unbounded. To prevent memory exhaustion, the task queue will periodically\n    // truncate already-completed tasks.\n\n    this.capacity = 1024; // The flush function processes all tasks that have been scheduled with\n    // `rawAsap` unless and until one of those tasks throws an exception.\n    // If a task throws an exception, `flush` ensures that its state will remain\n    // consistent and will resume where it left off when called again.\n    // However, `flush` does not make any arrangements to be called again if an\n    // exception is thrown.\n\n    this.flush = () => {\n      const {\n        queue: q\n      } = this;\n\n      while (this.index < q.length) {\n        const currentIndex = this.index; // Advance the index before calling the task. This ensures that we will\n        // begin flushing on the next task the task throws an error.\n\n        this.index++;\n        q[currentIndex].call(); // Prevent leaking memory for long chains of recursive calls to `asap`.\n        // If we call `asap` within tasks scheduled by `asap`, the queue will\n        // grow, but to avoid an O(n) walk for every task we execute, we don't\n        // shift tasks off the queue after they have been executed.\n        // Instead, we periodically shift 1024 tasks off the queue.\n\n        if (this.index > this.capacity) {\n          // Manually shift all values starting at the index back to the\n          // beginning of the queue.\n          for (let scan = 0, newLength = q.length - this.index; scan < newLength; scan++) {\n            q[scan] = q[scan + this.index];\n          }\n\n          q.length -= this.index;\n          this.index = 0;\n        }\n      }\n\n      q.length = 0;\n      this.index = 0;\n      this.flushing = false;\n    }; // In a web browser, exceptions are not fatal. However, to avoid\n    // slowing down the queue of pending tasks, we rethrow the error in a\n    // lower priority turn.\n\n\n    this.registerPendingError = err => {\n      this.pendingErrors.push(err);\n      this.requestErrorThrow();\n    }; // `requestFlush` requests that the high priority event queue be flushed as\n    // soon as possible.\n    // This is useful to prevent an error thrown in a task from stalling the event\n    // queue if the exception handled by Node.js’s\n    // `process.on(\"uncaughtException\")` or by a domain.\n    // `requestFlush` is implemented using a strategy based on data collected from\n    // every available SauceLabs Selenium web driver worker at time of writing.\n    // https://docs.google.com/spreadsheets/d/1mG-5UYGup5qxGdEMWkhP6BWCz053NUb2E1QoUTU16uA/edit#gid=783724593\n\n\n    this.requestFlush = makeRequestCall(this.flush);\n    this.requestErrorThrow = makeRequestCallFromTimer(() => {\n      // Throw first error\n      if (this.pendingErrors.length) {\n        throw this.pendingErrors.shift();\n      }\n    });\n  }\n\n} // The message channel technique was discovered by Malte Ubl and was the\n// original foundation for this library.\n// http://www.nonblocking.io/2011/06/windownexttick.html\n// Safari 6.0.5 (at least) intermittently fails to create message ports on a\n// page's first load. Thankfully, this version of Safari supports\n// MutationObservers, so we don't need to fall back in that case.\n// function makeRequestCallFromMessageChannel(callback) {\n//     var channel = new MessageChannel();\n//     channel.port1.onmessage = callback;\n//     return function requestCall() {\n//         channel.port2.postMessage(0);\n//     };\n// }\n// For reasons explained above, we are also unable to use `setImmediate`\n// under any circumstances.\n// Even if we were, there is another bug in Internet Explorer 10.\n// It is not sufficient to assign `setImmediate` to `requestFlush` because\n// `setImmediate` must be called *by name* and therefore must be wrapped in a\n// closure.\n// Never forget.\n// function makeRequestCallFromSetImmediate(callback) {\n//     return function requestCall() {\n//         setImmediate(callback);\n//     };\n// }\n// Safari 6.0 has a problem where timers will get lost while the user is\n// scrolling. This problem does not impact ASAP because Safari 6.0 supports\n// mutation observers, so that implementation is used instead.\n// However, if we ever elect to use timers in Safari, the prevalent work-around\n// is to add a scroll event listener that calls for a flush.\n// `setTimeout` does not call the passed callback if the delay is less than\n// approximately 7 in web workers in Firefox 8 through 18, and sometimes not\n// even then.\n// This is for `asap.js` only.\n// Its name will be periodically randomized to break any code that depends on\n// // its existence.\n// rawAsap.makeRequestCallFromTimer = makeRequestCallFromTimer\n// ASAP was originally a nextTick shim included in Q. This was factored out\n// into this ASAP package. It was later adapted to RSVP which made further\n// amendments. These decisions, particularly to marginalize MessageChannel and\n// to capture the MutationObserver implementation in a closure, were integrated\n// back into ASAP proper.\n// https://github.com/tildeio/rsvp.js/blob/cddf7232546a9cf858524b75cde6f9edf72620a7/lib/rsvp/asap.js\n\n// `call`, just like a function.\nclass RawTask {\n  call() {\n    try {\n      this.task && this.task();\n    } catch (error) {\n      this.onError(error);\n    } finally {\n      this.task = null;\n      this.release(this);\n    }\n  }\n\n  constructor(onError, release) {\n    this.onError = onError;\n    this.release = release;\n    this.task = null;\n  }\n\n}\n\nclass TaskFactory {\n  create(task) {\n    const tasks = this.freeTasks;\n    const t1 = tasks.length ? tasks.pop() : new RawTask(this.onError, t => tasks[tasks.length] = t);\n    t1.task = task;\n    return t1;\n  }\n\n  constructor(onError) {\n    this.onError = onError;\n    this.freeTasks = [];\n  }\n\n}\n\nconst asapQueue = new AsapQueue();\nconst taskFactory = new TaskFactory(asapQueue.registerPendingError);\n/**\n * Calls a task as soon as possible after returning, in its own event, with priority\n * over other events like animation, reflow, and repaint. An error thrown from an\n * event will not interrupt, nor even substantially slow down the processing of\n * other events, but will be rather postponed to a lower priority event.\n * @param {{call}} task A callable object, typically a function that takes no\n * arguments.\n */\n\nfunction asap(task) {\n  asapQueue.enqueueTask(taskFactory.create(task));\n}\n\nconst ADD_SOURCE = 'dnd-core/ADD_SOURCE';\nconst ADD_TARGET = 'dnd-core/ADD_TARGET';\nconst REMOVE_SOURCE = 'dnd-core/REMOVE_SOURCE';\nconst REMOVE_TARGET = 'dnd-core/REMOVE_TARGET';\nfunction addSource(sourceId) {\n  return {\n    type: ADD_SOURCE,\n    payload: {\n      sourceId\n    }\n  };\n}\nfunction addTarget(targetId) {\n  return {\n    type: ADD_TARGET,\n    payload: {\n      targetId\n    }\n  };\n}\nfunction removeSource(sourceId) {\n  return {\n    type: REMOVE_SOURCE,\n    payload: {\n      sourceId\n    }\n  };\n}\nfunction removeTarget(targetId) {\n  return {\n    type: REMOVE_TARGET,\n    payload: {\n      targetId\n    }\n  };\n}\n\nfunction validateSourceContract(source) {\n  invariant(typeof source.canDrag === 'function', 'Expected canDrag to be a function.');\n  invariant(typeof source.beginDrag === 'function', 'Expected beginDrag to be a function.');\n  invariant(typeof source.endDrag === 'function', 'Expected endDrag to be a function.');\n}\nfunction validateTargetContract(target) {\n  invariant(typeof target.canDrop === 'function', 'Expected canDrop to be a function.');\n  invariant(typeof target.hover === 'function', 'Expected hover to be a function.');\n  invariant(typeof target.drop === 'function', 'Expected beginDrag to be a function.');\n}\nfunction validateType(type, allowArray) {\n  if (allowArray && Array.isArray(type)) {\n    type.forEach(t => validateType(t, false));\n    return;\n  }\n\n  invariant(typeof type === 'string' || typeof type === 'symbol', allowArray ? 'Type can only be a string, a symbol, or an array of either.' : 'Type can only be a string or a symbol.');\n}\n\nvar HandlerRole;\n\n(function (HandlerRole) {\n  HandlerRole[\"SOURCE\"] = \"SOURCE\";\n  HandlerRole[\"TARGET\"] = \"TARGET\";\n})(HandlerRole || (HandlerRole = {}));\n\nlet nextUniqueId = 0;\nfunction getNextUniqueId() {\n  return nextUniqueId++;\n}\n\nfunction getNextHandlerId(role) {\n  const id = getNextUniqueId().toString();\n\n  switch (role) {\n    case HandlerRole.SOURCE:\n      return `S${id}`;\n\n    case HandlerRole.TARGET:\n      return `T${id}`;\n\n    default:\n      throw new Error(`Unknown Handler Role: ${role}`);\n  }\n}\n\nfunction parseRoleFromHandlerId(handlerId) {\n  switch (handlerId[0]) {\n    case 'S':\n      return HandlerRole.SOURCE;\n\n    case 'T':\n      return HandlerRole.TARGET;\n\n    default:\n      throw new Error(`Cannot parse handler ID: ${handlerId}`);\n  }\n}\n\nfunction mapContainsValue(map, searchValue) {\n  const entries = map.entries();\n  let isDone = false;\n\n  do {\n    const {\n      done,\n      value: [, value]\n    } = entries.next();\n\n    if (value === searchValue) {\n      return true;\n    }\n\n    isDone = !!done;\n  } while (!isDone);\n\n  return false;\n}\n\nclass HandlerRegistryImpl {\n  addSource(type, source) {\n    validateType(type);\n    validateSourceContract(source);\n    const sourceId = this.addHandler(HandlerRole.SOURCE, type, source);\n    this.store.dispatch(addSource(sourceId));\n    return sourceId;\n  }\n\n  addTarget(type, target) {\n    validateType(type, true);\n    validateTargetContract(target);\n    const targetId = this.addHandler(HandlerRole.TARGET, type, target);\n    this.store.dispatch(addTarget(targetId));\n    return targetId;\n  }\n\n  containsHandler(handler) {\n    return mapContainsValue(this.dragSources, handler) || mapContainsValue(this.dropTargets, handler);\n  }\n\n  getSource(sourceId, includePinned = false) {\n    invariant(this.isSourceId(sourceId), 'Expected a valid source ID.');\n    const isPinned = includePinned && sourceId === this.pinnedSourceId;\n    const source = isPinned ? this.pinnedSource : this.dragSources.get(sourceId);\n    return source;\n  }\n\n  getTarget(targetId) {\n    invariant(this.isTargetId(targetId), 'Expected a valid target ID.');\n    return this.dropTargets.get(targetId);\n  }\n\n  getSourceType(sourceId) {\n    invariant(this.isSourceId(sourceId), 'Expected a valid source ID.');\n    return this.types.get(sourceId);\n  }\n\n  getTargetType(targetId) {\n    invariant(this.isTargetId(targetId), 'Expected a valid target ID.');\n    return this.types.get(targetId);\n  }\n\n  isSourceId(handlerId) {\n    const role = parseRoleFromHandlerId(handlerId);\n    return role === HandlerRole.SOURCE;\n  }\n\n  isTargetId(handlerId) {\n    const role = parseRoleFromHandlerId(handlerId);\n    return role === HandlerRole.TARGET;\n  }\n\n  removeSource(sourceId) {\n    invariant(this.getSource(sourceId), 'Expected an existing source.');\n    this.store.dispatch(removeSource(sourceId));\n    asap(() => {\n      this.dragSources.delete(sourceId);\n      this.types.delete(sourceId);\n    });\n  }\n\n  removeTarget(targetId) {\n    invariant(this.getTarget(targetId), 'Expected an existing target.');\n    this.store.dispatch(removeTarget(targetId));\n    this.dropTargets.delete(targetId);\n    this.types.delete(targetId);\n  }\n\n  pinSource(sourceId) {\n    const source = this.getSource(sourceId);\n    invariant(source, 'Expected an existing source.');\n    this.pinnedSourceId = sourceId;\n    this.pinnedSource = source;\n  }\n\n  unpinSource() {\n    invariant(this.pinnedSource, 'No source is pinned at the time.');\n    this.pinnedSourceId = null;\n    this.pinnedSource = null;\n  }\n\n  addHandler(role, type, handler) {\n    const id = getNextHandlerId(role);\n    this.types.set(id, type);\n\n    if (role === HandlerRole.SOURCE) {\n      this.dragSources.set(id, handler);\n    } else if (role === HandlerRole.TARGET) {\n      this.dropTargets.set(id, handler);\n    }\n\n    return id;\n  }\n\n  constructor(store) {\n    this.types = new Map();\n    this.dragSources = new Map();\n    this.dropTargets = new Map();\n    this.pinnedSourceId = null;\n    this.pinnedSource = null;\n    this.store = store;\n  }\n\n}\n\nconst strictEquality = (a, b) => a === b;\n/**\n * Determine if two cartesian coordinate offsets are equal\n * @param offsetA\n * @param offsetB\n */\n\nfunction areCoordsEqual(offsetA, offsetB) {\n  if (!offsetA && !offsetB) {\n    return true;\n  } else if (!offsetA || !offsetB) {\n    return false;\n  } else {\n    return offsetA.x === offsetB.x && offsetA.y === offsetB.y;\n  }\n}\n/**\n * Determines if two arrays of items are equal\n * @param a The first array of items\n * @param b The second array of items\n */\n\nfunction areArraysEqual(a, b, isEqual = strictEquality) {\n  if (a.length !== b.length) {\n    return false;\n  }\n\n  for (let i = 0; i < a.length; ++i) {\n    if (!isEqual(a[i], b[i])) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction reduce$5( // eslint-disable-next-line @typescript-eslint/no-unused-vars\n_state = NONE, action) {\n  switch (action.type) {\n    case HOVER:\n      break;\n\n    case ADD_SOURCE:\n    case ADD_TARGET:\n    case REMOVE_TARGET:\n    case REMOVE_SOURCE:\n      return NONE;\n\n    case BEGIN_DRAG:\n    case PUBLISH_DRAG_SOURCE:\n    case END_DRAG:\n    case DROP:\n    default:\n      return ALL;\n  }\n\n  const {\n    targetIds = [],\n    prevTargetIds = []\n  } = action.payload;\n  const result = xor(targetIds, prevTargetIds);\n  const didChange = result.length > 0 || !areArraysEqual(targetIds, prevTargetIds);\n\n  if (!didChange) {\n    return NONE;\n  } // Check the target ids at the innermost position. If they are valid, add them\n  // to the result\n\n\n  const prevInnermostTargetId = prevTargetIds[prevTargetIds.length - 1];\n  const innermostTargetId = targetIds[targetIds.length - 1];\n\n  if (prevInnermostTargetId !== innermostTargetId) {\n    if (prevInnermostTargetId) {\n      result.push(prevInnermostTargetId);\n    }\n\n    if (innermostTargetId) {\n      result.push(innermostTargetId);\n    }\n  }\n\n  return result;\n}\n\nfunction _defineProperty$3(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread$3(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty$3(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\nconst initialState$1 = {\n  initialSourceClientOffset: null,\n  initialClientOffset: null,\n  clientOffset: null\n};\nfunction reduce$4(state = initialState$1, action) {\n  const {\n    payload\n  } = action;\n\n  switch (action.type) {\n    case INIT_COORDS:\n    case BEGIN_DRAG:\n      return {\n        initialSourceClientOffset: payload.sourceClientOffset,\n        initialClientOffset: payload.clientOffset,\n        clientOffset: payload.clientOffset\n      };\n\n    case HOVER:\n      if (areCoordsEqual(state.clientOffset, payload.clientOffset)) {\n        return state;\n      }\n\n      return _objectSpread$3({}, state, {\n        clientOffset: payload.clientOffset\n      });\n\n    case END_DRAG:\n    case DROP:\n      return initialState$1;\n\n    default:\n      return state;\n  }\n}\n\nfunction _defineProperty$2(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread$2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty$2(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\nconst initialState = {\n  itemType: null,\n  item: null,\n  sourceId: null,\n  targetIds: [],\n  dropResult: null,\n  didDrop: false,\n  isSourcePublic: null\n};\nfunction reduce$3(state = initialState, action) {\n  const {\n    payload\n  } = action;\n\n  switch (action.type) {\n    case BEGIN_DRAG:\n      return _objectSpread$2({}, state, {\n        itemType: payload.itemType,\n        item: payload.item,\n        sourceId: payload.sourceId,\n        isSourcePublic: payload.isSourcePublic,\n        dropResult: null,\n        didDrop: false\n      });\n\n    case PUBLISH_DRAG_SOURCE:\n      return _objectSpread$2({}, state, {\n        isSourcePublic: true\n      });\n\n    case HOVER:\n      return _objectSpread$2({}, state, {\n        targetIds: payload.targetIds\n      });\n\n    case REMOVE_TARGET:\n      if (state.targetIds.indexOf(payload.targetId) === -1) {\n        return state;\n      }\n\n      return _objectSpread$2({}, state, {\n        targetIds: without$1(state.targetIds, payload.targetId)\n      });\n\n    case DROP:\n      return _objectSpread$2({}, state, {\n        dropResult: payload.dropResult,\n        didDrop: true,\n        targetIds: []\n      });\n\n    case END_DRAG:\n      return _objectSpread$2({}, state, {\n        itemType: null,\n        item: null,\n        sourceId: null,\n        dropResult: null,\n        didDrop: false,\n        isSourcePublic: null,\n        targetIds: []\n      });\n\n    default:\n      return state;\n  }\n}\n\nfunction reduce$2(state = 0, action) {\n  switch (action.type) {\n    case ADD_SOURCE:\n    case ADD_TARGET:\n      return state + 1;\n\n    case REMOVE_SOURCE:\n    case REMOVE_TARGET:\n      return state - 1;\n\n    default:\n      return state;\n  }\n}\n\nfunction reduce$1(state = 0) {\n  return state + 1;\n}\n\nfunction _defineProperty$1(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread$1(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty$1(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\nfunction reduce(state = {}, action) {\n  return {\n    dirtyHandlerIds: reduce$5(state.dirtyHandlerIds, {\n      type: action.type,\n      payload: _objectSpread$1({}, action.payload, {\n        prevTargetIds: get(state, 'dragOperation.targetIds', [])\n      })\n    }),\n    dragOffset: reduce$4(state.dragOffset, action),\n    refCount: reduce$2(state.refCount, action),\n    dragOperation: reduce$3(state.dragOperation, action),\n    stateId: reduce$1(state.stateId)\n  };\n}\n\nfunction createDragDropManager(backendFactory, globalContext = undefined, backendOptions = {}, debugMode = false) {\n  const store = makeStoreInstance(debugMode);\n  const monitor = new DragDropMonitorImpl(store, new HandlerRegistryImpl(store));\n  const manager = new DragDropManagerImpl(store, monitor);\n  const backend = backendFactory(manager, globalContext, backendOptions);\n  manager.receiveBackend(backend);\n  return manager;\n}\n\nfunction makeStoreInstance(debugMode) {\n  // TODO: if we ever make a react-native version of this,\n  // we'll need to consider how to pull off dev-tooling\n  const reduxDevTools = typeof window !== 'undefined' && window.__REDUX_DEVTOOLS_EXTENSION__;\n  return createStore(reduce, debugMode && reduxDevTools && reduxDevTools({\n    name: 'dnd-core',\n    instanceId: 'dnd-core'\n  }));\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\nlet refCount = 0;\nconst INSTANCE_SYM = Symbol.for('__REACT_DND_CONTEXT_INSTANCE__');\nvar DndProvider = /*#__PURE__*/memo(function DndProvider(_param) {\n  var {\n    children\n  } = _param,\n      props = _objectWithoutProperties(_param, [\"children\"]);\n\n  const [manager, isGlobalInstance] = getDndContextValue(props) // memoized from props\n  ;\n  /**\n  * If the global context was used to store the DND context\n  * then where theres no more references to it we should\n  * clean it up to avoid memory leaks\n  */\n\n  useEffect(() => {\n    if (isGlobalInstance) {\n      const context = getGlobalContext();\n      ++refCount;\n      return () => {\n        if (--refCount === 0) {\n          context[INSTANCE_SYM] = null;\n        }\n      };\n    }\n\n    return;\n  }, []);\n  return /*#__PURE__*/jsx(DndContext.Provider, {\n    value: manager,\n    children: children\n  });\n});\n\nfunction getDndContextValue(props) {\n  if ('manager' in props) {\n    const manager = {\n      dragDropManager: props.manager\n    };\n    return [manager, false];\n  }\n\n  const manager = createSingletonDndContext(props.backend, props.context, props.options, props.debugMode);\n  const isGlobalInstance = !props.context;\n  return [manager, isGlobalInstance];\n}\n\nfunction createSingletonDndContext(backend, context = getGlobalContext(), options, debugMode) {\n  const ctx = context;\n\n  if (!ctx[INSTANCE_SYM]) {\n    ctx[INSTANCE_SYM] = {\n      dragDropManager: createDragDropManager(backend, context, options, debugMode)\n    };\n  }\n\n  return ctx[INSTANCE_SYM];\n}\n\nfunction getGlobalContext() {\n  return typeof global !== 'undefined' ? global : window;\n}\n\nvar fastDeepEqual = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    if (a.constructor !== b.constructor) return false;\n    var length, i, keys;\n\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length != b.length) return false;\n\n      for (i = length; i-- !== 0;) if (!equal(a[i], b[i])) return false;\n\n      return true;\n    }\n\n    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\n    if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\n    if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) return false;\n\n    for (i = length; i-- !== 0;) if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      var key = keys[i];\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  } // true if both NaN, false otherwise\n\n\n  return a !== a && b !== b;\n};\n\nconst useIsomorphicLayoutEffect = typeof window !== 'undefined' ? useLayoutEffect : useEffect;\n\n/**\n *\n * @param monitor The monitor to collect state from\n * @param collect The collecting function\n * @param onUpdate A method to invoke when updates occur\n */\n\nfunction useCollector(monitor, collect, onUpdate) {\n  const [collected, setCollected] = useState(() => collect(monitor));\n  const updateCollected = useCallback(() => {\n    const nextValue = collect(monitor); // This needs to be a deep-equality check because some monitor-collected values\n    // include XYCoord objects that may be equivalent, but do not have instance equality.\n\n    if (!fastDeepEqual(collected, nextValue)) {\n      setCollected(nextValue);\n\n      if (onUpdate) {\n        onUpdate();\n      }\n    }\n  }, [collected, monitor, onUpdate]); // update the collected properties after react renders.\n  // Note that the \"Dustbin Stress Test\" fails if this is not\n  // done when the component updates\n\n  useIsomorphicLayoutEffect(updateCollected);\n  return [collected, updateCollected];\n}\n\nfunction useMonitorOutput(monitor, collect, onCollect) {\n  const [collected, updateCollected] = useCollector(monitor, collect, onCollect);\n  useIsomorphicLayoutEffect(function subscribeToMonitorStateChange() {\n    const handlerId = monitor.getHandlerId();\n\n    if (handlerId == null) {\n      return;\n    }\n\n    return monitor.subscribeToStateChange(updateCollected, {\n      handlerIds: [handlerId]\n    });\n  }, [monitor, updateCollected]);\n  return collected;\n}\n\nfunction useCollectedProps(collector, monitor, connector) {\n  return useMonitorOutput(monitor, collector || (() => ({})), () => connector.reconnect());\n}\n\nfunction useOptionalFactory(arg, deps) {\n  const memoDeps = [...(deps || [])];\n\n  if (deps == null && typeof arg !== 'function') {\n    memoDeps.push(arg);\n  }\n\n  return useMemo(() => {\n    return typeof arg === 'function' ? arg() : arg;\n  }, memoDeps);\n}\n\nfunction useConnectDragSource(connector) {\n  return useMemo(() => connector.hooks.dragSource(), [connector]);\n}\nfunction useConnectDragPreview(connector) {\n  return useMemo(() => connector.hooks.dragPreview(), [connector]);\n}\n\nlet isCallingCanDrag = false;\nlet isCallingIsDragging = false;\nclass DragSourceMonitorImpl {\n  receiveHandlerId(sourceId) {\n    this.sourceId = sourceId;\n  }\n\n  getHandlerId() {\n    return this.sourceId;\n  }\n\n  canDrag() {\n    invariant(!isCallingCanDrag, 'You may not call monitor.canDrag() inside your canDrag() implementation. ' + 'Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor');\n\n    try {\n      isCallingCanDrag = true;\n      return this.internalMonitor.canDragSource(this.sourceId);\n    } finally {\n      isCallingCanDrag = false;\n    }\n  }\n\n  isDragging() {\n    if (!this.sourceId) {\n      return false;\n    }\n\n    invariant(!isCallingIsDragging, 'You may not call monitor.isDragging() inside your isDragging() implementation. ' + 'Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor');\n\n    try {\n      isCallingIsDragging = true;\n      return this.internalMonitor.isDraggingSource(this.sourceId);\n    } finally {\n      isCallingIsDragging = false;\n    }\n  }\n\n  subscribeToStateChange(listener, options) {\n    return this.internalMonitor.subscribeToStateChange(listener, options);\n  }\n\n  isDraggingSource(sourceId) {\n    return this.internalMonitor.isDraggingSource(sourceId);\n  }\n\n  isOverTarget(targetId, options) {\n    return this.internalMonitor.isOverTarget(targetId, options);\n  }\n\n  getTargetIds() {\n    return this.internalMonitor.getTargetIds();\n  }\n\n  isSourcePublic() {\n    return this.internalMonitor.isSourcePublic();\n  }\n\n  getSourceId() {\n    return this.internalMonitor.getSourceId();\n  }\n\n  subscribeToOffsetChange(listener) {\n    return this.internalMonitor.subscribeToOffsetChange(listener);\n  }\n\n  canDragSource(sourceId) {\n    return this.internalMonitor.canDragSource(sourceId);\n  }\n\n  canDropOnTarget(targetId) {\n    return this.internalMonitor.canDropOnTarget(targetId);\n  }\n\n  getItemType() {\n    return this.internalMonitor.getItemType();\n  }\n\n  getItem() {\n    return this.internalMonitor.getItem();\n  }\n\n  getDropResult() {\n    return this.internalMonitor.getDropResult();\n  }\n\n  didDrop() {\n    return this.internalMonitor.didDrop();\n  }\n\n  getInitialClientOffset() {\n    return this.internalMonitor.getInitialClientOffset();\n  }\n\n  getInitialSourceClientOffset() {\n    return this.internalMonitor.getInitialSourceClientOffset();\n  }\n\n  getSourceClientOffset() {\n    return this.internalMonitor.getSourceClientOffset();\n  }\n\n  getClientOffset() {\n    return this.internalMonitor.getClientOffset();\n  }\n\n  getDifferenceFromInitialOffset() {\n    return this.internalMonitor.getDifferenceFromInitialOffset();\n  }\n\n  constructor(manager) {\n    this.sourceId = null;\n    this.internalMonitor = manager.getMonitor();\n  }\n\n}\n\nlet isCallingCanDrop = false;\nclass DropTargetMonitorImpl {\n  receiveHandlerId(targetId) {\n    this.targetId = targetId;\n  }\n\n  getHandlerId() {\n    return this.targetId;\n  }\n\n  subscribeToStateChange(listener, options) {\n    return this.internalMonitor.subscribeToStateChange(listener, options);\n  }\n\n  canDrop() {\n    // Cut out early if the target id has not been set. This should prevent errors\n    // where the user has an older version of dnd-core like in\n    // https://github.com/react-dnd/react-dnd/issues/1310\n    if (!this.targetId) {\n      return false;\n    }\n\n    invariant(!isCallingCanDrop, 'You may not call monitor.canDrop() inside your canDrop() implementation. ' + 'Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor');\n\n    try {\n      isCallingCanDrop = true;\n      return this.internalMonitor.canDropOnTarget(this.targetId);\n    } finally {\n      isCallingCanDrop = false;\n    }\n  }\n\n  isOver(options) {\n    if (!this.targetId) {\n      return false;\n    }\n\n    return this.internalMonitor.isOverTarget(this.targetId, options);\n  }\n\n  getItemType() {\n    return this.internalMonitor.getItemType();\n  }\n\n  getItem() {\n    return this.internalMonitor.getItem();\n  }\n\n  getDropResult() {\n    return this.internalMonitor.getDropResult();\n  }\n\n  didDrop() {\n    return this.internalMonitor.didDrop();\n  }\n\n  getInitialClientOffset() {\n    return this.internalMonitor.getInitialClientOffset();\n  }\n\n  getInitialSourceClientOffset() {\n    return this.internalMonitor.getInitialSourceClientOffset();\n  }\n\n  getSourceClientOffset() {\n    return this.internalMonitor.getSourceClientOffset();\n  }\n\n  getClientOffset() {\n    return this.internalMonitor.getClientOffset();\n  }\n\n  getDifferenceFromInitialOffset() {\n    return this.internalMonitor.getDifferenceFromInitialOffset();\n  }\n\n  constructor(manager) {\n    this.targetId = null;\n    this.internalMonitor = manager.getMonitor();\n  }\n\n}\n\nfunction registerTarget(type, target, manager) {\n  const registry = manager.getRegistry();\n  const targetId = registry.addTarget(type, target);\n  return [targetId, () => registry.removeTarget(targetId)];\n}\nfunction registerSource(type, source, manager) {\n  const registry = manager.getRegistry();\n  const sourceId = registry.addSource(type, source);\n  return [sourceId, () => registry.removeSource(sourceId)];\n}\n\nfunction shallowEqual(objA, objB, compare, compareContext) {\n  let compareResult = compare ? compare.call(compareContext, objA, objB) : void 0;\n\n  if (compareResult !== void 0) {\n    return !!compareResult;\n  }\n\n  if (objA === objB) {\n    return true;\n  }\n\n  if (typeof objA !== 'object' || !objA || typeof objB !== 'object' || !objB) {\n    return false;\n  }\n\n  const keysA = Object.keys(objA);\n  const keysB = Object.keys(objB);\n\n  if (keysA.length !== keysB.length) {\n    return false;\n  }\n\n  const bHasOwnProperty = Object.prototype.hasOwnProperty.bind(objB); // Test for A's keys different from B.\n\n  for (let idx = 0; idx < keysA.length; idx++) {\n    const key = keysA[idx];\n\n    if (!bHasOwnProperty(key)) {\n      return false;\n    }\n\n    const valueA = objA[key];\n    const valueB = objB[key];\n    compareResult = compare ? compare.call(compareContext, valueA, valueB, key) : void 0;\n\n    if (compareResult === false || compareResult === void 0 && valueA !== valueB) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction isRef(obj) {\n  return (// eslint-disable-next-line no-prototype-builtins\n    obj !== null && typeof obj === 'object' && Object.prototype.hasOwnProperty.call(obj, 'current')\n  );\n}\n\nfunction throwIfCompositeComponentElement(element) {\n  // Custom components can no longer be wrapped directly in React DnD 2.0\n  // so that we don't need to depend on findDOMNode() from react-dom.\n  if (typeof element.type === 'string') {\n    return;\n  }\n\n  const displayName = element.type.displayName || element.type.name || 'the component';\n  throw new Error('Only native element nodes can now be passed to React DnD connectors.' + `You can either wrap ${displayName} into a <div>, or turn it into a ` + 'drag source or a drop target itself.');\n}\n\nfunction wrapHookToRecognizeElement(hook) {\n  return (elementOrNode = null, options = null) => {\n    // When passed a node, call the hook straight away.\n    if (! /*#__PURE__*/isValidElement(elementOrNode)) {\n      const node = elementOrNode;\n      hook(node, options); // return the node so it can be chained (e.g. when within callback refs\n      // <div ref={node => connectDragSource(connectDropTarget(node))}/>\n\n      return node;\n    } // If passed a ReactElement, clone it and attach this function as a ref.\n    // This helps us achieve a neat API where user doesn't even know that refs\n    // are being used under the hood.\n\n\n    const element = elementOrNode;\n    throwIfCompositeComponentElement(element); // When no options are passed, use the hook directly\n\n    const ref = options ? node => hook(node, options) : hook;\n    return cloneWithRef(element, ref);\n  };\n}\n\nfunction wrapConnectorHooks(hooks) {\n  const wrappedHooks = {};\n  Object.keys(hooks).forEach(key => {\n    const hook = hooks[key]; // ref objects should be passed straight through without wrapping\n\n    if (key.endsWith('Ref')) {\n      wrappedHooks[key] = hooks[key];\n    } else {\n      const wrappedHook = wrapHookToRecognizeElement(hook);\n\n      wrappedHooks[key] = () => wrappedHook;\n    }\n  });\n  return wrappedHooks;\n}\n\nfunction setRef(ref, node) {\n  if (typeof ref === 'function') {\n    ref(node);\n  } else {\n    ref.current = node;\n  }\n}\n\nfunction cloneWithRef(element, newRef) {\n  const previousRef = element.ref;\n  invariant(typeof previousRef !== 'string', 'Cannot connect React DnD to an element with an existing string ref. ' + 'Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. ' + 'Read more: https://reactjs.org/docs/refs-and-the-dom.html#callback-refs');\n\n  if (!previousRef) {\n    // When there is no ref on the element, use the new ref directly\n    return /*#__PURE__*/cloneElement(element, {\n      ref: newRef\n    });\n  } else {\n    return /*#__PURE__*/cloneElement(element, {\n      ref: node => {\n        setRef(previousRef, node);\n        setRef(newRef, node);\n      }\n    });\n  }\n}\n\nclass SourceConnector {\n  receiveHandlerId(newHandlerId) {\n    if (this.handlerId === newHandlerId) {\n      return;\n    }\n\n    this.handlerId = newHandlerId;\n    this.reconnect();\n  }\n\n  get connectTarget() {\n    return this.dragSource;\n  }\n\n  get dragSourceOptions() {\n    return this.dragSourceOptionsInternal;\n  }\n\n  set dragSourceOptions(options) {\n    this.dragSourceOptionsInternal = options;\n  }\n\n  get dragPreviewOptions() {\n    return this.dragPreviewOptionsInternal;\n  }\n\n  set dragPreviewOptions(options) {\n    this.dragPreviewOptionsInternal = options;\n  }\n\n  reconnect() {\n    const didChange = this.reconnectDragSource();\n    this.reconnectDragPreview(didChange);\n  }\n\n  reconnectDragSource() {\n    const dragSource = this.dragSource; // if nothing has changed then don't resubscribe\n\n    const didChange = this.didHandlerIdChange() || this.didConnectedDragSourceChange() || this.didDragSourceOptionsChange();\n\n    if (didChange) {\n      this.disconnectDragSource();\n    }\n\n    if (!this.handlerId) {\n      return didChange;\n    }\n\n    if (!dragSource) {\n      this.lastConnectedDragSource = dragSource;\n      return didChange;\n    }\n\n    if (didChange) {\n      this.lastConnectedHandlerId = this.handlerId;\n      this.lastConnectedDragSource = dragSource;\n      this.lastConnectedDragSourceOptions = this.dragSourceOptions;\n      this.dragSourceUnsubscribe = this.backend.connectDragSource(this.handlerId, dragSource, this.dragSourceOptions);\n    }\n\n    return didChange;\n  }\n\n  reconnectDragPreview(forceDidChange = false) {\n    const dragPreview = this.dragPreview; // if nothing has changed then don't resubscribe\n\n    const didChange = forceDidChange || this.didHandlerIdChange() || this.didConnectedDragPreviewChange() || this.didDragPreviewOptionsChange();\n\n    if (didChange) {\n      this.disconnectDragPreview();\n    }\n\n    if (!this.handlerId) {\n      return;\n    }\n\n    if (!dragPreview) {\n      this.lastConnectedDragPreview = dragPreview;\n      return;\n    }\n\n    if (didChange) {\n      this.lastConnectedHandlerId = this.handlerId;\n      this.lastConnectedDragPreview = dragPreview;\n      this.lastConnectedDragPreviewOptions = this.dragPreviewOptions;\n      this.dragPreviewUnsubscribe = this.backend.connectDragPreview(this.handlerId, dragPreview, this.dragPreviewOptions);\n    }\n  }\n\n  didHandlerIdChange() {\n    return this.lastConnectedHandlerId !== this.handlerId;\n  }\n\n  didConnectedDragSourceChange() {\n    return this.lastConnectedDragSource !== this.dragSource;\n  }\n\n  didConnectedDragPreviewChange() {\n    return this.lastConnectedDragPreview !== this.dragPreview;\n  }\n\n  didDragSourceOptionsChange() {\n    return !shallowEqual(this.lastConnectedDragSourceOptions, this.dragSourceOptions);\n  }\n\n  didDragPreviewOptionsChange() {\n    return !shallowEqual(this.lastConnectedDragPreviewOptions, this.dragPreviewOptions);\n  }\n\n  disconnectDragSource() {\n    if (this.dragSourceUnsubscribe) {\n      this.dragSourceUnsubscribe();\n      this.dragSourceUnsubscribe = undefined;\n    }\n  }\n\n  disconnectDragPreview() {\n    if (this.dragPreviewUnsubscribe) {\n      this.dragPreviewUnsubscribe();\n      this.dragPreviewUnsubscribe = undefined;\n      this.dragPreviewNode = null;\n      this.dragPreviewRef = null;\n    }\n  }\n\n  get dragSource() {\n    return this.dragSourceNode || this.dragSourceRef && this.dragSourceRef.current;\n  }\n\n  get dragPreview() {\n    return this.dragPreviewNode || this.dragPreviewRef && this.dragPreviewRef.current;\n  }\n\n  clearDragSource() {\n    this.dragSourceNode = null;\n    this.dragSourceRef = null;\n  }\n\n  clearDragPreview() {\n    this.dragPreviewNode = null;\n    this.dragPreviewRef = null;\n  }\n\n  constructor(backend) {\n    this.hooks = wrapConnectorHooks({\n      dragSource: (node, options) => {\n        this.clearDragSource();\n        this.dragSourceOptions = options || null;\n\n        if (isRef(node)) {\n          this.dragSourceRef = node;\n        } else {\n          this.dragSourceNode = node;\n        }\n\n        this.reconnectDragSource();\n      },\n      dragPreview: (node, options) => {\n        this.clearDragPreview();\n        this.dragPreviewOptions = options || null;\n\n        if (isRef(node)) {\n          this.dragPreviewRef = node;\n        } else {\n          this.dragPreviewNode = node;\n        }\n\n        this.reconnectDragPreview();\n      }\n    });\n    this.handlerId = null; // The drop target may either be attached via ref or connect function\n\n    this.dragSourceRef = null;\n    this.dragSourceOptionsInternal = null; // The drag preview may either be attached via ref or connect function\n\n    this.dragPreviewRef = null;\n    this.dragPreviewOptionsInternal = null;\n    this.lastConnectedHandlerId = null;\n    this.lastConnectedDragSource = null;\n    this.lastConnectedDragSourceOptions = null;\n    this.lastConnectedDragPreview = null;\n    this.lastConnectedDragPreviewOptions = null;\n    this.backend = backend;\n  }\n\n}\n\nclass TargetConnector {\n  get connectTarget() {\n    return this.dropTarget;\n  }\n\n  reconnect() {\n    // if nothing has changed then don't resubscribe\n    const didChange = this.didHandlerIdChange() || this.didDropTargetChange() || this.didOptionsChange();\n\n    if (didChange) {\n      this.disconnectDropTarget();\n    }\n\n    const dropTarget = this.dropTarget;\n\n    if (!this.handlerId) {\n      return;\n    }\n\n    if (!dropTarget) {\n      this.lastConnectedDropTarget = dropTarget;\n      return;\n    }\n\n    if (didChange) {\n      this.lastConnectedHandlerId = this.handlerId;\n      this.lastConnectedDropTarget = dropTarget;\n      this.lastConnectedDropTargetOptions = this.dropTargetOptions;\n      this.unsubscribeDropTarget = this.backend.connectDropTarget(this.handlerId, dropTarget, this.dropTargetOptions);\n    }\n  }\n\n  receiveHandlerId(newHandlerId) {\n    if (newHandlerId === this.handlerId) {\n      return;\n    }\n\n    this.handlerId = newHandlerId;\n    this.reconnect();\n  }\n\n  get dropTargetOptions() {\n    return this.dropTargetOptionsInternal;\n  }\n\n  set dropTargetOptions(options) {\n    this.dropTargetOptionsInternal = options;\n  }\n\n  didHandlerIdChange() {\n    return this.lastConnectedHandlerId !== this.handlerId;\n  }\n\n  didDropTargetChange() {\n    return this.lastConnectedDropTarget !== this.dropTarget;\n  }\n\n  didOptionsChange() {\n    return !shallowEqual(this.lastConnectedDropTargetOptions, this.dropTargetOptions);\n  }\n\n  disconnectDropTarget() {\n    if (this.unsubscribeDropTarget) {\n      this.unsubscribeDropTarget();\n      this.unsubscribeDropTarget = undefined;\n    }\n  }\n\n  get dropTarget() {\n    return this.dropTargetNode || this.dropTargetRef && this.dropTargetRef.current;\n  }\n\n  clearDropTarget() {\n    this.dropTargetRef = null;\n    this.dropTargetNode = null;\n  }\n\n  constructor(backend) {\n    this.hooks = wrapConnectorHooks({\n      dropTarget: (node, options) => {\n        this.clearDropTarget();\n        this.dropTargetOptions = options;\n\n        if (isRef(node)) {\n          this.dropTargetRef = node;\n        } else {\n          this.dropTargetNode = node;\n        }\n\n        this.reconnect();\n      }\n    });\n    this.handlerId = null; // The drop target may either be attached via ref or connect function\n\n    this.dropTargetRef = null;\n    this.dropTargetOptionsInternal = null;\n    this.lastConnectedHandlerId = null;\n    this.lastConnectedDropTarget = null;\n    this.lastConnectedDropTargetOptions = null;\n    this.backend = backend;\n  }\n\n}\n\n/**\n * A hook to retrieve the DragDropManager from Context\n */\n\nfunction useDragDropManager() {\n  const {\n    dragDropManager\n  } = useContext(DndContext);\n  invariant(dragDropManager != null, 'Expected drag drop context');\n  return dragDropManager;\n}\n\nfunction useDragSourceConnector(dragSourceOptions, dragPreviewOptions) {\n  const manager = useDragDropManager();\n  const connector = useMemo(() => new SourceConnector(manager.getBackend()), [manager]);\n  useIsomorphicLayoutEffect(() => {\n    connector.dragSourceOptions = dragSourceOptions || null;\n    connector.reconnect();\n    return () => connector.disconnectDragSource();\n  }, [connector, dragSourceOptions]);\n  useIsomorphicLayoutEffect(() => {\n    connector.dragPreviewOptions = dragPreviewOptions || null;\n    connector.reconnect();\n    return () => connector.disconnectDragPreview();\n  }, [connector, dragPreviewOptions]);\n  return connector;\n}\n\nfunction useDragSourceMonitor() {\n  const manager = useDragDropManager();\n  return useMemo(() => new DragSourceMonitorImpl(manager), [manager]);\n}\n\nclass DragSourceImpl {\n  beginDrag() {\n    const spec = this.spec;\n    const monitor = this.monitor;\n    let result = null;\n\n    if (typeof spec.item === 'object') {\n      result = spec.item;\n    } else if (typeof spec.item === 'function') {\n      result = spec.item(monitor);\n    } else {\n      result = {};\n    }\n\n    return result !== null && result !== void 0 ? result : null;\n  }\n\n  canDrag() {\n    const spec = this.spec;\n    const monitor = this.monitor;\n\n    if (typeof spec.canDrag === 'boolean') {\n      return spec.canDrag;\n    } else if (typeof spec.canDrag === 'function') {\n      return spec.canDrag(monitor);\n    } else {\n      return true;\n    }\n  }\n\n  isDragging(globalMonitor, target) {\n    const spec = this.spec;\n    const monitor = this.monitor;\n    const {\n      isDragging\n    } = spec;\n    return isDragging ? isDragging(monitor) : target === globalMonitor.getSourceId();\n  }\n\n  endDrag() {\n    const spec = this.spec;\n    const monitor = this.monitor;\n    const connector = this.connector;\n    const {\n      end\n    } = spec;\n\n    if (end) {\n      end(monitor.getItem(), monitor);\n    }\n\n    connector.reconnect();\n  }\n\n  constructor(spec, monitor, connector) {\n    this.spec = spec;\n    this.monitor = monitor;\n    this.connector = connector;\n  }\n\n}\n\nfunction useDragSource(spec, monitor, connector) {\n  const handler = useMemo(() => new DragSourceImpl(spec, monitor, connector), [monitor, connector]);\n  useEffect(() => {\n    handler.spec = spec;\n  }, [spec]);\n  return handler;\n}\n\nfunction useDragType(spec) {\n  return useMemo(() => {\n    const result = spec.type;\n    invariant(result != null, 'spec.type must be defined');\n    return result;\n  }, [spec]);\n}\n\nfunction useRegisteredDragSource(spec, monitor, connector) {\n  const manager = useDragDropManager();\n  const handler = useDragSource(spec, monitor, connector);\n  const itemType = useDragType(spec);\n  useIsomorphicLayoutEffect(function registerDragSource() {\n    if (itemType != null) {\n      const [handlerId, unregister] = registerSource(itemType, handler, manager);\n      monitor.receiveHandlerId(handlerId);\n      connector.receiveHandlerId(handlerId);\n      return unregister;\n    }\n\n    return;\n  }, [manager, monitor, connector, handler, itemType]);\n}\n\n/**\n * useDragSource hook\n * @param sourceSpec The drag source specification (object or function, function preferred)\n * @param deps The memoization deps array to use when evaluating spec changes\n */\n\nfunction useDrag(specArg, deps) {\n  const spec = useOptionalFactory(specArg, deps);\n  invariant(!spec.begin, `useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)`);\n  const monitor = useDragSourceMonitor();\n  const connector = useDragSourceConnector(spec.options, spec.previewOptions);\n  useRegisteredDragSource(spec, monitor, connector);\n  return [useCollectedProps(spec.collect, monitor, connector), useConnectDragSource(connector), useConnectDragPreview(connector)];\n}\n\n/**\n * useDragLayer Hook\n * @param collector The property collector\n */\n\nfunction useDragLayer(collect) {\n  const dragDropManager = useDragDropManager();\n  const monitor = dragDropManager.getMonitor();\n  const [collected, updateCollected] = useCollector(monitor, collect);\n  useEffect(() => monitor.subscribeToOffsetChange(updateCollected));\n  useEffect(() => monitor.subscribeToStateChange(updateCollected));\n  return collected;\n}\n\nfunction useConnectDropTarget(connector) {\n  return useMemo(() => connector.hooks.dropTarget(), [connector]);\n}\n\nfunction useDropTargetConnector(options) {\n  const manager = useDragDropManager();\n  const connector = useMemo(() => new TargetConnector(manager.getBackend()), [manager]);\n  useIsomorphicLayoutEffect(() => {\n    connector.dropTargetOptions = options || null;\n    connector.reconnect();\n    return () => connector.disconnectDropTarget();\n  }, [options]);\n  return connector;\n}\n\nfunction useDropTargetMonitor() {\n  const manager = useDragDropManager();\n  return useMemo(() => new DropTargetMonitorImpl(manager), [manager]);\n}\n\n/**\n * Internal utility hook to get an array-version of spec.accept.\n * The main utility here is that we aren't creating a new array on every render if a non-array spec.accept is passed in.\n * @param spec\n */\n\nfunction useAccept(spec) {\n  const {\n    accept\n  } = spec;\n  return useMemo(() => {\n    invariant(spec.accept != null, 'accept must be defined');\n    return Array.isArray(accept) ? accept : [accept];\n  }, [accept]);\n}\n\nclass DropTargetImpl {\n  canDrop() {\n    const spec = this.spec;\n    const monitor = this.monitor;\n    return spec.canDrop ? spec.canDrop(monitor.getItem(), monitor) : true;\n  }\n\n  hover() {\n    const spec = this.spec;\n    const monitor = this.monitor;\n\n    if (spec.hover) {\n      spec.hover(monitor.getItem(), monitor);\n    }\n  }\n\n  drop() {\n    const spec = this.spec;\n    const monitor = this.monitor;\n\n    if (spec.drop) {\n      return spec.drop(monitor.getItem(), monitor);\n    }\n\n    return;\n  }\n\n  constructor(spec, monitor) {\n    this.spec = spec;\n    this.monitor = monitor;\n  }\n\n}\n\nfunction useDropTarget(spec, monitor) {\n  const dropTarget = useMemo(() => new DropTargetImpl(spec, monitor), [monitor]);\n  useEffect(() => {\n    dropTarget.spec = spec;\n  }, [spec]);\n  return dropTarget;\n}\n\nfunction useRegisteredDropTarget(spec, monitor, connector) {\n  const manager = useDragDropManager();\n  const dropTarget = useDropTarget(spec, monitor);\n  const accept = useAccept(spec);\n  useIsomorphicLayoutEffect(function registerDropTarget() {\n    const [handlerId, unregister] = registerTarget(accept, dropTarget, manager);\n    monitor.receiveHandlerId(handlerId);\n    connector.receiveHandlerId(handlerId);\n    return unregister;\n  }, [manager, monitor, dropTarget, connector, accept.map(a => a.toString()).join('|')]);\n}\n\n/**\n * useDropTarget Hook\n * @param spec The drop target specification (object or function, function preferred)\n * @param deps The memoization deps array to use when evaluating spec changes\n */\n\nfunction useDrop(specArg, deps) {\n  const spec = useOptionalFactory(specArg, deps);\n  const monitor = useDropTargetMonitor();\n  const connector = useDropTargetConnector(spec.options);\n  useRegisteredDropTarget(spec, monitor, connector);\n  return [useCollectedProps(spec.collect, monitor, connector), useConnectDropTarget(connector)];\n}\n\n// cheap lodash replacements\nfunction memoize(fn) {\n  let result = null;\n\n  const memoized = () => {\n    if (result == null) {\n      result = fn();\n    }\n\n    return result;\n  };\n\n  return memoized;\n}\n/**\n * drop-in replacement for _.without\n */\n\nfunction without(items, item) {\n  return items.filter(i => i !== item);\n}\nfunction union(itemsA, itemsB) {\n  const set = new Set();\n\n  const insertItem = item => set.add(item);\n\n  itemsA.forEach(insertItem);\n  itemsB.forEach(insertItem);\n  const result = [];\n  set.forEach(key => result.push(key));\n  return result;\n}\n\nclass EnterLeaveCounter {\n  enter(enteringNode) {\n    const previousLength = this.entered.length;\n\n    const isNodeEntered = node => this.isNodeInDocument(node) && (!node.contains || node.contains(enteringNode));\n\n    this.entered = union(this.entered.filter(isNodeEntered), [enteringNode]);\n    return previousLength === 0 && this.entered.length > 0;\n  }\n\n  leave(leavingNode) {\n    const previousLength = this.entered.length;\n    this.entered = without(this.entered.filter(this.isNodeInDocument), leavingNode);\n    return previousLength > 0 && this.entered.length === 0;\n  }\n\n  reset() {\n    this.entered = [];\n  }\n\n  constructor(isNodeInDocument) {\n    this.entered = [];\n    this.isNodeInDocument = isNodeInDocument;\n  }\n\n}\n\nclass NativeDragSource {\n  initializeExposedProperties() {\n    Object.keys(this.config.exposeProperties).forEach(property => {\n      Object.defineProperty(this.item, property, {\n        configurable: true,\n        enumerable: true,\n\n        get() {\n          // eslint-disable-next-line no-console\n          console.warn(`Browser doesn't allow reading \"${property}\" until the drop event.`);\n          return null;\n        }\n\n      });\n    });\n  }\n\n  loadDataTransfer(dataTransfer) {\n    if (dataTransfer) {\n      const newProperties = {};\n      Object.keys(this.config.exposeProperties).forEach(property => {\n        const propertyFn = this.config.exposeProperties[property];\n\n        if (propertyFn != null) {\n          newProperties[property] = {\n            value: propertyFn(dataTransfer, this.config.matchesTypes),\n            configurable: true,\n            enumerable: true\n          };\n        }\n      });\n      Object.defineProperties(this.item, newProperties);\n    }\n  }\n\n  canDrag() {\n    return true;\n  }\n\n  beginDrag() {\n    return this.item;\n  }\n\n  isDragging(monitor, handle) {\n    return handle === monitor.getSourceId();\n  }\n\n  endDrag() {// empty\n  }\n\n  constructor(config) {\n    this.config = config;\n    this.item = {};\n    this.initializeExposedProperties();\n  }\n\n}\n\nconst FILE = '__NATIVE_FILE__';\nconst URL = '__NATIVE_URL__';\nconst TEXT = '__NATIVE_TEXT__';\nconst HTML = '__NATIVE_HTML__';\n\nvar NativeTypes = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    FILE: FILE,\n    URL: URL,\n    TEXT: TEXT,\n    HTML: HTML\n});\n\nfunction getDataFromDataTransfer(dataTransfer, typesToTry, defaultValue) {\n  const result = typesToTry.reduce((resultSoFar, typeToTry) => resultSoFar || dataTransfer.getData(typeToTry), '');\n  return result != null ? result : defaultValue;\n}\n\nconst nativeTypesConfig = {\n  [FILE]: {\n    exposeProperties: {\n      files: dataTransfer => Array.prototype.slice.call(dataTransfer.files),\n      items: dataTransfer => dataTransfer.items,\n      dataTransfer: dataTransfer => dataTransfer\n    },\n    matchesTypes: ['Files']\n  },\n  [HTML]: {\n    exposeProperties: {\n      html: (dataTransfer, matchesTypes) => getDataFromDataTransfer(dataTransfer, matchesTypes, ''),\n      dataTransfer: dataTransfer => dataTransfer\n    },\n    matchesTypes: ['Html', 'text/html']\n  },\n  [URL]: {\n    exposeProperties: {\n      urls: (dataTransfer, matchesTypes) => getDataFromDataTransfer(dataTransfer, matchesTypes, '').split('\\n'),\n      dataTransfer: dataTransfer => dataTransfer\n    },\n    matchesTypes: ['Url', 'text/uri-list']\n  },\n  [TEXT]: {\n    exposeProperties: {\n      text: (dataTransfer, matchesTypes) => getDataFromDataTransfer(dataTransfer, matchesTypes, ''),\n      dataTransfer: dataTransfer => dataTransfer\n    },\n    matchesTypes: ['Text', 'text/plain']\n  }\n};\n\nfunction createNativeDragSource(type, dataTransfer) {\n  const config = nativeTypesConfig[type];\n\n  if (!config) {\n    throw new Error(`native type ${type} has no configuration`);\n  }\n\n  const result = new NativeDragSource(config);\n  result.loadDataTransfer(dataTransfer);\n  return result;\n}\nfunction matchNativeItemType(dataTransfer) {\n  if (!dataTransfer) {\n    return null;\n  }\n\n  const dataTransferTypes = Array.prototype.slice.call(dataTransfer.types || []);\n  return Object.keys(nativeTypesConfig).filter(nativeItemType => {\n    const typeConfig = nativeTypesConfig[nativeItemType];\n\n    if (!(typeConfig === null || typeConfig === void 0 ? void 0 : typeConfig.matchesTypes)) {\n      return false;\n    }\n\n    return typeConfig.matchesTypes.some(t => dataTransferTypes.indexOf(t) > -1);\n  })[0] || null;\n}\n\nconst isFirefox = memoize(() => /firefox/i.test(navigator.userAgent));\nconst isSafari = memoize(() => Boolean(window.safari));\n\nclass MonotonicInterpolant {\n  interpolate(x) {\n    const {\n      xs,\n      ys,\n      c1s,\n      c2s,\n      c3s\n    } = this; // The rightmost point in the dataset should give an exact result\n\n    let i = xs.length - 1;\n\n    if (x === xs[i]) {\n      return ys[i];\n    } // Search for the interval x is in, returning the corresponding y if x is one of the original xs\n\n\n    let low = 0;\n    let high = c3s.length - 1;\n    let mid;\n\n    while (low <= high) {\n      mid = Math.floor(0.5 * (low + high));\n      const xHere = xs[mid];\n\n      if (xHere < x) {\n        low = mid + 1;\n      } else if (xHere > x) {\n        high = mid - 1;\n      } else {\n        return ys[mid];\n      }\n    }\n\n    i = Math.max(0, high); // Interpolate\n\n    const diff = x - xs[i];\n    const diffSq = diff * diff;\n    return ys[i] + c1s[i] * diff + c2s[i] * diffSq + c3s[i] * diff * diffSq;\n  }\n\n  constructor(xs, ys) {\n    const {\n      length\n    } = xs; // Rearrange xs and ys so that xs is sorted\n\n    const indexes = [];\n\n    for (let i = 0; i < length; i++) {\n      indexes.push(i);\n    }\n\n    indexes.sort((a, b) => xs[a] < xs[b] ? -1 : 1); // Get consecutive differences and slopes\n    const dxs = [];\n    const ms = [];\n    let dx;\n    let dy;\n\n    for (let i1 = 0; i1 < length - 1; i1++) {\n      dx = xs[i1 + 1] - xs[i1];\n      dy = ys[i1 + 1] - ys[i1];\n      dxs.push(dx);\n      ms.push(dy / dx);\n    } // Get degree-1 coefficients\n\n\n    const c1s = [ms[0]];\n\n    for (let i2 = 0; i2 < dxs.length - 1; i2++) {\n      const m2 = ms[i2];\n      const mNext = ms[i2 + 1];\n\n      if (m2 * mNext <= 0) {\n        c1s.push(0);\n      } else {\n        dx = dxs[i2];\n        const dxNext = dxs[i2 + 1];\n        const common = dx + dxNext;\n        c1s.push(3 * common / ((common + dxNext) / m2 + (common + dx) / mNext));\n      }\n    }\n\n    c1s.push(ms[ms.length - 1]); // Get degree-2 and degree-3 coefficients\n\n    const c2s = [];\n    const c3s = [];\n    let m;\n\n    for (let i3 = 0; i3 < c1s.length - 1; i3++) {\n      m = ms[i3];\n      const c1 = c1s[i3];\n      const invDx = 1 / dxs[i3];\n      const common = c1 + c1s[i3 + 1] - m - m;\n      c2s.push((m - c1 - common) * invDx);\n      c3s.push(common * invDx * invDx);\n    }\n\n    this.xs = xs;\n    this.ys = ys;\n    this.c1s = c1s;\n    this.c2s = c2s;\n    this.c3s = c3s;\n  }\n\n}\n\nconst ELEMENT_NODE$1 = 1;\nfunction getNodeClientOffset$1(node) {\n  const el = node.nodeType === ELEMENT_NODE$1 ? node : node.parentElement;\n\n  if (!el) {\n    return null;\n  }\n\n  const {\n    top,\n    left\n  } = el.getBoundingClientRect();\n  return {\n    x: left,\n    y: top\n  };\n}\nfunction getEventClientOffset$1(e) {\n  return {\n    x: e.clientX,\n    y: e.clientY\n  };\n}\n\nfunction isImageNode(node) {\n  var ref;\n  return node.nodeName === 'IMG' && (isFirefox() || !((ref = document.documentElement) === null || ref === void 0 ? void 0 : ref.contains(node)));\n}\n\nfunction getDragPreviewSize(isImage, dragPreview, sourceWidth, sourceHeight) {\n  let dragPreviewWidth = isImage ? dragPreview.width : sourceWidth;\n  let dragPreviewHeight = isImage ? dragPreview.height : sourceHeight; // Work around @2x coordinate discrepancies in browsers\n\n  if (isSafari() && isImage) {\n    dragPreviewHeight /= window.devicePixelRatio;\n    dragPreviewWidth /= window.devicePixelRatio;\n  }\n\n  return {\n    dragPreviewWidth,\n    dragPreviewHeight\n  };\n}\n\nfunction getDragPreviewOffset(sourceNode, dragPreview, clientOffset, anchorPoint, offsetPoint) {\n  // The browsers will use the image intrinsic size under different conditions.\n  // Firefox only cares if it's an image, but WebKit also wants it to be detached.\n  const isImage = isImageNode(dragPreview);\n  const dragPreviewNode = isImage ? sourceNode : dragPreview;\n  const dragPreviewNodeOffsetFromClient = getNodeClientOffset$1(dragPreviewNode);\n  const offsetFromDragPreview = {\n    x: clientOffset.x - dragPreviewNodeOffsetFromClient.x,\n    y: clientOffset.y - dragPreviewNodeOffsetFromClient.y\n  };\n  const {\n    offsetWidth: sourceWidth,\n    offsetHeight: sourceHeight\n  } = sourceNode;\n  const {\n    anchorX,\n    anchorY\n  } = anchorPoint;\n  const {\n    dragPreviewWidth,\n    dragPreviewHeight\n  } = getDragPreviewSize(isImage, dragPreview, sourceWidth, sourceHeight);\n\n  const calculateYOffset = () => {\n    const interpolantY = new MonotonicInterpolant([0, 0.5, 1], [// Dock to the top\n    offsetFromDragPreview.y, // Align at the center\n    offsetFromDragPreview.y / sourceHeight * dragPreviewHeight, // Dock to the bottom\n    offsetFromDragPreview.y + dragPreviewHeight - sourceHeight]);\n    let y = interpolantY.interpolate(anchorY); // Work around Safari 8 positioning bug\n\n    if (isSafari() && isImage) {\n      // We'll have to wait for @3x to see if this is entirely correct\n      y += (window.devicePixelRatio - 1) * dragPreviewHeight;\n    }\n\n    return y;\n  };\n\n  const calculateXOffset = () => {\n    // Interpolate coordinates depending on anchor point\n    // If you know a simpler way to do this, let me know\n    const interpolantX = new MonotonicInterpolant([0, 0.5, 1], [// Dock to the left\n    offsetFromDragPreview.x, // Align at the center\n    offsetFromDragPreview.x / sourceWidth * dragPreviewWidth, // Dock to the right\n    offsetFromDragPreview.x + dragPreviewWidth - sourceWidth]);\n    return interpolantX.interpolate(anchorX);\n  }; // Force offsets if specified in the options.\n\n\n  const {\n    offsetX,\n    offsetY\n  } = offsetPoint;\n  const isManualOffsetX = offsetX === 0 || offsetX;\n  const isManualOffsetY = offsetY === 0 || offsetY;\n  return {\n    x: isManualOffsetX ? offsetX : calculateXOffset(),\n    y: isManualOffsetY ? offsetY : calculateYOffset()\n  };\n}\n\nclass OptionsReader$1 {\n  get window() {\n    if (this.globalContext) {\n      return this.globalContext;\n    } else if (typeof window !== 'undefined') {\n      return window;\n    }\n\n    return undefined;\n  }\n\n  get document() {\n    var ref;\n\n    if ((ref = this.globalContext) === null || ref === void 0 ? void 0 : ref.document) {\n      return this.globalContext.document;\n    } else if (this.window) {\n      return this.window.document;\n    } else {\n      return undefined;\n    }\n  }\n\n  get rootElement() {\n    var ref;\n    return ((ref = this.optionsArgs) === null || ref === void 0 ? void 0 : ref.rootElement) || this.window;\n  }\n\n  constructor(globalContext, options) {\n    this.ownerDocument = null;\n    this.globalContext = globalContext;\n    this.optionsArgs = options;\n  }\n\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\nclass HTML5BackendImpl {\n  /**\n  * Generate profiling statistics for the HTML5Backend.\n  */\n  profile() {\n    var ref, ref1;\n    return {\n      sourcePreviewNodes: this.sourcePreviewNodes.size,\n      sourcePreviewNodeOptions: this.sourcePreviewNodeOptions.size,\n      sourceNodeOptions: this.sourceNodeOptions.size,\n      sourceNodes: this.sourceNodes.size,\n      dragStartSourceIds: ((ref = this.dragStartSourceIds) === null || ref === void 0 ? void 0 : ref.length) || 0,\n      dropTargetIds: this.dropTargetIds.length,\n      dragEnterTargetIds: this.dragEnterTargetIds.length,\n      dragOverTargetIds: ((ref1 = this.dragOverTargetIds) === null || ref1 === void 0 ? void 0 : ref1.length) || 0\n    };\n  } // public for test\n\n\n  get window() {\n    return this.options.window;\n  }\n\n  get document() {\n    return this.options.document;\n  }\n  /**\n  * Get the root element to use for event subscriptions\n  */\n\n\n  get rootElement() {\n    return this.options.rootElement;\n  }\n\n  setup() {\n    const root = this.rootElement;\n\n    if (root === undefined) {\n      return;\n    }\n\n    if (root.__isReactDndBackendSetUp) {\n      throw new Error('Cannot have two HTML5 backends at the same time.');\n    }\n\n    root.__isReactDndBackendSetUp = true;\n    this.addEventListeners(root);\n  }\n\n  teardown() {\n    const root = this.rootElement;\n\n    if (root === undefined) {\n      return;\n    }\n\n    root.__isReactDndBackendSetUp = false;\n    this.removeEventListeners(this.rootElement);\n    this.clearCurrentDragSourceNode();\n\n    if (this.asyncEndDragFrameId) {\n      var ref;\n      (ref = this.window) === null || ref === void 0 ? void 0 : ref.cancelAnimationFrame(this.asyncEndDragFrameId);\n    }\n  }\n\n  connectDragPreview(sourceId, node, options) {\n    this.sourcePreviewNodeOptions.set(sourceId, options);\n    this.sourcePreviewNodes.set(sourceId, node);\n    return () => {\n      this.sourcePreviewNodes.delete(sourceId);\n      this.sourcePreviewNodeOptions.delete(sourceId);\n    };\n  }\n\n  connectDragSource(sourceId, node, options) {\n    this.sourceNodes.set(sourceId, node);\n    this.sourceNodeOptions.set(sourceId, options);\n\n    const handleDragStart = e => this.handleDragStart(e, sourceId);\n\n    const handleSelectStart = e => this.handleSelectStart(e);\n\n    node.setAttribute('draggable', 'true');\n    node.addEventListener('dragstart', handleDragStart);\n    node.addEventListener('selectstart', handleSelectStart);\n    return () => {\n      this.sourceNodes.delete(sourceId);\n      this.sourceNodeOptions.delete(sourceId);\n      node.removeEventListener('dragstart', handleDragStart);\n      node.removeEventListener('selectstart', handleSelectStart);\n      node.setAttribute('draggable', 'false');\n    };\n  }\n\n  connectDropTarget(targetId, node) {\n    const handleDragEnter = e => this.handleDragEnter(e, targetId);\n\n    const handleDragOver = e => this.handleDragOver(e, targetId);\n\n    const handleDrop = e => this.handleDrop(e, targetId);\n\n    node.addEventListener('dragenter', handleDragEnter);\n    node.addEventListener('dragover', handleDragOver);\n    node.addEventListener('drop', handleDrop);\n    return () => {\n      node.removeEventListener('dragenter', handleDragEnter);\n      node.removeEventListener('dragover', handleDragOver);\n      node.removeEventListener('drop', handleDrop);\n    };\n  }\n\n  addEventListeners(target) {\n    // SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n    if (!target.addEventListener) {\n      return;\n    }\n\n    target.addEventListener('dragstart', this.handleTopDragStart);\n    target.addEventListener('dragstart', this.handleTopDragStartCapture, true);\n    target.addEventListener('dragend', this.handleTopDragEndCapture, true);\n    target.addEventListener('dragenter', this.handleTopDragEnter);\n    target.addEventListener('dragenter', this.handleTopDragEnterCapture, true);\n    target.addEventListener('dragleave', this.handleTopDragLeaveCapture, true);\n    target.addEventListener('dragover', this.handleTopDragOver);\n    target.addEventListener('dragover', this.handleTopDragOverCapture, true);\n    target.addEventListener('drop', this.handleTopDrop);\n    target.addEventListener('drop', this.handleTopDropCapture, true);\n  }\n\n  removeEventListeners(target) {\n    // SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n    if (!target.removeEventListener) {\n      return;\n    }\n\n    target.removeEventListener('dragstart', this.handleTopDragStart);\n    target.removeEventListener('dragstart', this.handleTopDragStartCapture, true);\n    target.removeEventListener('dragend', this.handleTopDragEndCapture, true);\n    target.removeEventListener('dragenter', this.handleTopDragEnter);\n    target.removeEventListener('dragenter', this.handleTopDragEnterCapture, true);\n    target.removeEventListener('dragleave', this.handleTopDragLeaveCapture, true);\n    target.removeEventListener('dragover', this.handleTopDragOver);\n    target.removeEventListener('dragover', this.handleTopDragOverCapture, true);\n    target.removeEventListener('drop', this.handleTopDrop);\n    target.removeEventListener('drop', this.handleTopDropCapture, true);\n  }\n\n  getCurrentSourceNodeOptions() {\n    const sourceId = this.monitor.getSourceId();\n    const sourceNodeOptions = this.sourceNodeOptions.get(sourceId);\n    return _objectSpread({\n      dropEffect: this.altKeyPressed ? 'copy' : 'move'\n    }, sourceNodeOptions || {});\n  }\n\n  getCurrentDropEffect() {\n    if (this.isDraggingNativeItem()) {\n      // It makes more sense to default to 'copy' for native resources\n      return 'copy';\n    }\n\n    return this.getCurrentSourceNodeOptions().dropEffect;\n  }\n\n  getCurrentSourcePreviewNodeOptions() {\n    const sourceId = this.monitor.getSourceId();\n    const sourcePreviewNodeOptions = this.sourcePreviewNodeOptions.get(sourceId);\n    return _objectSpread({\n      anchorX: 0.5,\n      anchorY: 0.5,\n      captureDraggingState: false\n    }, sourcePreviewNodeOptions || {});\n  }\n\n  isDraggingNativeItem() {\n    const itemType = this.monitor.getItemType();\n    return Object.keys(NativeTypes).some(key => NativeTypes[key] === itemType);\n  }\n\n  beginDragNativeItem(type, dataTransfer) {\n    this.clearCurrentDragSourceNode();\n    this.currentNativeSource = createNativeDragSource(type, dataTransfer);\n    this.currentNativeHandle = this.registry.addSource(type, this.currentNativeSource);\n    this.actions.beginDrag([this.currentNativeHandle]);\n  }\n\n  setCurrentDragSourceNode(node) {\n    this.clearCurrentDragSourceNode();\n    this.currentDragSourceNode = node; // A timeout of > 0 is necessary to resolve Firefox issue referenced\n    // See:\n    //   * https://github.com/react-dnd/react-dnd/pull/928\n    //   * https://github.com/react-dnd/react-dnd/issues/869\n\n    const MOUSE_MOVE_TIMEOUT = 1000; // Receiving a mouse event in the middle of a dragging operation\n    // means it has ended and the drag source node disappeared from DOM,\n    // so the browser didn't dispatch the dragend event.\n    //\n    // We need to wait before we start listening for mousemove events.\n    // This is needed because the drag preview needs to be drawn or else it fires an 'mousemove' event\n    // immediately in some browsers.\n    //\n    // See:\n    //   * https://github.com/react-dnd/react-dnd/pull/928\n    //   * https://github.com/react-dnd/react-dnd/issues/869\n    //\n\n    this.mouseMoveTimeoutTimer = setTimeout(() => {\n      var ref;\n      return (ref = this.rootElement) === null || ref === void 0 ? void 0 : ref.addEventListener('mousemove', this.endDragIfSourceWasRemovedFromDOM, true);\n    }, MOUSE_MOVE_TIMEOUT);\n  }\n\n  clearCurrentDragSourceNode() {\n    if (this.currentDragSourceNode) {\n      this.currentDragSourceNode = null;\n\n      if (this.rootElement) {\n        var ref;\n        (ref = this.window) === null || ref === void 0 ? void 0 : ref.clearTimeout(this.mouseMoveTimeoutTimer || undefined);\n        this.rootElement.removeEventListener('mousemove', this.endDragIfSourceWasRemovedFromDOM, true);\n      }\n\n      this.mouseMoveTimeoutTimer = null;\n      return true;\n    }\n\n    return false;\n  }\n\n  handleDragStart(e, sourceId) {\n    if (e.defaultPrevented) {\n      return;\n    }\n\n    if (!this.dragStartSourceIds) {\n      this.dragStartSourceIds = [];\n    }\n\n    this.dragStartSourceIds.unshift(sourceId);\n  }\n\n  handleDragEnter(_e, targetId) {\n    this.dragEnterTargetIds.unshift(targetId);\n  }\n\n  handleDragOver(_e, targetId) {\n    if (this.dragOverTargetIds === null) {\n      this.dragOverTargetIds = [];\n    }\n\n    this.dragOverTargetIds.unshift(targetId);\n  }\n\n  handleDrop(_e, targetId) {\n    this.dropTargetIds.unshift(targetId);\n  }\n\n  constructor(manager, globalContext, options) {\n    this.sourcePreviewNodes = new Map();\n    this.sourcePreviewNodeOptions = new Map();\n    this.sourceNodes = new Map();\n    this.sourceNodeOptions = new Map();\n    this.dragStartSourceIds = null;\n    this.dropTargetIds = [];\n    this.dragEnterTargetIds = [];\n    this.currentNativeSource = null;\n    this.currentNativeHandle = null;\n    this.currentDragSourceNode = null;\n    this.altKeyPressed = false;\n    this.mouseMoveTimeoutTimer = null;\n    this.asyncEndDragFrameId = null;\n    this.dragOverTargetIds = null;\n    this.lastClientOffset = null;\n    this.hoverRafId = null;\n\n    this.getSourceClientOffset = sourceId => {\n      const source = this.sourceNodes.get(sourceId);\n      return source && getNodeClientOffset$1(source) || null;\n    };\n\n    this.endDragNativeItem = () => {\n      if (!this.isDraggingNativeItem()) {\n        return;\n      }\n\n      this.actions.endDrag();\n\n      if (this.currentNativeHandle) {\n        this.registry.removeSource(this.currentNativeHandle);\n      }\n\n      this.currentNativeHandle = null;\n      this.currentNativeSource = null;\n    };\n\n    this.isNodeInDocument = node => {\n      // Check the node either in the main document or in the current context\n      return Boolean(node && this.document && this.document.body && this.document.body.contains(node));\n    };\n\n    this.endDragIfSourceWasRemovedFromDOM = () => {\n      const node = this.currentDragSourceNode;\n\n      if (node == null || this.isNodeInDocument(node)) {\n        return;\n      }\n\n      if (this.clearCurrentDragSourceNode() && this.monitor.isDragging()) {\n        this.actions.endDrag();\n      }\n\n      this.cancelHover();\n    };\n\n    this.scheduleHover = dragOverTargetIds => {\n      if (this.hoverRafId === null && typeof requestAnimationFrame !== 'undefined') {\n        this.hoverRafId = requestAnimationFrame(() => {\n          if (this.monitor.isDragging()) {\n            this.actions.hover(dragOverTargetIds || [], {\n              clientOffset: this.lastClientOffset\n            });\n          }\n\n          this.hoverRafId = null;\n        });\n      }\n    };\n\n    this.cancelHover = () => {\n      if (this.hoverRafId !== null && typeof cancelAnimationFrame !== 'undefined') {\n        cancelAnimationFrame(this.hoverRafId);\n        this.hoverRafId = null;\n      }\n    };\n\n    this.handleTopDragStartCapture = () => {\n      this.clearCurrentDragSourceNode();\n      this.dragStartSourceIds = [];\n    };\n\n    this.handleTopDragStart = e => {\n      if (e.defaultPrevented) {\n        return;\n      }\n\n      const {\n        dragStartSourceIds\n      } = this;\n      this.dragStartSourceIds = null;\n      const clientOffset = getEventClientOffset$1(e); // Avoid crashing if we missed a drop event or our previous drag died\n\n      if (this.monitor.isDragging()) {\n        this.actions.endDrag();\n        this.cancelHover();\n      } // Don't publish the source just yet (see why below)\n\n\n      this.actions.beginDrag(dragStartSourceIds || [], {\n        publishSource: false,\n        getSourceClientOffset: this.getSourceClientOffset,\n        clientOffset\n      });\n      const {\n        dataTransfer\n      } = e;\n      const nativeType = matchNativeItemType(dataTransfer);\n\n      if (this.monitor.isDragging()) {\n        if (dataTransfer && typeof dataTransfer.setDragImage === 'function') {\n          // Use custom drag image if user specifies it.\n          // If child drag source refuses drag but parent agrees,\n          // use parent's node as drag image. Neither works in IE though.\n          const sourceId = this.monitor.getSourceId();\n          const sourceNode = this.sourceNodes.get(sourceId);\n          const dragPreview = this.sourcePreviewNodes.get(sourceId) || sourceNode;\n\n          if (dragPreview) {\n            const {\n              anchorX,\n              anchorY,\n              offsetX,\n              offsetY\n            } = this.getCurrentSourcePreviewNodeOptions();\n            const anchorPoint = {\n              anchorX,\n              anchorY\n            };\n            const offsetPoint = {\n              offsetX,\n              offsetY\n            };\n            const dragPreviewOffset = getDragPreviewOffset(sourceNode, dragPreview, clientOffset, anchorPoint, offsetPoint);\n            dataTransfer.setDragImage(dragPreview, dragPreviewOffset.x, dragPreviewOffset.y);\n          }\n        }\n\n        try {\n          // Firefox won't drag without setting data\n          dataTransfer === null || dataTransfer === void 0 ? void 0 : dataTransfer.setData('application/json', {});\n        } catch (err) {// IE doesn't support MIME types in setData\n        } // Store drag source node so we can check whether\n        // it is removed from DOM and trigger endDrag manually.\n\n\n        this.setCurrentDragSourceNode(e.target); // Now we are ready to publish the drag source.. or are we not?\n\n        const {\n          captureDraggingState\n        } = this.getCurrentSourcePreviewNodeOptions();\n\n        if (!captureDraggingState) {\n          // Usually we want to publish it in the next tick so that browser\n          // is able to screenshot the current (not yet dragging) state.\n          //\n          // It also neatly avoids a situation where render() returns null\n          // in the same tick for the source element, and browser freaks out.\n          setTimeout(() => this.actions.publishDragSource(), 0);\n        } else {\n          // In some cases the user may want to override this behavior, e.g.\n          // to work around IE not supporting custom drag previews.\n          //\n          // When using a custom drag layer, the only way to prevent\n          // the default drag preview from drawing in IE is to screenshot\n          // the dragging state in which the node itself has zero opacity\n          // and height. In this case, though, returning null from render()\n          // will abruptly end the dragging, which is not obvious.\n          //\n          // This is the reason such behavior is strictly opt-in.\n          this.actions.publishDragSource();\n        }\n      } else if (nativeType) {\n        // A native item (such as URL) dragged from inside the document\n        this.beginDragNativeItem(nativeType);\n      } else if (dataTransfer && !dataTransfer.types && (e.target && !e.target.hasAttribute || !e.target.hasAttribute('draggable'))) {\n        // Looks like a Safari bug: dataTransfer.types is null, but there was no draggable.\n        // Just let it drag. It's a native type (URL or text) and will be picked up in\n        // dragenter handler.\n        return;\n      } else {\n        // If by this time no drag source reacted, tell browser not to drag.\n        e.preventDefault();\n      }\n    };\n\n    this.handleTopDragEndCapture = () => {\n      if (this.clearCurrentDragSourceNode() && this.monitor.isDragging()) {\n        // Firefox can dispatch this event in an infinite loop\n        // if dragend handler does something like showing an alert.\n        // Only proceed if we have not handled it already.\n        this.actions.endDrag();\n      }\n\n      this.cancelHover();\n    };\n\n    this.handleTopDragEnterCapture = e => {\n      this.dragEnterTargetIds = [];\n\n      if (this.isDraggingNativeItem()) {\n        var ref;\n        (ref = this.currentNativeSource) === null || ref === void 0 ? void 0 : ref.loadDataTransfer(e.dataTransfer);\n      }\n\n      const isFirstEnter = this.enterLeaveCounter.enter(e.target);\n\n      if (!isFirstEnter || this.monitor.isDragging()) {\n        return;\n      }\n\n      const {\n        dataTransfer\n      } = e;\n      const nativeType = matchNativeItemType(dataTransfer);\n\n      if (nativeType) {\n        // A native item (such as file or URL) dragged from outside the document\n        this.beginDragNativeItem(nativeType, dataTransfer);\n      }\n    };\n\n    this.handleTopDragEnter = e => {\n      const {\n        dragEnterTargetIds\n      } = this;\n      this.dragEnterTargetIds = [];\n\n      if (!this.monitor.isDragging()) {\n        // This is probably a native item type we don't understand.\n        return;\n      }\n\n      this.altKeyPressed = e.altKey; // If the target changes position as the result of `dragenter`, `dragover` might still\n      // get dispatched despite target being no longer there. The easy solution is to check\n      // whether there actually is a target before firing `hover`.\n\n      if (dragEnterTargetIds.length > 0) {\n        this.actions.hover(dragEnterTargetIds, {\n          clientOffset: getEventClientOffset$1(e)\n        });\n      }\n\n      const canDrop = dragEnterTargetIds.some(targetId => this.monitor.canDropOnTarget(targetId));\n\n      if (canDrop) {\n        // IE requires this to fire dragover events\n        e.preventDefault();\n\n        if (e.dataTransfer) {\n          e.dataTransfer.dropEffect = this.getCurrentDropEffect();\n        }\n      }\n    };\n\n    this.handleTopDragOverCapture = e => {\n      this.dragOverTargetIds = [];\n\n      if (this.isDraggingNativeItem()) {\n        var ref;\n        (ref = this.currentNativeSource) === null || ref === void 0 ? void 0 : ref.loadDataTransfer(e.dataTransfer);\n      }\n    };\n\n    this.handleTopDragOver = e => {\n      const {\n        dragOverTargetIds\n      } = this;\n      this.dragOverTargetIds = [];\n\n      if (!this.monitor.isDragging()) {\n        // This is probably a native item type we don't understand.\n        // Prevent default \"drop and blow away the whole document\" action.\n        e.preventDefault();\n\n        if (e.dataTransfer) {\n          e.dataTransfer.dropEffect = 'none';\n        }\n\n        return;\n      }\n\n      this.altKeyPressed = e.altKey;\n      this.lastClientOffset = getEventClientOffset$1(e);\n      this.scheduleHover(dragOverTargetIds);\n      const canDrop = (dragOverTargetIds || []).some(targetId => this.monitor.canDropOnTarget(targetId));\n\n      if (canDrop) {\n        // Show user-specified drop effect.\n        e.preventDefault();\n\n        if (e.dataTransfer) {\n          e.dataTransfer.dropEffect = this.getCurrentDropEffect();\n        }\n      } else if (this.isDraggingNativeItem()) {\n        // Don't show a nice cursor but still prevent default\n        // \"drop and blow away the whole document\" action.\n        e.preventDefault();\n      } else {\n        e.preventDefault();\n\n        if (e.dataTransfer) {\n          e.dataTransfer.dropEffect = 'none';\n        }\n      }\n    };\n\n    this.handleTopDragLeaveCapture = e => {\n      if (this.isDraggingNativeItem()) {\n        e.preventDefault();\n      }\n\n      const isLastLeave = this.enterLeaveCounter.leave(e.target);\n\n      if (!isLastLeave) {\n        return;\n      }\n\n      if (this.isDraggingNativeItem()) {\n        setTimeout(() => this.endDragNativeItem(), 0);\n      }\n\n      this.cancelHover();\n    };\n\n    this.handleTopDropCapture = e => {\n      this.dropTargetIds = [];\n\n      if (this.isDraggingNativeItem()) {\n        var ref;\n        e.preventDefault();\n        (ref = this.currentNativeSource) === null || ref === void 0 ? void 0 : ref.loadDataTransfer(e.dataTransfer);\n      } else if (matchNativeItemType(e.dataTransfer)) {\n        // Dragging some elements, like <a> and <img> may still behave like a native drag event,\n        // even if the current drag event matches a user-defined type.\n        // Stop the default behavior when we're not expecting a native item to be dropped.\n        e.preventDefault();\n      }\n\n      this.enterLeaveCounter.reset();\n    };\n\n    this.handleTopDrop = e => {\n      const {\n        dropTargetIds\n      } = this;\n      this.dropTargetIds = [];\n      this.actions.hover(dropTargetIds, {\n        clientOffset: getEventClientOffset$1(e)\n      });\n      this.actions.drop({\n        dropEffect: this.getCurrentDropEffect()\n      });\n\n      if (this.isDraggingNativeItem()) {\n        this.endDragNativeItem();\n      } else if (this.monitor.isDragging()) {\n        this.actions.endDrag();\n      }\n\n      this.cancelHover();\n    };\n\n    this.handleSelectStart = e => {\n      const target = e.target; // Only IE requires us to explicitly say\n      // we want drag drop operation to start\n\n      if (typeof target.dragDrop !== 'function') {\n        return;\n      } // Inputs and textareas should be selectable\n\n\n      if (target.tagName === 'INPUT' || target.tagName === 'SELECT' || target.tagName === 'TEXTAREA' || target.isContentEditable) {\n        return;\n      } // For other targets, ask IE\n      // to enable drag and drop\n\n\n      e.preventDefault();\n      target.dragDrop();\n    };\n\n    this.options = new OptionsReader$1(globalContext, options);\n    this.actions = manager.getActions();\n    this.monitor = manager.getMonitor();\n    this.registry = manager.getRegistry();\n    this.enterLeaveCounter = new EnterLeaveCounter(this.isNodeInDocument);\n  }\n\n}\n\nlet emptyImage;\nfunction getEmptyImage() {\n  if (!emptyImage) {\n    emptyImage = new Image();\n    emptyImage.src = 'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==';\n  }\n\n  return emptyImage;\n}\n\nconst HTML5Backend = function createBackend(manager, context, options) {\n  return new HTML5BackendImpl(manager, context, options);\n};\n\nvar ListenerType;\n\n(function (ListenerType) {\n  ListenerType[\"mouse\"] = \"mouse\";\n  ListenerType[\"touch\"] = \"touch\";\n  ListenerType[\"keyboard\"] = \"keyboard\";\n})(ListenerType || (ListenerType = {}));\n\nclass OptionsReader {\n  get delay() {\n    var _delay;\n\n    return (_delay = this.args.delay) !== null && _delay !== void 0 ? _delay : 0;\n  }\n\n  get scrollAngleRanges() {\n    return this.args.scrollAngleRanges;\n  }\n\n  get getDropTargetElementsAtPoint() {\n    return this.args.getDropTargetElementsAtPoint;\n  }\n\n  get ignoreContextMenu() {\n    var _ignoreContextMenu;\n\n    return (_ignoreContextMenu = this.args.ignoreContextMenu) !== null && _ignoreContextMenu !== void 0 ? _ignoreContextMenu : false;\n  }\n\n  get enableHoverOutsideTarget() {\n    var _enableHoverOutsideTarget;\n\n    return (_enableHoverOutsideTarget = this.args.enableHoverOutsideTarget) !== null && _enableHoverOutsideTarget !== void 0 ? _enableHoverOutsideTarget : false;\n  }\n\n  get enableKeyboardEvents() {\n    var _enableKeyboardEvents;\n\n    return (_enableKeyboardEvents = this.args.enableKeyboardEvents) !== null && _enableKeyboardEvents !== void 0 ? _enableKeyboardEvents : false;\n  }\n\n  get enableMouseEvents() {\n    var _enableMouseEvents;\n\n    return (_enableMouseEvents = this.args.enableMouseEvents) !== null && _enableMouseEvents !== void 0 ? _enableMouseEvents : false;\n  }\n\n  get enableTouchEvents() {\n    var _enableTouchEvents;\n\n    return (_enableTouchEvents = this.args.enableTouchEvents) !== null && _enableTouchEvents !== void 0 ? _enableTouchEvents : true;\n  }\n\n  get touchSlop() {\n    return this.args.touchSlop || 0;\n  }\n\n  get delayTouchStart() {\n    var ref, ref1;\n    var ref2, ref3;\n    return (ref3 = (ref2 = (ref = this.args) === null || ref === void 0 ? void 0 : ref.delayTouchStart) !== null && ref2 !== void 0 ? ref2 : (ref1 = this.args) === null || ref1 === void 0 ? void 0 : ref1.delay) !== null && ref3 !== void 0 ? ref3 : 0;\n  }\n\n  get delayMouseStart() {\n    var ref, ref4;\n    var ref5, ref6;\n    return (ref6 = (ref5 = (ref = this.args) === null || ref === void 0 ? void 0 : ref.delayMouseStart) !== null && ref5 !== void 0 ? ref5 : (ref4 = this.args) === null || ref4 === void 0 ? void 0 : ref4.delay) !== null && ref6 !== void 0 ? ref6 : 0;\n  }\n\n  get window() {\n    if (this.context && this.context.window) {\n      return this.context.window;\n    } else if (typeof window !== 'undefined') {\n      return window;\n    }\n\n    return undefined;\n  }\n\n  get document() {\n    var ref;\n\n    if ((ref = this.context) === null || ref === void 0 ? void 0 : ref.document) {\n      return this.context.document;\n    }\n\n    if (this.window) {\n      return this.window.document;\n    }\n\n    return undefined;\n  }\n\n  get rootElement() {\n    var ref;\n    return ((ref = this.args) === null || ref === void 0 ? void 0 : ref.rootElement) || this.document;\n  }\n\n  constructor(args, context) {\n    this.args = args;\n    this.context = context;\n  }\n\n}\n\nfunction distance(x1, y1, x2, y2) {\n  return Math.sqrt(Math.pow(Math.abs(x2 - x1), 2) + Math.pow(Math.abs(y2 - y1), 2));\n}\nfunction inAngleRanges(x1, y1, x2, y2, angleRanges) {\n  if (!angleRanges) {\n    return false;\n  }\n\n  const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI + 180;\n\n  for (let i = 0; i < angleRanges.length; ++i) {\n    const ar = angleRanges[i];\n\n    if (ar && (ar.start == null || angle >= ar.start) && (ar.end == null || angle <= ar.end)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n// Used for MouseEvent.buttons (note the s on the end).\nconst MouseButtons = {\n  Left: 1,\n  Right: 2,\n  Center: 4\n}; // Used for e.button (note the lack of an s on the end).\n\nconst MouseButton = {\n  Left: 0,\n  Center: 1,\n  Right: 2\n};\n/**\n * Only touch events and mouse events where the left button is pressed should initiate a drag.\n * @param {MouseEvent | TouchEvent} e The event\n */\n\nfunction eventShouldStartDrag(e) {\n  // For touch events, button will be undefined. If e.button is defined,\n  // then it should be MouseButton.Left.\n  return e.button === undefined || e.button === MouseButton.Left;\n}\n/**\n * Only touch events and mouse events where the left mouse button is no longer held should end a drag.\n * It's possible the user mouse downs with the left mouse button, then mouse down and ups with the right mouse button.\n * We don't want releasing the right mouse button to end the drag.\n * @param {MouseEvent | TouchEvent} e The event\n */\n\nfunction eventShouldEndDrag(e) {\n  // Touch events will have buttons be undefined, while mouse events will have e.buttons's left button\n  // bit field unset if the left mouse button has been released\n  return e.buttons === undefined || (e.buttons & MouseButtons.Left) === 0;\n}\nfunction isTouchEvent(e) {\n  return !!e.targetTouches;\n}\n\nconst ELEMENT_NODE = 1;\nfunction getNodeClientOffset(node) {\n  const el = node.nodeType === ELEMENT_NODE ? node : node.parentElement;\n\n  if (!el) {\n    return undefined;\n  }\n\n  const {\n    top,\n    left\n  } = el.getBoundingClientRect();\n  return {\n    x: left,\n    y: top\n  };\n}\nfunction getEventClientTouchOffset(e, lastTargetTouchFallback) {\n  if (e.targetTouches.length === 1) {\n    return getEventClientOffset(e.targetTouches[0]);\n  } else if (lastTargetTouchFallback && e.touches.length === 1) {\n    if (e.touches[0].target === lastTargetTouchFallback.target) {\n      return getEventClientOffset(e.touches[0]);\n    }\n  }\n\n  return;\n}\nfunction getEventClientOffset(e, lastTargetTouchFallback) {\n  if (isTouchEvent(e)) {\n    return getEventClientTouchOffset(e, lastTargetTouchFallback);\n  } else {\n    return {\n      x: e.clientX,\n      y: e.clientY\n    };\n  }\n}\n\nconst supportsPassive = (() => {\n  // simular to jQuery's test\n  let supported = false;\n\n  try {\n    addEventListener('test', () => {// do nothing\n    }, Object.defineProperty({}, 'passive', {\n      get() {\n        supported = true;\n        return true;\n      }\n\n    }));\n  } catch (e) {// do nothing\n  }\n\n  return supported;\n})();\n\nconst eventNames = {\n  [ListenerType.mouse]: {\n    start: 'mousedown',\n    move: 'mousemove',\n    end: 'mouseup',\n    contextmenu: 'contextmenu'\n  },\n  [ListenerType.touch]: {\n    start: 'touchstart',\n    move: 'touchmove',\n    end: 'touchend'\n  },\n  [ListenerType.keyboard]: {\n    keydown: 'keydown'\n  }\n};\nclass TouchBackendImpl {\n  /**\n  * Generate profiling statistics for the HTML5Backend.\n  */\n  profile() {\n    var ref;\n    return {\n      sourceNodes: this.sourceNodes.size,\n      sourcePreviewNodes: this.sourcePreviewNodes.size,\n      sourcePreviewNodeOptions: this.sourcePreviewNodeOptions.size,\n      targetNodes: this.targetNodes.size,\n      dragOverTargetIds: ((ref = this.dragOverTargetIds) === null || ref === void 0 ? void 0 : ref.length) || 0\n    };\n  } // public for test\n\n\n  get document() {\n    return this.options.document;\n  }\n\n  setup() {\n    const root = this.options.rootElement;\n\n    if (!root) {\n      return;\n    }\n\n    invariant(!TouchBackendImpl.isSetUp, 'Cannot have two Touch backends at the same time.');\n    TouchBackendImpl.isSetUp = true;\n    this.addEventListener(root, 'start', this.getTopMoveStartHandler());\n    this.addEventListener(root, 'start', this.handleTopMoveStartCapture, true);\n    this.addEventListener(root, 'move', this.handleTopMove);\n    this.addEventListener(root, 'move', this.handleTopMoveCapture, true);\n    this.addEventListener(root, 'end', this.handleTopMoveEndCapture, true);\n\n    if (this.options.enableMouseEvents && !this.options.ignoreContextMenu) {\n      this.addEventListener(root, 'contextmenu', this.handleTopMoveEndCapture);\n    }\n\n    if (this.options.enableKeyboardEvents) {\n      this.addEventListener(root, 'keydown', this.handleCancelOnEscape, true);\n    }\n  }\n\n  teardown() {\n    const root = this.options.rootElement;\n\n    if (!root) {\n      return;\n    }\n\n    TouchBackendImpl.isSetUp = false;\n    this._mouseClientOffset = {};\n    this.removeEventListener(root, 'start', this.handleTopMoveStartCapture, true);\n    this.removeEventListener(root, 'start', this.handleTopMoveStart);\n    this.removeEventListener(root, 'move', this.handleTopMoveCapture, true);\n    this.removeEventListener(root, 'move', this.handleTopMove);\n    this.removeEventListener(root, 'end', this.handleTopMoveEndCapture, true);\n\n    if (this.options.enableMouseEvents && !this.options.ignoreContextMenu) {\n      this.removeEventListener(root, 'contextmenu', this.handleTopMoveEndCapture);\n    }\n\n    if (this.options.enableKeyboardEvents) {\n      this.removeEventListener(root, 'keydown', this.handleCancelOnEscape, true);\n    }\n\n    this.uninstallSourceNodeRemovalObserver();\n  }\n\n  addEventListener(subject, event, handler, capture = false) {\n    const options = supportsPassive ? {\n      capture,\n      passive: false\n    } : capture;\n    this.listenerTypes.forEach(function (listenerType) {\n      const evt = eventNames[listenerType][event];\n\n      if (evt) {\n        subject.addEventListener(evt, handler, options);\n      }\n    });\n  }\n\n  removeEventListener(subject, event, handler, capture = false) {\n    const options = supportsPassive ? {\n      capture,\n      passive: false\n    } : capture;\n    this.listenerTypes.forEach(function (listenerType) {\n      const evt = eventNames[listenerType][event];\n\n      if (evt) {\n        subject.removeEventListener(evt, handler, options);\n      }\n    });\n  }\n\n  connectDragSource(sourceId, node) {\n    const handleMoveStart = this.handleMoveStart.bind(this, sourceId);\n    this.sourceNodes.set(sourceId, node);\n    this.addEventListener(node, 'start', handleMoveStart);\n    return () => {\n      this.sourceNodes.delete(sourceId);\n      this.removeEventListener(node, 'start', handleMoveStart);\n    };\n  }\n\n  connectDragPreview(sourceId, node, options) {\n    this.sourcePreviewNodeOptions.set(sourceId, options);\n    this.sourcePreviewNodes.set(sourceId, node);\n    return () => {\n      this.sourcePreviewNodes.delete(sourceId);\n      this.sourcePreviewNodeOptions.delete(sourceId);\n    };\n  }\n\n  connectDropTarget(targetId, node) {\n    const root = this.options.rootElement;\n\n    if (!this.document || !root) {\n      return () => {\n        /* noop */\n      };\n    }\n\n    const handleMove = e => {\n      if (!this.document || !root || !this.monitor.isDragging()) {\n        return;\n      }\n\n      let coords;\n      /**\n      * Grab the coordinates for the current mouse/touch position\n      */\n\n      switch (e.type) {\n        case eventNames.mouse.move:\n          coords = {\n            x: e.clientX,\n            y: e.clientY\n          };\n          break;\n\n        case eventNames.touch.move:\n          var ref, ref1;\n          coords = {\n            x: ((ref = e.touches[0]) === null || ref === void 0 ? void 0 : ref.clientX) || 0,\n            y: ((ref1 = e.touches[0]) === null || ref1 === void 0 ? void 0 : ref1.clientY) || 0\n          };\n          break;\n      }\n      /**\n      * Use the coordinates to grab the element the drag ended on.\n      * If the element is the same as the target node (or any of it's children) then we have hit a drop target and can handle the move.\n      */\n\n\n      const droppedOn = coords != null ? this.document.elementFromPoint(coords.x, coords.y) : undefined;\n      const childMatch = droppedOn && node.contains(droppedOn);\n\n      if (droppedOn === node || childMatch) {\n        return this.handleMove(e, targetId);\n      }\n    };\n    /**\n    * Attaching the event listener to the body so that touchmove will work while dragging over multiple target elements.\n    */\n\n\n    this.addEventListener(this.document.body, 'move', handleMove);\n    this.targetNodes.set(targetId, node);\n    return () => {\n      if (this.document) {\n        this.targetNodes.delete(targetId);\n        this.removeEventListener(this.document.body, 'move', handleMove);\n      }\n    };\n  }\n\n  getTopMoveStartHandler() {\n    if (!this.options.delayTouchStart && !this.options.delayMouseStart) {\n      return this.handleTopMoveStart;\n    }\n\n    return this.handleTopMoveStartDelay;\n  }\n\n  installSourceNodeRemovalObserver(node) {\n    this.uninstallSourceNodeRemovalObserver();\n    this.draggedSourceNode = node;\n    this.draggedSourceNodeRemovalObserver = new MutationObserver(() => {\n      if (node && !node.parentElement) {\n        this.resurrectSourceNode();\n        this.uninstallSourceNodeRemovalObserver();\n      }\n    });\n\n    if (!node || !node.parentElement) {\n      return;\n    }\n\n    this.draggedSourceNodeRemovalObserver.observe(node.parentElement, {\n      childList: true\n    });\n  }\n\n  resurrectSourceNode() {\n    if (this.document && this.draggedSourceNode) {\n      this.draggedSourceNode.style.display = 'none';\n      this.draggedSourceNode.removeAttribute('data-reactid');\n      this.document.body.appendChild(this.draggedSourceNode);\n    }\n  }\n\n  uninstallSourceNodeRemovalObserver() {\n    if (this.draggedSourceNodeRemovalObserver) {\n      this.draggedSourceNodeRemovalObserver.disconnect();\n    }\n\n    this.draggedSourceNodeRemovalObserver = undefined;\n    this.draggedSourceNode = undefined;\n  }\n\n  constructor(manager, context, options) {\n    this.getSourceClientOffset = sourceId => {\n      const element = this.sourceNodes.get(sourceId);\n      return element && getNodeClientOffset(element);\n    };\n\n    this.handleTopMoveStartCapture = e => {\n      if (!eventShouldStartDrag(e)) {\n        return;\n      }\n\n      this.moveStartSourceIds = [];\n    };\n\n    this.handleMoveStart = sourceId => {\n      // Just because we received an event doesn't necessarily mean we need to collect drag sources.\n      // We only collect start collecting drag sources on touch and left mouse events.\n      if (Array.isArray(this.moveStartSourceIds)) {\n        this.moveStartSourceIds.unshift(sourceId);\n      }\n    };\n\n    this.handleTopMoveStart = e => {\n      if (!eventShouldStartDrag(e)) {\n        return;\n      } // Don't prematurely preventDefault() here since it might:\n      // 1. Mess up scrolling\n      // 2. Mess up long tap (which brings up context menu)\n      // 3. If there's an anchor link as a child, tap won't be triggered on link\n\n\n      const clientOffset = getEventClientOffset(e);\n\n      if (clientOffset) {\n        if (isTouchEvent(e)) {\n          this.lastTargetTouchFallback = e.targetTouches[0];\n        }\n\n        this._mouseClientOffset = clientOffset;\n      }\n\n      this.waitingForDelay = false;\n    };\n\n    this.handleTopMoveStartDelay = e => {\n      if (!eventShouldStartDrag(e)) {\n        return;\n      }\n\n      const delay = e.type === eventNames.touch.start ? this.options.delayTouchStart : this.options.delayMouseStart;\n      this.timeout = setTimeout(this.handleTopMoveStart.bind(this, e), delay);\n      this.waitingForDelay = true;\n    };\n\n    this.handleTopMoveCapture = () => {\n      this.dragOverTargetIds = [];\n    };\n\n    this.handleMove = (_evt, targetId) => {\n      if (this.dragOverTargetIds) {\n        this.dragOverTargetIds.unshift(targetId);\n      }\n    };\n\n    this.handleTopMove = e1 => {\n      if (this.timeout) {\n        clearTimeout(this.timeout);\n      }\n\n      if (!this.document || this.waitingForDelay) {\n        return;\n      }\n\n      const {\n        moveStartSourceIds,\n        dragOverTargetIds\n      } = this;\n      const enableHoverOutsideTarget = this.options.enableHoverOutsideTarget;\n      const clientOffset = getEventClientOffset(e1, this.lastTargetTouchFallback);\n\n      if (!clientOffset) {\n        return;\n      } // If the touch move started as a scroll, or is is between the scroll angles\n\n\n      if (this._isScrolling || !this.monitor.isDragging() && inAngleRanges(this._mouseClientOffset.x || 0, this._mouseClientOffset.y || 0, clientOffset.x, clientOffset.y, this.options.scrollAngleRanges)) {\n        this._isScrolling = true;\n        return;\n      } // If we're not dragging and we've moved a little, that counts as a drag start\n\n\n      if (!this.monitor.isDragging() && // eslint-disable-next-line no-prototype-builtins\n      this._mouseClientOffset.hasOwnProperty('x') && moveStartSourceIds && distance(this._mouseClientOffset.x || 0, this._mouseClientOffset.y || 0, clientOffset.x, clientOffset.y) > (this.options.touchSlop ? this.options.touchSlop : 0)) {\n        this.moveStartSourceIds = undefined;\n        this.actions.beginDrag(moveStartSourceIds, {\n          clientOffset: this._mouseClientOffset,\n          getSourceClientOffset: this.getSourceClientOffset,\n          publishSource: false\n        });\n      }\n\n      if (!this.monitor.isDragging()) {\n        return;\n      }\n\n      const sourceNode = this.sourceNodes.get(this.monitor.getSourceId());\n      this.installSourceNodeRemovalObserver(sourceNode);\n      this.actions.publishDragSource();\n      if (e1.cancelable) e1.preventDefault(); // Get the node elements of the hovered DropTargets\n\n      const dragOverTargetNodes = (dragOverTargetIds || []).map(key => this.targetNodes.get(key)).filter(e => !!e); // Get the a ordered list of nodes that are touched by\n\n      const elementsAtPoint = this.options.getDropTargetElementsAtPoint ? this.options.getDropTargetElementsAtPoint(clientOffset.x, clientOffset.y, dragOverTargetNodes) : this.document.elementsFromPoint(clientOffset.x, clientOffset.y); // Extend list with parents that are not receiving elementsFromPoint events (size 0 elements and svg groups)\n\n      const elementsAtPointExtended = [];\n\n      for (const nodeId in elementsAtPoint) {\n        // eslint-disable-next-line no-prototype-builtins\n        if (!elementsAtPoint.hasOwnProperty(nodeId)) {\n          continue;\n        }\n\n        let currentNode = elementsAtPoint[nodeId];\n\n        if (currentNode != null) {\n          elementsAtPointExtended.push(currentNode);\n        }\n\n        while (currentNode) {\n          currentNode = currentNode.parentElement;\n\n          if (currentNode && elementsAtPointExtended.indexOf(currentNode) === -1) {\n            elementsAtPointExtended.push(currentNode);\n          }\n        }\n      }\n\n      const orderedDragOverTargetIds = elementsAtPointExtended // Filter off nodes that arent a hovered DropTargets nodes\n      .filter(node => dragOverTargetNodes.indexOf(node) > -1) // Map back the nodes elements to targetIds\n      .map(node => this._getDropTargetId(node)) // Filter off possible null rows\n      .filter(node => !!node).filter((id, index, ids) => ids.indexOf(id) === index); // Invoke hover for drop targets when source node is still over and pointer is outside\n\n      if (enableHoverOutsideTarget) {\n        for (const targetId in this.targetNodes) {\n          const targetNode = this.targetNodes.get(targetId);\n\n          if (sourceNode && targetNode && targetNode.contains(sourceNode) && orderedDragOverTargetIds.indexOf(targetId) === -1) {\n            orderedDragOverTargetIds.unshift(targetId);\n            break;\n          }\n        }\n      } // Reverse order because dnd-core reverse it before calling the DropTarget drop methods\n\n\n      orderedDragOverTargetIds.reverse();\n      this.actions.hover(orderedDragOverTargetIds, {\n        clientOffset: clientOffset\n      });\n    };\n    /**\n    *\n    * visible for testing\n    */\n\n\n    this._getDropTargetId = node => {\n      const keys = this.targetNodes.keys();\n      let next = keys.next();\n\n      while (next.done === false) {\n        const targetId = next.value;\n\n        if (node === this.targetNodes.get(targetId)) {\n          return targetId;\n        } else {\n          next = keys.next();\n        }\n      }\n\n      return undefined;\n    };\n\n    this.handleTopMoveEndCapture = e => {\n      this._isScrolling = false;\n      this.lastTargetTouchFallback = undefined;\n\n      if (!eventShouldEndDrag(e)) {\n        return;\n      }\n\n      if (!this.monitor.isDragging() || this.monitor.didDrop()) {\n        this.moveStartSourceIds = undefined;\n        return;\n      }\n\n      if (e.cancelable) e.preventDefault();\n      this._mouseClientOffset = {};\n      this.uninstallSourceNodeRemovalObserver();\n      this.actions.drop();\n      this.actions.endDrag();\n    };\n\n    this.handleCancelOnEscape = e => {\n      if (e.key === 'Escape' && this.monitor.isDragging()) {\n        this._mouseClientOffset = {};\n        this.uninstallSourceNodeRemovalObserver();\n        this.actions.endDrag();\n      }\n    };\n\n    this.options = new OptionsReader(options, context);\n    this.actions = manager.getActions();\n    this.monitor = manager.getMonitor();\n    this.sourceNodes = new Map();\n    this.sourcePreviewNodes = new Map();\n    this.sourcePreviewNodeOptions = new Map();\n    this.targetNodes = new Map();\n    this.listenerTypes = [];\n    this._mouseClientOffset = {};\n    this._isScrolling = false;\n\n    if (this.options.enableMouseEvents) {\n      this.listenerTypes.push(ListenerType.mouse);\n    }\n\n    if (this.options.enableTouchEvents) {\n      this.listenerTypes.push(ListenerType.touch);\n    }\n\n    if (this.options.enableKeyboardEvents) {\n      this.listenerTypes.push(ListenerType.keyboard);\n    }\n  }\n\n}\n\nconst TouchBackend = function createBackend(manager, context = {}, options = {}) {\n  return new TouchBackendImpl(manager, context, options);\n};\n\nconst COLUMNS = 'abcdefgh'.split('');\nconst chessboardDefaultProps = {\n  animationDuration: 300,\n  areArrowsAllowed: true,\n  arePiecesDraggable: true,\n  arePremovesAllowed: false,\n  boardOrientation: 'white',\n  boardWidth: 560,\n  clearPremovesOnRightClick: true,\n  customArrows: [],\n  customArrowColor: 'rgb(255,170,0)',\n  customBoardStyle: {},\n  customDarkSquareStyle: {\n    backgroundColor: '#B58863'\n  },\n  customDndBackend: undefined,\n  customDndBackendOptions: undefined,\n  customDropSquareStyle: {\n    boxShadow: 'inset 0 0 1px 6px rgba(255,255,255,0.75)'\n  },\n  customLightSquareStyle: {\n    backgroundColor: '#F0D9B5'\n  },\n  customPieces: {},\n  customPremoveDarkSquareStyle: {\n    backgroundColor: '#A42323'\n  },\n  customPremoveLightSquareStyle: {\n    backgroundColor: '#BD2828'\n  },\n  customSquareStyles: {},\n  dropOffBoardAction: 'snapback',\n  id: 0,\n  isDraggablePiece: () => true,\n  getPositionObject: () => {},\n  onArrowsChange: () => {},\n  onDragOverSquare: () => {},\n  onMouseOutSquare: () => {},\n  onMouseOverSquare: () => {},\n  onPieceClick: () => {},\n  onPieceDragBegin: () => {},\n  onPieceDragEnd: () => {},\n  onPieceDrop: () => true,\n  onSquareClick: () => {},\n  onSquareRightClick: () => {},\n  position: 'start',\n  showBoardNotation: true,\n  // showSparePieces: false,\n  snapToCursor: true\n};\n\nconst startPositionObject = {\n  a8: 'bR',\n  b8: 'bN',\n  c8: 'bB',\n  d8: 'bQ',\n  e8: 'bK',\n  f8: 'bB',\n  g8: 'bN',\n  h8: 'bR',\n  a7: 'bP',\n  b7: 'bP',\n  c7: 'bP',\n  d7: 'bP',\n  e7: 'bP',\n  f7: 'bP',\n  g7: 'bP',\n  h7: 'bP',\n  a2: 'wP',\n  b2: 'wP',\n  c2: 'wP',\n  d2: 'wP',\n  e2: 'wP',\n  f2: 'wP',\n  g2: 'wP',\n  h2: 'wP',\n  a1: 'wR',\n  b1: 'wN',\n  c1: 'wB',\n  d1: 'wQ',\n  e1: 'wK',\n  f1: 'wB',\n  g1: 'wN',\n  h1: 'wR'\n};\nconst whiteColumnValues = {\n  a: 0,\n  b: 1,\n  c: 2,\n  d: 3,\n  e: 4,\n  f: 5,\n  g: 6,\n  h: 7\n};\nconst blackColumnValues = {\n  a: 7,\n  b: 6,\n  c: 5,\n  d: 4,\n  e: 3,\n  f: 2,\n  g: 1,\n  h: 0\n};\nconst whiteRows = [7, 6, 5, 4, 3, 2, 1, 0];\nconst blackRows = [0, 1, 2, 3, 4, 5, 6, 7];\nconst getRelativeCoords = (boardOrientation, boardWidth, square) => {\n  const squareWidth = boardWidth / 8;\n  const columns = boardOrientation === 'white' ? whiteColumnValues : blackColumnValues;\n  const rows = boardOrientation === 'white' ? whiteRows : blackRows;\n  const x = columns[square[0]] * squareWidth + squareWidth / 2;\n  const y = rows[square[1] - 1] * squareWidth + squareWidth / 2;\n  return {\n    x,\n    y\n  };\n};\nconst isDifferentFromStart = newPosition => {\n  let isDifferent = false;\n  Object.keys(startPositionObject).forEach(square => {\n    if (newPosition[square] !== startPositionObject[square]) isDifferent = true;\n  });\n  Object.keys(newPosition).forEach(square => {\n    if (startPositionObject[square] !== newPosition[square]) isDifferent = true;\n  });\n  return isDifferent;\n};\nconst getPositionDifferences = (currentPosition, newPosition) => {\n  const difference = {\n    removed: {},\n    added: {}\n  }; // removed from current\n\n  Object.keys(currentPosition).forEach(square => {\n    if (newPosition[square] !== currentPosition[square]) difference.removed[square] = currentPosition[square];\n  }); // added from new\n\n  Object.keys(newPosition).forEach(square => {\n    if (currentPosition[square] !== newPosition[square]) difference.added[square] = newPosition[square];\n  });\n  return difference;\n};\n\nfunction isString(s) {\n  return typeof s === 'string';\n}\n\nfunction convertPositionToObject(position) {\n  if (position === 'start') return fenToObj('rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR');\n  if (validFen(position)) return fenToObj(position);\n  if (validPositionObject(position)) return position;\n  return {};\n}\nfunction fenToObj(fen) {\n  if (!validFen(fen)) return false; // cut off any move, castling, etc info from the end. we're only interested in position information\n\n  fen = fen.replace(/ .+$/, '');\n  const rows = fen.split('/');\n  const position = {};\n  let currentRow = 8;\n\n  for (let i = 0; i < 8; i++) {\n    const row = rows[i].split('');\n    let colIdx = 0; // loop through each character in the FEN section\n\n    for (let j = 0; j < row.length; j++) {\n      // number / empty squares\n      if (row[j].search(/[1-8]/) !== -1) {\n        const numEmptySquares = parseInt(row[j], 10);\n        colIdx = colIdx + numEmptySquares;\n      } else {\n        // piece\n        const square = COLUMNS[colIdx] + currentRow;\n        position[square] = fenToPieceCode(row[j]);\n        colIdx = colIdx + 1;\n      }\n    }\n\n    currentRow = currentRow - 1;\n  }\n\n  return position;\n}\n\nfunction expandFenEmptySquares(fen) {\n  return fen.replace(/8/g, '11111111').replace(/7/g, '1111111').replace(/6/g, '111111').replace(/5/g, '11111').replace(/4/g, '1111').replace(/3/g, '111').replace(/2/g, '11');\n}\n\nfunction validFen(fen) {\n  if (!isString(fen)) return false; // cut off any move, castling, etc info from the end. we're only interested in position information\n\n  fen = fen.replace(/ .+$/, ''); // expand the empty square numbers to just 1s\n\n  fen = expandFenEmptySquares(fen); // FEN should be 8 sections separated by slashes\n\n  const chunks = fen.split('/');\n  if (chunks.length !== 8) return false; // check each section\n\n  for (let i = 0; i < 8; i++) {\n    if (chunks[i].length !== 8 || chunks[i].search(/[^kqrnbpKQRNBP1]/) !== -1) {\n      return false;\n    }\n  }\n\n  return true;\n} // convert FEN piece code to bP, wK, etc\n\nfunction fenToPieceCode(piece) {\n  // black piece\n  if (piece.toLowerCase() === piece) {\n    return 'b' + piece.toUpperCase();\n  } // white piece\n\n\n  return 'w' + piece.toUpperCase();\n}\n\nfunction validSquare(square) {\n  return isString(square) && square.search(/^[a-h][1-8]$/) !== -1;\n}\n\nfunction validPieceCode(code) {\n  return isString(code) && code.search(/^[bw][KQRNBP]$/) !== -1;\n}\n\nfunction validPositionObject(pos) {\n  if (pos === null || typeof pos !== 'object') return false;\n\n  for (const i in pos) {\n    if (!pos[i]) continue;\n\n    if (!validSquare(i) || !validPieceCode(pos[i])) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nconst defaultPieces = {\n  wP: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsx(\"path\", {\n      d: \"m 22.5,9 c -2.21,0 -4,1.79 -4,4 0,0.89 0.29,1.71 0.78,2.38 C 17.33,16.5 16,18.59 16,21 c 0,2.03 0.94,3.84 2.41,5.03 C 15.41,27.09 11,31.58 11,39.5 H 34 C 34,31.58 29.59,27.09 26.59,26.03 28.06,24.84 29,23.03 29,21 29,18.59 27.67,16.5 25.72,15.38 26.21,14.71 26.5,13.89 26.5,13 c 0,-2.21 -1.79,-4 -4,-4 z\",\n      style: {\n        opacity: '1',\n        fill: '#ffffff',\n        fillOpacity: '1',\n        fillRule: 'nonzero',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'miter',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      }\n    })\n  }),\n  wR: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        opacity: '1',\n        fill: '#ffffff',\n        fillOpacity: '1',\n        fillRule: 'evenodd',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z \",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z \",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14\",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 34,14 L 31,17 L 14,17 L 11,14\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 31,17 L 31,29.5 L 14,29.5 L 14,17\",\n        style: {\n          strokeLinecap: 'butt',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 31,29.5 L 32.5,32 L 12.5,32 L 14,29.5\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 11,14 L 34,14\",\n        style: {\n          fill: 'none',\n          stroke: '#000000',\n          strokeLinejoin: 'miter'\n        }\n      })]\n    })\n  }),\n  wN: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        opacity: '1',\n        fill: 'none',\n        fillOpacity: '1',\n        fillRule: 'evenodd',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18\",\n        style: {\n          fill: '#ffffff',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10\",\n        style: {\n          fill: '#ffffff',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z\",\n        style: {\n          fill: '#000000',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z\",\n        transform: \"matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)\",\n        style: {\n          fill: '#000000',\n          stroke: '#000000'\n        }\n      })]\n    })\n  }),\n  wB: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        opacity: '1',\n        fill: 'none',\n        fillRule: 'evenodd',\n        fillOpacity: '1',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsxs(\"g\", {\n        style: {\n          fill: '#ffffff',\n          stroke: '#000000',\n          strokeLinecap: 'butt'\n        },\n        children: [/*#__PURE__*/jsx(\"path\", {\n          d: \"M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.65,38.99 6.68,38.97 6,38 C 7.35,36.54 9,36 9,36 z\"\n        }), /*#__PURE__*/jsx(\"path\", {\n          d: \"M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z\"\n        }), /*#__PURE__*/jsx(\"path\", {\n          d: \"M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z\"\n        })]\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18\",\n        style: {\n          fill: 'none',\n          stroke: '#000000',\n          strokeLinejoin: 'miter'\n        }\n      })]\n    })\n  }),\n  wQ: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        fill: '#ffffff',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinejoin: 'round'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 9,26 C 17.5,24.5 30,24.5 36,26 L 38.5,13.5 L 31,25 L 30.7,10.9 L 25.5,24.5 L 22.5,10 L 19.5,24.5 L 14.3,10.9 L 14,25 L 6.5,13.5 L 9,26 z\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 11,36 11,36 C 9.5,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 11.5,30 C 15,29 30,29 33.5,30\",\n        style: {\n          fill: 'none'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12,33.5 C 18,32.5 27,32.5 33,33.5\",\n        style: {\n          fill: 'none'\n        }\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"6\",\n        cy: \"12\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"14\",\n        cy: \"9\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"22.5\",\n        cy: \"8\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"31\",\n        cy: \"9\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"39\",\n        cy: \"12\",\n        r: \"2\"\n      })]\n    })\n  }),\n  wK: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        fill: 'none',\n        fillOpacity: '1',\n        fillRule: 'evenodd',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 22.5,11.63 L 22.5,6\",\n        style: {\n          fill: 'none',\n          stroke: '#000000',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 20,8 L 25,8\",\n        style: {\n          fill: 'none',\n          stroke: '#000000',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25\",\n        style: {\n          fill: '#ffffff',\n          stroke: '#000000',\n          strokeLinecap: 'butt',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12.5,37 C 18,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 20,16 10.5,13 6.5,19.5 C 3.5,25.5 12.5,30 12.5,30 L 12.5,37\",\n        style: {\n          fill: '#ffffff',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12.5,30 C 18,27 27,27 32.5,30\",\n        style: {\n          fill: 'none',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12.5,33.5 C 18,30.5 27,30.5 32.5,33.5\",\n        style: {\n          fill: 'none',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12.5,37 C 18,34 27,34 32.5,37\",\n        style: {\n          fill: 'none',\n          stroke: '#000000'\n        }\n      })]\n    })\n  }),\n  bP: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsx(\"path\", {\n      d: \"m 22.5,9 c -2.21,0 -4,1.79 -4,4 0,0.89 0.29,1.71 0.78,2.38 C 17.33,16.5 16,18.59 16,21 c 0,2.03 0.94,3.84 2.41,5.03 C 15.41,27.09 11,31.58 11,39.5 H 34 C 34,31.58 29.59,27.09 26.59,26.03 28.06,24.84 29,23.03 29,21 29,18.59 27.67,16.5 25.72,15.38 26.21,14.71 26.5,13.89 26.5,13 c 0,-2.21 -1.79,-4 -4,-4 z\",\n      style: {\n        opacity: '1',\n        fill: '#000000',\n        fillOpacity: '1',\n        fillRule: 'nonzero',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'miter',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      }\n    })\n  }),\n  bR: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        opacity: '1',\n        fill: '#000000',\n        fillOpacity: '1',\n        fillRule: 'evenodd',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z \",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12.5,32 L 14,29.5 L 31,29.5 L 32.5,32 L 12.5,32 z \",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z \",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 14,29.5 L 14,16.5 L 31,16.5 L 31,29.5 L 14,29.5 z \",\n        style: {\n          strokeLinecap: 'butt',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 14,16.5 L 11,14 L 34,14 L 31,16.5 L 14,16.5 z \",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14 L 11,14 z \",\n        style: {\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12,35.5 L 33,35.5 L 33,35.5\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff',\n          strokeWidth: '1',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 13,31.5 L 32,31.5\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff',\n          strokeWidth: '1',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 14,29.5 L 31,29.5\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff',\n          strokeWidth: '1',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 14,16.5 L 31,16.5\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff',\n          strokeWidth: '1',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 11,14 L 34,14\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff',\n          strokeWidth: '1',\n          strokeLinejoin: 'miter'\n        }\n      })]\n    })\n  }),\n  bN: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        opacity: '1',\n        fill: 'none',\n        fillOpacity: '1',\n        fillRule: 'evenodd',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18\",\n        style: {\n          fill: '#000000',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10\",\n        style: {\n          fill: '#000000',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z\",\n        style: {\n          fill: '#ffffff',\n          stroke: '#ffffff'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z\",\n        transform: \"matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)\",\n        style: {\n          fill: '#ffffff',\n          stroke: '#ffffff'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 24.55,10.4 L 24.1,11.85 L 24.6,12 C 27.75,13 30.25,14.49 32.5,18.75 C 34.75,23.01 35.75,29.06 35.25,39 L 35.2,39.5 L 37.45,39.5 L 37.5,39 C 38,28.94 36.62,22.15 34.25,17.66 C 31.88,13.17 28.46,11.02 25.06,10.5 L 24.55,10.4 z \",\n        style: {\n          fill: '#ffffff',\n          stroke: 'none'\n        }\n      })]\n    })\n  }),\n  bB: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        opacity: '1',\n        fill: 'none',\n        fillRule: 'evenodd',\n        fillOpacity: '1',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsxs(\"g\", {\n        style: {\n          fill: '#000000',\n          stroke: '#000000',\n          strokeLinecap: 'butt'\n        },\n        children: [/*#__PURE__*/jsx(\"path\", {\n          d: \"M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.65,38.99 6.68,38.97 6,38 C 7.35,36.54 9,36 9,36 z\"\n        }), /*#__PURE__*/jsx(\"path\", {\n          d: \"M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z\"\n        }), /*#__PURE__*/jsx(\"path\", {\n          d: \"M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z\"\n        })]\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff',\n          strokeLinejoin: 'miter'\n        }\n      })]\n    })\n  }),\n  bQ: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        fill: '#000000',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 9,26 C 17.5,24.5 30,24.5 36,26 L 38.5,13.5 L 31,25 L 30.7,10.9 L 25.5,24.5 L 22.5,10 L 19.5,24.5 L 14.3,10.9 L 14,25 L 6.5,13.5 L 9,26 z\",\n        style: {\n          strokeLinecap: 'butt',\n          fill: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"m 9,26 c 0,2 1.5,2 2.5,4 1,1.5 1,1 0.5,3.5 -1.5,1 -1,2.5 -1,2.5 -1.5,1.5 0,2.5 0,2.5 6.5,1 16.5,1 23,0 0,0 1.5,-1 0,-2.5 0,0 0.5,-1.5 -1,-2.5 -0.5,-2.5 -0.5,-2 0.5,-3.5 1,-2 2.5,-2 2.5,-4 -8.5,-1.5 -18.5,-1.5 -27,0 z\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 11.5,30 C 15,29 30,29 33.5,30\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"m 12,33.5 c 6,-1 15,-1 21,0\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"6\",\n        cy: \"12\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"14\",\n        cy: \"9\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"22.5\",\n        cy: \"8\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"31\",\n        cy: \"9\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"circle\", {\n        cx: \"39\",\n        cy: \"12\",\n        r: \"2\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 11,38.5 A 35,35 1 0 0 34,38.5\",\n        style: {\n          fill: 'none',\n          stroke: '#000000',\n          strokeLinecap: 'butt'\n        }\n      }), /*#__PURE__*/jsxs(\"g\", {\n        style: {\n          fill: 'none',\n          stroke: '#ffffff'\n        },\n        children: [/*#__PURE__*/jsx(\"path\", {\n          d: \"M 11,29 A 35,35 1 0 1 34,29\"\n        }), /*#__PURE__*/jsx(\"path\", {\n          d: \"M 12.5,31.5 L 32.5,31.5\"\n        }), /*#__PURE__*/jsx(\"path\", {\n          d: \"M 11.5,34.5 A 35,35 1 0 0 33.5,34.5\"\n        }), /*#__PURE__*/jsx(\"path\", {\n          d: \"M 10.5,37.5 A 35,35 1 0 0 34.5,37.5\"\n        })]\n      })]\n    })\n  }),\n  bK: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    width: \"45\",\n    height: \"45\",\n    children: /*#__PURE__*/jsxs(\"g\", {\n      style: {\n        fill: 'none',\n        fillOpacity: '1',\n        fillRule: 'evenodd',\n        stroke: '#000000',\n        strokeWidth: '1.5',\n        strokeLinecap: 'round',\n        strokeLinejoin: 'round',\n        strokeMiterlimit: '4',\n        strokeDasharray: 'none',\n        strokeOpacity: '1'\n      },\n      children: [/*#__PURE__*/jsx(\"path\", {\n        d: \"M 22.5,11.63 L 22.5,6\",\n        style: {\n          fill: 'none',\n          stroke: '#000000',\n          strokeLinejoin: 'miter'\n        },\n        id: \"path6570\"\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25\",\n        style: {\n          fill: '#000000',\n          fillOpacity: '1',\n          strokeLinecap: 'butt',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12.5,37 C 18,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 20,16 10.5,13 6.5,19.5 C 3.5,25.5 12.5,30 12.5,30 L 12.5,37\",\n        style: {\n          fill: '#000000',\n          stroke: '#000000'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 20,8 L 25,8\",\n        style: {\n          fill: 'none',\n          stroke: '#000000',\n          strokeLinejoin: 'miter'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 32,29.5 C 32,29.5 40.5,25.5 38.03,19.85 C 34.15,14 25,18 22.5,24.5 L 22.5,26.6 L 22.5,24.5 C 20,18 10.85,14 6.97,19.85 C 4.5,25.5 13,29.5 13,29.5\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff'\n        }\n      }), /*#__PURE__*/jsx(\"path\", {\n        d: \"M 12.5,30 C 18,27 27,27 32.5,30 M 12.5,33.5 C 18,30.5 27,30.5 32.5,33.5 M 12.5,37 C 18,34 27,34 32.5,37\",\n        style: {\n          fill: 'none',\n          stroke: '#ffffff'\n        }\n      })]\n    })\n  })\n};\n\nconst ChessboardContext = /*#__PURE__*/React.createContext();\nconst useChessboard = () => useContext(ChessboardContext);\nconst ChessboardProvider = /*#__PURE__*/forwardRef(({\n  animationDuration,\n  areArrowsAllowed,\n  arePiecesDraggable,\n  arePremovesAllowed,\n  boardOrientation,\n  boardWidth,\n  clearPremovesOnRightClick,\n  customArrows,\n  customArrowColor,\n  customBoardStyle,\n  customDarkSquareStyle,\n  customDropSquareStyle,\n  customLightSquareStyle,\n  customPieces,\n  customPremoveDarkSquareStyle,\n  customPremoveLightSquareStyle,\n  customSquareStyles,\n  dropOffBoardAction,\n  id,\n  isDraggablePiece,\n  getPositionObject,\n  onArrowsChange,\n  onDragOverSquare,\n  onMouseOutSquare,\n  onMouseOverSquare,\n  onPieceClick,\n  onPieceDragBegin,\n  onPieceDragEnd,\n  onPieceDrop,\n  onSquareClick,\n  onSquareRightClick,\n  position,\n  showBoardNotation,\n  showSparePieces,\n  snapToCursor,\n  children\n}, ref) => {\n  // position stored and displayed on board\n  const [currentPosition, setCurrentPosition] = useState(convertPositionToObject(position)); // calculated differences between current and incoming positions\n\n  const [positionDifferences, setPositionDifferences] = useState({}); // colour of last piece moved to determine if premoving\n\n  const [lastPieceColour, setLastPieceColour] = useState(undefined); // current premoves\n\n  const [premoves, setPremoves] = useState([]); // ref used to access current value during timeouts (closures)\n\n  const premovesRef = useRef(premoves); // current right mouse down square\n\n  const [currentRightClickDown, setCurrentRightClickDown] = useState(); // current arrows\n\n  const [arrows, setArrows] = useState([]); // chess pieces/styling\n\n  const [chessPieces, setChessPieces] = useState({ ...defaultPieces,\n    ...customPieces\n  }); // whether the last move was a manual drop or not\n\n  const [manualDrop, setManualDrop] = useState(false); // the most recent timeout whilst waiting for animation to complete\n\n  const [previousTimeout, setPreviousTimeout] = useState(undefined); // if currently waiting for an animation to finish\n\n  const [waitingForAnimation, setWaitingForAnimation] = useState(false); // open clearPremoves() to allow user to call on undo/reset/whenever\n\n  useImperativeHandle(ref, () => ({\n    clearPremoves(clearLastPieceColour = true) {\n      clearPremoves(clearLastPieceColour);\n    }\n\n  })); // handle custom pieces change\n\n  useEffect(() => {\n    setChessPieces({ ...defaultPieces,\n      ...customPieces\n    });\n  }, [customPieces]); // handle external position change\n\n  useEffect(() => {\n    var _Object$keys, _Object$entries, _Object$entries$;\n\n    const newPosition = convertPositionToObject(position);\n    const differences = getPositionDifferences(currentPosition, newPosition);\n    const newPieceColour = ((_Object$keys = Object.keys(differences.added)) === null || _Object$keys === void 0 ? void 0 : _Object$keys.length) <= 2 ? (_Object$entries = Object.entries(differences.added)) === null || _Object$entries === void 0 ? void 0 : (_Object$entries$ = _Object$entries[0]) === null || _Object$entries$ === void 0 ? void 0 : _Object$entries$[1][0] : undefined; // external move has come in before animation is over\n    // cancel animation and immediately update position\n\n    if (waitingForAnimation) {\n      setCurrentPosition(newPosition);\n      setWaitingForAnimation(false);\n      arePremovesAllowed && attemptPremove(newPieceColour);\n\n      if (previousTimeout) {\n        clearTimeout(previousTimeout);\n      }\n    } else {\n      // move was made using drag and drop\n      if (manualDrop) {\n        setCurrentPosition(newPosition);\n        setWaitingForAnimation(false);\n        arePremovesAllowed && attemptPremove(newPieceColour);\n      } else {\n        // move was made by external position change\n        // if position === start then don't override newPieceColour\n        // needs isDifferentFromStart in scenario where premoves have been cleared upon board reset but first move is made by computer, the last move colour would need to be updated\n        if (isDifferentFromStart(newPosition) && lastPieceColour !== undefined) {\n          setLastPieceColour(newPieceColour);\n        } else {\n          // position === start, likely a board reset\n          setLastPieceColour(undefined);\n        }\n\n        setPositionDifferences(differences); // animate external move\n\n        setWaitingForAnimation(true);\n        const newTimeout = setTimeout(() => {\n          setCurrentPosition(newPosition);\n          setWaitingForAnimation(false);\n          arePremovesAllowed && attemptPremove(newPieceColour);\n        }, animationDuration);\n        setPreviousTimeout(newTimeout);\n      }\n    } // reset manual drop, ready for next move to be made by user or external\n\n\n    setManualDrop(false); // inform latest position information\n\n    getPositionObject(newPosition); // clear arrows\n\n    clearArrows(); // clear timeout on unmount\n\n    return () => {\n      clearTimeout(previousTimeout);\n    };\n  }, [position]); // handle external arrows change\n\n  useEffect(() => {\n    setArrows(customArrows);\n  }, [customArrows]); // callback when new arrows are set\n\n  useEffect(() => {\n    onArrowsChange(arrows);\n  }, [arrows]); // handle drop position change\n\n  function handleSetPosition(sourceSq, targetSq, piece) {\n    // if dropped back down, don't do anything\n    if (sourceSq === targetSq) {\n      return;\n    }\n\n    clearArrows(); // if second move is made for same colour, or there are still premoves queued, then this move needs to be added to premove queue instead of played\n    // premoves length check for colour is added in because white could make 3 premoves, and then black responds to the first move (changing the last piece colour) and then white pre-moves again\n\n    if (arePremovesAllowed && waitingForAnimation || arePremovesAllowed && (lastPieceColour === piece[0] || premovesRef.current.filter(p => p.piece[0] === piece[0]).length > 0)) {\n      const oldPremoves = [...premovesRef.current];\n      oldPremoves.push({\n        sourceSq,\n        targetSq,\n        piece\n      });\n      premovesRef.current = oldPremoves;\n      setPremoves([...oldPremoves]);\n      return;\n    } // if transitioning, don't allow new drop\n\n\n    if (!arePremovesAllowed && waitingForAnimation) return;\n    const newOnDropPosition = { ...currentPosition\n    };\n    setManualDrop(true);\n    setLastPieceColour(piece[0]); // if onPieceDrop function provided, execute it, position must be updated externally and captured by useEffect above for this move to show on board\n\n    if (onPieceDrop.length) {\n      const isValidMove = onPieceDrop(sourceSq, targetSq, piece);\n      if (!isValidMove) clearPremoves();\n    } else {\n      // delete if dropping off board\n      if (dropOffBoardAction === 'trash' && !targetSq) {\n        delete newOnDropPosition[sourceSq];\n      } // delete source piece if not dropping from spare piece\n\n\n      if (sourceSq !== 'spare') {\n        delete newOnDropPosition[sourceSq];\n      } // add piece in new position\n\n\n      newOnDropPosition[targetSq] = piece;\n      setCurrentPosition(newOnDropPosition);\n    } // inform latest position information\n\n\n    getPositionObject(newOnDropPosition);\n  }\n\n  function attemptPremove(newPieceColour) {\n    if (premovesRef.current.length === 0) return; // get current value of premove as this is called in a timeout so value may have changed since timeout was set\n\n    const premove = premovesRef.current[0]; // if premove is a differing colour to last move made, then this move can be made\n\n    if (premove.piece[0] !== undefined && premove.piece[0] !== newPieceColour && onPieceDrop.length) {\n      setLastPieceColour(premove.piece[0]);\n      setManualDrop(true); // pre-move doesn't need animation\n\n      const isValidMove = onPieceDrop(premove.sourceSq, premove.targetSq, premove.piece); // premove was successful and can be removed from queue\n\n      if (isValidMove) {\n        const oldPremoves = [...premovesRef.current];\n        oldPremoves.shift();\n        premovesRef.current = oldPremoves;\n        setPremoves([...oldPremoves]);\n      } else {\n        // premove wasn't successful, clear premove queue\n        clearPremoves();\n      }\n    }\n  }\n\n  function clearPremoves(clearLastPieceColour = true) {\n    // don't clear when right clicking to clear, otherwise you won't be able to premove again before next go\n    if (clearLastPieceColour) setLastPieceColour(undefined);\n    premovesRef.current = [];\n    setPremoves([]);\n  }\n\n  function onRightClickDown(square) {\n    setCurrentRightClickDown(square);\n  }\n\n  function onRightClickUp(square) {\n    if (!areArrowsAllowed) return;\n\n    if (currentRightClickDown) {\n      // same square, don't draw an arrow, but do clear premoves and run onSquareRightClick\n      if (currentRightClickDown === square) {\n        setCurrentRightClickDown(null);\n        clearPremovesOnRightClick && clearPremoves(false);\n        onSquareRightClick(square);\n        return;\n      } // if arrow already exists then it needs to be removed\n\n\n      for (const i in arrows) {\n        if (arrows[i][0] === currentRightClickDown && arrows[i][1] === square) {\n          setArrows(oldArrows => {\n            const newArrows = [...oldArrows];\n            newArrows.splice(i, 1);\n            return newArrows;\n          });\n          return;\n        }\n      } // different square, draw an arrow\n\n\n      setArrows(oldArrows => [...oldArrows, [currentRightClickDown, square]]);\n    } else setCurrentRightClickDown(null);\n  }\n\n  function clearCurrentRightClickDown() {\n    setCurrentRightClickDown(null);\n  }\n\n  function clearArrows() {\n    setArrows([]);\n  }\n\n  return /*#__PURE__*/jsx(ChessboardContext.Provider, {\n    value: {\n      animationDuration,\n      arePiecesDraggable,\n      arePremovesAllowed,\n      boardOrientation,\n      boardWidth,\n      customArrowColor,\n      customBoardStyle,\n      customDarkSquareStyle,\n      customDropSquareStyle,\n      customLightSquareStyle,\n      customPremoveDarkSquareStyle,\n      customPremoveLightSquareStyle,\n      customSquareStyles,\n      dropOffBoardAction,\n      id,\n      isDraggablePiece,\n      getPositionObject,\n      onDragOverSquare,\n      onMouseOutSquare,\n      onMouseOverSquare,\n      onPieceClick,\n      onPieceDragBegin,\n      onPieceDragEnd,\n      onPieceDrop,\n      onSquareClick,\n      onSquareRightClick,\n      showBoardNotation,\n      showSparePieces,\n      snapToCursor,\n      arrows,\n      chessPieces,\n      clearArrows,\n      clearCurrentRightClickDown,\n      clearPremoves,\n      currentPosition,\n      handleSetPosition,\n      lastPieceColour,\n      manualDrop,\n      onRightClickDown,\n      onRightClickUp,\n      positionDifferences,\n      premoves,\n      setChessPieces,\n      setCurrentPosition,\n      setManualDrop,\n      waitingForAnimation\n    },\n    children: children\n  });\n});\n\nfunction Notation({\n  row,\n  col\n}) {\n  const {\n    boardOrientation,\n    boardWidth,\n    customDarkSquareStyle,\n    customLightSquareStyle\n  } = useChessboard();\n  const whiteColor = customLightSquareStyle.backgroundColor;\n  const blackColor = customDarkSquareStyle.backgroundColor;\n  const isRow = col === 0;\n  const isColumn = row === 7;\n  const isBottomLeftSquare = isRow && isColumn;\n\n  function getRow() {\n    return boardOrientation === 'white' ? 8 - row : row + 1;\n  }\n\n  function getColumn() {\n    return boardOrientation === 'black' ? COLUMNS[7 - col] : COLUMNS[col];\n  }\n\n  function renderBottomLeft() {\n    return /*#__PURE__*/jsxs(Fragment, {\n      children: [/*#__PURE__*/jsx(\"div\", {\n        style: { ...notationStyle,\n          ...{\n            color: whiteColor\n          },\n          ...numericStyle(boardWidth)\n        },\n        children: getRow()\n      }), /*#__PURE__*/jsx(\"div\", {\n        style: { ...notationStyle,\n          ...{\n            color: whiteColor\n          },\n          ...alphaStyle(boardWidth)\n        },\n        children: getColumn()\n      })]\n    });\n  }\n\n  function renderLetters() {\n    return /*#__PURE__*/jsx(\"div\", {\n      style: { ...notationStyle,\n        ...{\n          color: col % 2 !== 0 ? blackColor : whiteColor\n        },\n        ...alphaStyle(boardWidth)\n      },\n      children: getColumn()\n    });\n  }\n\n  function renderNumbers() {\n    return /*#__PURE__*/jsx(\"div\", {\n      style: { ...notationStyle,\n        ...(boardOrientation === 'black' ? {\n          color: row % 2 === 0 ? blackColor : whiteColor\n        } : {\n          color: row % 2 === 0 ? blackColor : whiteColor\n        }),\n        ...numericStyle(boardWidth)\n      },\n      children: getRow()\n    });\n  }\n\n  if (isBottomLeftSquare) {\n    return renderBottomLeft();\n  }\n\n  if (isColumn) {\n    return renderLetters();\n  }\n\n  if (isRow) {\n    return renderNumbers();\n  }\n\n  return null;\n}\n\nconst alphaStyle = width => ({\n  alignSelf: 'flex-end',\n  paddingLeft: width / 8 - width / 48,\n  fontSize: width / 48\n});\n\nconst numericStyle = width => ({\n  alignSelf: 'flex-start',\n  paddingRight: width / 8 - width / 48,\n  fontSize: width / 48\n});\n\nconst notationStyle = {\n  zIndex: 3,\n  position: 'absolute'\n};\n\nfunction Piece({\n  piece,\n  square,\n  squares,\n  isPremovedPiece = false\n}) {\n  const {\n    animationDuration,\n    arePiecesDraggable,\n    arePremovesAllowed,\n    boardWidth,\n    id,\n    isDraggablePiece,\n    onPieceClick,\n    onPieceDragBegin,\n    onPieceDragEnd,\n    premoves,\n    chessPieces,\n    dropTarget,\n    positionDifferences,\n    waitingForAnimation,\n    currentPosition\n  } = useChessboard();\n  const [pieceStyle, setPieceStyle] = useState({\n    opacity: 1,\n    zIndex: 5,\n    touchAction: 'none',\n    cursor: arePiecesDraggable && isDraggablePiece({\n      piece,\n      sourceSquare: square\n    }) ? '-webkit-grab' : 'default'\n  });\n  const [{\n    canDrag,\n    isDragging\n  }, drag, dragPreview] = useDrag(() => ({\n    type: 'piece',\n    item: () => {\n      onPieceDragBegin(piece, square);\n      return {\n        piece,\n        square,\n        id\n      };\n    },\n    end: () => onPieceDragEnd(piece, square),\n    collect: monitor => ({\n      canDrag: isDraggablePiece({\n        piece,\n        sourceSquare: square\n      }),\n      isDragging: !!monitor.isDragging()\n    })\n  }), [piece, square, currentPosition, id]); // hide the default preview\n\n  dragPreview(getEmptyImage(), {\n    captureDraggingState: true\n  }); // hide piece on drag\n\n  useEffect(() => {\n    setPieceStyle(oldPieceStyle => ({ ...oldPieceStyle,\n      opacity: isDragging ? 0 : 1\n    }));\n  }, [isDragging]); // hide piece on matching premoves\n\n  useEffect(() => {\n    // if premoves aren't allowed, don't waste time on calculations\n    if (!arePremovesAllowed) return;\n    let hidePiece = false; // side effect: if piece moves into pre-moved square, its hidden\n    // if there are any premove targets on this square, hide the piece underneath\n\n    if (!isPremovedPiece && premoves.find(p => p.targetSq === square)) hidePiece = true; // if sourceSq === sq and piece matches then this piece has been pre-moved elsewhere?\n\n    if (premoves.find(p => p.sourceSq === square && p.piece === piece)) hidePiece = true; // TODO: If a premoved piece returns to a premoved square, it will hide (e1, e2, e1)\n\n    setPieceStyle(oldPieceStyle => ({ ...oldPieceStyle,\n      display: hidePiece ? 'none' : 'unset'\n    }));\n  }, [currentPosition, premoves]); // new move has come in\n  // if waiting for animation, then animation has started and we can perform animation\n  // we need to head towards where we need to go, we are the source, we are heading towards the target\n\n  useEffect(() => {\n    var _positionDifferences$;\n\n    const removedPiece = (_positionDifferences$ = positionDifferences.removed) === null || _positionDifferences$ === void 0 ? void 0 : _positionDifferences$[square]; // return as null and not loaded yet\n\n    if (!positionDifferences.added) return; // check if piece matches or if removed piece was a pawn and new square is on 1st or 8th rank (promotion)\n\n    const newSquare = Object.entries(positionDifferences.added).find(([s, p]) => p === removedPiece || (removedPiece === null || removedPiece === void 0 ? void 0 : removedPiece[1]) === 'P' && (s[1] === '1' || s[1] === '8')); // we can perform animation if our square was in removed, AND the matching piece is in added AND this isn't a premoved piece\n\n    if (waitingForAnimation && removedPiece && newSquare && !isPremovedPiece) {\n      const {\n        sourceSq,\n        targetSq\n      } = getSquareCoordinates(square, newSquare[0]);\n\n      if (sourceSq && targetSq) {\n        setPieceStyle(oldPieceStyle => ({ ...oldPieceStyle,\n          transform: `translate(${targetSq.x - sourceSq.x}px, ${targetSq.y - sourceSq.y}px)`,\n          transition: `transform ${animationDuration}ms`,\n          zIndex: 6\n        }));\n      }\n    }\n  }, [positionDifferences]); // translate to their own positions (repaint on undo)\n\n  useEffect(() => {\n    const {\n      sourceSq\n    } = getSingleSquareCoordinates(square);\n\n    if (sourceSq) {\n      setPieceStyle(oldPieceStyle => ({ ...oldPieceStyle,\n        transform: `translate(${0}px, ${0}px)`,\n        transition: `transform ${0}ms`\n      }));\n    }\n  }, [currentPosition]); // update is piece draggable\n\n  useEffect(() => {\n    setPieceStyle(oldPieceStyle => ({ ...oldPieceStyle,\n      cursor: arePiecesDraggable && isDraggablePiece({\n        piece,\n        sourceSquare: square\n      }) ? '-webkit-grab' : 'default'\n    }));\n  }, [square, currentPosition, arePiecesDraggable]);\n\n  function getSingleSquareCoordinates(square) {\n    return {\n      sourceSq: squares[square]\n    };\n  }\n\n  function getSquareCoordinates(sourceSquare, targetSquare) {\n    return {\n      sourceSq: squares[sourceSquare],\n      targetSq: squares[targetSquare]\n    };\n  }\n\n  return /*#__PURE__*/jsx(\"div\", {\n    ref: arePiecesDraggable ? canDrag ? drag : null : null,\n    onClick: () => onPieceClick(piece),\n    style: pieceStyle,\n    children: typeof chessPieces[piece] === 'function' ? chessPieces[piece]({\n      squareWidth: boardWidth / 8,\n      isDragging,\n      droppedPiece: dropTarget === null || dropTarget === void 0 ? void 0 : dropTarget.piece,\n      targetSquare: dropTarget === null || dropTarget === void 0 ? void 0 : dropTarget.target,\n      sourceSquare: dropTarget === null || dropTarget === void 0 ? void 0 : dropTarget.source\n    }) : /*#__PURE__*/jsx(\"svg\", {\n      viewBox: '1 1 43 43',\n      width: boardWidth / 8,\n      height: boardWidth / 8,\n      children: /*#__PURE__*/jsx(\"g\", {\n        children: chessPieces[piece]\n      })\n    })\n  });\n}\n\nfunction Square({\n  square,\n  squareColor,\n  setSquares,\n  squareHasPremove,\n  children\n}) {\n  const squareRef = useRef();\n  const {\n    boardWidth,\n    boardOrientation,\n    clearArrows,\n    currentPosition,\n    customBoardStyle,\n    customDarkSquareStyle,\n    customDropSquareStyle,\n    customLightSquareStyle,\n    customPremoveDarkSquareStyle,\n    customPremoveLightSquareStyle,\n    customSquareStyles,\n    handleSetPosition,\n    lastPieceColour,\n    onDragOverSquare,\n    onMouseOutSquare,\n    onMouseOverSquare,\n    onPieceDrop,\n    onRightClickDown,\n    onRightClickUp,\n    onSquareClick,\n    waitingForAnimation\n  } = useChessboard();\n  const [{\n    isOver\n  }, drop] = useDrop(() => ({\n    accept: 'piece',\n    drop: item => handleSetPosition(item.square, square, item.piece),\n    collect: monitor => ({\n      isOver: !!monitor.isOver()\n    })\n  }), [square, currentPosition, onPieceDrop, waitingForAnimation, lastPieceColour]);\n  useEffect(() => {\n    const {\n      x,\n      y\n    } = squareRef.current.getBoundingClientRect();\n    setSquares(oldSquares => ({ ...oldSquares,\n      [square]: {\n        x,\n        y\n      }\n    }));\n  }, [boardWidth, boardOrientation]);\n  const defaultSquareStyle = { ...borderRadius(customBoardStyle, square, boardOrientation),\n    ...(squareColor === 'black' ? customDarkSquareStyle : customLightSquareStyle),\n    ...(squareHasPremove && (squareColor === 'black' ? customPremoveDarkSquareStyle : customPremoveLightSquareStyle)),\n    ...(isOver && customDropSquareStyle)\n  };\n  return /*#__PURE__*/jsx(\"div\", {\n    ref: drop,\n    style: defaultSquareStyle,\n    \"data-square-color\": squareColor,\n    \"data-square\": square,\n    onMouseOver: e => {\n      // noop if moving from child of square into square.\n      if (e.relatedTarget && e.currentTarget.contains(e.relatedTarget)) return;\n      onMouseOverSquare(square);\n    },\n    onMouseOut: e => {\n      // noop if moving from square into a child of square.\n      if (e.relatedTarget && e.currentTarget.contains(e.relatedTarget)) return;\n      onMouseOutSquare(square);\n    },\n    onMouseDown: e => {\n      if (e.button === 2) onRightClickDown(square);\n    },\n    onMouseUp: e => {\n      if (e.button === 2) onRightClickUp(square);\n    },\n    onDragEnter: () => onDragOverSquare(square),\n    onClick: () => {\n      onSquareClick(square);\n      clearArrows();\n    },\n    onContextMenu: e => {\n      e.preventDefault();\n    },\n    children: /*#__PURE__*/jsx(\"div\", {\n      ref: squareRef,\n      style: { ...size(boardWidth),\n        ...center,\n        ...(!squareHasPremove && (customSquareStyles === null || customSquareStyles === void 0 ? void 0 : customSquareStyles[square]))\n      },\n      children: children\n    })\n  });\n}\nconst center = {\n  display: 'flex',\n  justifyContent: 'center'\n};\n\nconst size = width => ({\n  width: width / 8,\n  height: width / 8\n});\n\nconst borderRadius = (customBoardStyle, square, boardOrientation) => {\n  if (!customBoardStyle.borderRadius) return {};\n\n  if (square === 'a1') {\n    return boardOrientation === 'white' ? {\n      borderBottomLeftRadius: customBoardStyle.borderRadius\n    } : {\n      borderTopRightRadius: customBoardStyle.borderRadius\n    };\n  }\n\n  if (square === 'a8') {\n    return boardOrientation === 'white' ? {\n      borderTopLeftRadius: customBoardStyle.borderRadius\n    } : {\n      borderBottomRightRadius: customBoardStyle.borderRadius\n    };\n  }\n\n  if (square === 'h1') {\n    return boardOrientation === 'white' ? {\n      borderBottomRightRadius: customBoardStyle.borderRadius\n    } : {\n      borderTopLeftRadius: customBoardStyle.borderRadius\n    };\n  }\n\n  if (square === 'h8') {\n    return boardOrientation === 'white' ? {\n      borderTopRightRadius: customBoardStyle.borderRadius\n    } : {\n      borderBottomLeftRadius: customBoardStyle.borderRadius\n    };\n  }\n\n  return {};\n};\n\nfunction Squares({\n  children\n}) {\n  const {\n    boardOrientation,\n    boardWidth,\n    customBoardStyle,\n    id\n  } = useChessboard();\n  return /*#__PURE__*/jsx(\"div\", {\n    \"data-boardid\": id,\n    style: { ...boardStyles(boardWidth),\n      ...customBoardStyle\n    },\n    children: [...Array(8)].map((_, r) => {\n      return /*#__PURE__*/jsx(\"div\", {\n        style: rowStyles(boardWidth),\n        children: [...Array(8)].map((_, c) => {\n          // a1, a2 ...\n          const square = boardOrientation === 'black' ? COLUMNS[7 - c] + (r + 1) : COLUMNS[c] + (8 - r);\n          const squareColor = c % 2 === r % 2 ? 'white' : 'black';\n          return children({\n            square,\n            squareColor,\n            col: c,\n            row: r\n          });\n        })\n      }, r.toString());\n    })\n  });\n}\n\nconst boardStyles = width => ({\n  cursor: 'default',\n  height: width,\n  width\n});\n\nconst rowStyles = width => ({\n  display: 'flex',\n  flexWrap: 'nowrap',\n  width\n});\n\nconst errorImage = {\n  whiteKing: /*#__PURE__*/jsx(\"svg\", {\n    xmlns: \"http://www.w3.org/2000/svg\",\n    version: \"1.1\",\n    style: {\n      shapeRendering: 'geometricPrecision',\n      textRendering: 'geometricPrecision',\n      imageRendering: 'optimizeQuality'\n    },\n    viewBox: \"0 0 4210 12970\",\n    x: \"0px\",\n    y: \"0px\",\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    width: \"250\",\n    height: \"250\",\n    children: /*#__PURE__*/jsx(\"g\", {\n      children: /*#__PURE__*/jsx(\"path\", {\n        style: {\n          fill: 'black',\n          fillRule: 'nonzero'\n        },\n        d: \"M2105 0c169,0 286,160 249,315l200 0c-172,266 -231,479 -256,792 315,-24 530,-86 792,-255l0 897c-265,-171 -479,-231 -792,-256 18,234 75,495 185,682l339 0c233,0 369,269 225,456l545 0 -595 1916c130,94 158,275 59,402 465,0 416,568 51,568l-334 0 465 2867 332 0c250,0 381,306 199,485 162,63 273,220 273,399l0 633 168 0 0 475c-1403,0 -2807,0 -4210,0l0 -475 167 0 0 -633c0,-179 112,-336 274,-399 -181,-178 -52,-485 199,-485l332 0 465 -2867 -335 0c-353,0 -418,-568 51,-568 -98,-127 -70,-308 59,-402l-594 -1916c181,0 363,0 545,0 -144,-187 -9,-456 225,-456l339 0c110,-187 167,-448 185,-682 -315,25 -530,87 -793,256l0 -897c266,171 480,231 793,255 -25,-315 -87,-529 -256,-792l199 0c-36,-155 81,-315 250,-315zm-1994 10012l0 253 3988 0 0 -253c-1330,0 -2659,0 -3988,0zm484 -1060c-174,0 -316,142 -316,316l0 633 3652 0 0 -633c0,-174 -142,-316 -316,-316 -1007,0 -2013,0 -3020,0zm45 -457c-230,0 -225,345 0,345l2930 0c230,0 225,-345 0,-345 -977,0 -1953,0 -2930,0zm2020 -2978l-1111 0 -465 2867 2041 0 -465 -2867zm-1558 -456c-229,0 -224,345 0,345 669,0 1337,0 2005,0 230,0 225,-345 0,-345 -668,0 -1336,0 -2005,0zm1730 -457l-1454 0c-229,0 -224,345 0,345l1454 0c229,0 224,-345 0,-345zm-2064 -1862l544 1751c529,0 1057,0 1586,0l544 -1751c-892,0 -1783,0 -2674,0zm1085 -567l504 0c-126,-247 -163,-526 -177,-800 273,15 553,52 800,177l0 -504c-247,126 -527,163 -800,177 14,-273 51,-552 177,-799 -168,0 -336,0 -504,0 125,247 162,526 177,799 -274,-14 -553,-51 -800,-177l0 504c247,-125 527,-162 800,-177 -15,274 -52,553 -177,800zm969 111l-1434 0c-230,0 -225,345 0,345l1434 0c230,0 225,-345 0,-345zm-717 -2175c-105,0 -175,109 -133,204l266 0c42,-96 -30,-205 -133,-204z\"\n      })\n    })\n  })\n};\n\nfunction ErrorBoundary({\n  children\n}) {\n  try {\n    return children;\n  } catch (error) {\n    return /*#__PURE__*/jsx(WhiteKing, {\n      showError: true\n    });\n  }\n}\nfunction WhiteKing({\n  showError = false\n}) {\n  return /*#__PURE__*/jsxs(\"div\", {\n    style: container,\n    children: [/*#__PURE__*/jsx(\"div\", {\n      style: whiteKingStyle,\n      children: errorImage.whiteKing\n    }), showError && /*#__PURE__*/jsx(\"h1\", {\n      children: \"Something went wrong\"\n    })]\n  });\n}\nconst container = {\n  display: 'flex',\n  justifyContent: 'center',\n  alignItems: 'center',\n  flexDirection: 'column'\n};\nconst whiteKingStyle = {\n  width: 250,\n  height: 250,\n  transform: 'rotate(90deg)'\n};\n\nfunction Board() {\n  const boardRef = useRef();\n  const [squares, setSquares] = useState({});\n  const {\n    arrows,\n    boardOrientation,\n    boardWidth,\n    clearCurrentRightClickDown,\n    customArrowColor,\n    showBoardNotation,\n    currentPosition,\n    premoves\n  } = useChessboard();\n  useEffect(() => {\n    function handleClickOutside(event) {\n      if (boardRef.current && !boardRef.current.contains(event.target)) {\n        clearCurrentRightClickDown();\n      }\n    }\n\n    document.addEventListener('mouseup', handleClickOutside);\n    return () => {\n      document.removeEventListener('mouseup', handleClickOutside);\n    };\n  }, []);\n  return boardWidth ? /*#__PURE__*/jsxs(\"div\", {\n    ref: boardRef,\n    style: {\n      position: 'relative'\n    },\n    children: [/*#__PURE__*/jsx(Squares, {\n      children: ({\n        square,\n        squareColor,\n        col,\n        row\n      }) => {\n        const squareHasPremove = premoves.find(p => p.sourceSq === square || p.targetSq === square);\n        const squareHasPremoveTarget = premoves.find(p => p.targetSq === square);\n        return /*#__PURE__*/jsxs(Square, {\n          square: square,\n          squareColor: squareColor,\n          setSquares: setSquares,\n          squareHasPremove: squareHasPremove,\n          children: [currentPosition[square] && /*#__PURE__*/jsx(Piece, {\n            piece: currentPosition[square],\n            square: square,\n            squares: squares\n          }), squareHasPremoveTarget && /*#__PURE__*/jsx(Piece, {\n            isPremovedPiece: true,\n            piece: squareHasPremoveTarget.piece,\n            square: square,\n            squares: squares\n          }), showBoardNotation && /*#__PURE__*/jsx(Notation, {\n            row: row,\n            col: col\n          })]\n        }, `${col}${row}`);\n      }\n    }), /*#__PURE__*/jsx(\"svg\", {\n      width: boardWidth,\n      height: boardWidth,\n      style: {\n        position: 'absolute',\n        top: '0',\n        left: '0',\n        pointerEvents: 'none',\n        zIndex: '10'\n      },\n      children: arrows.map(arrow => {\n        const from = getRelativeCoords(boardOrientation, boardWidth, arrow[0]);\n        const to = getRelativeCoords(boardOrientation, boardWidth, arrow[1]);\n        return /*#__PURE__*/jsxs(Fragment$1, {\n          children: [/*#__PURE__*/jsx(\"defs\", {\n            children: /*#__PURE__*/jsx(\"marker\", {\n              id: \"arrowhead\",\n              markerWidth: \"2\",\n              markerHeight: \"2.5\",\n              refX: \"1.25\",\n              refY: \"1.25\",\n              orient: \"auto\",\n              children: /*#__PURE__*/jsx(\"polygon\", {\n                points: \"0 0, 2 1.25, 0 2.5\",\n                style: {\n                  fill: customArrowColor\n                }\n              })\n            })\n          }), /*#__PURE__*/jsx(\"line\", {\n            x1: from.x,\n            y1: from.y,\n            x2: to.x,\n            y2: to.y,\n            style: {\n              stroke: customArrowColor,\n              strokeWidth: boardWidth / 36\n            },\n            markerEnd: \"url(#arrowhead)\"\n          })]\n        }, `${arrow[0]}-${arrow[1]}`);\n      })\n    })]\n  }) : /*#__PURE__*/jsx(WhiteKing, {});\n}\n\nfunction CustomDragLayer() {\n  const {\n    boardWidth,\n    chessPieces,\n    id,\n    snapToCursor\n  } = useChessboard();\n  const collectedProps = useDragLayer(monitor => ({\n    item: monitor.getItem(),\n    clientOffset: monitor.getClientOffset(),\n    sourceClientOffset: monitor.getSourceClientOffset(),\n    isDragging: monitor.isDragging()\n  }));\n  const {\n    isDragging,\n    item,\n    clientOffset,\n    sourceClientOffset\n  } = collectedProps;\n  const layerStyles = {\n    position: 'fixed',\n    pointerEvents: 'none',\n    zIndex: 10,\n    left: 0,\n    top: 0\n  };\n  const getItemStyle = useCallback((clientOffset, sourceClientOffset) => {\n    if (!clientOffset || !sourceClientOffset) return {\n      display: 'none'\n    };\n    let {\n      x,\n      y\n    } = snapToCursor ? clientOffset : sourceClientOffset;\n\n    if (snapToCursor) {\n      const halfSquareWidth = boardWidth / 8 / 2;\n      x -= halfSquareWidth;\n      y -= halfSquareWidth;\n    }\n\n    const transform = `translate(${x}px, ${y}px)`;\n    return {\n      transform,\n      WebkitTransform: transform,\n      touchAction: 'none'\n    };\n  }, [boardWidth, snapToCursor]);\n  return isDragging && item.id === id ? /*#__PURE__*/jsx(\"div\", {\n    style: layerStyles,\n    children: /*#__PURE__*/jsx(\"div\", {\n      style: getItemStyle(clientOffset, sourceClientOffset),\n      children: typeof chessPieces[item.piece] === 'function' ? chessPieces[item.piece]({\n        squareWidth: boardWidth / 8,\n        isDragging: true\n      }) : /*#__PURE__*/jsx(\"svg\", {\n        viewBox: '1 1 43 43',\n        width: boardWidth / 8,\n        height: boardWidth / 8,\n        children: /*#__PURE__*/jsx(\"g\", {\n          children: chessPieces[item.piece]\n        })\n      })\n    })\n  }) : null;\n}\n\nconst Chessboard = /*#__PURE__*/forwardRef((props, ref) => {\n  const [backendSet, setBackendSet] = useState(false);\n  const [isMobile, setIsMobile] = useState(false);\n  const {\n    customDndBackend,\n    customDndBackendOptions,\n    ...otherProps\n  } = props;\n  useEffect(() => {\n    setIsMobile('ontouchstart' in window);\n    setBackendSet(true);\n  }, []);\n  const backend = customDndBackend || (isMobile ? TouchBackend : HTML5Backend);\n  return backendSet && /*#__PURE__*/jsx(ErrorBoundary, {\n    children: /*#__PURE__*/jsx(DndProvider, {\n      backend: backend,\n      children: /*#__PURE__*/jsxs(ChessboardProvider, {\n        ref: ref,\n        ...otherProps,\n        children: [/*#__PURE__*/jsx(CustomDragLayer, {}), /*#__PURE__*/jsx(Board, {})]\n      })\n    })\n  });\n});\nChessboard.defaultProps = chessboardDefaultProps;\n\nexport { Chessboard };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}